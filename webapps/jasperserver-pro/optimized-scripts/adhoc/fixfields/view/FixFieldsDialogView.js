define(["require","underscore","jquery","common/component/dialog/Dialog","components/scalableList/view/ScalableList","bundle!adhoc_messages","text!adhoc/fixfields/template/fixFieldsDialogTemplate.htm","text!adhoc/fixfields/template/missingFieldItemsTemplate.htm"],function(e){"use strict";var t=e("underscore"),i=e("jquery"),n=e("common/component/dialog/Dialog"),l=e("components/scalableList/view/ScalableList"),s=e("bundle!adhoc_messages"),a=e("text!adhoc/fixfields/template/fixFieldsDialogTemplate.htm"),o=e("text!adhoc/fixfields/template/missingFieldItemsTemplate.htm"),d="embeddedDesigner";return n.extend({defaultTemplate:a,constructor:function(e){e||(e={}),t.defaults(e,{title:s["adhoc.inuse.dialog.title"],modal:!0,resizable:!0,buttons:[{label:s["adhoc.inuse.remove.items.button.label"],action:"apply",primary:!0},{label:s.ADH_010_BUTTON_CANCEL,action:"cancel",primary:!1}]}),this.isEmbeddedDesigner=this._getParameterByName(d),n.call(this,e);var i=this;this.on("button:apply",t.bind(this._onOKClick,i)),this.on("button:cancel",t.bind(this._onCancelClick,i)),this.fieldList=new l({getData:this._missingFieldDataProvider,itemsTemplate:o,el:this.$el.find(".jr-mListbox-list")})},el:function(){return this.template({title:this.title,additionalCssClasses:this.additionalCssClasses,fields:this.missingFields,bodyInstructions:s["adhoc.inuse.body.instructions"]})},_missingFieldDataProvider:function(e){var n=document.getElementById("missingFieldBuffer"),l=t.filter(t.map(n.innerHTML.split("<br>"),function(e){return{fieldName:t.trim(e)}}),function(e){return""!==e.fieldName});t.defaults(e,{limit:n.length,offset:0});var s=new i.Deferred,a=Math.min(l.length,e.limit),o=[];return e.offset<l.length&&(o=l.slice(e.offset,e.offset+a)),s.resolve({data:o,total:l.length}),s.promise()},_getParameterByName:function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))},_onOKClick:function(){var e=this._getParameterByName("decorate");document.location="flow.html?_flowId=adhocFlow&_flowExecutionKey="+flowExecutionKey+"&embeddedDesigner="+window.isEmbeddedDesigner+"&decorate="+e+"&_eventId=fixAndInit"},_onCancelClick:function(){this.close(),window.isEmbeddedDesigner&&-1===document.referrer.indexOf("login.html")?i(document).trigger("adhocDesigner:cancel"):(this.close(),window.history.back())}})});