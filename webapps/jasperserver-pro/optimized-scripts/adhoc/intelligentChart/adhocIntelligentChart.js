define(["require","exports","module","jquery","underscore","xssUtil","bundle!all","highcharts","adhoc/api/chart/adhocToHighchartsAdapter","adhoc/api/chart/adhocToHighchartsAdapter/adhocDataProcessor","adhoc/api/chart/adhocToHighchartsAdapter/highchartsDataMapper","adhoc/intelligentChart/formattingDialog/model/FormattingDialogModel","adhoc/intelligentChart/formattingDialog/view/FormattingDialogView","logger","jquery.ui","prototype","utils.common","designer.base"],function(e,t,r){"use strict";var a=e("jquery"),n=e("underscore"),i=e("xssUtil"),s=e("bundle!all"),o=e("highcharts"),l=e("adhoc/api/chart/adhocToHighchartsAdapter"),c=e("adhoc/api/chart/adhocToHighchartsAdapter/adhocDataProcessor"),d=e("adhoc/api/chart/adhocToHighchartsAdapter/highchartsDataMapper"),u=e("adhoc/intelligentChart/formattingDialog/model/FormattingDialogModel"),h=e("adhoc/intelligentChart/formattingDialog/view/FormattingDialogView"),m=e("logger").register(r);e("jquery.ui"),e("prototype"),e("utils.common"),e("designer.base");var p={},g=p;return n.extend(g,{debug:!1,mode:null,controller:"ich",state:{},cache:[],initd:!1,hasAllData:!1,groupLevel:{column:0,row:0},firstRendering:!0,chartContainerSelector:"#chartContainer",reset:function(){g.isDesignerInitialized=!1},setMode:function(e){this.mode=e},getMode:function(){return this.mode},flush:function(){this.hasAllData=!1,this.cache=[]},setUp:function(){},isOLAP:function(){return this.getMode()===designerBase.OLAP_ICHART},isOlapMode:function(){return this.getMode()===designerBase.OLAP_ICHART},isNonOlapMode:function(){return this.getMode()===designerBase.ICHART},update:function(e){try{g.setUp(),n.extend(this.state,e)}catch(t){g.debug&&console.log("AIC.update:   caught error "+t+" restore state to previous"),adhocDesigner.undo(),dialogs.systemConfirm.show("The previous request encountered an error '"+t+"' restoring chart to previous state")}return this},render:function(){var e=g.state.queryData.data.length>0,t=g.state.unresolvedReferences&&g.state.unresolvedReferences.length>0,r=t?adhocDesigner.getMissingFieldsCanvasMessage(g.state):adhocDesigner.getMessage("ADH_1214_ICHARTS_NO_DATA");return a("#nothingToDisplayMessage").html(r),adhocDesigner.setNothingToDisplayVisibility(!e||t),g.chart&&g.state.isRedrawRequired===!0&&(g.chart.destroy(),g.chart=void 0),g.ui.update(g.state),g.ui.render(),e=g.renderChart(e),g.isDesignerInitialized=!0,a("[action='chart-format']").removeClass("disabled"),e},checkChartDataOnClientSide:function(){if(g.state.queryData.metadata.canRender){var e=g.state.queryData.metadata,t=1===e.measureAxis?0:1,r=1===e.measureAxis?1:0,a=g.state.chartState.chartType,n=e.measures.length,i=e.axes[t].length,s=e.axes[r].length,o=0===e.measureAxis?"row":"column",l=(1===e.measureAxis?"row":"column",!0),c="olap_ichart"===g.state.viewType;"dual_measure_tree_map"===a?(l="column"===o&&2===n&&1===i&&!c,l=l&&1===s):"tree_map"===a?(l="column"===o&&1===n&&i>=1&&!c,l=l&&1===s):"one_parent_tree_map"===a&&(l="column"===o&&1===n&&i>=2&&!c,l=l&&1===s),l||(g.state.queryData.metadata.canRender=l)}},renderChart:function(e){if(!g.firstRendering&&g.state.queryData.data.length){g.debug&&console.info(g.state),this.checkChartDataOnClientSide();var t;if(g.state.queryData.metadata.canRender===!1){var r=g.state.chartState.chartType;t=g._isTimeSeries()&&!d.isHeatMapTimeSeriesChart(r)?adhocDesigner.getMessage("ADH_1214_ICHARTS_NO_TIME_SERIES_DATA"):d.isDualOrMultiAxisChart(r)||d.isScatterChart(r)||d.isBubbleChart(r)?adhocDesigner.messages["ADH_1214_ICHARTS_NO_DATA_"+r.toUpperCase()]:d.isDualLevelPieChart(r)?adhocDesigner.messages.ADH_1214_ICHARTS_NO_DATA_DUAL_LEVEL_PIE:d.isHeatMapChart(r)&&!adhocDesigner.isOlapMode()?adhocDesigner.messages.ADH_1214_ICHARTS_NO_DATA_HEAT_MAP_NON_OLAP:d.isHeatMapChart(r)&&adhocDesigner.isOlapMode()?adhocDesigner.messages.ADH_1214_ICHARTS_NO_DATA_HEAT_MAP_OLAP:d.isHeatMapTimeSeriesChart(r)?adhocDesigner.messages.ADH_1214_ICHARTS_NO_DATA_TIME_SERIES_HEAT_MAP:d.isDualMeasureTreeMapChart(r)?s.ADH_1214_ICHARTS_NO_DATA_DUAL_MEASURE_TREE_MAP:d.isTreeMapChart(r)?s.ADH_1214_ICHARTS_NO_DATA_TREE_MAP:d.isOneParentTreeMapChart(r)?s.ADH_1214_ICHARTS_NO_DATA_ONE_PARENT_TREE_MAP:"Unknown chart type group.",a("#nothingToDisplayMessage").text(t),adhocDesigner.setNothingToDisplayVisibility(!0),g.chart&&(g.chart.destroy(),g.chart=void 0)}else{var u=a(g.chartContainerSelector);g.ichWidth=u.width(),g.ichHeight=u.height();var h=l.generateOptions(g.state.queryData,g.state.chartState,{width:g.ichWidth,height:g.ichHeight,messages:adhocDesigner.messages});if(g._checkHasData(h)){if(e=!0,g.state.isRedrawRequired===!0||!g.chart){g._setAutoScaleFonts();try{g.chart=new o.Chart(h)}catch(p){m.error(p),t=/\#12/.test(p)?s.ADH_1214_ICHARTS_ERROR_12:/\#13/.test(p)?s.ADH_1214_ICHARTS_ERROR_13:/\#14/.test(p)?s.ADH_1214_ICHARTS_ERROR_14:/\#15/.test(p)?s.ADH_1214_ICHARTS_ERROR_15:/\#16/.test(p)?s.ADH_1214_ICHARTS_ERROR_16:/\#17/.test(p)?s.ADH_1214_ICHARTS_ERROR_17:/\#18/.test(p)?s.ADH_1214_ICHARTS_ERROR_18:/\#19/.test(p)?adhocDesigner.messages.ADH_1214_ICHARTS_ERROR_TOO_MANY_VALUES:/\#20/.test(p)?s.ADH_1214_ICHARTS_ERROR_20:/\#21/.test(p)?s.ADH_1214_ICHARTS_ERROR_21:/\#22/.test(p)?s.ADH_1214_ICHARTS_ERROR_22:/\#23/.test(p)?s.ADH_1214_ICHARTS_ERROR_23:adhocDesigner.messages.ADH_1214_ICHARTS_ERROR_UNCAUGHT,n.each(o.charts,function(e){e&&e.destroy()}),g.state.canSave=!1,adhocDesigner.enableRunAndSave(!1),a("#nothingToDisplayMessage").text(t),adhocDesigner.setNothingToDisplayVisibility(!0),g.chart&&(g.chart.destroy(),g.chart=void 0),e=!1}}}else e=!1,a("#nothingToDisplayMessage").html(i.escape(adhocDesigner.getMessage("ADH_1214_ICHARTS_NO_CHART_DATA"),{softHTMLEscape:!0})),adhocDesigner.setNothingToDisplayVisibility(!e);g.isOLAP()&&(g.state.olapDimensionInfo=c.getOLAPDimensionInfo()),isDesignView&&g._renderDataLevelSelector()}}return e},redraw:function(){var e=a(g.chartContainerSelector);if(g.ichWidth!=e.width()||g.ichHeight!=e.height()){var t=g.ichHeight==e.height();g.ichWidth=e.width(),g.ichHeight=e.height(),g._setAutoScaleFonts()?g.render():g.chart.setSize(g.ichWidth,g.ichHeight,t)}},_setAutoScaleFonts:function(){var e=a(g.chartContainerSelector);if(!g.state.chartState.autoScaleFonts)return"undefined"!=typeof g.autoScaleFontsSize&&e.css("font-size",g.autoScaleFontsSize),!1;"undefined"==typeof g.autoScaleFontsSize&&(g.autoScaleFontsSize=parseInt(e.css("font-size")));var t=1;return g.ichWidth<=100?t=.4:g.ichWidth>100&&g.ichWidth<=200?t=.5:g.ichWidth>200&&g.ichWidth<=300?t=.6:g.ichWidth>300&&g.ichWidth<=400?t=.7:g.ichWidth>400&&g.ichWidth<=500?t=.8:g.ichWidth>500&&g.ichWidth<=600&&(t=.9),parseInt(e.css("font-size"))!==Math.round(g.autoScaleFontsSize*t)?(e.css("font-size",g.autoScaleFontsSize*t),!0):!1},_isTimeSeries:function(){return-1!=g.state.chartState.chartType.indexOf("time_series")},_isDualMeasureTreeMap:function(){return-1!=g.state.chartState.chartType.indexOf("dual_measure_tree_map")},_isTimeSeriesHeatMap:function(){return d.isHeatMapTimeSeriesChart(g.state.chartState.chartType)},cleanupOnSwitch:function(){g.ui.controls.chartTypeSelector.hide(),g.ui.dialogs.groupSelector.hide()},resize:function(){("pie"==g.state.chartState.chartType||d.isHeatMapTimeSeriesChart(g.state.chartState.chartType))&&g.render()},fixFirstRendering:function(){g.firstRendering&&(g.firstRendering=!1,g.renderChart())},initAll:function(){},_checkHasData:function(e){if(!e)return!1;if(!e.series)return!1;if(e.series.length<=0)return!1;for(var t=!1,r=0;r<e.series.length;r++)if(null!=e.series[r].data&&e.series[r].data.length>0){t=!0;break}return t},_isPivotAllowed:function(){var e=g;return e.getDimensions("row").length>0||e.isOLAP()&&e.getDimensions("column").length>0},_renderDataLevelSelector:function(){var e=g.ui.controls.dataLevelSelector;e.render(),(g._isTimeSeries()||g._isDualMeasureTreeMap())&&e.hideRowsSlider()}}),n.extend(g,{serviceBus:{_listenersMap:{},_allEventsListeners:[],_incorrectEventTypeMsg:"Service bus supports only string events. Received event is not a string.",fireEvent:function(e){var t=g.serviceBus;if("string"!=typeof e)throw t._incorrectEventTypeMsg;var r=t._listenersMap,a=r[e];a&&n.each(a,function(t){t(e)}),n.each(t._allEventsListeners,function(t){t(e)})},registerListener:function(e,t){var r=g.serviceBus;if("string"!=typeof e)throw r._incorrectEventTypeMsg;var a=r._listenersMap,n=a[e];n||(n=[],a[e]=n),n.push(t)},registerAllEventsListener:function(e){g.serviceBus._allEventsListeners.push(e)}}}),n.extend(g,{mediator:{_isListenerRegistered:!1,eventToAction:{"chart:typeChanged":function(){g.state.chartState.chartType=g.ui.controls.chartTypeSelector.getType(),g.updateChartState()},"chart:levelChanged":function(){g.state.chartState.columnsSelectedLevels=g.ui.controls.dataLevelSelector.getColumnSelectedLevels(),g.state.chartState.rowsSelectedLevels=g.ui.controls.dataLevelSelector.getRowsSelectedLevels(),g.updateChartState()}},listener:function(e){if("string"!=typeof e)throw"Mediator supports only string events. Received event is not a string.";var t=g.mediator.eventToAction[e];t&&t()},register:function(){g.serviceBus._isListenerRegistered||(g.serviceBus.registerAllEventsListener(g.mediator.listener),g.serviceBus._isListenerRegistered=!0)}}}),n.extend(g,{ui:{controls:{dataLevelSelector:{_container:null,_column:null,_row:null,init:function(){var e=g.ui.controls.dataLevelSelector;e._container=a("#dataLevelSelector")},render:function(){if(d.isDualLevelPieChart(g.state.chartState.chartType))return void g.ui.controls.dataLevelSelector.hide();var e=g.ui.controls.dataLevelSelector;g.ui.selectorTables.column.show().find("td.select-header").parent().siblings().remove(),g.ui.selectorTables.row.show().find("td.select-header").parent().siblings().remove(),g.isOLAP()?e._renderOlapSlider():e._renderNonOlapSliders(),adhocDesigner.resetFilterPanelState()},_renderOlapSlider:function(){var e=g.ui.controls.dataLevelSelector;e._column=[],e._row=[],a.each(["row","column"],function(t,r){g.state.olapDimensionInfo[t].length?(a.each(g.state.olapDimensionInfo[t],function(t,a){var n=g.state.chartState[r+"sSelectedLevels"][t];e["_"+r].push(g.ui.create.slider(g.ui.selectorTables[r],a.levels,a.dimension,{max:a.levels.length-1,value:e._levelToLevelPosition(n,a),stop:function(e,t){g.serviceBus.fireEvent("chart:levelChanged")}}))}),g.ui.selectorTables[r].show()):g.ui.selectorTables[r].hide()})},_renderNonOlapSliders:function(){var e=g.ui.controls.dataLevelSelector;e._row=e._renderNonOlapSlider(0),e._column=e._renderNonOlapSlider(1)},_renderNonOlapSlider:function(e){var t=g.ui.controls.dataLevelSelector,r=[];a.each(g.state.queryData.metadata.axes[e],function(e,t){"Measures"!=t.name&&r.push(t.label)});var n=0===e?g.ui.selectorTables.row:g.ui.selectorTables.column,i=0===e?c.getRowSliderLevelCount():c.getColumnSliderLevelCount(),s=0===e?g.state.chartState.rowsSelectedLevels:g.state.chartState.columnsSelectedLevels;return n.find("td.select-header").parent().siblings().remove(),1==i?n.hide():n.show(),g.ui.create.slider(n,r,"",{max:i-1,value:t._getSliderPositionForNonOlap(s,e),stop:function(e,t){g.serviceBus.fireEvent("chart:levelChanged")}})},hide:function(){g.ui.selectorTables.column.hide(),g.ui.selectorTables.row.hide()},hideRowsSlider:function(){g.ui.selectorTables.row.hide()},hideColumnsSlider:function(){g.ui.selectorTables.column.hide()},_levelToLevelPosition:function(e,t){for(var r=0;r<t.levels.length;r++)if(t.levels[r].levelName===e.name)return r;throw"No OLAP level info found for specified level = "+e},getRowsSelectedLevels:function(){var e=g.ui.controls.dataLevelSelector;return e._getSelectedLevels(e._row,e._row,0)},getColumnSelectedLevels:function(){var e=g.ui.controls.dataLevelSelector;return e._getSelectedLevels(e._column,e._column,1)},_getSelectedLevels:function(e,t,r){var a=g.ui.controls.dataLevelSelector;return g.isOLAP()?a._extractOlapSelectedLevels(t,r):a._extractNonOlapSelectedLevels(e,r)},_extractOlapSelectedLevels:function(e,t){var r=g.ui.controls.dataLevelSelector,n=[];return a(e).each(function(e){var s=r._extractSliderPosition(a(this)),o=g.state.olapDimensionInfo[t][e],l=o.levels[s];n.push({name:i.unescape(l.levelName),label:i.unescape(l.label),dimension:o.dimension})}),n},_extractNonOlapSelectedLevels:function(e,t){var r=g.ui.controls.dataLevelSelector,a=r._extractSliderPosition(e);if(0===a)return[];var n=c.getLevelsWithoutMeasures(g.state.queryData.metadata.axes[t]);return[n[a-1]]},_getSliderPositionForNonOlap:function(e,t){if(0===e.length)return 0;var r=c.getLevelsWithoutMeasures(g.state.queryData.metadata.axes[t]);return c.getLevelIndex(r,e[0])+1},_extractSliderPosition:function(e){return e.slider("option","value")},dock:function(){var e=g.ui.controls.dataLevelSelector;e._container.find("div.pod-body").eq(0).appendTo(a("#level-container")),dialogs.popup.hide(e._container[0])},undock:function(){var e=g.ui.controls.dataLevelSelector;a("#level-container").children("div.pod-body").eq(0).appendTo(e._container.find("div.body").eq(0)),dialogs.popup.show(e._container[0])}},chartTypeSelector:{_type:null,_container:null,_DISABLED_CLASS:"disabled",_patternsDisabledForOlap:["[name$='_time_series']","[name$='tree_map']"],init:function(){var e=g.ui.controls.chartTypeSelector;if(e._container=a("#chartTypeSelector"),e._container.on("click","div.cell",e._typeSelectedHandler),g.isOLAP())for(var t=0;t<e._patternsDisabledForOlap.length;t++)a(e._patternsDisabledForOlap[t]).addClass(e._DISABLED_CLASS)},update:function(e){var t=g.ui.controls.chartTypeSelector;t._type=e},render:function(){var e=g.ui.controls.chartTypeSelector;e._container.find("div.cell").removeClass("selected"),e._container.find('div.cell[name="'+e._type+'"]').eq(0).addClass("selected")},hide:function(){var e=g.ui.controls.chartTypeSelector;dialogs.popup.hide(e._container[0])},_typeSelectedHandler:function(){var e=g.ui.controls.chartTypeSelector;a(this).hasClass(e._DISABLED_CLASS)||(e._type=this.getAttribute("name"),e.render(),g.serviceBus.fireEvent("chart:typeChanged"))},getType:function(){var e=g.ui.controls.chartTypeSelector;return e._type}}},update:function(e){g.ui.controls.chartTypeSelector.update(e.chartState.chartType)},render:function(){var e=a("#titleCaption");g.state.titleBarShowing?e.show():e.hide(),e.text(g.state.title),adhocDesigner.enableXtabPivot(g._isPivotAllowed()),g.ui.controls.chartTypeSelector.render(),g.ui.dialogs.formatDialog.model.set(g.state.chartState),g.ui.controls.dataLevelSelector.hide()},create:{sliderTable:function(e){var t=a("#level-container").show().children(".pod-body").eq(0),r=Mustache.to_html(a("#levelSelectorTemplate").html(),{id:(e?"row":"column")+"LevelSelector",colspan:g.isOLAP()?2:1,name:e?layoutManagerLabels.row[g.mode]:layoutManagerLabels.column[g.mode]}),n=a(r).appendTo(t);return n.on("mouseover","div.tickOverlay",function(e){var t=a(this).parent();g.dataLevelTooltip.text(t.attr("level-name")),g.dataLevelTooltip.show().position({of:t,at:"center top",my:"center bottom",offset:"0 -6",collision:"fit"}),"block"==g.ui.selectorTables.column.css("display")&&g.ui.selectorTables.column.hide().show(),"block"==g.ui.selectorTables.row.css("display")&&g.ui.selectorTables.row.hide().show()}),n.on("mouseover","a.ui-slider-handle",function(e){var t=a(this).parent(),r=t.children("div.sliderTick").eq(t.slider("option","value"));g.dataLevelTooltip.text(r.attr("level-name")),g.dataLevelTooltip.show().position({of:r,at:"center top",my:"center bottom",offset:"0 -6",collision:"fit"}),"block"==g.ui.selectorTables.column.css("display")&&g.ui.selectorTables.column.hide().show(),"block"==g.ui.selectorTables.row.css("display")&&g.ui.selectorTables.row.hide().show()}),n.on("mouseout","a.ui-slider-handle, div.tickOverlay",function(e){g.dataLevelTooltip.hide(),"block"==g.ui.selectorTables.column.css("display")&&g.ui.selectorTables.column.hide().show(),"block"==g.ui.selectorTables.row.css("display")&&g.ui.selectorTables.row.hide().show()}),n},slider:function(e,t,r,n){var s={label:g.isOLAP()?{name:r}:!1,marginLeft:g.isOLAP()?"24px":0};e.find("tbody").eq(0).append(Mustache.to_html(a("#dataLevelSelectorTemplate").html(),s));var o=e.find("div.jrs-slider").last();o.slider({value:n.value,min:0,max:n.max,step:1,range:"min",stop:n.stop,slide:function(e,t){var r=a(t.handle).parent().children("div.sliderTick").eq(t.value);g.dataLevelTooltip.text(r.attr("level-name")),g.dataLevelTooltip.show().position({of:r,at:"center top",my:"center bottom",offset:"0 -6",collision:"fit"}),"block"==g.ui.selectorTables.column.css("display")&&g.ui.selectorTables.column.hide().show(),"block"==g.ui.selectorTables.row.css("display")&&g.ui.selectorTables.row.hide().show()}});var l=n.max>0?100/n.max:0;g.isOLAP()||(t.unshift("All"),n.max++);for(var c=0;c<n.max+1;c++)if(t[c]){var s={label:t[c].label||t[c],width:c*l};"All"==s.label&&(s.label="Total"),s.label=i.unescape(s.label);var d=Mustache.to_html(a("#sliderTickTemplate").html(),s);o.append(d)}return o}}},init:function(e){if(g.mediator.register(),g.dataLevelTooltip=a("#dataLevelTooltip"),a("#chartOptions").appendTo(adhocDesigner.ui.canvas).show(),a("#chartMenu").appendTo(adhocDesigner.ui.canvas),a(Mustache.to_html(a("#titleCaptionTemplate").html()),{}).appendTo(adhocDesigner.ui.canvas).show(),a("#chartContainer").appendTo(adhocDesigner.ui.canvas).show(),!g.initd&&(a("#chartOptions").on("mouseenter",function(){a(this).addClass("over"),a("#chartMenu").show().position({of:a("#chartOptions"),at:"left bottom",my:"left top",offset:"0 -1"})}),a("#chartMenu").on("mouseleave",function(){a("#chartOptions").removeClass("over"),a("#chartMenu").hide()}),a("#chartMenu").on("mouseenter","p.wrap",function(){a(this).addClass("over")}),a("#chartMenu").on("mouseleave","p.wrap",function(){a(this).removeClass("over")}),a("#chartMenu").on("click","li",function(){if(a(this).is('[action="chart-types"]'))dialogs.popup.show(g.ui.dialogs.typeSelector[0]),g.ui.controls.chartTypeSelector.render();else if(a(this).is('[action="chart-format"]')){if(a(this).hasClass("disabled"))return;g.ui.dialogs.formatDialog.model.set(g.state.chartState),dialogs.popup.show(g.ui.dialogs.formatDialog.el),adhocDesigner.initEnableBrowserSelection($("designer"))}}),a("#chartTypeSelector .closeIcon").on(isIPad()?"touchstart":"click",function(){g.ui.dialogs.typeSelector.hide()}),a("#dataLevelSelector .closeIcon").on(isIPad()?"touchstart":"click",function(){g.ui.dialogs.groupSelector.hide()}),g.ui.dialogs={typeSelector:a("#chartTypeSelector"),groupSelector:a("#dataLevelSelector")},g.ui.selectorTables={column:g.ui.create.sliderTable(!1),row:g.ui.create.sliderTable(!0)},g.ui.controls.chartTypeSelector.init(),g.ui.controls.dataLevelSelector.init(),!g.ui.dialogs.formatDialog)){var t=new u(g.state.chartState,{parse:!0,updateState:n.bind(g.updateChartState,g)});g.ui.dialogs.formatDialog=new h({model:t})}g.ui.dialogs.typeSelector.hide(),g.ui.dialogs.groupSelector.hide(),a("#level-container").show(),g.initd=!0},hide:function(){a("#chartOptions").appendTo("#highChartsRepo").hide(),a("#chartMenu").appendTo("#highChartsRepo").hide(),a("#titleCaption").remove(),a("#chartContainer").appendTo("#highChartsRepo").hide()}}),n.extend(g,{mouseUpHandler:function(e){},mouseDownHandler:function(e){},mouseOverHandler:function(e){},mouseOutHandler:function(e){},mouseClickHandler:function(e){},treeMenuHandler:function(e){var t,r=e.memo.node;"dimensionsTree"===r.treeId?t=r.isParent()?adhocDesigner.DIMENSION_TREE_DIMENSION_CONTEXT:adhocDesigner.DIMENSION_TREE_LEVEL_CONTEXT:"measuresTree"===r.treeId&&(t=r.isParent()?adhocDesigner.MEASURE_TREE_GROUP_CONTEXT:adhocDesigner.MEASURE_TREE_CONTEXT),adhocDesigner.showDynamicMenu(e.memo.targetEvent,t,null)},lmHandlersMap:{addItems:function(e,t,r){var a=n.uniq(n.map(e,function(e){return e.extra.dimensionId})),i=n.pluck(e,"id"),s=e[0].extra.isMeasure,o=localContext.isOlapMode();g.insertDimensionInAxisWithChild({dim:s?a.slice(0,1):a,axis:r,pos:t,child:o||s?i:null,hierarchyName:e[0].extra.hierarchyName})},measureReorder:function(e,t){g.moveMeasure(e,t)},column:{addItem:function(e,t,r,a,n,i,s){g.insertDimensionInAxisWithChild({dim:e,axis:"column",pos:t,child:localContext.isOlapMode()||n?r:null,measure_pos:a,isMeasure:n,uri:i,hierarchyName:s})},removeItem:function(e,t){e.isMeasure?g.removeMeasure(t):g.hideColumnLevel(e.dimensionId,e.level)},moveItem:function(e,t,r){g.moveDimension(e,"column","column",t,r)},switchItem:function(e,t,r){g.moveDimension(e,"row","column",t,r)},contextMenu:function(e,t){g.selectFromDisplayManager(t.targetEvent,t.extra,designerBase.COLUMN_GROUP_MENU_LEVEL),actionModel.setSelected([t.extra]),g.showMenu(t.targetEvent,"displayManagerColumn")}},row:{addItem:function(e,t,r,a,n,i,s){g.insertDimensionInAxisWithChild({dim:e,axis:"row",pos:t,child:localContext.isOlapMode()||n?r:null,measure_pos:a,isMeasure:n,uri:i,hierarchyName:s})},removeItem:function(e,t){e.isMeasure?g.removeMeasure(t):g.hideRowLevel(e.dimensionId,e.level)},moveItem:function(e,t,r){g.moveDimension(e,"row","row",t,r)},switchItem:function(e,t,r){g.moveDimension(e,"column","row",t,r)},contextMenu:function(e,t){g.selectFromDisplayManager(t.targetEvent,t.extra,designerBase.ROW_GROUP_MENU_LEVEL),actionModel.setSelected([t.extra]),g.showMenu(t.targetEvent,"displayManagerRow")}}}}),n.extend(g,{insertDimensionInAxisWithChild:function(e){e&&(e.dim&&(e.dim=designerBase.encodeParam(e.dim)),e.child&&(e.child=designerBase.encodeParam(e.child)),e.hierarchyName&&(e.hierarchyName=designerBase.encodeParam(e.hierarchyName)),e.uri&&(e.uri=designerBase.encodeParam(e.uri))),g.flush(),designerBase.sendRequest("ich_insertDimensionInAxisWithChild",e,g.standardOpCallback,{bPost:!0})},removeMeasure:function(e){designerBase.sendRequest("ich_removeMeasure",new Array("i="+e),g.standardOpCallback,null)},moveDimension:function(e,t,r,a,n){designerBase.sendRequest("ich_moveDimension",{dim:encodeURIComponent(e),axisFrom:t,axisTo:r,f:a,t:n},g.standardOpCallback,null)},hideRowLevel:function(e,t){designerBase.sendRequest("ich_hideRowLevel",new Array("f="+encodeText(e),"level="+encodeText(t)),g.standardOpCallback,null)},hideColumnLevel:function(e,t){var r=function(r){g.standardOpCallback(r);var a=g.getLevelObject(t,e,"column");a&&a.propertyMap&&"true"==a.propertyMap.lastFilteredLevel&&dialogs.systemConfirm.show(adhocDesigner.getMessage("ADH_CROSSTAB_LAST_FILTERED_LEVEL"),5e3)};designerBase.sendRequest("ich_hideColumnLevel",new Array("f="+encodeText(e),"level="+encodeText(t)),r,null)},expandAllLevels:function(){g.debug&&console.log("AIC.expandAllLevels:  sending expandAll query, this may take some time"),g.cache=[],g.hasAllData=!0,designerBase.sendRequest("ich_expandAllLevels",null,g.standardOpCallback,null)},switchToColumnGroup:function(e){var t=adhocDesigner.getSelectedColumnOrGroup(),r=n.isNumber(e)?e:t.groupIndex;designerBase.sendRequest("ich_switchToColumnGroup",new Array("i="+r),g.standardOpCallback,null)},switchToRowGroup:function(e){var t=adhocDesigner.getSelectedColumnOrGroup(),r=n.isNumber(e)?e:t.groupIndex;designerBase.sendRequest("ich_switchToRowGroup",new Array("i="+r),g.standardOpCallback,null)},moveRowGroup:function(e,t,r){var a=function(e){g.standardOpCallback(e),r&&r()};designerBase.sendRequest("ich_moveRowGroup",new Array("f="+e,"t="+t),a,null)},moveColumnGroup:function(e,t,r){var a=function(e){g.standardOpCallback(e),r&&r()};designerBase.sendRequest("ich_moveColumnGroup",new Array("f="+e,"t="+t),a,null)},moveMeasure:function(e,t){designerBase.sendRequest("ich_moveMeasureByName",["measure="+encodeText(e),"to="+t],g.standardOpCallback,null)},updateChartState:function(e){a.extend(g.state.chartState,e);var t=function(e){if(!e)throw"No response received on save chart state request";g.standardOpCallback(e)};designerBase.sendRequest("ich_updateChartState",["chartState="+encodeURIComponent(Object.toJSON(g.state.chartState))],t,null)},setCategoryForRowGroup:function(e,t){var r=function(e){g.standardOpCallback(e)};designerBase.sendRequest("ich_setRowGroupCategorizer",new Array("cat="+encodeText(e),"i="+t),r,null)},setCategoryForColumnGroup:function(e,t){var r=function(e){g.standardOpCallback(e)};designerBase.sendRequest("ich_setColumnGroupCategorizer",new Array("cat="+encodeText(e),"i="+t),r,null)},setSummaryFunction:function(e,t){designerBase.sendRequest("ich_setSummaryFunction",new Array("f="+encodeText(e),"i="+t),g.standardOpCallback,null)},setSummaryFunctionAndMask:function(e,t,r){designerBase.sendRequest("cr_setSummaryFunctionAndDataMask",new Array("f="+encodeText(e),"m="+encodeText(t),"i="+r),g.standardOpCallback,null)},setSummaryTimeFunction:function(e,t){designerBase.sendRequest("ich_setSummaryTimeFunction",new Array("f="+encodeText(e),"i="+t),g.standardOpCallback,null)},setHideEmptyRows:function(){designerBase.sendRequest("ich_setProperty",new Array("name=hideEmptyRows","value=true"),g.standardOpCallback,null)},setUnhideEmptyRows:function(){designerBase.sendRequest("ich_setProperty",new Array("name=hideEmptyRows","value=false"),g.standardOpCallback,null)},updateViewCallback:function(e){g.standardOpCallback(e)}}),n.extend(g,{canSaveReport:function(){return g.state.canSave},hideEmptyRowsEquals:function(e){return g.state.crosstabState.hideEmptyRows===e},canAddFilter:function(e,t){var r,a;if(localContext.isOlapMode()&&(r=isNotNullORUndefined(e.isMeasure)?e.isMeasure:e.param.extra&&e.param.extra.isMeasure,a=localContext._isAddingFilterDuplicate(e)),r)return t&&t.push(addFilterErrorMessageMeasureAdd),!1;var n=e.param?e.param.extra&&e.param.extra.id:e.level,i=n&&0===n.indexOf(localContext.ALL_LEVEL_NAME);return i?(t&&t.push(addFilterErrorMessageAllLevelAdd),!1):e.isParent&&e.isParent()?(t&&t.push(addFilterErrorMessageGroupAdd),!1):e.param&&localContext.fromSiblingHierarchy(e.param.extra.hierarchyName,e.param.extra.dimensionId)?(t&&t.push(addFilterErrorMessageAnotherHierarchy),!1):adhocDesigner.isSpacerSelected(e)?(t&&t.push(addFilterErrorMessageSpacerAdd),!1):adhocDesigner.isPercentOfParentCalcSelected(e)?(t&&t.push(addFilterErrorMessagePercentOfParentCalcFieldAdd),!1):adhocDesigner.isConstantSelected(e)?(t&&t.push(addFilterErrorMessageConstantAdd),!1):a?(t&&t.push(addFilterErrorMessage),!1):!0},canAddSliceFilter:function(){var e=selObjects.find(function(e){return!e.isSliceable});return selObjects.first()&&!e},_isAddingFilterDuplicate:function(e){var t;return t=e.param?"["+e.param.extra.dimensionId+"].["+e.param.extra.id+"]":"["+e.dimensionId+"].["+e.level+"]",adhocDesigner.filtersController.hasFilterForField(t)},isDateType:function(){return g.isDateTimeType("date")},isTimestampType:function(){return g.isDateTimeType("timestamp")},isTimeType:function(){return g.isDateTimeType("time")},isDateTimeType:function(e){var t=adhocDesigner.getSelectedColumnOrGroup();if(t){var r=g.isGroupSelected(t),a=AdHocCrosstab.getSelectedGroup(t);if(a){var n=a.canReBucket===!0,i=a.type===e;return r&&n&&i}}return!1},isGroupSelected:function(e){return!e.isMeasure},isCurrentDateType:function(e){var t=AdHocCrosstab.getSelectedGroup(adhocDesigner.getSelectedColumnOrGroup());return t?t.categorizerName==e:!1},canMoveUpOrLeft:function(){var e=adhocDesigner.getSelectedColumnOrGroup(),t=g.getSelectedDimensionIndex(e);return t>0},canMoveDownOrRight:function(){var e=adhocDesigner.getSelectedColumnOrGroup(),t=g.getSelectedDimensionIndex(e);return t<g.getDimensions(e.axis).length-1},canAddSiblingLevels:function(){return!0},canSwitchToRow:function(){var e=adhocDesigner.getSelectedColumnOrGroup();return!g.isOLAP()||g.getDimensions(e.axis).length>1},canAddDimensionAsRowGroup:function(){var e=selObjects.first();if(e.hasChilds()||(e=e.parent),g.isOLAP()){if(0===g.getDimensions("column").length)return!1;var t=e.param.id,r=e.param.extra.isHierarchy&&e.param.extra.id,a=g.getLevelsFromDimension(t,"column"),i=g.getLevelsFromDimension(t,"row"),s=localContext.fromSiblingHierarchy(r,t);return 0===a.length&&(e.param.extra.isHierarchy&&s||i.length<e.getChildCount())}var o=dynamicTree.trees[e.getTreeId()],l=adhocDesigner.getAllLeaves(e,o),c=adhocDesigner.getAllLeaves(e,o).collect(function(e){return e.param.extra.id});if(l[0].param.extra.isMeasure){var d=g.getFilteredMeasureList("column");return 0===d.length}var u=n.pluck(g.getFilteredList(),"name");return n.difference(c,u).length>0},canAddDimensionAsColumnGroup:function(){var e=selObjects.first();if(e.hasChilds()||(e=e.parent),g.isOLAP()){var t=e.param.id,r=e.param.extra.isHierarchy&&e.param.extra.id,a=g.getLevelsFromDimension(t,"column"),i=g.getLevelsFromDimension(t,"row"),s=localContext.fromSiblingHierarchy(r,t);return 0===i.length&&(e.param.extra.isHierarchy&&s||a.length<e.getChildCount())}var o=dynamicTree.trees[e.getTreeId()],l=adhocDesigner.getAllLeaves(e,o),c=adhocDesigner.getAllLeaves(e,o).collect(function(e){return e.param.extra.id});if(l[0].param.extra.isMeasure){var d=g.getFilteredMeasureList("row");return 0===d.length}var u=n.pluck(g.getFilteredList(),"name");return n.difference(c,u).length>0},canAddLevelAsColumnGroup:function(){var e=selObjects.first(),t=g.isOLAP()?[e.param.extra.dimensionId]:adhocDesigner.getAllLeaves(e).map(function(e){return e.param.extra.dimensionId}),r=t.inject([],function(e,t){return e.concat(g.getLevelsFromDimension(t,"column")||[])}),a=t.inject([],function(e,t){return e.concat(g.getLevelsFromDimension(t,"row")||[])});return 0===a.length&&(0===r.length||!g.isOLAP()&&(e.param.extra.isMeasure||g.isDateField(e.param.extra))||!r.find(function(e){return n.contains(n.map(designerBase.getSelectedObjects(),function(e){return e.param.extra.id}),e)}))},canAddLevelAsRowGroup:function(){if(0===g.getDimensions("column").length&&g.isOLAP())return!1;var e=selObjects.first(),t=g.isOLAP()?[e.param.extra.dimensionId]:adhocDesigner.getAllLeaves(e).map(function(e){return e.param.extra.dimensionId}),r=t.inject([],function(e,t){return e.concat(g.getLevelsFromDimension(t,"column")||[])}),a=t.inject([],function(e,t){return e.concat(g.getLevelsFromDimension(t,"row")||[])});return e.param.extra?0===r.length&&(0===a.length||!g.isOLAP()&&(e.param.extra.isMeasure||g.isDateField(e.param.extra))||!a.find(function(t){return e.param.extra.id===t})):!1},isRowGroupSelected:function(e){return"row"===e.axis&&!e.isMeasure},isColumnGroupSelected:function(e){return"column"===e.axis&&!e.isMeasure},showAddHierarchyConfirm:function(e,t,r){return g.fromSiblingHierarchy(e,t)?(adhocDesigner.addConfirmDialog.show({ok:function(){return g.isFiltersApplied(t)?void dialogs.systemConfirm.show(adhocDesigner.getMessage("ADH_CROSSTAB_LAST_FILTERED_LEVEL"),5e3):void r()}}),!0):!1},isFiltersApplied:function(e,t){var r=n.pluck(g.getLevelObjectsFromDimension(e,t),"levelUniqueName"),a=n.pluck(g.state.existingFilters,"name");return!n.isEmpty(n.intersection(r,a))},isDateField:function(e){return"Timestamp"===e.type||"Date"===e.type||"Time"===e.type}}),n.extend(g,{removeLevelFromColumn:function(){var e=selObjects.first();a("#"+adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:removeItem",{axis:"column",index:e.index,item:{level:e.level,dimensionId:e.dimensionId,isMeasure:e.isMeasure}})},removeLevelFromRow:function(){var e=selObjects.first();a("#"+adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:removeItem",{axis:"row",index:e.index,item:{level:e.level,dimensionId:e.dimensionId,isMeasure:e.isMeasure}})},moveRowGroupLeft:function(e){var t=adhocDesigner.getSelectedColumnOrGroup(),r=g.getSelectedDimensionIndex(t),a=r-1;g.moveRowGroup(r,a,e)},moveRowGroupRight:function(e){var t=adhocDesigner.getSelectedColumnOrGroup(),r=g.getSelectedDimensionIndex(t),a=r+1;g.moveRowGroup(r,a,e)},moveColumnGroupLeft:function(e){var t=adhocDesigner.getSelectedColumnOrGroup(),r=g.getSelectedDimensionIndex(t),a=r-1;g.moveColumnGroup(r,a,e)},moveColumnGroupRight:function(e){var t=adhocDesigner.getSelectedColumnOrGroup(),r=g.getSelectedDimensionIndex(t),a=r+1;g.moveColumnGroup(r,a,e)},appendDimensionWithLevel:function(e,t){var r=e?g.getAvailableFieldsNodeBySelection(e.id,e.groupId):g.getAvailableFieldsNodeBySelection();r.axis=t,g.showAddHierarchyConfirm(r.hierarchyName,r.dimensionId,function(){a("#"+adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItem",r)})||a("#"+adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItem",r);
},appendDimensionToRowAxisWithLevel:function(e){g.appendDimensionWithLevel(e,"row")},appendDimensionToColumnAxisWithLevel:function(e){g.appendDimensionWithLevel(e,"column")},appendMeasureToRow:function(e){var t=e?g.getAvailableFieldsNodesBySelection(e):g.getAvailableFieldsNodesBySelection();a("#"+adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItems",{axis:"row",levels:t,index:t[0].index})},appendMeasureToColumn:function(e){var t=e?g.getAvailableFieldsNodesBySelection(e):g.getAvailableFieldsNodesBySelection();a("#"+adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItems",{axis:"column",levels:t,index:t[0].index})},showMenu:function(e,t){var r,a=null;switch(t){case"displayManagerRow":r="displayManagerRow",a=g.generateAvailableSummaryCalculationsMenu;break;case"displayManagerColumn":r="displayManagerColumn",a=g.generateAvailableSummaryCalculationsMenu;break;case"groupMember":r=designerBase.MEMBER_GROUP_MENU_LEVEL,a=g.updateContextMenuWithSiblingLevels;break;case"measuresDimensionRow":r="measuresDimensionInRows";break;case"measuresDimensionColumn":r="measuresDimensionInColumns";break;case"rowGroup":r=designerBase.ROW_GROUP_MENU_LEVEL;break;case"columnGroup":r=designerBase.COLUMN_GROUP_MENU_LEVEL;break;case"measureRow":r="measureRow";break;case"measureColumn":r="measureColumn"}adhocDesigner.showDynamicMenu(e,r,null,a)},generateAvailableSummaryCalculationsMenu:function(e,t){if(!actionModel.selObjects[0].isMeasure)return t;var r=n.find(t,function(e){return"AdHocCrosstab.selectedMeasureShowsSummaryOptions"===e.clientTest});if(r){var a=actionModel.selObjects[0],i=n.findWhere(g.state.measures,{name:a.name});i&&adhocDesigner.generateAvailableSummaryCalculationsMenu(i.fieldName,r,{action:p.selectFunction,isSelectedTest:AdHocCrosstab.isSelectedSummaryFunction})}return t},setCatForColumnGroup:function(e){var t=adhocDesigner.getSelectedColumnOrGroup();t&&g.isColumnGroupSelected(t)&&g.setCategoryForColumnGroup(e,t.groupIndex)},setCatForRowGroup:function(e){var t=adhocDesigner.getSelectedColumnOrGroup();t&&g.isRowGroupSelected(t)&&g.setCategoryForRowGroup(e,t.groupIndex)},selectFunction:function(e){var t=AdHocCrosstab.getSelectedMeasure();if(t){var r=selObjects.first().index,a=adhocDesigner.getSuperType(t.type),n=AdHocCrosstab.getMeasureTypeByFunction(e);a!==n?g.setSummaryFunctionAndMask(e,defaultMasks[n],r):g.setSummaryFunction(e,r)}},selectTimeFunction:function(e){var t=AdHocCrosstab.getSelectedMeasure();if(t){var r=selObjects.first().index;adhocDesigner.getSuperType(t.type),AdHocCrosstab.getMeasureTypeByFunction(e);g.setSummaryTimeFunction(e,r)}}}),n.extend(g,{getDimensions:function(e){var t=g.state.crosstabState;return e?t[e+"Groups"]:n.chain(t).filter(function(e,t){return t.search(/Groups$/)>=0}).flatten().value()},getLevelsFromDimension:function(e,t){return n.pluck(this.getLevelObjectsFromDimension(e,t),"name")},getLevelObjectsFromDimension:function(e,t){var r=this.getDimensions(t);return e=n.find(r,function(t){return t.name===e}),e?n.chain(e.levels).filter(function(e){return e.visible}).map(function(e){return n.isEmpty(e.members)?e:e.members}).flatten().filter(function(e){return!e.isSpacer}).value():[]},getLevelObject:function(e,t,r){function a(e,t){return n.find(e,function(e){return e.name==t})}var i=this.getDimensions(r),s=a(i,t);return s?a(s.levels,e):null},getFilteredList:function(e,t){var r=e||null,a=t||{};return 1===arguments.length&&n.isObject(e)&&(a=e,r=null),a.visible=!0,n.chain(g.getDimensions(r)).pluck("levels").flatten().map(function(e){return n.isEmpty(e.members)?e:e.members}).flatten().filter(function(e){return n.all(a,function(t,r){return void 0===e[r]||e[r]===t})}).value()},getFilteredMeasureList:function(e,t){var r=e||null,a=t||{};return 1===arguments.length&&n.isObject(e)&&(a=e,r=null),g.getFilteredList(r,n.extend(a,{measure:!0,measuresLevel:!0}))},fromSiblingHierarchy:function(e,t,r){if(!e)return!1;var a=this.getLevelsFromDimension(t,r);return a.length>0&&-1===a[0].indexOf("["+e+"]")},getHierarchy:function(e){var t=e.param.extra;return e.hasChilds()?(e.getFirstChild().hasChilds()&&(t=e.getFirstChild().param.extra),t&&t.isHierarchy?t.id:void 0):t.hierarchyName},getAvailableFieldsNodeBySelection:function(e,t,r){var a={};if(r||(r=selObjects.first()),selectionCategory.area==designerBase.AVAILABLE_FIELDS_AREA)r.hasChilds()?(a.isMeasure="measuresTree"===r.treeId,a.dimensionId=a.isMeasure?r.treeId:r.param.id,a.uri=localContext.isNonOlapMode()?r.param.uri:void 0,a.level=null):(a.isMeasure=!!r.param.extra.isMeasure,a.level=r.param.extra.dimensionId&&r.param.id,a.dimensionId=r.param.extra.dimensionId||r.param.extra.id),a.hierarchyName=this.getHierarchy(r),a.index=-1;else if(selectionCategory.area==designerBase.ROW_GROUP_MENU_LEVEL||selectionCategory.area==designerBase.COLUMN_GROUP_MENU_LEVEL)if(e||t){var n=/.*\[(.*)\]/.exec(e),i=n&&n[1];a.isMeasure=!t,a.level=e,a.dimensionId=a.isMeasure?adhocDesigner.MEASURES:t,a.index=-1,a.hierarchyName=i}else{if(!r.axis)return void alert("Need a way to get dimension name for clicked level from crosstab");a=r}return a},getAvailableFieldsNodesBySelection:function(e,t){for(var r=[],a=0;a<selObjects.length;a++)r.push(g.getAvailableFieldsNodeBySelection(e,t,selObjects[a])),r[a].extra=r[a],r[a].dimensionId=r[a].dimensionId,r[a].id=r[a].level;return r},updateContextMenuWithSiblingLevels:function(e,t){if(!adhocDesigner.ui.display_manager)return t;var r=t.find(function(e){return"AdHocCrosstab.canAddSiblingLevels"===e.clientTest});if(!r)return t;var a=null,i=null,s=null,o=selObjects[0],l=/.*\[(.*)\]/.exec(o.level),c=l&&l[1];if(selObjects.first().isMeasure)i=adhocDesigner.measuresTree.getRootNode(),s="row"===selObjects.first().axis?"AdHocCrosstab.appendMeasureToRow":"AdHocCrosstab.appendMeasureToColumn";else{if(!g.isOLAP())return selObjects.first().index=0,t;i=adhocDesigner.dimensionsTree.getRootNode().childs.find(function(e){return e.param.extra.id===selObjects.first().dimensionId}),i.childs[0].param.extra.isHierarchy&&(i=n.find(i.childs,function(e){return e.param.extra.id===c})),s="row"===selObjects.first().axis?"AdHocCrosstab.appendDimensionToRowAxisWithLevel":"AdHocCrosstab.appendDimensionToColumnAxisWithLevel"}if(void 0===selObjects.first().allLevels){var d=selObjects.first();d.allLevels=AdHocCrosstab.state.getLevelsFromDimension(selObjects.first().dimensionId,d.axis),d.index=d.allLevels.indexOf(d.level)}return selObjects.first().allLevels&&(a=g.isOLAP()?i.childs.findAll(function(e){return!selObjects.first().allLevels.include(e.param.extra.id)}):adhocDesigner.getAllLeaves(i,adhocDesigner.measuresTree).findAll(function(e){return!selObjects.first().allLevels.include(e.param.extra.id)})),a&&0!==a.length?(r.text=adhocDesigner.getMessage(selObjects.first().isMeasure?"addMeasures":"addLevels"),r.children=a.collect(function(e){return actionModel.createMenuElement("optionAction",{text:e.name,action:s,actionArgs:selObjects.first().isMeasure?[e.param.extra.id]:[{id:e.param.extra.id,groupId:e.param.extra.dimensionId,isMeasure:!1}]})}),t):t},getSelectedDimensionIndex:function(e){var t;if(e){var r=e.isMeasure?adhocDesigner.MEASURES:e.dimensionId;t=-1,n.find(g.getDimensions(e.axis),function(e,a){return e.name===r?(t=a,!0):void 0})}return t}}),n.extend(g,{selectFromDisplayManager:function(e,t,r){designerBase.unSelectAll();var a=adhocDesigner.isMultiSelect(e,r);selectionCategory.area=r;var n=adhocDesigner.isAlreadySelected(t);adhocDesigner.addSelectedObject(e,t,a,n),Event.stop(e)},deselectAllSelectedOverlays:function(){}}),n.extend(g,{standardOpCallback:function(e){e?adhocDesigner.updateStateAndRender(e):window.console&&console.log("Internal server error occurred")}}),a(window).on("resizeEnd",function(){(localContext.getMode()==designerBase.ICHART||localContext.getMode()==designerBase.OLAP_ICHART)&&localContext.resize()}),a("#designer").bind({"rendering:done":function(){(localContext.getMode()==designerBase.ICHART||localContext.getMode()==designerBase.OLAP_ICHART)&&g.fixFirstRendering()}}),window.AdhocIntelligentChart=p,window.AIC=p,p});