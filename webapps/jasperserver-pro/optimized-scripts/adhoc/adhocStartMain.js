define("common/component/panel/trait/collapsiblePanelTrait",["require","underscore","jquery","./abstractPanelTrait"],function(e){"use strict";function t(e,t){!t&&e.stopPropagation(),this.onCollapseControlPressed?this.onCollapseControlPressed(e):this.toggleCollapsedState()}function i(){this.$collapser&&this.$collapser.off("mousedown"),this.$el&&this.$el.find(this.expandOnDblClickSelector).off("dblclick")}var s=e("underscore"),a=e("jquery"),o=e("./abstractPanelTrait");return s.extend({},o,{onConstructor:function(e){this.collapserClass=e.collapserClass||"buttonIconToggle",this.collapserSelector=e.collapserSelector||".buttonIconToggle",this.collapsiblePanelClass=e.collapsiblePanelClass||"collapsiblePanel",this.expandOnDblClickSelector=e.expandOnDblClickSelector||"> p:first",this.allowEventPropagation=!!e.allowMouseDownEventPropagation,this.onCollapseControlPressed=e.onCollapseControlPressed},beforeSetElement:function(){i.call(this)},afterSetElement:function(){this.$el.addClass(this.collapsiblePanelClass),this.$collapser=this.$(this.collapserSelector),this.$collapser.length||(this.$collapser=a("<button></button>").addClass(this.collapserClass),this.$("> .header").prepend(this.$collapser)),this.$collapser.on("mousedown",s.bind(t,this,this.allowEventPropagation)),this.$el.find(this.expandOnDblClickSelector).on("dblclick",s.bind(t,this))},onRemove:function(){i.call(this)}})}),define("common/component/tree/trait/addToSelectionModelTrait",["require","underscore","common/component/list/model/ScalableListModel"],function(e){"use strict";var t=e("underscore"),i=e("common/component/list/model/ScalableListModel");return{afterFetchComplete:function(e,s){i.prototype.afterFetchComplete.apply(this,arguments);var a,o;t.each(e,function(e,t){e.addToSelection&&(e.selected=!0,a=e.value,o=this.get("bufferStartIndex")+t,this.selectionContains&&!this.selectionContains(a,o)&&this.addValueToSelection(a,o),delete e.addToSelection)},this)}}}),define("common/component/tree/plugin/TreePlugin",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.View.extend({dataLayerObtained:function(){},itemsRendered:function(){}},{processors:null,treeInitialized:function(){},treeRemoved:function(){}})}),define("text!common/component/tooltip/template/tooltipTemplate.htm",[],function(){return'<div class="{{- cssClasses }}" style="position: absolute; z-index: 100000;">\n    <div class="content">\n        <div class="body"></div>\n    </div>\n</div>\n'}),define("common/component/tooltip/Tooltip",["require","jquery","underscore","backbone","text!./template/tooltipTemplate.htm"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),s=e("backbone"),a=e("text!./template/tooltipTemplate.htm");return s.View.extend({template:i.template(a),delay:500,offset:{x:10,y:10},attribute:"data-tooltip",cssClasses:"panel info tooltip",contentSelector:".body",triggerEvents:!1,el:function(){return this.template({cssClasses:this.cssClasses})},constructor:function(e){if(e||(e={}),!e.attachTo||0===t(e.attachTo).length)throw new Error("Tooltip should be attached to an element");if(!e.contentTemplate)throw new Error("Tooltip should have contentTemplate");this._shown=!1,this.$attachTo=t(e.attachTo),this.$attachTo[0].tooltip=this,e.delay&&(this.delay=e.delay),e.offset&&(this.offset=e.offset),e.attribute&&(this.attribute=e.attribute),e.cssClasses&&(this.cssClasses=e.cssClasses),this.contentTemplate=e.contentTemplate,this.i18n=e.i18n||{},!i.isUndefined(e.triggerEvents)&&(this.triggerEvents=e.triggerEvents),this.selector="["+this.attribute+"]",i.bindAll(this,"show","_onMouseMove","_onMouseLeave"),this.$attachTo.on("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.on("mouseleave touchend",this.selector,this._onMouseLeave),s.View.prototype.constructor.apply(this,arguments)},_render:function(e,t,a){if(this._event){e=e instanceof s.Model?e.toJSON():e;var o=i.template(this.contentTemplate)({model:e,i18n:this.i18n,options:t||{}});this.$el.find(".body").empty().append(o),this._showTooltip()}a.resolve()},show:function(e,s){var a=new t.Deferred;return this._timer=setTimeout(i.bind(this._render,this,e,s,a),this.delay),a},_showTooltip:function(){t("body").append(this.$el),this._updatePosition(),this._shown=!0,this.triggerEvents&&this.trigger("show",this)},hide:function(){this.contentTemplate&&this._timer&&clearTimeout(this._timer),this.$el.detach(),this._shown=!1,this.triggerEvents&&this.trigger("hide",this)},_updatePosition:function(){var e=this.$el.innerHeight(),i=this.$el.innerWidth(),s=t(window).height(),a=t(window).width(),o=this.offset.y,n=this.offset.x;e+this._event.pageY+this.offset.y+3>=s&&(o=-this.offset.y-e),i+this._event.pageX+this.offset.x+3>=a&&(n=-this.offset.x-i),this.$el.css({top:this._event.pageY+o,left:this._event.pageX+n})},_onMouseMove:function(e){this._event=e},_onMouseLeave:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this._event=null},remove:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this.$attachTo.off("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.off("mouseleave touchend",this.selector,this._onMouseLeave),s.View.prototype.remove.apply(this,arguments)}},{attachTo:function(e,t){var i=this;return t||(t={}),t.attachTo=e||"body",new i(t)},detachFrom:function(e){e=t(e)[0],e.tooltip&&e.tooltip.remove()}})}),define("common/component/tree/plugin/TooltipPlugin",["require","./TreePlugin","underscore","common/component/tooltip/Tooltip"],function(e){"use strict";var t=e("./TreePlugin"),i=e("underscore"),s=e("common/component/tooltip/Tooltip");return t.extend({initialize:function(e){this.tooltip=s.attachTo(e.attachTo,i.omit(e,"el")),this.listensToList=!1,t.prototype.initialize.apply(this,arguments)},itemsRendered:function(e,t){var i=this;this.listensToList||(this.listensToList=!0,this.listenTo(t,"list:item:mouseover",function(e,t){i.tooltip.show(e)}),this.listenTo(t,"list:item:mouseout",function(){i.tooltip.hide()}))},remove:function(){s.detachFrom(this.$el),this.tooltip.remove(),t.prototype.remove.apply(this,arguments)}})}),define("common/component/tree/dataprovider/DataProviderWithSearchCache",["require","underscore","jquery"],function(e){"use strict";var t=e("underscore"),i=e("jquery"),s=999,a=50,o=50,n="criteria",r=2147483647,l=function(e){t.bindAll(this,"getData"),e=e||{},this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.pageSize=e.pageSize||s,this.criteriaKey=e.searchKey||n,this.maxSearchCacheSize=e.maxSearchCacheSize||a,this.getDataByCriteriaHolder={},this.controlGetTotal="undefined"!=typeof e.controlGetTotal?e.controlGetTotal:!1,this.dataConverter=e.dataConverter,this.saveLastCriteria="undefined"!=typeof e.saveLastCriteria?e.saveLastCriteria:!1,this.lastCriteria=null,this.serialRequestsDelay="undefined"!=typeof e.serialRequestsDelay?e.serialRequestsDelay:o,this.serialRequestsDelayedPromise=null,this.request=e.request};return t.extend(l.prototype,{getData:function(e){if(e=e||{},e[this.criteriaKey])return this._getDataByCriteria(e[this.criteriaKey])(e);if("undefined"==typeof e[this.criteriaKey]&&this.saveLastCriteria&&this.lastCriteria)return this._getDataByCriteria(this.lastCriteria)(e);this.lastCriteria=null;var t=i.Deferred(),s=this._getPagesToLoad(e);return s?this._requestData(e,s,t):this._resolveDeferredUsingDataFromCache(t,e),t.promise()},clear:function(){this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.getDataByCriteriaHolder={},this.lastCriteria=null},_requestData:function(e,i,s){var a=(i[i.length-1]-i[0]+1)*this.pageSize,o=t.extend({},e,{offset:i[0]*this.pageSize,limit:a});this.controlGetTotal&&(o.skipGetTotal=!0),a>=r/this.pageSize*this.pageSize&&delete o.limit,this.controlGetTotal&&"number"!=typeof this.dataCacheTotal&&delete o.skipGetTotal,this.serialRequestsDelay>0?(clearTimeout(this.deferredTimeout),this.deferredTimeout=setTimeout(t.bind(this._requestDataDeferred,this,e,o,s),this.serialRequestsDelay)):this._requestDataDeferred(e,o,s)},_requestDataDeferred:function(e,i,s){var a=this._getPagesToLoad(e);a?this.serialRequestsDelayedPromise&&t.isEqual(i,this.serialRequestsDelayedPromise.query)?this.serialRequestsDelayedPromise.promise.done(s.resolve).fail(s.reject):(this.serialRequestsDelayedPromise={promise:s.promise(),query:i},this.request(i).done(t.bind(this._requestDone,this,e,i,s)).fail(s.reject)):this._resolveDeferredUsingDataFromCache(s,e)},_requestDone:function(e,t,i,s){this._putDataToCache(t,s),this.serialRequestsDelayedPromise=null,this._resolveDeferredUsingDataFromCache(i,e)},_resolveDeferredUsingDataFromCache:function(e,t){var i=this._getDataFromCache(t);e.resolve({total:this.dataCacheTotal,data:i})},_getPagesToLoad:function(e){var t,i=this._convertLimitOffsetToFirstLast(e),s=this._findPageIndex(i.first),a=this._findPageIndex(i.last),o=[];for(t=s;a>=t;t++)if(!this.dataCachePages[t]){o.push(t);break}for(t=a;t>=s;t--)if(!this.dataCachePages[t]){o.push(t);break}return o.length>0?o:null},_findPageIndex:function(e){return Math.floor(e/this.pageSize)},_convertLimitOffsetToFirstLast:function(e){var t=e&&e.offset?e.offset:0,i=e&&e.limit?t+e.limit-1:this.dataCacheTotal?this.dataCacheTotal-1:r;return this.dataCacheTotal&&i>this.dataCacheTotal-1&&(i=this.dataCacheTotal-1),{first:t,last:i}},_getDataFromCache:function(e){e=t.defaults(e,{offset:0,limit:r});var i=Math.max(0,e.offset),s=Math.min(i+e.limit,this.dataCacheTotal);return this.dataCache.slice(i,s)},_putDataToCache:function(e,t){var i;for("undefined"!=typeof t.total&&(this.dataCacheTotal=t.total),e.limit=e.limit||r,i=0;i<t.data.length;i++)this.dataCache[i+e.offset]=this.dataConverter?this.dataConverter(t.data[i]):t.data[i];var s=e.offset/this.pageSize,a=Math.floor((Math.min(e.limit,t.data.length)+e.offset-1)/this.pageSize);for(i=s;a>=i;i++)this.dataCachePages[i]=!0},_getDataByCriteria:function(e){if(!this.getDataByCriteriaHolder[e]){var t,i=Number.MAX_VALUE,s=0,a=0;for(var o in this.getDataByCriteriaHolder)if(this.getDataByCriteriaHolder.hasOwnProperty(o)){a+=1;var n=this.getDataByCriteriaHolder[o];n.index<i&&(i=n.index,t=o),n.index>s&&(s=n.index)}a>=this.maxSearchCacheSize&&delete this.getDataByCriteriaHolder[t],this.getDataByCriteriaHolder[e]={getData:this._createDataProviderForCriteria(e),index:s+1}}return this.lastCriteria=e,this.getDataByCriteriaHolder[e].getData},_createDataProviderForCriteria:function(e){var i=this.request,s=this,a=new l({pageSize:this.pageSize,dataConverter:this.dataConverter,serialRequestsDelay:this.serialRequestsDelay,searchKey:this.criteriaKey,controlGetTotal:this.controlGetTotal,request:function(a){var o=t.extend({},a);return o[s.criteriaKey]=e,i(o)}}),o=a.getData;return a.getData=function(e){var i=t.extend({},e);return delete i[s.criteriaKey],o.call(a,i)},a.getData}}),l}),define("common/component/tree/TreeLevel",["require","underscore","common/component/panel/Panel","common/component/panel/trait/collapsiblePanelTrait","common/component/list/view/ListWithSelection","common/component/tree/trait/addToSelectionModelTrait","common/component/list/model/ListWithSelectionModel","common/component/tree/plugin/TooltipPlugin","./dataprovider/DataProviderWithSearchCache"],function(e){"use strict";function t(){this.$el.removeClass(this.loadingClass).addClass(this.openClass),l.invoke(this.plugins,"itemsRendered",this.list.model,this.list);var e=this.list.$("> .j-view-port-chunk > ul > li").addClass(this.cid).length,t=l.isFunction(this.levelHeight)?this.levelHeight():this.levelHeight;t&&e*this.listItemHeight>t?this.list.$el.css({height:t+"px","overflow-y":"auto"}):this.list.$el.css({height:"auto",overflow:"auto"}),this.list._calcViewPortHeight(),this._isReady=!0,this.trigger("ready",this)}function i(e,t){this.listRenderError=!0,this.trigger("listRenderError",e,t,this)}function s(e){var t=[];l.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||r(this),this.trigger("selection:change",t,this,[])}function a(e){var t=[];l.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||r(this),this.trigger("item:dblclick",t)}function o(e,t){for(var i=0;i<t.length;i++)if(t[i]===e)return!0}function n(e,t,i,s){i&&i.exclude&&l.isArray(i.exclude)&&o(e,i.exclude)||(void 0===s||s>0)&&l.chain(e.items).keys().each(function(a){i&&i.exclude&&l.isArray(i.exclude)&&o(e.items[a],i.exclude)||t.call(e.items[a],i),n(e.items[a],t,i,void 0===s?s:--s)})}function r(e,t){t=t&&{exclude:t.exclude},n(e,function(e){this.list.clearSelection(),this.list.model.selection=[]},t)}var l=e("underscore"),c=e("common/component/panel/Panel"),h=e("common/component/panel/trait/collapsiblePanelTrait"),d=e("common/component/list/view/ListWithSelection"),u=e("common/component/tree/trait/addToSelectionModelTrait"),p=e("common/component/list/model/ListWithSelectionModel").extend(u),m=(e("common/component/tree/plugin/TooltipPlugin"),e("./dataprovider/DataProviderWithSearchCache"));return c.extend({constructor:function(e){e||(e={}),l.extend(e,{traits:[h]}),c.prototype.constructor.call(this,e)},initialize:function(e){e||(e={}),this._isReady=!1,this.item=e.item||{},this.id=this.item.id,this.owner=e.owner,this.parent=e.parent,this.itemsTemplate=e.itemsTemplate,this.listItemHeight=e.listItemHeight,this.levelHeight=e.levelHeight,this.lazyLoad=!!e.lazyLoad,this.selection=e.selection||{allowed:!1,multiple:!1},this.resource=this.item.value,this.bufferSize=e.bufferSize,this.cache="undefined"!=typeof e.cache?e.cache:!1,this.allowMouseDownEventPropagation=e.allowMouseDownEventPropagation,this.items={},this.plugins=[];for(var t={el:this.el,model:this.model},i=0,s=e.plugins.length;s>i;i++){var a=e.plugins[i].constr;this.plugins.push(new a(l.extend({},t,e.plugins[i].options)))}this.dataLayer=this.owner.getDataLayer(this),l.invoke(this.plugins,"dataLayerObtained",this.dataLayer),c.prototype.initialize.apply(this,arguments)},render:function(){var e=new p({bufferSize:this.bufferSize,getData:this._getDataProvider(this.cache)});return this.list=new d({markerClass:"."+this.cid,eventListenerPattern:"."+this.cid+":not(.readonly) > p",el:this.$contentContainer,itemsTemplate:this.itemsTemplate,listItemHeight:this.listItemHeight,lazy:!0,selection:this.selection,allowMouseDownEventPropagation:this.allowMouseDownEventPropagation,model:e}),this.list.on("render:data",l.bind(t,this)),this.list.on("listRenderError",l.bind(i,this)),this.list.on("selection:change",l.bind(s,this)),this.list.on("item:dblclick",l.bind(a,this)),this.lazyLoad?this.on("open",this._onOpen,this):this.list.renderData(),this},_getDataProvider:function(e){var t=this,i=l.bind(function(e){return this.obtainData(e,t)},this.dataLayer),s={};return e&&("object"==typeof e&&(s=l.extend(s,e)),s.request=s.request||i,this.dataProvider=new m(s),i=this.dataProvider.getData),function(e){return e||(e={offset:0,limit:100}),e.id=t.id,i(l.extend({},t.owner.context,e),t)}},_onOpen:function(){this.$el.removeClass(this.openClass).addClass(this.loadingClass),this.list.renderData()},setElement:function(e){var t=c.prototype.setElement.apply(this,arguments);return this.list&&(this.list.setElement(this.$contentContainer),this.list.totalItems=-1),l.each(this.plugins,function(t){t.setElement(e)}),this.lazyLoad||this.list&&this.list.renderData(),this.collapsed||(this.open({silent:!0,depth:0}),this.lazyLoad&&this.list.renderData()),t},open:function(e){n(this,c.prototype.open,e,e?e.depth:0),c.prototype.open.call(this,e)},close:function(e){c.prototype.close.call(this,e),n(this,c.prototype.close,e,e?e.depth:void 0),r(this)},getLevel:function(e){return l(this.items).reduce(function(t,i){return t||(i.id===e?i:i.getLevel(e))},!1)},refresh:function(e){this.listRenderError||(this.lazyLoad&&!this.collapsed||!this.lazyLoad?(this.once("ready",l.bind(n,this,this,this.refresh,e,1)),this.list.model.fetch({top:0,bottom:this.list.model.bufferSize,force:!0}),this.list.scrollTo(0)):(this.list.model.set("bufferStartIndex",void 0,{silent:!0}),this.list.model.set("bufferEndIndex",void 0,{silent:!0}),this.list.model.set("total",void 0,{silent:!0}),n(this,this.refresh,e)))},fetch:function(e,t){this.list.fetch(t,e)},recalcConstraints:function(){this.list.resize()},fetchVisibleData:function(){this.list._fetchVisibleData()},resetSelection:function(e){r(this,e),e&&e.silent||this.trigger("selection:change",[])},hasItems:function(){return!!this.$("> .subcontainer > .j-view-port-chunk > ul > li").length},clearCache:function(){l.each(this.items,function(e){e.clearCache()}),this.dataProvider&&this.dataProvider.clear()},remove:function(){var e=this,t=-1;if(l.forEach(l.keys(this.items),function(t){e.items[t].remove()}),this.dataProvider&&this.dataProvider.clear(),this.list.remove(),this.parent){var i=this.parent.id,s=this.owner.getDataLayer(i);if(s&&s.predefinedData&&s.predefinedData[i]&&l.isArray(s.predefinedData[i])){for(var a=0;a<s.predefinedData[i].length;a++)if(s.predefinedData[i][a].id===this.id){t=a;break}t>-1&&(s.predefinedData[i].splice(t,1),delete s.predefinedData[this.id])}delete this.parent.items[this.id]}c.prototype.remove.apply(this,arguments)},isReady:function(){return this._isReady}})}),define("common/component/tree/TreeDataLayer",["require","underscore","jquery","common/util/classUtil","./TreeLevel","common/util/xssUtil","request"],function(e){"use strict";function t(e,t){return s.call(this,i.call(this,e),t)}function i(e){for(var t=0,i=e.length;i>t;t++)e[t]={id:this.extractId(e[t]),value:e[t]};return e}function s(e,t){var i,s;if(this.processors&&this.processors.length)for(var a=0,o=this.processors.length;o>a;a++){i=[];for(var n=0,r=e.length;r>n;n++)s=this.processors[a].processItem(e[n],t,this),s&&i.push(s);e=i}return e}var a=e("underscore"),o=e("jquery"),n=e("common/util/classUtil"),r=(e("./TreeLevel"),e("common/util/xssUtil")),l=e("request");return n.extend({constructor:function(e){this.requestType=e.requestType?e.requestType:"GET",e.getDataUri&&(this.getDataUri=e.getDataUri),this.getDataUri||(this.getDataUri=a.template(e.dataUriTemplate)),e.getDataArray&&(this.getDataArray=e.getDataArray),e.getDataSize&&(this.getDataSize=e.getDataSize),e.extractId&&(this.extractId=e.extractId),this.levelDataId=e.levelDataId?e.levelDataId:"id",this.processors=e.processors||[],this.initialize(e)},initialize:function(e){},extractId:function(e){return e[this.levelDataId]},getDataSize:function(e,t,i){return this.getDataArray(e,t,i).length},getDataArray:function(e,t,i){return e},obtainData:function(e,i){var s=new o.Deferred,a=this;return this.predefinedData&&this.predefinedData[e.id]?s.resolve({total:this.predefinedData[e.id].length,data:this.predefinedData[e.id]}):l({type:this.requestType,dataType:this.dataType||"json",headers:{Accept:this.accept||"application/json","Content-Type":this.contentType||void 0},cache:!1,data:this.data||void 0,url:this.getDataUri(e)}).done(function(){var i=r.escape(arguments[0],{softHTMLEscape:!0});a.dataSize=a.getDataSize.call(a,i,e,arguments[2]),s.resolve({total:a.dataSize,data:t.call(a,a.getDataArray.call(a,i,e,arguments[2]),e)})}).fail(function(e){s.reject(e.status,e.responseText)}),s},_process:t})}),define("text!common/component/tree/template/treeLevelListTemplate.htm",[],function(){return'<ul class="list collapsible folders" style="top: {{- top}}px; position: relative;">\n    {{ _.each(items, function(item){ }}\n    <li class="{{- item._node ? \'node closed\' : \'leaf\'}} {{- item.selected ? \'selected\' : \'\'}}" data-index="{{- item.index }}" tabindex="-1">\n        <p class="wrap button draggable" data-tooltip="{{- item.value.label }}"><b class="icon"/> {{- item.value.label }} </p>\n        <div class="subcontainer" />\n    </li>\n    {{ }) }}\n</ul>\n'}),define("text!common/component/tree/template/treeLevelTemplate.htm",[],function(){return'<div>\n    <ul class="list collapsible folders">\n        <li class="node">\n            <p class="wrap button">\n                <b class="icon" id="handler2" title=""></b>root\n            </p>\n            <div class="subcontainer"/>\n        </li>\n    </ul>\n</div>'}),define("common/component/tree/Tree",["require","css!lists","jquery","underscore","backbone","./TreeLevel","./TreeDataLayer","text!./template/treeLevelListTemplate.htm","text!./template/treeLevelTemplate.htm"],function(e){"use strict";function t(e){var i=e.list.model.get("items"),a=this;i=s.where(i,{_node:!0}),e.$(".node").each(function(n,r){var l=i[n].id;e.items[l]?e.items[l].setElement(r):(e.items[l]=new o(s.extend({},a._options,{el:r,item:i[n],parent:e})),a.listenTo(e.items[l],"listRenderError",s.bind(function(e,t,i){this.trigger("levelRenderError",e,t,i)},a)),e.listenTo(e.items[l],"ready",s.bind(t,a)),e.listenTo(e.items[l],"selection:change",function(t,i,s){i&&s.push(i),e.list.model.clearSelection(),e.trigger("selection:change",t,e,s)}),e.listenTo(e.items[l],"item:dblclick",function(t){e.list.model.clearSelection(),e.trigger("item:dblclick",t)}),e.items[l].render())}).length&&e.$(".j-view-port-chunk").css({height:"auto"})}e("css!lists");var i=e("jquery"),s=e("underscore"),a=e("backbone"),o=e("./TreeLevel"),n=e("./TreeDataLayer"),r=e("text!./template/treeLevelListTemplate.htm"),l=e("text!./template/treeLevelTemplate.htm"),c={ADD:"add",UPDATE:"update"},h=a.View.extend({template:s.template(l),_plugins:[],el:function(){return this.template()},constructor:function(e){e||(e={}),this.defaultDataLayer=new n(e),this.customDataLayers=e.customDataLayers,e.type?(this._type=e.type,e.type=void 0):this._type="tree",e.collapserSelector||(e.collapserSelector="b.icon:eq(0)"),e.predefinedData?(this.defaultDataLayer.predefinedData=e.predefinedData,e.predefinedData=void 0):this.defaultDataLayer.predefinedData={},e.rootless&&(this.rootless=e.rootless,e.rootless=void 0),e.additionalCssClasses&&(this.additionalCssClasses=e.additionalCssClasses,e.additionalCssClasses=void 0),e.getDataLayer&&(this.getDataLayer=e.getDataLayer,e.getDataLayer=void 0),this._options=s.extend({itemsTemplate:r,plugins:this._plugins,owner:this},e),this.context=e.context||{};for(var t=0,i=this._plugins.length;i>t;t++)this._plugins[t].processors&&(this.processors=this.processors.concat(this._plugins[t].processors));a.View.apply(this,arguments)},initialize:function(e){this.rootLevel=new o(s.extend({},this._options,{levelHeight:e.rootLevelHeight},{el:this.$("li")[0]},{item:{id:"/",value:{id:"/",resourceType:"folder"}}})),this.rootless&&this.$el.find("ul:first").addClass("hideRoot"),this.additionalCssClasses&&this.$el.find("ul:first").addClass(this.additionalCssClasses),this.listenTo(this.rootLevel,"ready",s.bind(t,this)),this.listenTo(this.rootLevel,"selection:change",s.bind(function(e,t,i){t&&i&&s.isArray(i)&&(this.rootLevel.selection.multiple||this.rootLevel.resetSelection({silent:!0,exclude:[i[0]]})),this.trigger("selection:change",e)},this)),this.listenTo(this.rootLevel,"item:dblclick",s.bind(function(e){this.trigger("item:dblclick",e)},this));for(var i=0,a=this._plugins.length;a>i;i++)this._plugins[i].constr.treeInitialized.call(this,this._plugins[i].options);this.rootLevel.render(),e.collapsed&&e.lazyLoad&&this.rootless&&this.expand("/")},remove:function(){for(var e=0,t=this._plugins.length;t>e;e++)this._plugins[e].constr.treeRemoved.call(this);this.rootLevel.remove(),a.View.prototype.remove.apply(this,arguments)},expand:function(e,t){var i=this.getLevel(e);return i&&i.open(t),this},collapse:function(e,t){var i=this.getLevel(e);return i&&i.close(t),this},_getNodeById:function(e){var t,i,a=this.getLevel(e);if(a)return a.parent?(t=a.parent.list,{node:a.item,nodeElement:a.$el,itsList:t}):null;var o=!1;if("list"===this._type)o=this.rootLevel;else if("tree"===this._type){var n=e.split("/");if(n=n.slice(0,n.length-1).join("/"),""===n&&(n="@fakeRoot"),o=this.getLevel(n),!o)return null}return o?(t=o.list,i=s.find(t.model.get("items"),function(t){return t.id===e}),i?{node:i,nodeElement:t.$el.find("li.leaf.selected"),itsList:t}:null):null},select:function(e){var t=this._getNodeById(e);t&&(t.itsList.model.clearSelection().addValueToSelection(t.node.value,t.node.index),this.trigger("selection:change",t.itsList.getValue()))},deselect:function(e){},addItem:function(e,t){var i=this.getLevel(e),s=c.ADD;return i&&this._getNodeItems(e,i,t,s),this},updateItem:function(e,t){var i=t?this.getLevel(t):this.rootLevel;return i&&this._getNodeItems(i.id,i,e),this},resetSelection:function(e){return this.rootLevel.list.clearSelection(),this.rootLevel.list.model.selection=[],this.rootLevel.resetSelection(e),this},refresh:function(e){e&&(this.context=e),this.rootLevel.refresh()},recalcConstraints:function(){this.rootLevel.recalcConstraints()},fetchVisibleData:function(){this.rootLevel.fetchVisibleData()},clearCache:function(){this.rootLevel.clearCache()},getLevel:function(e){return this.rootLevel.id===e?this.rootLevel:this.rootLevel.getLevel(e)},getDataLayer:function(e){return this.customDataLayers&&this.customDataLayers[e.id]?this.customDataLayers[e.id]:this.defaultDataLayer},_addItem:function(e,t,i){return!s.findWhere(e,{id:i.id})&&e.push(i),e},_updateItem:function(e,t){return s.each(e,function(e){e.id===t.id&&s.extend(e,t)},this),e},_getNodeItems:function(e,t,i,a){var o,n=this.getDataLayer(t),r=t.list.model.get("items")?t.list.model.get("items"):[];n.predefinedData=n.predefinedData||{},o=a===c.ADD?this._addItem(r,e,i):this._updateItem(r,i),n.predefinedData[e]=s.sortBy(o,"label"),t.fetch({force:!0,keepPosition:!0})},_selectTreeNode:function(e,t){if(s.isString(e)&&""!==e){var a=s.bind(function(){var o=s.bind(function(){var i=e;if("/"===i&&(i="@fakeRoot"),this.expand(i),this.select(i),"list"===this._type)this.rootLevel.on("ready",a);else if("tree"===this._type&&t&&t.length){var s=this.$el,o=this._getNodeById(i);if(!o)return;var n=o.nodeElement;if(!n)return;var r=n.offset().top-s.offset().top-t.height()/2+n.height()/2;t.scrollTop(r)}},this);if("/"===e||"/public"===e||"list"===this._type)o();else{var n=e.replace(/\/$/,""),r=n.substr(0,n.lastIndexOf("/"));r=r||"/";var l=new i.Deferred;this._openPath(r,l,0),l.done(o)}},this);this.rootLevel.isReady()?a():this.rootLevel.on("ready",a)}},_openPath:function(e,t,i){if(!e)return t.resolve();var a,o,n,r=this;return"/"===e?o=["/"]:(o=e.split("/"),o[0]="/"),"/"===o[0]&&"public"===o[1]&&(o=s.union(["/public"],s.rest(o,2))),i=i||0,i===o.length?t.resolve():(a=s.first(o,i+1).join("/"),"/"===a&&(a="@fakeRoot"),a=a.replace(/\/\//g,"/"),n=this.getLevel(a),void(n&&(n.collapsed?(n.once("ready",function(){r._openPath(e,t,i+1)}),n.open()):this._openPath(e,t,i+1))))}},{instance:function(e){return new this(e)}});return{use:function(e,t){return function(e){return{use:function(t,i){return e.prototype._plugins.push({constr:t,options:i}),this},create:function(){return e}}}(h.extend({_plugins:[{constr:e,options:t}]}))},create:function(){return h}}}),define("text!common/component/panel/template/tabbedPanelButtonTemplate.htm",[],function(){return'<button class="button up">\n    <span class="wrap">{{- label }}<span class="icon"></span></span>\n</button>\n'}),define("common/component/panel/trait/tabbedPanelTrait",["require","underscore","jquery","backbone","./abstractPanelTrait","common/component/base/OptionContainer","text!../template/tabbedPanelButtonTemplate.htm"],function(e){"use strict";function t(e,t){var i=t.get("action");this._contentRendered[i]||(this._contentRendered[i]=!0,this.tabs[i].render&&this.tabs[i].render()),this.$tabs.hide(),this.$tabs.filter(function(){return s(this).data("tab")===i}).show(),this.selectedTab=i,this.trigger("tab:"+i,e,t)}var i=e("underscore"),s=e("jquery"),a=e("backbone"),o=e("./abstractPanelTrait"),n=e("common/component/base/OptionContainer"),r=e("text!../template/tabbedPanelButtonTemplate.htm");return i.extend({},o,{onConstructor:function(e){if(e||(e={}),!e.tabs||!i.isArray(e.tabs)||0===e.tabs.length)throw new Error("Tabbed panel should have at least one tab");this.tabContainerClass=e.tabContainerClass||"tabContainer",this.tabHeaderContainerSelector=e.tabHeaderContainerSelector||"> .header > .tabHeaderContainer",this.tabHeaderContainerClass=e.tabHeaderContainerClass||"tabHeaderContainer",this.tabbedPanelClass=e.tabbedPanelClass||"tabbedPanel",this.tabs={},i.each(e.tabs,i.bind(function(e){this.tabs[e.action]=e.content,delete e.content},this))},afterSetElement:function(){this.$el.addClass(this.tabbedPanelClass),this.$tabHeaderContainer=this.$(this.tabHeaderContainerSelector),this.$tabHeaderContainer.length||(this.$tabHeaderContainer=s("<div></div>").addClass(this.tabHeaderContainerClass),this.$("> .header").append(this.$tabHeaderContainer)),this.$contentContainer.empty(),i.each(this.tabs,i.bind(function(e,t){var i=s("<div></div>").addClass(this.tabContainerClass);i.data("tab",t),i.html(e instanceof a.View?e.$el:e),this.$contentContainer.append(i)},this));var e=this.tabContainerClass.split(" ");this.$tabs=this.$("."+e[0])},afterInitialize:function(e){this.tabHeaderContainer=new n({options:e.tabs,el:this.$tabHeaderContainer,contextName:"tab",toggleClass:e.toggleClass||"active",toggle:!0,optionTemplate:e.optionTemplate||r}),this._contentRendered={},this.listenTo(this.tabHeaderContainer,i.map(e.tabs,function(e){return"tab:"+e.action}).join(" "),i.bind(t,this));for(var s=0;s<e.tabs.length;s++)if(e.tabs[s].primary){this.openTab(e.tabs[s].action);break}},onRemove:function(){i.each(this.tabs,function(e){e.remove&&e.remove()}),this.tabHeaderContainer.remove()},extension:{openTab:function(e){var t=this.tabHeaderContainer.getOptionView(e);t&&t.select()},showTab:function(e){var t=this.tabHeaderContainer.getOptionView(e);t&&t.show()},hideTab:function(e){var t=this.tabHeaderContainer.getOptionView(e);t&&t.hide()}}})}),define("text!common/component/tree/template/searchPluginTemplate.htm",[],function(){return'<span class="control searchLockup ">\n    <div class="wrap">\n        <input type="text" tabindex="">\n    </div>\n    <b class="right">\n        <a class="button searchClear"></a>\n    </b>\n    <a class="button search up"></a>\n</span>\n'}),define("common/component/tree/plugin/SearchPlugin",["require","underscore","jquery","backbone","./TreePlugin","text!../template/searchPluginTemplate.htm"],function(e){"use strict";var t=e("underscore"),i=e("jquery"),s=e("backbone"),a=e("./TreePlugin"),o=e("text!../template/searchPluginTemplate.htm"),n=s.View.extend({template:t.template(o),el:function(){return this.template()},events:{"click .button.search":"clickHandler","click .button.searchClear":"clear","keydown input[type=text]":"keyHandler"},initialize:function(e){this.owner=e.owner,this.$searchInput=this.$el.find("input[type=text]")},search:function(e){var i=this.$searchInput.val();this.owner.refresh(t.extend({searchString:i},e)),i?this.$el.find(".button.searchClear").addClass("up"):this.$el.find(".button.searchClear").removeClass("up")},clearInput:function(){this.$searchInput.val("")},clear:function(){this.clearInput(),this.clickHandler(),this.trigger("clear",this)},clearSilently:function(){this.clearInput(),delete this.owner.context.searchString,this.owner.refresh(t.extend({searchString:""},this.owner.context)),this.$el.find(".button.searchClear").removeClass("up")},clickHandler:function(){delete this.owner.context.searchString,this.search(this.owner.context),this.trigger("search",this.owner.context)},keyHandler:function(e){13===e.which&&this.clickHandler()},setSearchString:function(e){this.$searchInput.val(e)}});return a.extend({initialize:function(e){this.searchParameter=e&&e.searchParameter||"q",this.additionalParams=e&&e.additionalParams},dataLayerObtained:function(e){var s=this;if(!e.__searchPluginExtended){var a=e.getDataUri,o=this.searchParameter;e.getDataUri=function(e){var n=a.apply(this,arguments),r={};return e.searchString&&(r[o]=e.searchString),s.additionalParams&&t.extend(r,s.additionalParams,t.pick(e,t.keys(s.additionalParams))),n+=(-1===n.indexOf("?")?"?":"&")+i.param(r,!0)},e.__searchPluginExtended=!0}}},{treeInitialized:function(e){e=e||{};var t=this;this.searchForm=new n({owner:this}),e.dfdRenderTo?e.dfdRenderTo.done(function(e){e.prepend(t.searchForm.render().el)}):this.$el.prepend(this.searchForm.render().el)},treeRemoved:function(){
this.searchForm.remove()}})}),define("common/component/tree/plugin/InfiniteScrollPlugin",["require","./TreePlugin"],function(e){"use strict";var t=e("./TreePlugin");return t.extend({itemsRendered:function(){this.$("> .subcontainer > .j-view-port-chunk").css({height:"auto"})}})}),define("text!common/component/tree/template/noResourcesFoundMessageTemplate.htm",[],function(){return'<div class="noSearchResults">{{- msg}}</div>'}),define("common/component/tree/plugin/NoSearchResultsMessagePlugin",["require","underscore","jquery","bundle!js-sdk/CommonBundle","./TreePlugin","text!../template/noResourcesFoundMessageTemplate.htm"],function(e){"use strict";var t=e("underscore"),i=(e("jquery"),e("bundle!js-sdk/CommonBundle")),s=e("./TreePlugin"),a=e("text!../template/noResourcesFoundMessageTemplate.htm"),o=function(e){!e.list.totalItems&&e.list.$el.html(this.noResourcesFoundMessage)};return s.extend({},{treeInitialized:function(e){this.noResourcesFoundMessage=t.template(a,{msg:i["no.resources.found"]}),this.listenTo(this.rootLevel,"ready",o)},treeRemoved:function(){this.stopListening(this.rootLevel,"ready",o)}})}),define("bi/repository/enum/repositoryResourceTypes",{RESOURCE_LOOKUP:"resourceLookup",DASHBOARD:"dashboard",LEGACY_DASHBOARD:"legacyDashboard",REPORT_UNIT:"reportUnit",TOPIC:"topic",ADHOC_DATA_VIEW:"adhocDataView",FILE:"file",FOLDER:"folder",SECURE_FILE:"secureFile",DATA_TYPE:"dataType",JDBC_DATA_SOURCE:"jdbcDataSource",AWS_DATA_SOURCE:"awsDataSource",AZURE_SQL_DATA_SOURCE:"azureSqlDataSource",JNDI_DATA_SOURCE:"jndiJdbcDataSource",VIRTUAL_DATA_SOURCE:"virtualDataSource",CUSTOM_DATA_SOURCE:"customDataSource",BEAN_DATA_SOURCE:"beanDataSource",XMLA_CONNECTION:"xmlaConnection",LIST_OF_VALUES:"listOfValues",REPORT_OPTIONS:"reportOptions",QUERY:"query",OLAP_UNIT:"olapUnit",DOMAIN_TOPIC:"domainTopic",SEMANTIC_LAYER_DATA_SOURCE:"semanticLayerDataSource",SECURE_MONDRIAN_CONNECTION:"secureMondrianConnection",MONDRIAN_XMLA_DEFINITION:"mondrianXmlaDefinition",MONDRIAN_CONNECTION:"mondrianConnection",INPUT_CONTROL:"inputControl",ORGANIZATION:"organization",OLAP_CUBE:"olapCube"}),define("text!adhoc/datachooser/template/datachooserDialogTemplate.htm",[],function(){return'<div class="jr-mDialog jr-uWidth-400px jr {{- additionalCssClasses }}" tabindex="-1">\n    <div class="jr-mDialog-header mover jr">\n        <h1 class="jr-mDialog-header-title jr">{{- title }}</h1>\n    </div>\n    <div class="sub header tabHeaderContainer"></div>\n    <div class="jr-mDialog-body subcontainer jr"></div>\n    <p class="itemDescription"></p>\n    <div class="jr-mDialog-footer jr"></div>\n</div>\n'}),define("text!adhoc/datachooser/template/dataChooserTreeLeafTemplate.htm",[],function(){return'<ul class="list collapsible" style="top: {{- top}}px; position: relative;">\n    {{ _.each(items, function(item){ }}\n    <li class="{{- item._node ? \'node folders closed\' : \'leaf\'}} {{- item.selected ? \'selected\' : \'\'}} {{- item.cssClass }}" data-index="{{- item.index }}" tabindex="-1">\n        <p class="wrap button {{- item._node ? \'\' : \'draggable\'}} " {{ if (item.value.description || item.value.uri) { }}data-tooltip=\'{{ if (item.value.description) { }}<p class="message label">{{- item.i18n ? item.i18n["tooltip.description"] : "Description:" }} </p><p class="message">{{- item.value.description }}</p>{{ } }} {{ if (item.value.uri) { }} <p class="message label">{{- item.i18n ? item.i18n["tooltip.path"] : "Path:" }} </p><p class="message">{{- item.value.uri }}</p> {{ } }}\' {{ } }}><b class="icon"/> {{- item.value.label }} </p>\n        <div class="subcontainer" />\n    </li>\n    {{ }) }}\n</ul>'}),define("text!adhoc/datachooser/template/tooltip/sidebarTreeLeafTooltipTemplate.htm",[],function(){return'{{ if (model.value.description) { }}\n    <p class="message label">{{- model.i18n[\'tooltip.description\'] }}</p><p class="message">{{- model.value.description }}</p>\n{{ } }}\n{{ if (model.value.uri) { }}\n    <p class="message label">{{- model.i18n[\'tooltip.path\'] }}</p><p class="message">{{- model.value.uri }}</p>\n{{ } }}'}),define("text!adhoc/datachooser/template/datachooserTabTemplate.htm",[],function(){return'<button class="button {{- additionalCssClasses }}{{ if (exposeAction) { }} {{- action}} {{ } }} up" title="{{ if(action === \'list\') { }} {{- i18n.ADH_108_DATA_CHOOSER_LIST_TAB_TOOLTIP }} {{ } else { }} {{- i18n.ADH_108_DATA_CHOOSER_FOLDERS_TAB_TOOLTIP }} {{ } }}">\n    <span class="wrap">{{- label }}<span class="icon"></span></span>\n</button>'}),define("adhoc/datachooser/view/DatachooserDialogView",["require","underscore","jquery","common/component/dialog/Dialog","common/component/dialog/AlertDialog","common/component/panel/Panel","common/component/tree/Tree","common/component/tree/TreeDataLayer","common/component/panel/trait/tabbedPanelTrait","common/component/tree/plugin/TooltipPlugin","common/component/tree/plugin/SearchPlugin","common/component/tree/plugin/InfiniteScrollPlugin","common/component/tree/plugin/NoSearchResultsMessagePlugin","jrs.configs","bi/repository/enum/repositoryResourceTypes","bundle!adhoc_messages","bundle!CommonBundle","common/util/browserDetection","text!adhoc/datachooser/template/datachooserDialogTemplate.htm","text!adhoc/datachooser/template/dataChooserTreeLeafTemplate.htm","text!adhoc/datachooser/template/tooltip/sidebarTreeLeafTooltipTemplate.htm","text!adhoc/datachooser/template/datachooserTabTemplate.htm"],function(e){"use strict";function t(e){switch(e.value.resourceType){case m.REPORT_UNIT:e.cssClass="topic";break;case m.DOMAIN_TOPIC:e.cssClass="domain topic";break;case m.SEMANTIC_LAYER_DATA_SOURCE:e.cssClass="domain";break;case m.OLAP_CUBE:e.cssClass="olap"}return e}var i=e("underscore"),s=e("jquery"),a=e("common/component/dialog/Dialog"),o=e("common/component/dialog/AlertDialog"),n=(e("common/component/panel/Panel"),e("common/component/tree/Tree")),r=e("common/component/tree/TreeDataLayer"),l=e("common/component/panel/trait/tabbedPanelTrait"),c=e("common/component/tree/plugin/TooltipPlugin"),h=e("common/component/tree/plugin/SearchPlugin"),d=e("common/component/tree/plugin/InfiniteScrollPlugin"),u=e("common/component/tree/plugin/NoSearchResultsMessagePlugin"),p=e("jrs.configs").contextPath,m=e("bi/repository/enum/repositoryResourceTypes"),f=e("bundle!adhoc_messages"),g=e("bundle!CommonBundle"),v=e("common/util/browserDetection"),T=e("text!adhoc/datachooser/template/datachooserDialogTemplate.htm"),b=e("text!adhoc/datachooser/template/dataChooserTreeLeafTemplate.htm"),C=e("text!adhoc/datachooser/template/tooltip/sidebarTreeLeafTooltipTemplate.htm"),y=e("text!adhoc/datachooser/template/datachooserTabTemplate.htm"),D="reportType",_=22,L="decorate",S="embeddedDesigner",P="list",w=5e3,x="&recursive=true",O="&recursive=false",E=p+"/rest_v2/api/resources?{{= id != '@fakeRoot' ? 'folderUri=' + id : ''}}",R="&type="+m.DOMAIN_TOPIC+"&type="+m.TOPIC+"&type="+m.SEMANTIC_LAYER_DATA_SOURCE,I="&type="+m.SECURE_MONDRIAN_CONNECTION+"&type="+m.MONDRIAN_CONNECTION+"&type="+m.XMLA_CONNECTION,A="&offset={{= offset }}&limit={{= limit }}&forceTotalCount=true&forceFullPage=true",N=E+O+"&containerType="+m.FOLDER,H=E+x+A,$=[m.MONDRIAN_CONNECTION,m.SECURE_MONDRIAN_CONNECTION,m.XMLA_CONNECTION];return a.extend({events:{resize:"onResizeHeight"},onResizeHeight:function(){this.$contentContainer.height(this.$el.height()-this._resizableContainerShiftHeight),this.listTreeView.rootLevel.list.$el.height(this.$el.height()-this._resizableContainerShiftHeight-6),this.hierarhicalTreeView.rootLevel.list.$el.css("height","100%")},constructor:function(e){e||(e={}),this._dfdRenderSerachFormTo=s.Deferred();var o=this._getParameterByName(D);o=o||"crosstab",this.reportType="chart"===o?"ichart":o,this.decorate=this._getParameterByName(L)||"yes",this.isEmbeddedDesigner=this._getParameterByName(S);var v=N+R;v+="table"===this.reportType?A:I+A;var P={attachTo:this.$el,i18n:f,contentTemplate:C},x=n.use(c,P).use(d).create(),O=i.union([m.TOPIC,m.DOMAIN_TOPIC,m.SEMANTIC_LAYER_DATA_SOURCE],$),E=n.use(c,P).use(u).use(h,{additionalParams:{type:"table"===this.reportType?i.first(O,3):O},dfdRenderTo:this._dfdRenderSerachFormTo}).create(),k={treeNodeProcessor:{processItem:function(e){return e._node=i.contains(i.union([m.FOLDER],$),e.value.resourceType),e}},i18nItemProcessor:{processItem:function(e){return e.i18n=g,e}},filterPublicFolderProcessor:{processItem:function(e){return"/public"!==e.value.uri?e:void 0}},filterTempFolderProcessor:{processItem:function(e){return e.value.uri.match(/\/temp\//)||e.value.uri.match(/\/temp$/)?void 0:e}},filterEmptyFoldersProcessor:{processItem:function(e){return"folder"!==e.value.resourceType||""!==e.value._links.content?e:void 0}},cssClassItemProcessor:{processItem:t}},U=new r({requestType:"POST",dataUriTemplate:p+"/rest_v2/connections",processors:[k.i18nItemProcessor,k.cssClassItemProcessor],levelDataId:"uri",getDataArray:function(e,t,i){return e&&e[m.RESOURCE_LOOKUP]?e[m.RESOURCE_LOOKUP]:[]}}),q=function(e){var t=i.contains($,e.resource.resourceType);if(t){var s=i.clone(this.customDataLayers.olapDataLayer);return i.extend(s,{accept:"application/repository."+e.resource.resourceType+".metadata+json",contentType:"application/repository."+e.resource.resourceType+"+json",data:JSON.stringify(e.resource)}),s}return this.customDataLayers&&this.customDataLayers[e.id]?this.customDataLayers[e.id]:this.defaultDataLayer};this.hierarhicalTreeView=x.instance({itemsTemplate:b,listItemHeight:_,selection:{allowed:!0,multiple:!1},rootless:!0,collapsed:!0,lazyLoad:!0,bufferSize:w,additionalCssClasses:"folders",dataUriTemplate:v,levelDataId:"uri",customDataLayers:{"/":i.extend(new r({dataUriTemplate:p+"/flow.html?_flowId=searchFlow&method=getNode&provider=repositoryExplorerTreeFoldersProvider&uri=/&depth=1",processors:i.chain(k).omit("filterPublicFolderProcessor").values().value(),getDataArray:function(e){e=JSON.parse(s(e).text());var t=i.find(e.children,function(e){return"/public"===e.uri}),a=[{id:"@fakeRoot",label:e.label,uri:"/",resourceType:"folder",_links:{content:"@fakeContentLink"}}];return t&&a.push({id:"/public",label:t.label,uri:"/public",resourceType:"folder",_links:{content:"@fakeContentLink"}}),a}}),{accept:"text/html",dataType:"text"}),olapDataLayer:U},processors:i.values(k),getDataArray:function(e,t,i){return e&&e[m.RESOURCE_LOOKUP]?e[m.RESOURCE_LOOKUP]:[]},getDataSize:function(e,t,i){return+i.getResponseHeader("Total-Count")},getDataLayer:q}),this.listTreeView=E.instance({rootLevelHeight:i.bind(this.getContentHeight,this),itemsTemplate:b,listItemHeight:_,selection:{allowed:!0,multiple:!1},rootless:!0,collapsed:!0,lazyLoad:!0,dataUriTemplate:H,levelDataId:"uri",cache:{searchKey:"searchString",pageSize:100},processors:[{processItem:function(e){return e._node=i.contains($,e.value.resourceType),e}},k.i18nItemProcessor,k.cssClassItemProcessor,k.filterTempFolderProcessor],customDataLayers:{olapDataLayer:U},getDataLayer:q,getDataArray:function(e,t,i){return e&&e[m.RESOURCE_LOOKUP]?e[m.RESOURCE_LOOKUP]:[]},getDataSize:function(e,t,i){return+i.getResponseHeader("Total-Count")}}),a.prototype.constructor.call(this,{template:T,modal:!0,resizable:!0,additionalCssClasses:"sourceDialogNew",title:f.ADH_108_DATA_CHOOSER_DIALOG_TITLE,traits:[l],tabHeaderContainerSelector:".tabHeaderContainer",tabContainerClass:"tabContainer control groupBox treeBox",optionTemplate:y,toggleClass:"down",tabs:[{label:f.ADH_108_DATA_CHOOSER_FOLDERS_TAB,action:"tree",content:this.hierarhicalTreeView,exposeAction:!0,additionalCssClasses:"action square small",i18n:f},{label:f.ADH_108_DATA_CHOOSER_LIST_TAB,action:"list",content:this.listTreeView,exposeAction:!0,additionalCssClasses:"action square small",i18n:f}],buttons:[{label:f.ADH_016_BUTTON_OK,action:"apply",primary:!0},{label:f.ADH_010_BUTTON_CANCEL,action:"cancel",primary:!1}]}),this.disableButton("apply"),this.on("button:apply",i.bind(this._onSelectDataDialogOkButtonClick,this)),this.on("button:cancel",i.bind(this._onSelectDataDialogCancelButtonClick,this))},initialize:function(e){var t=function(e){var t=i.find(this.buttons.options,function(e){return"apply"===e.model.attributes.action}).$el,s=e&&i.isArray(e)&&e[0],a=s?e[0].uri:void 0,o=s?e[0].resourceType:void 0;return s||a||o?(o!==m.FOLDER?this.$(".itemDescription").text(s.description||""):this.$(".itemDescription").empty(),o===m.SEMANTIC_LAYER_DATA_SOURCE?t.find(".wrap").text(f.ADH_108_DATA_CHOOSER_DOMAIN_LABEL):t.find(".wrap").text(f.ADH_016_BUTTON_OK),i.contains(i.union([m.FOLDER],$),o)?(delete this.resourceData,void this.disableButton("apply")):(this.resourceData={},o===m.OLAP_CUBE?(this.resourceData.resourceUri=a.substring(0,a.lastIndexOf("/")),this.resourceData.cube=a.substring(a.lastIndexOf("/")+1),this.resourceData.reportType="olap_"+this.reportType):(this.resourceData.resourceUri=a,this.resourceData.reportType=this.reportType),this.resourceData.event=this._getAdHocFlowEvent(o),this.resourceData.flowExecutionKey=flowExecutionKey,void this.enableButton("apply"))):(this.disableButton("apply"),void this.$(".itemDescription").empty())};this.errorDialog=new o,this.listenTo(this.hierarhicalTreeView,"selection:change",t),this.listenTo(this.listTreeView,"selection:change",t),this.listenTo(this.hierarhicalTreeView,"levelRenderError",i.bind(this._onLevelRenderError,this.errorDialog)),this.listenTo(this.listTreeView,"levelRenderError",i.bind(this._onLevelRenderError,this.errorDialog)),this.listenTo(this.hierarhicalTreeView,"item:dblclick",this._onSelectDataDialogOkButtonClick),this.listenTo(this.listTreeView,"item:dblclick",this._onSelectDataDialogOkButtonClick),this.listenTo(this.listTreeView.rootLevel,"ready",this.onResizeHeight,this),this.listenTo(this.hierarhicalTreeView.rootLevel,"ready",this.onResizeHeight,this),this.listenTo(this.listTreeView.searchForm,"search",this._onSearch),this.listenTo(this.listTreeView.searchForm,"clear",this._resetItemSelection),this.on("tab:tree tab:list",this._resetItemSelection,this),a.prototype.initialize.apply(this,arguments)},getContentHeight:function(){return this.$el.height()-this._resizableContainerShiftHeight},render:function(){return a.prototype.render.apply(this,arguments),this._dfdRenderSerachFormTo.resolve(this.$tabHeaderContainer),this.openTab(P),this},open:function(){var e=this;e._resizableContainerShiftHeight=6,a.prototype.open.apply(this,arguments);var t=i.bind(function(){this.$contentContainer.find(".tabContainer").css({height:"inherit","overflow-y":"auto"})},this);v.isIE8()||v.isIE9()?setTimeout(t,1):t(),this.$el.children().not(".subcontainer").not(".ui-resizable-e").not(".ui-resizable-se").each(function(){e._resizableContainerShiftHeight+=e.$(this).outerHeight(!0)}),this.$contentContainer.height(this.$el.height()-this._resizableContainerShiftHeight)},close:function(){this.hierarhicalTreeView&&(this.hierarhicalTreeView.collapse("@fakeRoot",{silent:!0}),this.hierarhicalTreeView.collapse("/public",{silent:!0}),this.hierarhicalTreeView.resetSelection()),a.prototype.close.apply(this,arguments)},_onSearch:function(){this.openTab(P),this.disableButton("apply")},_resetItemSelection:function(){this.hierarhicalTreeView.resetSelection(),this.listTreeView.resetSelection(),this.$(".itemDescription").empty()},_getAdHocFlowEvent:function(e){var t="";return e==m.REPORT_UNIT||e==m.DOMAIN_TOPIC?t="startAdHocWithTopic":e==m.SEMANTIC_LAYER_DATA_SOURCE?t="startQueryBuilder":e===m.OLAP_CUBE&&(t="startAdhocForOlap"),t},_onSelectDataDialogOkButtonClick:function(){this.resourceData&&(document.location="flow.html?_flowId=adhocFlow&realm="+encodeURIComponent(encodeURIComponent(this.resourceData.resourceUri))+"&_flowExecutionKey="+this.resourceData.flowExecutionKey+"&reportType="+this.resourceData.reportType+"&embeddedDesigner="+this.isEmbeddedDesigner+"&decorate="+this.decorate+"&_eventId="+this.resourceData.event+(this.resourceData.cube?"&cube="+this.resourceData.cube:""))},_onLevelRenderError:function(e,t,i){t=JSON.parse(t);var s=t.message;t.parameters&&(s=t.parameters[0].substring(t.parameters[0].indexOf(": ")+2,t.parameters[0].indexOf("\n"))),this.setMessage(s),this.open(),i.$el.removeClass(i.loadingClass).addClass(i.openClass)},_onSelectDataDialogCancelButtonClick:function(){this.close(),this.isEmbeddedDesigner&&-1===document.referrer.indexOf("login.html")&&s(document).trigger("adhocDesigner:cancel")},_getParameterByName:function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}})}),define("adhoc/adhocStartMain",["require","jquery","./datachooser/view/DatachooserDialogView"],function(e){"use strict";var t=(e("jquery"),e("./datachooser/view/DatachooserDialogView"));e(["!domReady"],function(){var e=new t;window.location.href.indexOf("embeddedDesigner=true")<0&&e.listenTo(e,"close",function(){"undefined"!=typeof alreadyEditing&&-1===document.referrer.indexOf("login.html")?window.history.back():document.location="flow.html?_flowId=homeFlow"}),e.open()})});