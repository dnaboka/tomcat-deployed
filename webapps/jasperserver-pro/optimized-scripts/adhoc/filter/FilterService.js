define(["require","common/util/classUtil","underscore","jquery","components.dialogs","jrs.configs"],function(e){"use strict";var t={table:"adhoc/table.html",crosstab:"adhoc/crosstab.html",olap_crosstab:"adhoc/crosstab.html",ichart:"adhoc/intelligentChart.html",olap_ichart:"adhoc/intelligentChart.html"},i=e("common/util/classUtil"),r=e("underscore"),l=e("jquery"),n=e("components.dialogs"),s=e("jrs.configs"),a=i.extend({constructor:function(e){this.clientKey=e.clientKey,this.mode=e.mode},createUrl:function(e,i){return(i||t[this.mode()])+"?action="+e},_request:function(e,t,i){t="undefined"==typeof t?!0:t,i=i||a.defaultCallbacks;var r=l.ajax(e).done(i.done||a.defaultCallbacks.done).fail(i.fail||a.defaultCallbacks.fail).always(i.always||a.defaultCallbacks.always);return t&&setTimeout(function(){"pending"===r.state()&&n.popup.show(l("#loading")[0],!1,{focus:!1})},a.SLOW_REQUEST_TIMEOUT),r},get:function(){return this._request({url:this.createUrl("generateFilterPanel"),data:{clientKey:this.clientKey}})},add:function(e){return this._request({url:this.createUrl("addAdhocFilter"),type:"POST",data:{addAdhocFilterFields:r.map(e,encodeURIComponent),clientKey:this.clientKey}})},addOlapFilter:function(e,i){return this._request({url:this.createUrl("addOLAPFilter",t.olap_crosstab),type:"POST",data:{dim:e,child:i,clientKey:this.clientKey}})},addSlice:function(e,i,l){return this._request({url:this.createUrl("addQuickSliceFilter",t.crosstab),type:"POST",data:{axis:e,includeOrExclude:i,pathList:JSON.stringify(r.map(l,function(e){return encodeURIComponent(e)})),clientKey:this.clientKey}})},update:function(e,t){return this._request({url:this.createUrl("editAdhocFilter"),type:"POST",data:{filterId:e,editAdhocFilter:JSON.stringify(t),clientKey:this.clientKey}})},remove:function(e){return this._request({url:this.createUrl("deleteAdhocFilter"),type:"POST",data:{filterId:e,clientKey:this.clientKey}})},removeAll:function(){return this._request({url:this.createUrl("deleteAllAdhocFilters"),type:"POST",data:{clientKey:this.clientKey}})},reorder:function(e,t){return this._request({url:this.createUrl("reorderFilters"),type:"POST",data:{oldIndex:e,newIndex:t,clientKey:this.clientKey}})},toggleVisibility:function(e){return this._request({url:this.createUrl("toggleFilterPodState"),type:"POST",data:{filterId:e,clientKey:this.clientKey}})},minimizeAll:function(){return this._request({url:this.createUrl("minimizeAllAdhocFilterPods"),type:"POST",data:{clientKey:this.clientKey}})},maximizeAll:function(){return this._request({url:this.createUrl("maximizeAllAdhocFilterPods"),type:"POST",data:{clientKey:this.clientKey}})},fetchValues:function(e,t,i){return t=t||{},t.criteria&&(t.criteria=encodeURIComponent(t.criteria)),this._request({url:this.createUrl("getFieldValues"),data:r.extend({fieldName:encodeURIComponent(e),clientKey:this.clientKey},t)},i)},applyFiltersAndExpression:function(e,t){return this._request({url:this.createUrl("applyAdhocFiltersAndExpression"),type:"POST",data:{complexFilterExpression:t,adhocFilters:JSON.stringify(e),clientKey:this.clientKey}})},getMaxMinValues:function(e){return this._request({url:this.createUrl("getMaxMinValues"),data:{fieldName:encodeURIComponent(e),clientKey:this.clientKey}})}});return a.defaultCallbacks={fail:function(e,t,i){if(e.getResponseHeader("LoginRequested"))document.location=s.urlContext;else if(e.getResponseHeader("adhocException")){var r=e.getResponseHeader("adhocException");r=decodeURIComponent(r),r=r.replace(/@@/g," "),n.errorPopup.show(r)}else(500==e.status||e.getResponseHeader("JasperServerError")&&!e.getResponseHeader("SuppressError"))&&n.errorPopup.show(e.responseText)},always:function(){n.popup.hide(l("#loading")[0])}},a.SLOW_REQUEST_TIMEOUT=2e3,window.FilterService=a,a});