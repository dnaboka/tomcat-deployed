define(["require","backbone","underscore","text!common/component/tree/template/searchPluginTemplate.htm"],function(e){var t=e("backbone"),r=e("underscore"),i=e("text!common/component/tree/template/searchPluginTemplate.htm");return t.View.extend({template:r.template(i),el:function(){return this.template()},events:{"click .button.search":"onClickOnSearchButton","click .button.searchClear":"onClearSearch","keydown input[type=text]":"onKeyPress"},initialize:function(e){r.bindAll(this,"onTreeLoaded","_walkThroughTree","_saveTreeStateAction","_restoreSavedTreeStateAction"),this.tree=e.tree,this.depth=e.depth,this.treeState={},this.model=new t.Model,this.initObservers(),e.keyword&&this.setKeyword(e.keyword)},initObservers:function(){this.listenTo(this.model,"change:keyword",this.onChangeKeyword)},_walkThroughTree:function(e,t){var r,i=e.childs.length;for(r=0;i>r;r++)this._walkThroughTree(e.childs[r],t);t(e)},_saveTreeStateAction:function(e){var t=this.tree.stateObject[e.id];t&&(this.treeState[e.param.id]=this.tree.stateObject[e.id]),dynamicTree.nodes[e.id]=void 0},_restoreSavedTreeStateAction:function(e){var t=this.treeState[e.param.id];t&&(this.tree.stateObject[e.id]=t)},onChangeKeyword:function(){var e=this.getKeyword(),t=this.model.previous("keyword");t||this._walkThroughTree(this.tree.rootNode,this._saveTreeStateAction),this.tree.additionalParams.query=e,this.tree.showTree(this.depth,this.onTreeLoaded),e?this.$el.find(".button.searchClear").addClass("up"):this.$el.find(".button.searchClear").removeClass("up"),this.trigger("change:keyword",e)},onClickOnSearchButton:function(){this.model.set("keyword",this.$el.find("input[type=text]").val())},onClearSearch:function(){this.setKeyword("")},onKeyPress:function(e){13===e.which&&this.onClickOnSearchButton()},onTreeLoaded:function(){this.getKeyword()||(this.tree.resetStates(),this._walkThroughTree(this.tree.rootNode,this._restoreSavedTreeStateAction),this.treeState={}),this.tree.renderTree()},setKeyword:function(e){this.$el.find("input[type=text]").val(e),this.model.set("keyword",e)},getKeyword:function(){return this.model.get("keyword")}})});