define(["require","underscore","common/util/classUtil","jquery","requestSettings","components.dialogs","jrs.configs"],function(e){"use strict";var t=e("underscore"),s=e("common/util/classUtil"),n=e("jquery"),a=e("requestSettings"),r=e("components.dialogs"),i=e("jrs.configs"),o=s.extend({constructor:function(e){this.clientKey=e.clientKey},createRestUrl:function(e){return"rest_v2/metadata/_temp/"+this.clientKey+e},_request:function(e,s,i){s="undefined"==typeof s?!0:s,i=i||o.defaultCallbacks;var u=n.ajax(t.defaults(e,a)).done(i.done||o.defaultCallbacks.done).fail(i.fail||o.defaultCallbacks.fail).always(i.always||o.defaultCallbacks.always);return s&&setTimeout(function(){"pending"===u.state()&&r.popup.show(n("#loading")[0],!1)},o.SLOW_REQUEST_TIMEOUT),u},fetchFieldsList:function(){return this._request({url:this.createRestUrl("/fields"),type:"GET",dataType:"json"})},fetchFunctionsList:function(){return this._request({url:this.createRestUrl("/functions"),type:"GET",dataType:"json"})},validate:function(e){return this._request({url:this.createRestUrl("/action/validate"),type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},get:function(e){return this._request({url:this.createRestUrl("/fields/"+e),type:"GET",dataType:"json"})},add:function(e){return this._request({url:this.createRestUrl("/fields"),type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},update:function(e,t){return this._request({url:this.createRestUrl("/fields/"+t),type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},remove:function(e){return this._request({url:this.createRestUrl("/fields/"+e),type:"DELETE",contentType:"application/json"})}});return o.defaultCallbacks={fail:function(e,t,s){if(401==e.status||e.getResponseHeader("LoginRequested"))document.location=i.urlContext;else if(e.getResponseHeader("adhocException"))r.errorPopup.show(e.getResponseHeader("adhocException"));else if(500==e.status||e.getResponseHeader("JasperServerError")&&!e.getResponseHeader("SuppressError")){var n=JSON.parse(e.responseText),a="<p>"+s+"</p><p>"+n.message+"</p><p>"+n.parameters[0]+"</p>";r.errorPopup.show(a)}},always:function(){r.popup.hide(n("#loading")[0])}},o.SLOW_REQUEST_TIMEOUT=2e3,window.CalculatedFieldsService=o,o});