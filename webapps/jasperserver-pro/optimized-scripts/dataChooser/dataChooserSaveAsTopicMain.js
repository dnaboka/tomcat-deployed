var domain={PROPAGATE_EVENT:"propagateEvent",_messages:{},disabledFolderTooltip:"disabledFolderTooltip",attributesPattern:new RegExp("\\s*attribute\\s*\\(\\s*'[^\\/'\\s][^\\/']*'(?:\\s*,\\s*'[^\\/'\\s][^\\/']*')*\\s*\\)\\s*"),getMessage:function(e,t){var i=this._messages[e];return i?new Template(i).evaluate(t?t:{}):""},setMessage:function(e,t){this._messages[e]=t},treeErrorHandler:function(){throw"exception while loading tree"},submitForm:function(e,t,i){if(t){var a=buildActionUrl(t);i&&i(),$(e).writeAttribute("method","post").writeAttribute("action",a),$(e).submit()}},sendAjaxRequest:function(e,t,i,a){var n=buildActionUrl(e),o={postData:Object.toQueryString(t),callback:i,errorHandler:this._serverErrorHandler,mode:AjaxRequester.prototype.EVAL_JSON};a&&Object.extend(o,a),ajaxTargettedUpdate(n,o)},_serverErrorHandler:function(e,t){return baseErrorHandler(e)},elementClicked:function(e,t){return e&&t?matchAny(e,[t],!0):!1},basicClickHandler:function(e,t,i){var a=null;return t.any(function(t){return a=domain.elementClicked(e,t.key),a?(Object.isFunction(t.value)?t.value(a):Object.isFunction(i)&&i(t.value),!0):void 0})},registerClickHandlers:function(e,t,i){if(domain._bodyClickEventHandlers)return void(i?Array.prototype.unshift:Array.prototype.push).apply(domain._bodyClickEventHandlers,e);domain._bodyClickEventHandlers=e;var a=t?t:"body";$$(a)[0].observe(isSupportsTouch()?"touchstart":"click",function(e){var t=e.element();domain._bodyClickEventHandlers&&domain._bodyClickEventHandlers.each(function(i){var a=i(t);if(a)throw a!==domain.PROPAGATE_EVENT&&Event.stop(e),$break})})},enableButton:function(e,t){"string"==typeof e&&(e=$(e)),e.disabled=t,t?buttonManager.enable(e):buttonManager.disable(e)},setOptionsToSelect:function(e,t){return e&&(e.update(""),t)?(t.each(function(t){var i={value:t.value,title:t.label};t.selected&&(i.selected="selected");var a=new Element("option",i);a.appendChild(document.createTextNode(t.label)),e.appendChild(a)}),e):void 0},getDataIslandId:function(e,t){var i=dynamicTree.trees[e.getTreeId()].getRootNode(),a=function n(e,t){return null===e.parent||e.parent===i?e.param.extra[t]:n(e.parent,t)};return a(e,t)},areNodesFromSameIsland:function(e,t){var i=e.any(function(e){return e.param.extra.isConstant});if(i)return!0;var a=1===e.pluck("parent").uniq().length;return a?!0:1===e.map(function(e){return domain.getDataIslandId(e,t||"itemId")}).uniq().length},NumberFormat:function(e,t){var i="."===e,a=new RegExp("["+e.gsub(/\s/,"\\s")+"]+"),n=new RegExp("["+t.gsub(/\s/,"\\s")+"]+"),o=new RegExp("^-|\\"+t+"?\\d+|\\"+t+"$|\\"+e+"+","g");return{toNumber:function(e){return!e||!i&&/[.]/.test(e)?NaN:Number(e.gsub(n,"").gsub(a,"."))||domain.attributesPattern.test(e)},normalizeNumberEntry:function(i){var a=i.strip(),n=a.match(domain.attributesPattern)||a.match(o);if(!n)return"";for(var r=!1,s=0;s<n.length;s++)n[s].startsWith(e)?r?delete n[s]:(n[s]=e,r=!0):n[s].startsWith(t)&&r&&(n[s]=n[s].substring(1));var d=n.join("");return d},isInteger:function(e){return a.test(e)}}},baseValidator:function(e,t){var i=!0,a="";return e()&&(a=t,i=!1),{isValid:i,errorMessage:a}},maxLengthValidator:function(e,t,i){return domain.baseValidator(function(e,t){return e.length>t}.curry(e,t),i)},minLengthValidator:function(e,t,i){return domain.baseValidator(function(e,t){return e.length<t}.curry(e,t),i)},valueNotEmptyValidator:function(e,t){return domain.baseValidator(function(e){return Object.isArray(e)&&0===e.length||!e||!String(e).strip()}.curry(e),t)},stringIdValidator:function(e,t){return domain.baseValidator(function(e){return!/^[^0-9() .,'"=!+-\/><\/\/:][^() .,'"=!+-\/><\/\/:]*$/.test(e)}.curry(e),t)},numberValidator:function(e,t,i){return domain.baseValidator(isNaN.curry(t.toNumber(e)),i)},numberBoundsValidator:function(e,t,i){return domain.baseValidator(function(e,t){return e===1/0||e===-(1/0)?!0:!(e<=t.max&&e>=t.min)}.curry(e,t),i)},rangeValidator:function(e,t,i){return domain.baseValidator(function(e,t){return!(t>e)}.curry(e,t),i)},dateValidator:function(e,t,i){return domain.baseValidator(function(e,t){return 0===getDateFromFormat(t,e)&&!domain.attributesPattern.test(t)}.curry(t,e),i)},unescapeTree:function e(t){t.hasChilds()&&_.each(t.childs,function(t){e(t)}),t.name=xssUtil.unescape(t.name)}};domain.NodeCopyMoveController=function(){},domain.NodeCopyMoveController.addMethod("copy",function(e,t,i){if(e&&e.length>0&&t){var a=dynamicTree.trees[t.getTreeId()],n=e.collect(function(e){var n=e.param.id,o=this._copyParentStructure(e,a);return o?this._mergeToDestTree(o,t,n,i):null}.bind(this));return t.isloaded=!0,n.without(null)}}),domain.NodeCopyMoveController.addMethod("copySelected",function(e,t){return sourceTree&&t?this.copy(sourceTree.selectedNodes,t):void 0}),domain.NodeCopyMoveController.addMethod("move",function(e,t){if(e&&t){var i=this.copy(e,t);return this.hide(e),i}}),domain.NodeCopyMoveController.addMethod("moveSelected",function(e,t){return e&&t?this.move(e.selectedNodes,t):void 0}),domain.NodeCopyMoveController.addMethod("hide",function(e,t,i){if(e&&e.length>0){t||(t=this._getVisibleChildrenCount),i||(i=function(e,t){e.hide(t)});var a=dynamicTree.trees[e[0].getTreeId()];e.collect(function(e){return e.id}).each(function(e){var n=dynamicTree.nodes[e];i(n,!0);for(var o=n.parent;o&&o!=a.getRootNode()&&!(t(o)>0);)i(o,!1),o.refreshStyle(),o=o.parent}.bind(this))}}),domain.NodeCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){return e.param.id}),domain.NodeCopyMoveController.addMethod("_markAsLoaded",function(e){e.isloaded=!0,e.isParent()&&e.childs.each(function(e){this._markAsLoaded(e)}.bind(this))}),domain.NodeCopyMoveController.addMethod("_mergeToDestTree",function(e,t,i,a){if(t){var n=dynamicTree.trees[t.getTreeId()];if(a)return i=this._handleDuplicatedNode(e,t),n.findNodeById(i,e);var o=n.findNodeChildByMetaName(t,e.param.id);return null!=o?(o.isHidden()&&o.show(),e.hasChilds()&&(o.disabled&&o.enable(e.tooltip),e.childs.each(function(e){this._mergeToDestTree(e,o)}.bind(this))),n.findNodeById(i,o)):(t.addChild(e),this._markAsLoaded(e),n.findNodeById(i,e))}}),domain.NodeCopyMoveController.addMethod("_copyParentStructure",function(e,t){if(e&&t){var i=dynamicTree.trees[e.getTreeId()];if(e.disabled)return null;for(var a=this._copyNode(e,t,!0),n=e.parent,o=null;n&&n!=i.getRootNode();)o=this._copyNode(n,t,!1),o.addChild(a),a=o,n=n.parent;return a}}),domain.NodeCopyMoveController.addMethod("_buildMetanode",function(e){return deepClone(e.param)}),domain.NodeCopyMoveController.addMethod("_copyNode",function(e,t,i){if(e&&t){var a=t.processNode(this._buildMetanode(e));i&&(e.hasChilds()?e.childs.each(function(e){if(!e.disabled){var e=this._copyNode(e,t,i);e&&a.addChild(e)}}.bind(this)):a.setHasChilds(!1));var n=e.childs.findAll(function(e){return e.disabled});return e.childs.length>0&&n.length==e.childs.length?null:a}}),domain.NodeCopyMoveController.addMethod("_delete",function(e){e&&e.collect(function(e){return e.id}).each(function(e){var t=dynamicTree.nodes[e];t&&t.parent.removeChild(t)})}),domain.NodeCopyMoveController.addMethod("_getVisibleChildrenCount",function(e){var t=e.childs.findAll(function(e){return e.isHidden()});return e.childs.length-t.length}),domain.resetTreeSelectionHandler={_COMMON_ELEMENTS_TO_SAVE_SELECTION:["#pageDimmer","#detail","#standardConfirm"],_getTrees:null,_elementIds:null,_callback:null,_validator:null,init:function(e,t,i,a){domain.resetTreeSelectionHandler._init.bind(domain.resetTreeSelectionHandler,e,t,i,a)()},_init:function(e,t,i,a){this._getTrees=t,this._callback=i,this._validator=a,this._elementIds=this._COMMON_ELEMENTS_TO_SAVE_SELECTION.concat(e),domain.registerClickHandlers([this._removeTreeSelectionClickEventHandler.bind(this)],null,!0)},_removeTreeSelectionClickEventHandler:function(e){if(!matchAny(e,this._elementIds,!0)){var t=!1;return this._getTrees().each(function(e){if(e.selectedNodes&&e.selectedNodes.first())throw t=!0,$break}),t?this._validator&&!this._validator()?!0:(this._getTrees().each(function(e){e._deselectAllNodes()}),this._callback&&this._callback(),!1):!1}}},domain.NodeChangeOrderController=function(){},domain.NodeChangeOrderController.addMethod("findNodeWithSpecificOrder",function(e,t,i){for(var a=e.length-1;a>=0;a--)if(e[a].isSelected()==i&&e[a].orderNumber===t)return e[a];return null}),domain.NodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i){var a=null,n=null;return e.each(function(e){e.isSelected()==t&&(null===a||i==e.orderNumber<a)&&(a=e.orderNumber,n=e)}),n}),domain.NodeChangeOrderController.addMethod("moveNode",function(e,t,i,a){var n=e.orderNumber,o=e.parent.childs,r=null,s=null;i?(r=this.findMaxSiblingNode(o,!1,t,e.param.type),s=r?r.orderNumber:-1,o.each(function(i){i.param.id!==e.param.id&&(t==i.orderNumber>s&&t==i.orderNumber<n||i.orderNumber==s)&&(i.orderNumber=t?i.orderNumber+1:i.orderNumber-1,a&&a(i,i.orderNumber))}),a&&a(e,s),e.orderNumber=s):(s=t?e.orderNumber-1:e.orderNumber+1,r=this.findNodeWithSpecificOrder(o,s,!1),r&&(a&&a(e,s),a&&a(r,n),e.orderNumber=s,r.orderNumber=n))}),domain.NodeChangeOrderController.addMethod("nodeAscSorter",function(e,t){return e.orderNumber-t.orderNumber}),domain.NodeChangeOrderController.addMethod("nodeDescSorter",function(e,t){return t.orderNumber-e.orderNumber}),domain.DisplayNodeChangeOrderController=function(){domain.NodeChangeOrderController.call()},domain.DisplayNodeChangeOrderController.prototype=deepClone(domain.NodeChangeOrderController.prototype),domain.DisplayNodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i,a){var n=null,o=null;return e.each(function(e){e.isSelected()==t&&(null!==n&&i!=e.orderNumber<n||(a?e.param.type!==a:0)||(n=e.orderNumber,o=e))}),o}),define("domain.base",["jquery","underscore","backbone","utils.common"],function(e){return function(){var t;return t||e.domain}}(this));var REPORT_TYPE_PARAM="reportType",REPORT_TYPE_URL_PARAM_PATTERN=new RegExp("[\\?&]"+REPORT_TYPE_PARAM+"=([^&#]*)");domain.chooser={FLOW_ID:"adhocFlow",FIELDS:"dataChooserFields",DISPLAY:"dataChooserDisplay",SAVE_AS_TOPIC:"dataChooserSaveAsTopic",PRE_FILTERS:"dataChooserPreFilters",submitFormId:"stepDisplayForm",currentPage:null,flowExecutionKey:null,unsavedChangesPresent:!1,initialize:function(e){var t=REPORT_TYPE_URL_PARAM_PATTERN.exec(location.search);if(this.reportType=null==t?"":decodeURIComponent(t[1].replace(/\+/g," ")),localContext.rsInitOptions){var i=localContext.rsInitOptions;this.currentPage=$(document.body).identify(),this.flowExecutionKey=i.flowExecutionKey,this.unsavedChangesPresent=i.unsavedChangesPresent;var a=this.pageInitFactory[this.currentPage]();i=_.extend({},i,e),this.initModule(a,i),domain.registerClickHandlers([this.getFlowControlsClickEventHandler()])}},initModule:function(e,t){e&&(e.fillForm&&(dc.fillForm=e.fillForm.bind(e)),e.getFlowControlsClickEventHandler&&(dc.getFlowControlsClickEventHandler=e.getFlowControlsClickEventHandler.bind(e)),e.init.bind(e)(t))},fillForm:function(){},getFlowControlsClickEventHandler:function(){return dc.flowControlsClickEventHandler.bind(dc)},flowControlsClickEventHandler:function(e){var t=!1;return this.flowControlsEventMap.each(function(i){if(domain.elementClicked(e,i.key)){if(t=!0,i.value.returnOnPage&&this.currentPage===i.value.returnOnPage)throw $break;if(i.value.confirmLeave&&!this.confirmAndLeave())throw $break;throw delete i.value.returnOnPage,i.value.flowId=this.FLOW_ID,i.value.flowExecutionKey=this.flowExecutionKey,i.value.reportType=this.reportType,__jrsConfigs__.initAdditionalUIComponents||(i.value.decorate="no"),"cancelRedirect"===i.value.eventId&&jQuery(document).trigger("adhocDesigner:cancel"),domain.submitForm(this.submitFormId,i.value,this.fillForm),$break}}.bind(this)),t}};var dc=domain.chooser;dc.confirmAndLeave=function(){return dc.unsavedChangesPresent?confirm(domain.getMessage("exitMessage")):!0},dc.setUnsavedChangesPresent=function(e){dc.unsavedChangesPresent=!!e},dc.isUnsavedChangesPresent=function(){return dc.unsavedChangesPresent},dc.pageInitFactory={dataChooserFields:function(){return dc_fields},dataChooserPreFilters:function(){return dc_filters},dataChooserDisplay:function(){return dc_display},dataChooserSaveAsTopic:function(){return dc_saveAs}},dc.flowControlsEventMap=$H({"#fieldsTab":{returnOnPage:domain.chooser.FIELDS,eventId:"fields"},"#filtersTab":{returnOnPage:domain.chooser.PRE_FILTERS,eventId:"preFilters"},"#displayTab":{returnOnPage:domain.chooser.DISPLAY,eventId:"display"},"#saveTopicTab":{returnOnPage:domain.chooser.SAVE_AS_TOPIC,eventId:"saveAsTopic"},"#goToDesigner":{eventId:"done",reportType:dc.reportType},"#cancel":{eventId:"cancelRedirect",confirmLeave:!0}}),define("domain.chooser",["domain.base"],function(e){return function(){var t;return t||e.domain}}(this)),domain.ItemNode=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("ItemGroupType"),Leaf:new dynamicTree.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_fields:fields",this._hidden=!1,this.disabled=!1},domain.ItemNode.prototype=deepClone(dynamicTree.TreeNode.prototype),domain.ItemNode.addMethod("hide",function(e){if(e&&this.hasChilds())for(var t=0;t<this.getChildCount();t++)this.childs[t].hide(!0);var i=(this.childs.findAll(function(e){return e.disabled}).length,this.childs.findAll(function(e){return e.isHidden()}).length),a=this.childs.length-i;this.disabled||0!==a?this.getType()===this.Types.Leaf&&(this.deselect(),this.disable(domain.getMessage(domain.disabledFolderTooltip))):(this._hidden=!0,this.deselect(),this.refreshStyle())}),domain.ItemNode.addMethod("show",function(){this._hidden=!1,this._getElement()&&this.refreshStyle(this._getElement())}),domain.ItemNode.addMethod("disable",function(e){e&&(this.tooltip=e),this.disabled=!0,this._getElement()&&this.refreshStyle(this._getElement())}),domain.ItemNode.addMethod("enable",function(e){e&&(this.tooltip=e),this.disabled=!1,this._getElement()&&this.refreshStyle(this._getElement())}),domain.ItemNode.addMethod("refreshStyle",function(e){if(e||(e=this._getElement())){dynamicTree.TreeNode.prototype.refreshStyle.call(this,e),this.isHidden()?e.addClassName(layoutModule.HIDDEN_CLASS):e.removeClassName(layoutModule.HIDDEN_CLASS);var t=e.select("p").first();t&&(this.tooltip?t.title=this.tooltip:t.title="",this.disabled?(buttonManager.disable(t),buttonManager.disable(e)):(buttonManager.enable(t),buttonManager.enable(e)))}}),domain.ItemNode.addMethod("isHidden",function(){return this._hidden}),domain.ItemNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.labelId=e.labelId||"",t.descr=e.descr,t.descrId=e.descrId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=_.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),domain.ItemNode.addMethod("hasVisibleChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.isHidden()})}),domain.ItemNode.addMethod("hasEnabledChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.disabled})}),domain.ItemNode.addMethod("removeChilds",function(){this.hasChilds()&&this.childs.each(function(e){this.removeChild(e)}.bind(this))}),domain.FieldsCopyMoveController=function(){domain.NodeCopyMoveController(this)},domain.FieldsCopyMoveController.prototype=deepClone(domain.NodeCopyMoveController.prototype),domain.FieldsCopyMoveController.addMethod("_buildMetanode",function(e){var t=deepClone(e.param);return t.label=e.name,t.order=e.orderNumber,t.tooltip=e.tooltip,t}),domain.TwoColumnNode=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("ItemGroupType",{}),Leaf:new dynamicTree.TreeNode.Type("ItemType",{})},this.nodeHeaderTemplateDomId="list_responsive:twoColumn"},domain.TwoColumnNode.prototype=deepClone(dynamicTree.TreeNode.prototype),domain.TwoColumnNode.addMethod("_createNode",function(){var e=this.id,t=(dynamicTree.trees[this.getTreeId()],this._getHeaderTemplateElement());t.id=this.NODE_ID_PREFIX+e,this.refreshStyle(t),t.treeNode=this;var i=t.childElements()[0];this.tooltip&&(i.title=this.tooltip);var a=i.childElements()[0];a.id=this.HANDLER_ID_PREFIX+e;var n=i.childElements()[1],o=this.param.extra&&this.param.extra.label?this.param.extra.label:this.name;n.insert(xssUtil.escape(o));var r=i.childElements()[2];r.insert(xssUtil.escape(this.name)),this._element=t}),domain.TwoColumnNode.addMethod("_getTitle",function(){var e=this._getElement().childElements()[0].childElements()[2];return e.cleanWhitespace(),0===e.childNodes.length&&e.appendChild(document.createTextNode("")),e.childNodes[0]}),domain.TwoColumnNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type,order:this.orderNumber.toString()};return e&&(t.labelId=e.labelId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=_.invoke(this.childs,"toJSON")),t}),domain.TwoColumnNode.addMethod("expandAllChilds",function(){var e=dynamicTree.trees[this.getTreeId()];this.isParent()&&!this.isOpen()&&(e.writeStates(this.id,dynamicTree.TreeNode.State.OPEN),this.refreshNode()),this.hasChilds()&&this.childs.each(function(e){e.expandAllChilds()})}),domain.TablesNode=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("level"),Leaf:new dynamicTree.TreeNode.Type("item")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_tables:tables"},domain.TablesNode.prototype=deepClone(domain.ItemNode.prototype),domain.TablesNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.originalId=e.originalId,t.datasourceId=e.datasourceId,t.repoId=e.repoId,t.itemId=e.itemId,t.dataSource=e.dataSource,t.table=e.table,this.isParent()?(t.query=e.query,t.dataSetType=e.dataSetType):(t.expression=e.expression,t.islandId=e.islandId,t.isConstant=e.isConstant,t.JavaType=e.JavaType,t.JdbcType=e.JdbcType),e.fieldDbName&&(t.fieldDbName=e.fieldDbName)),this.isParent()&&(t.children=_.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),domain.TablesNode.addVar("CONSTANT_TABLE_ID","constant_fields_level"),domain.TablesNode.addVar("CROSSTABLES_FIELDS_TABLE_ID","crossTablesFieldsLevel"),domain.TablesNode.addVar("INVALID_NODE_CLASS","invalid"),domain.TablesNode.addVar("DATA_ISLAND_CLASS","dataIsland"),domain.TablesNode.addVar("DERIVED_TABLE_CLASS","table derived"),domain.TablesNode.addVar("CONSTANT_TABLE_CLASS","table constant"),domain.TablesNode.addVar("CALCULATED_FIELD_CLASS","field calculated"),domain.TablesNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(domain.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS),this.param.extra&&this.param.extra.expression&&e.addClassName(this.CALCULATED_FIELD_CLASS),this.param.extra&&this.param.extra.query&&e.addClassName(this.DERIVED_TABLE_CLASS),this.param.id===this.CONSTANT_TABLE_ID&&e.addClassName(this.CONSTANT_TABLE_CLASS),this.param.extra&&this.param.extra.isIsland&&e.addClassName(this.DATA_ISLAND_CLASS))}),domain.TablesNode.addMethod("edit",function(e){e&&"dblclick"!==e.type||domain.ItemNode.prototype.edit.call(this,e)}),domain.TablesCustomNode=function(e){domain.TablesNode.call(this,e),this.nodeHeaderTemplateDomId=e.param.type===this.Types.Folder.name?"list_responsive_collapsible_type_tables:tables":"list_responsive_collapsible_type_tables:fields"},domain.TablesCustomNode.prototype=deepClone(domain.TablesNode.prototype),domain.TablesCopyMoveController=function(){domain.NodeCopyMoveController(this)},domain.TablesCopyMoveController.prototype=deepClone(domain.NodeCopyMoveController.prototype),domain.TablesCopyMoveController.addMethod("_buildMetanode",function(e){var t={id:e.param.id,label:e.name,type:e.param.type,uri:e.param.uri};return e.param.extra&&(t.extra={originalId:e.param.extra.originalId,table:e.param.extra.table,itemId:e.param.extra.itemId,datasourceId:e.param.extra.datasourceId,repoId:e.param.extra.repoId,dataSource:e.param.extra.dataSource,dataSetType:e.param.extra.dataSetType,query:e.param.extra.query},e.param.extra.expression&&(t.extra.expression=e.param.extra.expression),e.param.extra.fieldDbName&&(t.extra.fieldDbName=e.param.extra.fieldDbName),e.isParent()||(t.extra.JavaType=e.param.extra.JavaType,t.extra.JdbcType=e.param.extra.JdbcType,t.extra.sourceItem=e.parent.param.extra.originalId)),t}),domain.TablesCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){if(e.isParent()){for(var i=1,a=e.param.extra.datasourceId+"."+e.param.extra.itemId+i,n=dynamicTree.trees[t.getTreeId()];n.findNodeChildByMetaName(t,a);)i++,a=e.param.extra.datasourceId+"."+e.param.extra.itemId+i;return e.param.id=a,e.param.extra.itemId+=i,e.name=e.param.extra.itemId,e.param.extra.originalId=e.param.extra.itemId,t.addChild(e),e.isloaded=!0,e.hasChilds()&&e.childs.each(function(t){this._handleDuplicatedNode(t,e)}.bind(this)),a}e.param.id=e.parent.param.id+"."+e.param.extra.itemId,e.param.extra.originalId=e.parent.param.extra.originalId+"."+e.param.extra.itemId}),domain.DerivedTablesNode=function(e){domain.TablesNode.call(this,e),e.param.type===this.Types.Folder.name&&e.param.extra&&e.param.extra.query&&(this.isSelectable=!0)},domain.DerivedTablesNode.prototype=deepClone(domain.TablesNode.prototype),domain.JoinsList=function(e,t){dynamicList.List.call(this,e,t)},domain.JoinsList.prototype=deepClone(dynamicList.List.prototype),domain.JoinsList.addMethod("_changeHandler",function(e){var t=this.getItemByEvent(e);t&&(t._respondOnItemEvents&&!e.isInvoked&&this.fire("item:change",{targetEvent:e,item:t}),e.isInvoked=!0)}),domain.JoinsList.addMethod("_initEvents",function(){dynamicList.List.prototype._initEvents.call(this);var e=this._getElement();jQuery(e).off("change").on("change","select",_.bind(this._changeHandler,this))}),domain.JoinsListItem=function(e){dynamicList.ListItem.call(this,e),this._hidden=!1},domain.JoinsListItem.prototype=deepClone(dynamicList.ListItem.prototype),domain.JoinsListItem.addMethod("hide",function(e){this._hidden=!!e,this.refreshStyle()}),domain.JoinsListItem.addMethod("refreshStyle",function(){dynamicList.ListItem.prototype.refreshStyle.call(this),this._getElement()&&(this._hidden?this._getElement().addClassName(layoutModule.HIDDEN_CLASS):this._getElement().removeClassName(layoutModule.HIDDEN_CLASS))}),domain.JoinsListItem.addMethod("processTemplate",function(e){var t=e.childElements()[0];t.cleanWhitespace();var i=t.childElements()[1],a=t.childElements()[2],n=t.childElements()[3],o=n.childElements()[0],r=o.childElements();return i.update(xssUtil.escape(this._value.left.table.label)+":"+xssUtil.escape(this._value.left.label)),a.update(xssUtil.escape(this._value.right.table.label)+":"+xssUtil.escape(this._value.right.label)),r.each(function(e){e.selected=e.value===this._value.type}.bind(this)),e}),domain.JoinsListItem.addMethod("setJoinType",function(e){this.getValue().type=e;var t=this._getElement();if(t){var i=t.childElements()[0].childElements()[3].childElements()[0];$(i).value=e}}),domain.JoinsListItem.addMethod("toJSON",function(){return{left:this._value.left.id,right:this._value.right.id,type:this._value.type}}),domain.DisplayNode=function(e){domain.ItemNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("ItemGroupType"),Leaf:new dynamicTree.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_sets:sets"},domain.DisplayNode.prototype=deepClone(domain.ItemNode.prototype),domain.DisplayNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,type:this.param.type};return e&&(t.itemId=e.itemId,t.descr=e.descr,t.labelId=e.labelId||"",t.descrId=e.descrId||"",t.resourceId=e.resourceId||""),e&&e.label&&(t.label=e.label),this.isParent()?t.children=_.chain(this.childs).filter(function(e){return!e.isHidden()&&!e._markAsDeleted}).invoke("toJSON").value():(t.dataType=e.dataType,t.dimensionOrMeasure=e.dimensionOrMeasure,t.defaultMask=e.defaultMask,t.defaultAgg=e.defaultAgg),t}),domain.DisplayNode.addVar("INVALID_NODE_CLASS","invalid"),domain.DisplayNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(domain.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS))}),domain.genericTreeParams={rootUri:"/",showRoot:!1,nodeClass:domain.ItemNode,treeClassName:"",multiSelectEnabled:!0},domain.createItemsTree=function(e){return e=Object.extend(deepClone(domain.genericTreeParams),e),new dynamicTree.TreeSupport(e.treeId,e)},domain.confirmDialog={MODE_OK_CANCEL:"okCancel",MODE_YES_NO:"yesNo",_CONFIRM_DIALOG_DOM_ID:"standardConfirm",_CONFIRM_DIALOG_BODY_DOM_PATTERN:"#standardConfirm > .content > .body",_CONFIRM_DIALOG_OK_BUTTON_ID:"#confirmYes",_CONFIRM_DIALOG_CANCEL_BUTTON_ID:"#confirmNo",_CONFIRM_DIALOG_OK_PATTERN:"#confirmYes > span",_CONFIRM_DIALOG_CANCEL_PATTERN:"#confirmNo > span",_yesMessageHolder:null,_noMessageHolder:null,_dialog:null,_onOk:null,_onCancel:null,_customEventHandler:null,_templateDomId:null,_visible:!1,init:function(){domain.confirmDialog._init.bind(domain.confirmDialog)()},show:function(e,t,i,a,n){domain.confirmDialog._show.bind(domain.confirmDialog,e,t,i,a,n)()},hideForDetails:function(){dialogs.popup.hide(domain.confirmDialog._dialog)},showFromDetails:function(){dialogs.popup.show(domain.confirmDialog._dialog,!0)},visible:function(){return domain.confirmDialog._visible},_init:function(){this._dialog=$(this._CONFIRM_DIALOG_DOM_ID),this._yesMessageHolder=$$(this._CONFIRM_DIALOG_OK_PATTERN).first(),this._noMessageHolder=$$(this._CONFIRM_DIALOG_CANCEL_PATTERN).first(),domain.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e,t,i,a,n){this._onOk=t,this._onCancel=i,this._customEventHandler=a,this._templateDomId=e,n&&n==this.MODE_YES_NO?(this._yesMessageHolder.update(domain.getMessage("yes")),this._noMessageHolder.update(domain.getMessage("no"))):(this._yesMessageHolder.update(domain.getMessage("ok")),this._noMessageHolder.update(domain.getMessage("cancel"))),$(this._templateDomId).removeClassName(layoutModule.HIDDEN_CLASS),dialogs.popup.show(this._dialog,!0),this._visible=!0},_hide:function(e){$(this._templateDomId).addClassName(layoutModule.HIDDEN_CLASS),dialogs.popup.hide(this._dialog),this._visible=!1,e&&e()},_clickEventHandler:function(e){return domain.elementClicked(e,this._CONFIRM_DIALOG_OK_BUTTON_ID)?(this._hide(this._onOk),!0):domain.elementClicked(e,this._CONFIRM_DIALOG_CANCEL_BUTTON_ID)?(this._hide(this._onCancel),!0):this._customEventHandler?this._customEventHandler(e):void 0}},domain.detailsDialog={_DETAIL_DIALOG_DOM_ID:"detail",_DETAIL_DIALOG_CLOSE_BUTTON_ID:"#close",_DETAIL_DIALOG_LIST_DOM_ID:"detailsList",_DETAIL_DIALOG_TEXT_DOM_ID:"detailsText",_LIST_TEMPLATE:"defaultListTemplate",_LIST_ITEM_TEMPLATE:"dynamicListItemTemplate",_dialog:null,_showConfirmAfterClose:!1,_list:null,_listItems:null,init:function(){domain.detailsDialog._init.bind(domain.detailsDialog)()},show:function(e){domain.detailsDialog._show.bind(domain.detailsDialog,e)()},_init:function(){this._dialog=$(this._DETAIL_DIALOG_DOM_ID),domain.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e){domain.confirmDialog.visible()?(domain.confirmDialog.hideForDetails(),this._showConfirmAfterClose=!0):this._showConfirmAfterClose=!1,this._createMessage(e),dialogs.popup.show(this._dialog,!0),$(this._DETAIL_DIALOG_LIST_DOM_ID).parentNode.scrollTop=0},_createMessage:function(e){"string"==typeof e?($(this._DETAIL_DIALOG_LIST_DOM_ID).addClassName(layoutModule.HIDDEN_CLASS),$(this._DETAIL_DIALOG_TEXT_DOM_ID).removeClassName(layoutModule.HIDDEN_CLASS).update(e)):($(this._DETAIL_DIALOG_TEXT_DOM_ID).addClassName(layoutModule.HIDDEN_CLASS),$(this._DETAIL_DIALOG_LIST_DOM_ID).removeClassName(layoutModule.HIDDEN_CLASS),this._items&&(this._list.removeItems(this._items),this._items=null,this._list=null),this._items=e.collect(function(e){return new dynamicList.ListItem({label:e})}),this._list=new dynamicList.List(this._DETAIL_DIALOG_LIST_DOM_ID,{listTemplateDomId:this._LIST_TEMPLATE,itemTemplateDomId:this._LIST_ITEM_TEMPLATE,items:this._items}),this._list.show())},_close:function(){dialogs.popup.hide(this._dialog),this._showConfirmAfterClose&&domain.confirmDialog.showFromDetails()},_clickEventHandler:function(e){return domain.elementClicked(e,this._DETAIL_DIALOG_CLOSE_BUTTON_ID)?(this._close(),!0):void 0}},define("domain.components",["domain.base","dynamicTree.utils","components.list"],function(e){return function(){var t;return t||e.domain}}(this)),dc.saveAsTopic={RESOURCE_DOESNT_EXISTS_RESPONSE:"resource doesnt exist",RESOURCE_ALREADY_EXISTS_RESPONSE:"resource already exists",RESOURCE_OF_OTHER_TYPE_EXISTS_RESPONSE:"resource of other type already exists",ID_TOPIC_NAME:"topicName",ID_TOPIC_LOCATION:"topicLocation",ID_TOPIC_DESCRIPTION:"topicDesc",ID_DATA_LIFETIME:"dataStrategy_dataLifetimeMinutes",ID_STAGED:"dataStrategy_staged",ID_MAX_ROWS:"dataStrategy_maxRows",ID_HIDDEN_TOPIC_NAME:"slTopicLabel",ID_HIDDEN_TOPIC_LOCATION:"slTopicLocation",ID_HIDDEN_TOPIC_DESCRIPTION:"slTopicDesc",ID_SAVE_AS_TOPIC_CONFIRM:"standardConfirm",SAVE_TOPIC_BUTTONS:["#goToDesigner"],ID_ENABLE_STAGING:"#dataStrategy_staged",ID_STAGING_QUERY_TIMEOUT:"#dataStrategy_dataLifetimeMinutes",ID_SAVE_AS_TOPIC_INPUTS:"#saveAsTopicInputs",EDIT_MODE:"editMode",CREATE_MODE:"createMode",ID_MIN_MAX_STAGING_QUERY_TIMEOUT_CHANGED:"#minMaxTimeNote",CLASS_LIFETIME_INFO:".lifeTimeInfo",idToAttrMap:{dataStrategy_dataLifetimeMinutes:"stagingQueryTimeOut",topicDesc:"description",topicName:"name",topicLocation:"location"},defaultStagingTimeout:{min:10,max:10080},minutesIn:{day:1440,hour:60},fillForm:function(){$("slTopicLabel").writeAttribute("value",this.saveAsTopicModel.get("name")),$("slTopicLocation").writeAttribute("value",this.saveAsTopicModel.get("location")),$("slTopicDesc").writeAttribute("value",this.saveAsTopicModel.get("description")),"true"===this.params.stagingEnabled&&($("slDataStrategy_staged").writeAttribute("value",this.saveAsTopicModel.get("stagingEnabled").toString()),$("slDataStrategy_dataLifetimeMinutes").writeAttribute("value",this.saveAsTopicModel.get("stagingQueryTimeOut")))},getFlowControlsClickEventHandler:function(){return this._flowControlsClickEventHandlerWrapper.bind(this)},init:function(e){var t=this;this.params=e,this.organizationId=e.organizationId,this.storedTopicLocationPath=e.folderURI,this.ORGANIZATIONS_FOLDER_URI=e.organizationsFolderUri,this.ORGANIZATION_MATCHER="^#{org}(/[^/]+#{org})*$".interpolate({org:dc.saveAsTopic.ORGANIZATIONS_FOLDER_URI});var i=e.maxTopicDescription,a=e.maxTopicName;this.minStagingQueryTimeOut=e.minStagingTopicMinutes||this.defaultStagingTimeout.min,this.maxStagingQueryTimeOut=e.maxStagingTopicMinutes||this.defaultStagingTimeout.max,this.topicStagingEnabled=JSON.parse(""===e.topicStagingEnabled?!1:e.topicStagingEnabled),this.enableStaging=jQuery(this.ID_ENABLE_STAGING),this.stagingQueryTimeOut=jQuery(this.ID_STAGING_QUERY_TIMEOUT),this.minMaxQueryTimeoutNote=jQuery(this.ID_MIN_MAX_STAGING_QUERY_TIMEOUT_CHANGED),this.lifeTimeInfo=jQuery(this.CLASS_LIFETIME_INFO),this.goToDesignerButton=jQuery("#goToDesigner"),this.saveAsTopicInputs=jQuery(this.ID_SAVE_AS_TOPIC_INPUTS),this.name=jQuery("#"+this.ID_TOPIC_NAME),this.description=jQuery("#"+this.ID_TOPIC_DESCRIPTION),this.topicLocation=$(this.ID_TOPIC_LOCATION),this.saveTopicBtn=null,this.saveAsTopicConfirm=$(this.ID_SAVE_AS_TOPIC_CONFIRM),this._clickHandlersHash=this._clickHandlersFactory(),domain.registerClickHandlers([this._flowControlsClickEventHandlerWrapper.bind(this),this._clickHandler.bind(this)]),this.setUpStagingQueryTimeOutValue(this.params.topicStagingQueryCacheTimeout||this.minStagingQueryTimeOut),
this.initDataLifetimeInputs(),this.initSaveAsTopicModel({name:t.params.topicName||"",description:t.params.topicDescription||"",location:t.params.folderURI,stagingQueryTimeOut:t.stagingQueryTimeOutValue,stagingEnabled:t.topicStagingEnabled},{customValidationValues:{maxNameLength:a,maxDescLength:i,minStagingQueryTimeOut:t.minStagingQueryTimeOut,maxStagingQueryTimeOut:t.maxStagingQueryTimeOut,i18n:{maxStagingQueryTimeOut:t.stagingQueryTimeOutDDHHMM.max,minStagingQueryTimeOut:t.stagingQueryTimeOutDDHHMM.min}}}),this.initEvents()},initEvents:function(){var e=this;this.enableStaging.change(function(){e.toggleStaging()}),this.saveAsTopicModel.bind("attr:invalid",function(e,t,i,a){var n=jQuery(a.el),o=_.isUndefined(a.silent)?!1:a.silent;i&&!o&&(n.is("input")||n.is("textarea")?(n.parent().addClass("error"),n.siblings(".message.warning").text(i)):(n.addClass("error"),n.find(".message.warning").text(i)))}),this.saveAsTopicModel.bind("attr:valid",function(e,t,i,a){var n=jQuery(a.el);n.is("input")||n.is("textarea")?(n.parent().removeClass("error"),n.siblings(".message.warning").text("")):(n.removeClass("error"),n.find(".message.warning").text(""))}),this.saveAsTopicInputs.on("keyup","input, textarea",function(t){var i=e.idToAttrMap[this.id],a=this;i&&(e.saveAsTopicModel.set(i,a.value),e.saveAsTopicModel.validateAttr(i,a.value,{el:a,silent:!0}))})},setUpStagingQueryTimeOutValue:function(e){this.stagingQueryTimeOutValue=e,e>this.maxStagingQueryTimeOut&&(this.stagingQueryTimeOutValue=this.maxStagingQueryTimeOut,this.minMaxQueryTimeoutNote.find("span").text(domain._messages["page.saveAsTopic.dataLifetime.max.was.changed"]),this.minMaxQueryTimeoutNote.show()),e<this.minStagingQueryTimeOut&&(this.stagingQueryTimeOutValue=this.minStagingQueryTimeOut,this.minMaxQueryTimeoutNote.find("span").text(domain._messages["page.saveAsTopic.dataLifetime.min.was.changed"]),this.minMaxQueryTimeoutNote.show())},initSaveAsTopicModel:function(e,t){this.saveAsTopicModel=new this.params.model(e,t)},initDataLifetimeInputs:function(){var e=this;this.stagingQueryTimeOutDDHHMM={max:this.convertToDDHHMM(e.maxStagingQueryTimeOut).stringFormat,min:this.convertToDDHHMM(e.minStagingQueryTimeOut).stringFormat},this.daysInput=this.stagingQueryTimeOut.find("input.days"),this.hoursInput=this.stagingQueryTimeOut.find("input.hours"),this.minutesInput=this.stagingQueryTimeOut.find("input.minutes"),this.setDataLifetimeInfo(),this.setDataLifetimeInputsValues(this.convertToDDHHMM(this.stagingQueryTimeOutValue).values),this.stagingQueryTimeOut.on("keydown","input",function(e){var t=e.which?e.which:event.keyCode;46!=t&&t>31&&(48>t||t>57)&&(96>t||t>105)&&!e.ctrlKey&&!e.shiftKey&&37!=t&&39!=t&&e.preventDefault()}),this.stagingQueryTimeOut.on("keyup","input",function(t){e.validateDataLifetimeInputs(this);var i=e.convertToMinutes(e.daysInput.val()||0,e.hoursInput.val()||0,e.minutesInput.val()||0);e.saveAsTopicModel.set("stagingQueryTimeOut",i),e.saveAsTopicModel.validateAttr("stagingQueryTimeOut",i,{el:e.stagingQueryTimeOut,silent:!0})})},setDataLifetimeInputsValues:function(e){this.daysInput.val(e.days.value),this.hoursInput.val(e.hours.value),this.minutesInput.val(e.minutes.value)},setDataLifetimeInfo:function(){this.lifeTimeInfo.find(".minimumLifetime").text(domain._messages["page.saveAsTopic.dataLifetime.minimum"].replace("{0}",this.stagingQueryTimeOutDDHHMM.min)),this.lifeTimeInfo.find(".maximumLifetime").text(domain._messages["page.saveAsTopic.dataLifetime.maximum"].replace("{0}",this.stagingQueryTimeOutDDHHMM.max))},validateDataLifetimeInputs:function(e){var t=parseInt(e.getAttribute("max"))>=0?parseInt(e.getAttribute("max")):"",i=parseInt(e.value,10)||0;e.value!=i&&(e.value=i),i>t&&(e.value=t)},convertToMinutes:function(e,t,i){return e*this.minutesIn.day+t*this.minutesIn.hour+1*i},convertToDDHHMM:function(e){var t=e,i=Math.floor(e/this.minutesIn.day);e%=this.minutesIn.day;var a=Math.floor(e/this.minutesIn.hour);e%=this.minutesIn.hour;var n=e,o=function(e){return e.value?e.value+" "+e.units+" ":""},r={days:{value:i||"",units:1!==i?domain._messages["page.saveAsTopic.dataLifetime.units.days"]:domain._messages["page.saveAsTopic.dataLifetime.units.day"]},hours:{value:a||"",units:1!==a?domain._messages["page.saveAsTopic.dataLifetime.units.hours"]:domain._messages["page.saveAsTopic.dataLifetime.units.hour"]},minutes:{value:n||"",units:1!==n?domain._messages["page.saveAsTopic.dataLifetime.units.minutes"]:domain._messages["page.saveAsTopic.dataLifetime.units.minute"]},originalValue:t},s={stringFormat:jQuery.trim(o(r.days)+o(r.hours)+o(r.minutes)),values:r};return s},toggleStaging:function(){this.enableStaging.prop("checked")?(this.saveAsTopicModel.set("stagingEnabled",!0),this.stagingQueryTimeOut.find("input").removeAttr("disabled")):(this.saveAsTopicModel.set("stagingEnabled",!1),this.stagingQueryTimeOut.find("input").attr("disabled","disabled"),this.saveAsTopicModel.set("stagingQueryTimeOut",this.minStagingQueryTimeOut),this.saveAsTopicModel.validateAttr("stagingQueryTimeOut",this.minStagingQueryTimeOut,{el:this.stagingQueryTimeOut}),this.saveAsTopicModel.validateAttr("name",this.saveAsTopicModel.get("name"),{el:this.name}))},_changeEventIdForSaveButtons:function(){this.SAVE_TOPIC_BUTTONS.each(function(e){dc.flowControlsEventMap.get(e).eventId="save"})},_isDataValid:function(){var e=this;return _.each(this.saveAsTopicModel.attributes,function(t,i){e.saveAsTopicModel.validateAttr(i,t,{el:e[i]})}),this.saveAsTopicModel.isValid(!0)},_flowControlsClickEventHandlerWrapper:function(e){function t(e,t){if(!e)return!0;var i=!0;return _.each(e,function(e,a){e?(i=!1,ValidationModule.showError(t[a],e)):ValidationModule.hideError(t[a])}),i}var i=!1;return this.SAVE_TOPIC_BUTTONS.each(function(a){if(domain.elementClicked(e,a)){if(i=!0,this.saveTopicBtn=$$(a).first(),!dc.saveAsTopic._isDataValid())throw $break;var n=this._formToParams();if(!n[this.ID_HIDDEN_TOPIC_NAME])throw dc.flowControlsClickEventHandler(e),$break;throw this.checkIfTopicExists(n,function(e){if(ValidationModule.hideError($(this.ID_TOPIC_NAME)),!e)throw"malformed server response";t(e.validation,{topicLocation:this.topicLocation})&&(e.topicExists&&"no"!=e.topicExists?"nameBusy"==e.topicExists?ValidationModule.showError($(this.ID_TOPIC_NAME),domain._messages.resource_of_other_type_exists):"yes"==e.topicExists&&this.showConfirmDialog().then(function(){this.saveTopic()}.bind(this)):this.saveTopic())}.bind(this)),$break}},this),i||dc.flowControlsClickEventHandler(e)},_clickHandler:function(e){domain.basicClickHandler(e,this._clickHandlersHash)},_clickHandlersFactory:function(){return $H({"#browser_button":function(){var e=this.repositoryBrowser;return e.isInitialized?(dialogs.popup.show(e.browseRepositoryDialog),e.saveAsTree.selectFolder($("topicLocation").getValue())):(e.init(this.params,this.saveAsTopicModel),dialogs.popup.show(e.browseRepositoryDialog)),!0}.bind(this)})},checkIfTopicExists:function(e,t){domain.sendAjaxRequest({flowExecutionKey:dc.flowExecutionKey,eventId:"checkIfExists"},e,t)},saveTopic:function(){this._changeEventIdForSaveButtons(),dc.flowControlsClickEventHandler(this.saveTopicBtn)},showConfirmDialog:function(){return dialogs.popupConfirm.show(this.saveAsTopicConfirm,null,{okButtonSelector:"#saveAsTopicOverwriteButtonId",cancelButtonSelector:"#saveAsTopicOverwriteCancelButtonId"})},_formToParams:function(){var e={};return e[this.ID_HIDDEN_TOPIC_NAME]=$F(this.ID_TOPIC_NAME)||this.params.topicName,e[this.ID_HIDDEN_TOPIC_LOCATION]=$F(this.ID_TOPIC_LOCATION)||this.params.topicLocation,e[this.ID_HIDDEN_TOPIC_DESCRIPTION]=$F(this.ID_TOPIC_DESCRIPTION)||this.params.topicDescription,void 0!==$(this.ID_DATA_LIFETIME)&&null!=$(this.ID_DATA_LIFETIME)&&(e[this.ID_DATA_LIFETIME]=this.saveAsTopicModel.get("stagingQueryTimeOut"),e[this.ID_STAGED]=$(this.ID_STAGED).checked),e}};var dc_saveAs=dc.saveAsTopic;dc_saveAs.repositoryBrowser={isInitialized:!1,init:function(e,t){this.browseRepositoryDialog=$("selectFromRepository"),this.selectFromRepoButton=$("selectFromRepoBtnSelect"),this.saveAsTree=this.createRepositoryTree(e),this.saveAsTopicModel=t,this._clickHandlersHash=this._createClickHandlersFactory(),domain.registerClickHandlers([function(e){domain.basicClickHandler(e,this._clickHandlersHash)}.bind(this)]),this.isInitialized=!0},createRepositoryTree:function(e){var t="addFileTreeRepoLocation",i="repositoryTreeFoldersProvider",a=e.folderURI?e.folderURI:"/",n=new dynamicTree.createRepositoryTree(t,{providerId:i,organizationId:e.organizationId,publicFolderUri:e.publicFolderUri});return n.getTreeId=function(){return t},n.selectFolder=function(e){n.openAndSelectNode(e)},n.getSelectedFolderUri=function(){var e=n.getSelectedNode();return e&&e.param.uri},n.observe("server:error",function(){window.console&&console.log("Server internal error occurred on repo tree loading.")}),n.observe("childredPrefetched:loaded",function(){n.openAndSelectNode(a)}),n.observe("tree:loaded",function(){n.openAndSelectNode(a)}),n.observe("node:selected",function(e){this._refreshSelectButtonState(e.memo.node)}.bind(this)),n.showTreePrefetchNodes(a),n},_refreshSelectButtonState:function(e){if(e){var t=!!e.param.uri.match(dc.saveAsTopic.ORGANIZATION_MATCHER);e.param.extra.isWritable&&!t?buttonManager.enable(this.selectFromRepoButton):buttonManager.disable(this.selectFromRepoButton)}},_createClickHandlersFactory:function(){return $H({"#selectFromRepoBtnCancel":function(){dialogs.popup.hide(this.browseRepositoryDialog)}.bind(this),"#selectFromRepoBtnSelect":function(){var e=this.saveAsTree.getSelectedFolderUri();this.saveAsTopicModel.set("location",e),$("topicLocation").value=e,dialogs.popup.hide(this.browseRepositoryDialog)}.bind(this)})}},"undefined"==typeof require&&document.observe("dom:loaded",dc.initialize.bind(dc)),define("domain.chooser.saveAsTopic",["domain.chooser","domain.components"],function(e){return function(){var t;return t||e.domain}}(this)),define("domainTopic/model/SaveAsTopicModel",["require","underscore","backbone","bundle!DomainTopicBundle","backbone.validation"],function(e){var t=e("underscore"),i=e("backbone"),a=e("bundle!DomainTopicBundle"),n=e("backbone.validation"),o=i.Model.extend({defaults:{stagingQueryTimeOut:0,name:"",location:"/",description:"",stagingEnabled:!1},validationPattern:function(e){return{name:[{fn:function(e,t,i){return i.stagingEnabled&&!e?!0:void 0},msg:a["error.name.is.required"]},{maxLength:e.maxNameLength||100,msg:a["error.name.is.too.long"].replace("{0}",e.maxNameLength||100)}],description:[{maxLength:e.maxDescLength||300,msg:a["error.description.is.too.long"].replace("{0}",e.maxDescLength||300)}],stagingQueryTimeOut:[{fn:function(e,t,i){return/^[-+]?\d+$/.test(e)?void 0:!0},msg:a["error.staging.query.time.out.only.integers.above.zero"]},{min:e.minStagingQueryTimeOut||10,msg:a["error.min.staging.query.time.out.units"].replace("{0}",e.i18n.minStagingQueryTimeOut||"10 "+a["min.staging.query.time.out.units"])},{max:e.maxStagingQueryTimeOut||10080,msg:a["error.max.staging.query.time.out.units"].replace("{0}",e.i18n.maxStagingQueryTimeOut||"7 "+a["max.staging.query.time.out.units"])}]}},initialize:function(e,t){this.setValidationRules(t&&t.customValidationValues||{i18n:{}})},setValidationRules:function(e){this.validation=this.validationPattern(e)},validateAttr:function(e,t,i){var a=n.mixin.preValidate.call(this,e,t),o={};return o[e]=t,a?this.trigger("attr:invalid",this,o,a,i):this.trigger("attr:valid",this,o,a,i),!a}});return t.extend(o.prototype,n.mixin),o}),define("dataChooser/dataChooserSaveAsTopicMain",["require","!domReady","domain.chooser.saveAsTopic","domainTopic/model/SaveAsTopicModel","jrs.configs","underscore","common/component/dialog/AlertDialog"],function(e){"use strict";var t=e("!domReady"),i=e("domain.chooser.saveAsTopic"),a=e("domainTopic/model/SaveAsTopicModel"),n=e("jrs.configs"),o=e("underscore"),r=e("common/component/dialog/AlertDialog");t(function(){if(o.extend(i._messages,n.dataChooser.domain._messages),o.extend(window.localContext,n.dataChooser.localContext),n.dataChooser.errorMessage){var e=new r;e.setMessage(n.dataChooser.errorMessage),e.open()}i.chooser.initialize({model:a})})});