function LZ(e){return(0>e||e>9?"":"0")+e}function isDate(e,t){var i=getDateFromFormat(e,t);return 0==i?!1:!0}function compareDates(e,t,i,a){var n=getDateFromFormat(e,t),o=getDateFromFormat(i,a);return 0==n||0==o?-1:n>o?1:0}function formatDate(e,t){t+="";var i,a="",n=0,o="",r="",d=e.getYear()+"",l=e.getMonth()+1,s=e.getDate(),u=e.getDay(),i=e.getHours(),c=e.getMinutes(),m=e.getSeconds(),h=new Object;for(d.length<4&&(d=""+(d-0+1900)),h.y=""+d,h.yyyy=d,h.yy=d.substring(2,4),h.M=l,h.MM=LZ(l),h.MMM=MONTH_NAMES[l-1],h.NNN=MONTH_NAMES[l+11],h.d=s,h.dd=LZ(s),h.E=DAY_NAMES[u+7],h.EE=DAY_NAMES[u],h.H=i,h.HH=LZ(i),0==i?h.h=12:i>12?h.h=i-12:h.h=i,h.hh=LZ(h.h),i>11?h.K=i-12:h.K=i,h.k=i+1,h.KK=LZ(h.K),h.kk=LZ(h.k),i>11?h.a="PM":h.a="AM",h.m=c,h.mm=LZ(c),h.s=m,h.ss=LZ(m);n<t.length;){for(o=t.charAt(n),r="";t.charAt(n)==o&&n<t.length;)r+=t.charAt(n++);a+=null!=h[r]?h[r]:r}return a}function _isInteger(e){for(var t="1234567890",i=0;i<e.length;i++)if(-1==t.indexOf(e.charAt(i)))return!1;return!0}function _getInt(e,t,i,a){for(var n=a;n>=i;n--){var o=e.substring(t,t+n);if(o.length<i)return null;if(_isInteger(o))return o}return null}function getDateFromFormat(e,t,i){e+="",t+="";for(var a,n,o=0,r=0,d="",l="",s=new Date,u=s.getYear(),c=s.getMonth()+1,m=1,h=s.getHours(),p=s.getMinutes(),f=s.getSeconds(),E="",_=!1,g=!1,T=!1;r<t.length;){for(d=t.charAt(r),l="";t.charAt(r)==d&&r<t.length;)l+=t.charAt(r++);if("yyyy"==l||"yy"==l||"y"==l){if("yyyy"==l&&(a=4,n=4),"yy"==l&&(a=2,n=2),"y"==l&&(a=2,n=4),u=_getInt(e,o,a,n),null==u)return 0;o+=u.length,2==u.length&&(u=u>70?1900+(u-0):2e3+(u-0))}else if("MMM"==l||"NNN"==l){c=0;for(var b=0;b<MONTH_NAMES.length;b++){var v=MONTH_NAMES[b];if(e.substring(o,o+v.length).toLowerCase()==v.toLowerCase()&&("MMM"==l||"NNN"==l&&b>11)){c=b+1,c>12&&(c-=12),o+=v.length;break}}if(1>c||c>12)return 0}else if("EE"==l||"E"==l)for(var b=0;b<DAY_NAMES.length;b++){var M=DAY_NAMES[b];if(e.substring(o,o+M.length).toLowerCase()==M.toLowerCase()){o+=M.length;break}}else if("MM"==l||"M"==l){if(c=_getInt(e,o,l.length,2),null==c||1>c||c>12)return 0;o+=c.length}else if("dd"==l||"d"==l){if(m=_getInt(e,o,l.length,2),null==m||1>m||m>31)return 0;o+=m.length}else if("hh"==l||"h"==l){if(h=_getInt(e,o,l.length,2),null==h||1>h||h>12)return 0;o+=h.length,_=!0}else if("HH"==l||"H"==l){if(h=_getInt(e,o,l.length,2),null==h||0>h||h>23)return 0;o+=h.length,_=!0}else if("KK"==l||"K"==l){if(h=_getInt(e,o,l.length,2),null==h||0>h||h>11)return 0;o+=h.length,_=!0}else if("kk"==l||"k"==l){if(h=_getInt(e,o,l.length,2),null==h||1>h||h>24)return 0;o+=h.length,h--,_=!0}else if("mm"==l||"m"==l){if(p=_getInt(e,o,l.length,2),null==p||0>p||p>59)return 0;o+=p.length,g=!0}else if("ss"==l||"s"==l){if(f=_getInt(e,o,l.length,2),null==f||0>f||f>59)return 0;o+=f.length,T=!0}else if("a"==l){if("am"==e.substring(o,o+2).toLowerCase())E="AM";else{if("pm"!=e.substring(o,o+2).toLowerCase())return 0;E="PM"}o+=2}else if("'"==l){var y=t.indexOf("'",r),I=t.substring(r,y),C=e.substring(o,o+(y-r));if(I!=C)return 0;r=y+1,o+=C.length}else{if(e.substring(o,o+l.length)!=l)return 0;o+=l.length}}if(!i&&o!=e.length)return 0;if(2==c)if(u%4==0&&u%100!=0||u%400==0){if(m>29)return 0}else if(m>28)return 0;if((4==c||6==c||9==c||11==c)&&m>30)return 0;12>h&&"PM"==E?h=h-0+12:h>11&&"AM"==E&&(h-=12),_||(h=0),g||(p=0),T||(f=0);var N=new Date(u,c-1,m,h,p,f);return N.getTime()}function parseDate(e){var t=2==arguments.length?arguments[1]:!1;generalFormats=new Array("y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d"),monthFirst=new Array("M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d"),dateFirst=new Array("d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M");for(var i=new Array("generalFormats",t?"dateFirst":"monthFirst",t?"monthFirst":"dateFirst"),a=null,n=0;n<i.length;n++)for(var o=window[i[n]],r=0;r<o.length;r++)if(a=getDateFromFormat(e,o[r]),0!=a)return new Date(a);return null}var domain={PROPAGATE_EVENT:"propagateEvent",_messages:{},disabledFolderTooltip:"disabledFolderTooltip",attributesPattern:new RegExp("\\s*attribute\\s*\\(\\s*'[^\\/'\\s][^\\/']*'(?:\\s*,\\s*'[^\\/'\\s][^\\/']*')*\\s*\\)\\s*"),getMessage:function(e,t){var i=this._messages[e];return i?new Template(i).evaluate(t?t:{}):""},setMessage:function(e,t){this._messages[e]=t},treeErrorHandler:function(){throw"exception while loading tree"},submitForm:function(e,t,i){if(t){var a=buildActionUrl(t);i&&i(),$(e).writeAttribute("method","post").writeAttribute("action",a),$(e).submit()}},sendAjaxRequest:function(e,t,i,a){var n=buildActionUrl(e),o={postData:Object.toQueryString(t),callback:i,errorHandler:this._serverErrorHandler,mode:AjaxRequester.prototype.EVAL_JSON};a&&Object.extend(o,a),ajaxTargettedUpdate(n,o)},_serverErrorHandler:function(e,t){return baseErrorHandler(e)},elementClicked:function(e,t){return e&&t?matchAny(e,[t],!0):!1},basicClickHandler:function(e,t,i){var a=null;return t.any(function(t){return a=domain.elementClicked(e,t.key),a?(Object.isFunction(t.value)?t.value(a):Object.isFunction(i)&&i(t.value),!0):void 0})},registerClickHandlers:function(e,t,i){if(domain._bodyClickEventHandlers)return void(i?Array.prototype.unshift:Array.prototype.push).apply(domain._bodyClickEventHandlers,e);domain._bodyClickEventHandlers=e;var a=t?t:"body";$$(a)[0].observe(isSupportsTouch()?"touchstart":"click",function(e){var t=e.element();domain._bodyClickEventHandlers&&domain._bodyClickEventHandlers.each(function(i){var a=i(t);if(a)throw a!==domain.PROPAGATE_EVENT&&Event.stop(e),$break})})},enableButton:function(e,t){"string"==typeof e&&(e=$(e)),e.disabled=t,t?buttonManager.enable(e):buttonManager.disable(e)},setOptionsToSelect:function(e,t){return e&&(e.update(""),t)?(t.each(function(t){var i={value:t.value,title:t.label};t.selected&&(i.selected="selected");var a=new Element("option",i);a.appendChild(document.createTextNode(t.label)),e.appendChild(a)}),e):void 0},getDataIslandId:function(e,t){var i=dynamicTree.trees[e.getTreeId()].getRootNode(),a=function n(e,t){return null===e.parent||e.parent===i?e.param.extra[t]:n(e.parent,t)};return a(e,t)},areNodesFromSameIsland:function(e,t){var i=e.any(function(e){return e.param.extra.isConstant});if(i)return!0;var a=1===e.pluck("parent").uniq().length;return a?!0:1===e.map(function(e){return domain.getDataIslandId(e,t||"itemId")}).uniq().length},NumberFormat:function(e,t){var i="."===e,a=new RegExp("["+e.gsub(/\s/,"\\s")+"]+"),n=new RegExp("["+t.gsub(/\s/,"\\s")+"]+"),o=new RegExp("^-|\\"+t+"?\\d+|\\"+t+"$|\\"+e+"+","g");return{toNumber:function(e){return!e||!i&&/[.]/.test(e)?NaN:Number(e.gsub(n,"").gsub(a,"."))||domain.attributesPattern.test(e)},normalizeNumberEntry:function(i){var a=i.strip(),n=a.match(domain.attributesPattern)||a.match(o);if(!n)return"";for(var r=!1,d=0;d<n.length;d++)n[d].startsWith(e)?r?delete n[d]:(n[d]=e,r=!0):n[d].startsWith(t)&&r&&(n[d]=n[d].substring(1));var l=n.join("");return l},isInteger:function(e){return a.test(e)}}},baseValidator:function(e,t){var i=!0,a="";return e()&&(a=t,i=!1),{isValid:i,errorMessage:a}},maxLengthValidator:function(e,t,i){return domain.baseValidator(function(e,t){return e.length>t}.curry(e,t),i)},minLengthValidator:function(e,t,i){return domain.baseValidator(function(e,t){return e.length<t}.curry(e,t),i)},valueNotEmptyValidator:function(e,t){return domain.baseValidator(function(e){return Object.isArray(e)&&0===e.length||!e||!String(e).strip()}.curry(e),t)},stringIdValidator:function(e,t){return domain.baseValidator(function(e){return!/^[^0-9() .,'"=!+-\/><\/\/:][^() .,'"=!+-\/><\/\/:]*$/.test(e)}.curry(e),t)},numberValidator:function(e,t,i){return domain.baseValidator(isNaN.curry(t.toNumber(e)),i)},numberBoundsValidator:function(e,t,i){return domain.baseValidator(function(e,t){return e===1/0||e===-(1/0)?!0:!(e<=t.max&&e>=t.min)}.curry(e,t),i)},rangeValidator:function(e,t,i){return domain.baseValidator(function(e,t){return!(t>e)}.curry(e,t),i)},dateValidator:function(e,t,i){return domain.baseValidator(function(e,t){return 0===getDateFromFormat(t,e)&&!domain.attributesPattern.test(t)}.curry(t,e),i)},unescapeTree:function e(t){t.hasChilds()&&_.each(t.childs,function(t){e(t)}),t.name=xssUtil.unescape(t.name)}};domain.NodeCopyMoveController=function(){},domain.NodeCopyMoveController.addMethod("copy",function(e,t,i){if(e&&e.length>0&&t){var a=dynamicTree.trees[t.getTreeId()],n=e.collect(function(e){var n=e.param.id,o=this._copyParentStructure(e,a);return o?this._mergeToDestTree(o,t,n,i):null}.bind(this));return t.isloaded=!0,n.without(null)}}),domain.NodeCopyMoveController.addMethod("copySelected",function(e,t){return sourceTree&&t?this.copy(sourceTree.selectedNodes,t):void 0}),domain.NodeCopyMoveController.addMethod("move",function(e,t){if(e&&t){var i=this.copy(e,t);return this.hide(e),i}}),domain.NodeCopyMoveController.addMethod("moveSelected",function(e,t){return e&&t?this.move(e.selectedNodes,t):void 0}),domain.NodeCopyMoveController.addMethod("hide",function(e,t,i){if(e&&e.length>0){t||(t=this._getVisibleChildrenCount),i||(i=function(e,t){e.hide(t)});var a=dynamicTree.trees[e[0].getTreeId()];e.collect(function(e){return e.id}).each(function(e){var n=dynamicTree.nodes[e];i(n,!0);for(var o=n.parent;o&&o!=a.getRootNode()&&!(t(o)>0);)i(o,!1),o.refreshStyle(),o=o.parent}.bind(this))}}),domain.NodeCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){return e.param.id}),domain.NodeCopyMoveController.addMethod("_markAsLoaded",function(e){e.isloaded=!0,e.isParent()&&e.childs.each(function(e){this._markAsLoaded(e)}.bind(this))}),domain.NodeCopyMoveController.addMethod("_mergeToDestTree",function(e,t,i,a){if(t){var n=dynamicTree.trees[t.getTreeId()];if(a)return i=this._handleDuplicatedNode(e,t),n.findNodeById(i,e);var o=n.findNodeChildByMetaName(t,e.param.id);return null!=o?(o.isHidden()&&o.show(),e.hasChilds()&&(o.disabled&&o.enable(e.tooltip),e.childs.each(function(e){this._mergeToDestTree(e,o)}.bind(this))),n.findNodeById(i,o)):(t.addChild(e),this._markAsLoaded(e),n.findNodeById(i,e))}}),domain.NodeCopyMoveController.addMethod("_copyParentStructure",function(e,t){if(e&&t){var i=dynamicTree.trees[e.getTreeId()];if(e.disabled)return null;for(var a=this._copyNode(e,t,!0),n=e.parent,o=null;n&&n!=i.getRootNode();)o=this._copyNode(n,t,!1),o.addChild(a),a=o,n=n.parent;return a}}),domain.NodeCopyMoveController.addMethod("_buildMetanode",function(e){return deepClone(e.param)}),domain.NodeCopyMoveController.addMethod("_copyNode",function(e,t,i){if(e&&t){var a=t.processNode(this._buildMetanode(e));i&&(e.hasChilds()?e.childs.each(function(e){if(!e.disabled){var e=this._copyNode(e,t,i);e&&a.addChild(e)}}.bind(this)):a.setHasChilds(!1));var n=e.childs.findAll(function(e){return e.disabled});return e.childs.length>0&&n.length==e.childs.length?null:a}}),domain.NodeCopyMoveController.addMethod("_delete",function(e){e&&e.collect(function(e){return e.id}).each(function(e){var t=dynamicTree.nodes[e];t&&t.parent.removeChild(t)})}),domain.NodeCopyMoveController.addMethod("_getVisibleChildrenCount",function(e){var t=e.childs.findAll(function(e){return e.isHidden()});return e.childs.length-t.length}),domain.resetTreeSelectionHandler={_COMMON_ELEMENTS_TO_SAVE_SELECTION:["#pageDimmer","#detail","#standardConfirm"],_getTrees:null,_elementIds:null,_callback:null,_validator:null,init:function(e,t,i,a){domain.resetTreeSelectionHandler._init.bind(domain.resetTreeSelectionHandler,e,t,i,a)()},_init:function(e,t,i,a){this._getTrees=t,this._callback=i,this._validator=a,this._elementIds=this._COMMON_ELEMENTS_TO_SAVE_SELECTION.concat(e),domain.registerClickHandlers([this._removeTreeSelectionClickEventHandler.bind(this)],null,!0)},_removeTreeSelectionClickEventHandler:function(e){if(!matchAny(e,this._elementIds,!0)){var t=!1;return this._getTrees().each(function(e){if(e.selectedNodes&&e.selectedNodes.first())throw t=!0,$break}),t?this._validator&&!this._validator()?!0:(this._getTrees().each(function(e){e._deselectAllNodes()}),this._callback&&this._callback(),!1):!1}}},domain.NodeChangeOrderController=function(){},domain.NodeChangeOrderController.addMethod("findNodeWithSpecificOrder",function(e,t,i){for(var a=e.length-1;a>=0;a--)if(e[a].isSelected()==i&&e[a].orderNumber===t)return e[a];return null}),domain.NodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i){var a=null,n=null;return e.each(function(e){e.isSelected()==t&&(null===a||i==e.orderNumber<a)&&(a=e.orderNumber,n=e)}),n}),domain.NodeChangeOrderController.addMethod("moveNode",function(e,t,i,a){var n=e.orderNumber,o=e.parent.childs,r=null,d=null;i?(r=this.findMaxSiblingNode(o,!1,t,e.param.type),d=r?r.orderNumber:-1,o.each(function(i){i.param.id!==e.param.id&&(t==i.orderNumber>d&&t==i.orderNumber<n||i.orderNumber==d)&&(i.orderNumber=t?i.orderNumber+1:i.orderNumber-1,a&&a(i,i.orderNumber))}),a&&a(e,d),e.orderNumber=d):(d=t?e.orderNumber-1:e.orderNumber+1,r=this.findNodeWithSpecificOrder(o,d,!1),r&&(a&&a(e,d),a&&a(r,n),e.orderNumber=d,r.orderNumber=n))}),domain.NodeChangeOrderController.addMethod("nodeAscSorter",function(e,t){return e.orderNumber-t.orderNumber}),domain.NodeChangeOrderController.addMethod("nodeDescSorter",function(e,t){return t.orderNumber-e.orderNumber}),domain.DisplayNodeChangeOrderController=function(){domain.NodeChangeOrderController.call()},domain.DisplayNodeChangeOrderController.prototype=deepClone(domain.NodeChangeOrderController.prototype),domain.DisplayNodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i,a){var n=null,o=null;return e.each(function(e){e.isSelected()==t&&(null!==n&&i!=e.orderNumber<n||(a?e.param.type!==a:0)||(n=e.orderNumber,o=e))}),o}),define("domain.base",["jquery","underscore","backbone","utils.common"],function(e){return function(){var t;return t||e.domain}}(this)),domain.ItemNode=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("ItemGroupType"),Leaf:new dynamicTree.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_fields:fields",this._hidden=!1,this.disabled=!1},domain.ItemNode.prototype=deepClone(dynamicTree.TreeNode.prototype),domain.ItemNode.addMethod("hide",function(e){if(e&&this.hasChilds())for(var t=0;t<this.getChildCount();t++)this.childs[t].hide(!0);var i=(this.childs.findAll(function(e){return e.disabled}).length,this.childs.findAll(function(e){return e.isHidden()}).length),a=this.childs.length-i;this.disabled||0!==a?this.getType()===this.Types.Leaf&&(this.deselect(),this.disable(domain.getMessage(domain.disabledFolderTooltip))):(this._hidden=!0,this.deselect(),this.refreshStyle())}),domain.ItemNode.addMethod("show",function(){this._hidden=!1,this._getElement()&&this.refreshStyle(this._getElement())}),domain.ItemNode.addMethod("disable",function(e){e&&(this.tooltip=e),this.disabled=!0,this._getElement()&&this.refreshStyle(this._getElement())}),domain.ItemNode.addMethod("enable",function(e){e&&(this.tooltip=e),this.disabled=!1,this._getElement()&&this.refreshStyle(this._getElement())}),domain.ItemNode.addMethod("refreshStyle",function(e){if(e||(e=this._getElement())){dynamicTree.TreeNode.prototype.refreshStyle.call(this,e),this.isHidden()?e.addClassName(layoutModule.HIDDEN_CLASS):e.removeClassName(layoutModule.HIDDEN_CLASS);var t=e.select("p").first();t&&(this.tooltip?t.title=this.tooltip:t.title="",this.disabled?(buttonManager.disable(t),buttonManager.disable(e)):(buttonManager.enable(t),buttonManager.enable(e)))}}),domain.ItemNode.addMethod("isHidden",function(){return this._hidden}),domain.ItemNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.labelId=e.labelId||"",t.descr=e.descr,t.descrId=e.descrId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=_.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),domain.ItemNode.addMethod("hasVisibleChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.isHidden()})}),domain.ItemNode.addMethod("hasEnabledChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.disabled})}),domain.ItemNode.addMethod("removeChilds",function(){this.hasChilds()&&this.childs.each(function(e){this.removeChild(e)}.bind(this))}),domain.FieldsCopyMoveController=function(){domain.NodeCopyMoveController(this)},domain.FieldsCopyMoveController.prototype=deepClone(domain.NodeCopyMoveController.prototype),domain.FieldsCopyMoveController.addMethod("_buildMetanode",function(e){var t=deepClone(e.param);return t.label=e.name,t.order=e.orderNumber,t.tooltip=e.tooltip,t}),domain.TwoColumnNode=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("ItemGroupType",{}),Leaf:new dynamicTree.TreeNode.Type("ItemType",{})},this.nodeHeaderTemplateDomId="list_responsive:twoColumn"},domain.TwoColumnNode.prototype=deepClone(dynamicTree.TreeNode.prototype),domain.TwoColumnNode.addMethod("_createNode",function(){var e=this.id,t=(dynamicTree.trees[this.getTreeId()],this._getHeaderTemplateElement());t.id=this.NODE_ID_PREFIX+e,this.refreshStyle(t),t.treeNode=this;var i=t.childElements()[0];this.tooltip&&(i.title=this.tooltip);var a=i.childElements()[0];a.id=this.HANDLER_ID_PREFIX+e;var n=i.childElements()[1],o=this.param.extra&&this.param.extra.label?this.param.extra.label:this.name;n.insert(xssUtil.escape(o));var r=i.childElements()[2];r.insert(xssUtil.escape(this.name)),this._element=t}),domain.TwoColumnNode.addMethod("_getTitle",function(){var e=this._getElement().childElements()[0].childElements()[2];return e.cleanWhitespace(),0===e.childNodes.length&&e.appendChild(document.createTextNode("")),e.childNodes[0]}),domain.TwoColumnNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type,order:this.orderNumber.toString()};return e&&(t.labelId=e.labelId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=_.invoke(this.childs,"toJSON")),t}),domain.TwoColumnNode.addMethod("expandAllChilds",function(){var e=dynamicTree.trees[this.getTreeId()];this.isParent()&&!this.isOpen()&&(e.writeStates(this.id,dynamicTree.TreeNode.State.OPEN),this.refreshNode()),this.hasChilds()&&this.childs.each(function(e){e.expandAllChilds()})}),domain.TablesNode=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("level"),Leaf:new dynamicTree.TreeNode.Type("item")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_tables:tables"},domain.TablesNode.prototype=deepClone(domain.ItemNode.prototype),domain.TablesNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.originalId=e.originalId,t.datasourceId=e.datasourceId,t.repoId=e.repoId,t.itemId=e.itemId,t.dataSource=e.dataSource,t.table=e.table,this.isParent()?(t.query=e.query,t.dataSetType=e.dataSetType):(t.expression=e.expression,t.islandId=e.islandId,t.isConstant=e.isConstant,t.JavaType=e.JavaType,t.JdbcType=e.JdbcType),e.fieldDbName&&(t.fieldDbName=e.fieldDbName)),this.isParent()&&(t.children=_.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),domain.TablesNode.addVar("CONSTANT_TABLE_ID","constant_fields_level"),domain.TablesNode.addVar("CROSSTABLES_FIELDS_TABLE_ID","crossTablesFieldsLevel"),domain.TablesNode.addVar("INVALID_NODE_CLASS","invalid"),domain.TablesNode.addVar("DATA_ISLAND_CLASS","dataIsland"),domain.TablesNode.addVar("DERIVED_TABLE_CLASS","table derived"),domain.TablesNode.addVar("CONSTANT_TABLE_CLASS","table constant"),domain.TablesNode.addVar("CALCULATED_FIELD_CLASS","field calculated"),domain.TablesNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(domain.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS),this.param.extra&&this.param.extra.expression&&e.addClassName(this.CALCULATED_FIELD_CLASS),this.param.extra&&this.param.extra.query&&e.addClassName(this.DERIVED_TABLE_CLASS),this.param.id===this.CONSTANT_TABLE_ID&&e.addClassName(this.CONSTANT_TABLE_CLASS),this.param.extra&&this.param.extra.isIsland&&e.addClassName(this.DATA_ISLAND_CLASS))}),domain.TablesNode.addMethod("edit",function(e){e&&"dblclick"!==e.type||domain.ItemNode.prototype.edit.call(this,e)}),domain.TablesCustomNode=function(e){domain.TablesNode.call(this,e),this.nodeHeaderTemplateDomId=e.param.type===this.Types.Folder.name?"list_responsive_collapsible_type_tables:tables":"list_responsive_collapsible_type_tables:fields"},domain.TablesCustomNode.prototype=deepClone(domain.TablesNode.prototype),domain.TablesCopyMoveController=function(){domain.NodeCopyMoveController(this)},domain.TablesCopyMoveController.prototype=deepClone(domain.NodeCopyMoveController.prototype),domain.TablesCopyMoveController.addMethod("_buildMetanode",function(e){var t={id:e.param.id,label:e.name,type:e.param.type,uri:e.param.uri};return e.param.extra&&(t.extra={originalId:e.param.extra.originalId,table:e.param.extra.table,itemId:e.param.extra.itemId,datasourceId:e.param.extra.datasourceId,repoId:e.param.extra.repoId,dataSource:e.param.extra.dataSource,dataSetType:e.param.extra.dataSetType,query:e.param.extra.query},e.param.extra.expression&&(t.extra.expression=e.param.extra.expression),e.param.extra.fieldDbName&&(t.extra.fieldDbName=e.param.extra.fieldDbName),e.isParent()||(t.extra.JavaType=e.param.extra.JavaType,t.extra.JdbcType=e.param.extra.JdbcType,t.extra.sourceItem=e.parent.param.extra.originalId)),t}),domain.TablesCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){if(e.isParent()){for(var i=1,a=e.param.extra.datasourceId+"."+e.param.extra.itemId+i,n=dynamicTree.trees[t.getTreeId()];n.findNodeChildByMetaName(t,a);)i++,a=e.param.extra.datasourceId+"."+e.param.extra.itemId+i;return e.param.id=a,e.param.extra.itemId+=i,e.name=e.param.extra.itemId,e.param.extra.originalId=e.param.extra.itemId,t.addChild(e),e.isloaded=!0,e.hasChilds()&&e.childs.each(function(t){this._handleDuplicatedNode(t,e)}.bind(this)),a}e.param.id=e.parent.param.id+"."+e.param.extra.itemId,e.param.extra.originalId=e.parent.param.extra.originalId+"."+e.param.extra.itemId}),domain.DerivedTablesNode=function(e){domain.TablesNode.call(this,e),e.param.type===this.Types.Folder.name&&e.param.extra&&e.param.extra.query&&(this.isSelectable=!0)},domain.DerivedTablesNode.prototype=deepClone(domain.TablesNode.prototype),domain.JoinsList=function(e,t){dynamicList.List.call(this,e,t)},domain.JoinsList.prototype=deepClone(dynamicList.List.prototype),domain.JoinsList.addMethod("_changeHandler",function(e){var t=this.getItemByEvent(e);t&&(t._respondOnItemEvents&&!e.isInvoked&&this.fire("item:change",{targetEvent:e,item:t}),e.isInvoked=!0)}),domain.JoinsList.addMethod("_initEvents",function(){dynamicList.List.prototype._initEvents.call(this);var e=this._getElement();jQuery(e).off("change").on("change","select",_.bind(this._changeHandler,this))}),domain.JoinsListItem=function(e){dynamicList.ListItem.call(this,e),this._hidden=!1},domain.JoinsListItem.prototype=deepClone(dynamicList.ListItem.prototype),domain.JoinsListItem.addMethod("hide",function(e){this._hidden=!!e,this.refreshStyle()}),domain.JoinsListItem.addMethod("refreshStyle",function(){dynamicList.ListItem.prototype.refreshStyle.call(this),this._getElement()&&(this._hidden?this._getElement().addClassName(layoutModule.HIDDEN_CLASS):this._getElement().removeClassName(layoutModule.HIDDEN_CLASS))}),domain.JoinsListItem.addMethod("processTemplate",function(e){var t=e.childElements()[0];t.cleanWhitespace();var i=t.childElements()[1],a=t.childElements()[2],n=t.childElements()[3],o=n.childElements()[0],r=o.childElements();return i.update(xssUtil.escape(this._value.left.table.label)+":"+xssUtil.escape(this._value.left.label)),a.update(xssUtil.escape(this._value.right.table.label)+":"+xssUtil.escape(this._value.right.label)),r.each(function(e){e.selected=e.value===this._value.type}.bind(this)),e}),domain.JoinsListItem.addMethod("setJoinType",function(e){this.getValue().type=e;var t=this._getElement();if(t){var i=t.childElements()[0].childElements()[3].childElements()[0];$(i).value=e}}),domain.JoinsListItem.addMethod("toJSON",function(){return{left:this._value.left.id,right:this._value.right.id,type:this._value.type}}),domain.DisplayNode=function(e){domain.ItemNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("ItemGroupType"),Leaf:new dynamicTree.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_sets:sets"},domain.DisplayNode.prototype=deepClone(domain.ItemNode.prototype),domain.DisplayNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,type:this.param.type};return e&&(t.itemId=e.itemId,t.descr=e.descr,t.labelId=e.labelId||"",t.descrId=e.descrId||"",t.resourceId=e.resourceId||""),e&&e.label&&(t.label=e.label),this.isParent()?t.children=_.chain(this.childs).filter(function(e){return!e.isHidden()&&!e._markAsDeleted}).invoke("toJSON").value():(t.dataType=e.dataType,t.dimensionOrMeasure=e.dimensionOrMeasure,t.defaultMask=e.defaultMask,t.defaultAgg=e.defaultAgg),t}),domain.DisplayNode.addVar("INVALID_NODE_CLASS","invalid"),domain.DisplayNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(domain.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS))}),domain.genericTreeParams={rootUri:"/",showRoot:!1,nodeClass:domain.ItemNode,treeClassName:"",multiSelectEnabled:!0},domain.createItemsTree=function(e){return e=Object.extend(deepClone(domain.genericTreeParams),e),new dynamicTree.TreeSupport(e.treeId,e)},domain.confirmDialog={MODE_OK_CANCEL:"okCancel",MODE_YES_NO:"yesNo",_CONFIRM_DIALOG_DOM_ID:"standardConfirm",_CONFIRM_DIALOG_BODY_DOM_PATTERN:"#standardConfirm > .content > .body",_CONFIRM_DIALOG_OK_BUTTON_ID:"#confirmYes",_CONFIRM_DIALOG_CANCEL_BUTTON_ID:"#confirmNo",_CONFIRM_DIALOG_OK_PATTERN:"#confirmYes > span",_CONFIRM_DIALOG_CANCEL_PATTERN:"#confirmNo > span",_yesMessageHolder:null,_noMessageHolder:null,_dialog:null,_onOk:null,_onCancel:null,_customEventHandler:null,_templateDomId:null,_visible:!1,init:function(){domain.confirmDialog._init.bind(domain.confirmDialog)()},show:function(e,t,i,a,n){domain.confirmDialog._show.bind(domain.confirmDialog,e,t,i,a,n)()},hideForDetails:function(){dialogs.popup.hide(domain.confirmDialog._dialog)},showFromDetails:function(){dialogs.popup.show(domain.confirmDialog._dialog,!0)},visible:function(){return domain.confirmDialog._visible},_init:function(){this._dialog=$(this._CONFIRM_DIALOG_DOM_ID),this._yesMessageHolder=$$(this._CONFIRM_DIALOG_OK_PATTERN).first(),this._noMessageHolder=$$(this._CONFIRM_DIALOG_CANCEL_PATTERN).first(),domain.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e,t,i,a,n){this._onOk=t,this._onCancel=i,this._customEventHandler=a,this._templateDomId=e,n&&n==this.MODE_YES_NO?(this._yesMessageHolder.update(domain.getMessage("yes")),this._noMessageHolder.update(domain.getMessage("no"))):(this._yesMessageHolder.update(domain.getMessage("ok")),this._noMessageHolder.update(domain.getMessage("cancel"))),$(this._templateDomId).removeClassName(layoutModule.HIDDEN_CLASS),dialogs.popup.show(this._dialog,!0),this._visible=!0},_hide:function(e){$(this._templateDomId).addClassName(layoutModule.HIDDEN_CLASS),dialogs.popup.hide(this._dialog),this._visible=!1,e&&e()},_clickEventHandler:function(e){return domain.elementClicked(e,this._CONFIRM_DIALOG_OK_BUTTON_ID)?(this._hide(this._onOk),!0):domain.elementClicked(e,this._CONFIRM_DIALOG_CANCEL_BUTTON_ID)?(this._hide(this._onCancel),!0):this._customEventHandler?this._customEventHandler(e):void 0}},domain.detailsDialog={_DETAIL_DIALOG_DOM_ID:"detail",_DETAIL_DIALOG_CLOSE_BUTTON_ID:"#close",_DETAIL_DIALOG_LIST_DOM_ID:"detailsList",_DETAIL_DIALOG_TEXT_DOM_ID:"detailsText",_LIST_TEMPLATE:"defaultListTemplate",_LIST_ITEM_TEMPLATE:"dynamicListItemTemplate",_dialog:null,_showConfirmAfterClose:!1,_list:null,_listItems:null,init:function(){domain.detailsDialog._init.bind(domain.detailsDialog)()},show:function(e){domain.detailsDialog._show.bind(domain.detailsDialog,e)()},_init:function(){this._dialog=$(this._DETAIL_DIALOG_DOM_ID),domain.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e){domain.confirmDialog.visible()?(domain.confirmDialog.hideForDetails(),this._showConfirmAfterClose=!0):this._showConfirmAfterClose=!1,this._createMessage(e),dialogs.popup.show(this._dialog,!0),$(this._DETAIL_DIALOG_LIST_DOM_ID).parentNode.scrollTop=0},_createMessage:function(e){"string"==typeof e?($(this._DETAIL_DIALOG_LIST_DOM_ID).addClassName(layoutModule.HIDDEN_CLASS),$(this._DETAIL_DIALOG_TEXT_DOM_ID).removeClassName(layoutModule.HIDDEN_CLASS).update(e)):($(this._DETAIL_DIALOG_TEXT_DOM_ID).addClassName(layoutModule.HIDDEN_CLASS),$(this._DETAIL_DIALOG_LIST_DOM_ID).removeClassName(layoutModule.HIDDEN_CLASS),this._items&&(this._list.removeItems(this._items),this._items=null,this._list=null),this._items=e.collect(function(e){return new dynamicList.ListItem({label:e})}),this._list=new dynamicList.List(this._DETAIL_DIALOG_LIST_DOM_ID,{listTemplateDomId:this._LIST_TEMPLATE,itemTemplateDomId:this._LIST_ITEM_TEMPLATE,items:this._items}),this._list.show())},_close:function(){dialogs.popup.hide(this._dialog),this._showConfirmAfterClose&&domain.confirmDialog.showFromDetails()},_clickEventHandler:function(e){return domain.elementClicked(e,this._DETAIL_DIALOG_CLOSE_BUTTON_ID)?(this._close(),!0):void 0}},define("domain.components",["domain.base","dynamicTree.utils","components.list"],function(e){return function(){var t;return t||e.domain}}(this));var toolbarButtonModule={UP:"up",DOWN:"down",OVER:"over",DISABLED:"disabled",PRESSED:"pressed",CONTENT_PREFIX:"toolbar_",MenuClass:"menu vertical dropDown",TOOLBAR_MENU_CLASS:"menu vertical dropDown fitable",ACTION_MODEL_TAG:"adhocActionModel",CAPSULE_PATTERN:"capsule",showButtonMenu:function(e,t){t=jQuery(t);var i=this.CONTENT_PREFIX+t.attr("id"),a="adhocActionModel"==this.ACTION_MODEL_TAG?this.actionModel:this.ACTION_MODEL_TAG;actionModel.showDropDownMenu(e,t,i,this.TOOLBAR_MENU_CLASS,a)},setActionModel:function(e){this.actionModel=e},isToolBarButton:function(e){return e?jQuery(e).hasClass("capsule"):!1},enable:function(e,t){buttonManager.enable(e)},disable:function(e){buttonManager.disable(e)},setButtonState:function(e,t){t?this.enable(e):this.disable(e)}};define("components.toolbarButtons",["jquery","prototype"],function(e){return function(){var t;return t||e.toolbarButtonModule}}(this)),toolbarButtonModule.initialize=function(e){toolbarButtonModule.actionMap=e,jQuery(".toolbar").on("mouseup mouseover mouseout","button",function(e){jQuery(this).prop("disabled")||toolbarButtonModule["mouse"+e.type.substring(5,6).toUpperCase()+e.type.substring(6)+"Handler"](e,this)}),isFirefox()&&jQuery(".toolbar li").each(function(e,t){jQuery(t).css("padding","0 2px")})},toolbarButtonModule.mouseUpHandler=function(e,t){var i=t.className.indexOf("capsule")>=0?toolbarButtonModule.actionMap[t.id]:null;if(i){var a=getAsFunction(i);a(e),e.stopPropagation()}},toolbarButtonModule.mouseOverHandler=function(e,t){t.className.indexOf("capsule")>=0&&t.className.indexOf("mutton")>=0&&!buttonManager.isDisabled(t)&&toolbarButtonModule.showButtonMenu(e.originalEvent,t)},toolbarButtonModule.mouseOutHandler=function(e,t){},define("components.toolbar",["jquery","prototype","utils.common","components.toolbarButtons"],function(e){return function(){var t;return t||e.toolbarButtonModule}}(this)),define("text!domain/template/domainUsedResourcesTemplate.htm",[],function(){return"<table class='usedResources'>\n    <thead>\n        <tr>\n            <th>{{- fieldLabel }}</th>\n            <th>{{- resourceLabel }}</th>\n        </tr>\n    </thead>\n    <tbody>\n        {{ _.each(usedResources, function(usedResource, index) { }}\n        <tr>\n            <td>{{- usedResource.field }}</td>\n            <td><a target='_blank' href='{{- contextPath }}/flow.html?_flowId=adhocFlow&resource={{- encodeURIComponent(usedResource.resource) }}'>{{- usedResource.resource }}</a></td>\n        </tr>\n        {{ }); }}\n    </tbody>\n</table>";
}),define("domain/domainUtil",["require","underscore","jrs.configs","text!./template/domainUsedResourcesTemplate.htm"],function(e){"use strict";function t(e){return new RegExp(e.replace(".","\\.").replace("]","\\]").replace("[","\\[").replace("{0}","(\\S+)").replace("{1}","(\\S+)"),"g")}var i=e("underscore"),a=e("jrs.configs"),n=i.template(e("text!./template/domainUsedResourcesTemplate.htm"));return window.domainUtil={getUsedResourcesList:function(e,i){for(var a,n=t(i),o=[];a=n.exec(e);)o.push({field:a[1],resource:a[2]});return o},indexOfNoAccessMessage:function(e,t){return e.indexOf(t)},getUsedResourcesFormattedMessage:function(e,t,i){if(!e.length)return t;var o=i.ITEM_BEING_USED_BY_RESOURCE.split("{0}")[0],r=t.split(o)[0],d=r+n({contextPath:a.contextPath,usedResources:e,resourceLabel:i["resource.label"],fieldLabel:i["field.label"]});return this.indexOfNoAccessMessage(t,i.resourcesWithNoAccess)>-1&&(d+="<br/>"+i.resourcesWithNoAccess),d}},window.domainUtil}),domain.designer={FLOW_ID:"domainDesignerFlow",CREATE_DS_FLOW:"createSLDatasourceFlow",TABLES_VIEW:"domainDesigner_tables",DERIVED_TABLES_VIEW:"domainDesigner_derivedTables",JOINS_VIEW:"domainDesigner_joins",CALC_FIELDS_VIEW:"domainDesigner_calculatedFields",FILTERS_VIEW:"domainDesigner_filters",DISPLAY_VIEW:"domainDesigner_display",ACTION_MODEL_TAG:"domainDesignerActionModel",TREE_DRAG_PATTERN:".draggable",ITEM_KEY_BLACKLIST_REGEX_PATTERN:/[-+='"!#$%^&,<> %:;?{}@()|\*\[\]\/\\]/,ITEM_ID_BLACKLIST_REGEX_PATTERN:/[-+='"!%^&<> %.:;?{}()|\*\[\]\/\\]/,formDomId:"stepDisplayForm",currentPage:null,flowExecutionKey:null,hasSchemas:!1,presentationSelected:!1,unsavedChangesPresent:!1,derivedTableQueryRegex:/^\s*select\s+([^\s]+(\s+|$)){3,}|^\s*\{\s*attribute\s*\('.+'\)\s*\}\s*$/gi,initialize:function(){webHelpModule.setCurrentContext("domain");var e=localContext.domainInitOptions;this.flowExecutionKey=e.flowExecutionKey,this.unsavedChangesPresent=e.unsavedChangesPresent,this.allowDesignerCloseWithValidationErrors=e.allowDesignerCloseWithValidationErrors;var t=e.dataSourceId;if(!t&&e.dataSourcesList&&e.dataSourcesList.first()&&(t=e.dataSourcesList.first().id),!t)return void this.redirectToCreateDomain();this.presentationSelected=e.presentationSelected;var i=e.datasourcesProperties[t]?e.datasourcesProperties[t].schemas:null;this.hasSchemas=i&&i.first(),domain.registerClickHandlers([this.flowControlsClickEventHandler.bind(this),this.stopEventForToolbarButtonsClickEventHandler.bind(this)]),domain.confirmDialog.init(),domain.detailsDialog.init(),this.currentPage=document.body.identify();var a=this.pageInitFactory[this.currentPage]();this.initModule(a,e)},initModule:function(e,t){e&&(e.fillForm&&(dd.fillForm=e.fillForm.bind(e)),e.getValidationPostData&&(dd.getValidationPostData=e.getValidationPostData.bind(e)),e.getCheckDesignValidator&&(dd.getCheckDesignValidator=e.getCheckDesignValidator.bind(e)),e.exportEnabled&&(dd.exportEnabled=e.exportEnabled.bind(e)),e.exportBundleStub&&(dd.exportBundleStub=e.exportBundleStub.bind(e)),dd.initToolbar(e.toolbarActionMap),e.init.bind(e)(t))},initToolbar:function(e){this.toolbarActionMap=Object.extend(this.toolbarActionMap,e),toolbarButtonModule.ACTION_MODEL_TAG=this.ACTION_MODEL_TAG,toolbarButtonModule.initialize(this.toolbarActionMap)},redirectToCreateDomain:function(){document.location=buildActionUrl({flowId:this.CREATE_DS_FLOW})},fillForm:function(){},getValidationPostData:function(){return{}},getCheckDesignValidator:function(){return dd.checkDesignValidator},flowControlsClickEventHandler:function(e){var t=!1;return this.flowControlsEventMap.each(function(i){if(domain.elementClicked(e,i.key)){var a=i.value;if(t=!0,this.currentPage===a.returnOnPage)throw $break;a.flowExecutionKey=this.flowExecutionKey;var n=function(){delete a.returnOnPage,delete a.performValidation,a.flowId=this.FLOW_ID,domain.submitForm(this.formDomId,a,this.fillForm)},o="#done"===i.key&&this.allowDesignerCloseWithValidationErrors;throw a.performValidation?this.getCheckDesignValidator().validate(o,n.bind(this)):n.bind(this)(),$break}}.bind(this)),t},stopEventForToolbarButtonsClickEventHandler:function(e){var t=!1;return $H(this.toolbarActionMap).each(function(i){if(domain.elementClicked(e,"#"+i.key))throw t=!0,$break}.bind(this)),t},checkDesign:function(e,t){var i={flowExecutionKey:this.flowExecutionKey,eventId:"validateSchema"};domain.sendAjaxRequest(i,this.getValidationPostData(),e,t)},checkForEmptySets:function(e){var t={flowExecutionKey:this.flowExecutionKey,eventId:"checkForEmptySets"};domain.sendAjaxRequest(t,{},e)},deleteEmptySets:function(e,t){var i={flowExecutionKey:this.flowExecutionKey,eventId:"deleteEmptySets"},a={emptySets:Object.toJSON(e)};domain.sendAjaxRequest(i,a,t)},exportToXml:function(e){var t={flowExecutionKey:this.flowExecutionKey,eventId:"exportToXML"};this.hasSchemas&&(t.exportSchemaPrefix=!!e),domain.submitForm(this.formDomId,t,null)},generateAndDownloadBundles:function(e,t,i,a){var n={flowExecutionKey:this.flowExecutionKey,eventId:"bundle"},o={generateDescrKey:!!e,generateLabelKey:!!t},r=function(e){"success"===e&&(i&&a?a.done(this.downloadBundleStubs.bind(this)):this.downloadBundleStubs(),i&&i())};domain.sendAjaxRequest(n,o,r.bind(this))},downloadBundleStubs:function(){var e={flowExecutionKey:this.flowExecutionKey,eventId:"downloadBundleStubs"};domain.submitForm(this.formDomId,e,null)},validateForCalcFields:function(e,t,i){var a={flowExecutionKey:this.flowExecutionKey,eventId:"validateDeletedTablesForCalcFields"},n={deletedTablesIds:e,isRealTables:t};domain.sendAjaxRequest(a,n,i)},changeTableAlias:function(e,t,i){var a={};a[e]=t;var n={flowExecutionKey:dd.flowExecutionKey,eventId:"changeTableAlias"},o={aliasChangesMap:Object.toJSON(a)};domain.sendAjaxRequest(n,o,i)},createTreeNodesMap:function(e){var t=function(e,i){e&&(i[e.param.id]=e,e.isParent()&&e.childs.each(function(e){t(e,i)}))};e.treeMap={},e.getRootNode().childs.each(function(i){t(i,e.treeMap)})},deleteNodesFromTreeById:function(e,t,i){if(e&&e.first()){var a=function(e){return e.childs.length},n=function(e){return e.parent.removeChild(e)},o=function(e){delete t.treeMap[e.param.id],e.isParent()&&e.childs.each(o)};e.each(function(e){var r=t.treeMap[e];r&&(i.hide([r],a,n),o(r))}.bind(this))}},getTablesUsedForFilters:function(e,t){if(!t.first())return[];var i=t.findAll(function(t){if(!e)return!1;var i=t.param.extra.itemId;return e&&e[i]&&e[i].itemId===i});return i.collect(function(e){return e.param.extra.itemId})},insertAtCaret:function(e,t,i){if(document.selection){if(i||(i=document.selection.createRange()),i.parentElement()!=e)return e.value+=t,!1;e.focus(),i.text=t,i.collapse(!1),i.select()}else if(Object.isNumber(e.selectionStart)&&e.selectionStart>=0){var a=e.getValue(),n=e.selectionStart,o=e.selectionEnd;e.setValue(a.substr(0,n)+t+a.substr(o)),e.focus(),e.setSelectionRange(n,n+t.length)}else e.value+=t},emptyValidator:function(e){return{isValid:e&&e.strip(),errorMessage:domain.getMessage("field.empty")}},itemKeyValidator:function(e,t){return{isValid:!t||null==t.match(dd.ITEM_KEY_BLACKLIST_REGEX_PATTERN),errorMessage:domain.getMessage(e)}},itemIdValidator:function(e,t){return{isValid:!t||null==t.match(dd.ITEM_ID_BLACKLIST_REGEX_PATTERN),errorMessage:domain.getMessage(e?e:"id.invalid")}},itemIdNotStartFromNumberValidator:function(e){return{isValid:!e||null==e.match(/^[0-9]/),errorMessage:domain.getMessage("id.startFromNumber")}},escapeJsonValidator:function(e){return{isValid:!e||!e.match(/[\?]+/g),errorMessage:domain.getMessage("field.invalid")}}};var dd=domain.designer;dd.confirmAndLeave=function(){return dd.isUnsavedChangesPresent()?confirm(domain.getMessage("exitMessage")):!0},dd.setUnsavedChangesPresent=function(e){dd.unsavedChangesPresent=!!e},dd.isUnsavedChangesPresent=function(){return dd.unsavedChangesPresent},dd.toolbarActionMap={checkDesign:"dd.validateDesign",exportSchema:"dd.exportSchema",exportBundleStub:"dd.exportBundleStub"},dd.toolbarEnableMap={exportSchema:function(){return dd.exportEnabled()},exportBundleStub:function(){return dd.exportEnabled()}},dd.updateToolBarButtons=function(){$H(dd.toolbarEnableMap).each(function(e){toolbarButtonModule.setButtonState(e.key,e.value())})},dd.exportSchema=function(){dd.exportSchemaValidator.validate(dd.exportToXml.bind(dd))},dd.isPresentationSelected=function(){return dd.presentationSelected},dd.exportBundleStub=function(){dd.exportBundlesValidator.validate(dd.generateAndDownloadBundles.bind(dd))},dd.exportEnabled=function(){return dd.presentationSelected},dd.validateDesign=function(){dd.getCheckDesignValidator().validate(!1)},dd.pageInitFactory={domainDesigner_tables:function(){return dd_tables},domainDesigner_derivedTables:function(){return dd_derivedTables},domainDesigner_joins:function(){return dd_joins},domainDesigner_calculatedFields:function(){return dd_calcFields},domainDesigner_filters:function(){return dd_filters},domainDesigner_display:function(){return dd_display}},dd.flowControlsEventMap=$H({"#tablesTab":{returnOnPage:dd.TABLES_VIEW,eventId:"tables"},"#derivedTablesTab":{returnOnPage:dd.DERIVED_TABLES_VIEW,eventId:"query"},"#joinsTab":{returnOnPage:dd.JOINS_VIEW,eventId:"joins"},"#calcFieldsTab":{returnOnPage:dd.CALC_FIELDS_VIEW,eventId:"calcFields"},"#preFiltersTab":{returnOnPage:dd.FILTERS_VIEW,eventId:"filters"},"#displayTab":{returnOnPage:dd.DISPLAY_VIEW,eventId:"design"},"#done":{eventId:"done",performValidation:!0},"#cancelButton":{eventId:"cancel"}}),define("domain.designer",["domain.components","components.toolbar","domain/domainUtil"],function(e){return function(){var t;return t||e.dd}}(this)),dd.checkDesignValidator={_INVALID_DESIGN_TEMPLATE_DOM_ID:"invalidDesignConfirmMessage",_INVALID_DESIGN_LINK_ID:"#designDetails",_DONE_BUTTON_ID:"done",_callback:null,_errorMessage:null,_showConfirmation:null,validate:function(e,t){dd.checkDesignValidator._validate.bind(dd.checkDesignValidator,e,t)()},_validate:function(e,t){this._callback=t,this._showConfirmation=e,dd.emptySetsValidator.validate(this._emptySetsCallback.bind(this))},_emptySetsCallback:function(e){"empty"===e&&domain.enableButton(this._DONE_BUTTON_ID,!1),dd.checkDesign.bind(dd,this._checkDesignCallback.bind(this))()},_checkDesignCallback:function(e){if("success"===e)this._callback?this._callback():dialogs.systemConfirm.show(domain.getMessage("designIsValid"));else{this._errorMessage=e.errorMessage;var t=domainUtil.getUsedResourcesList(e.errorMessage,domain._messages.ITEM_BEING_USED_BY_RESOURCE),i=t.length||domainUtil.indexOfNoAccessMessage(e.errorMessage,domain._messages.resourcesWithNoAccess)>-1?domainUtil.getUsedResourcesFormattedMessage(t,e.errorMessage,{"resource.label":domain._messages["resource.label"],"field.label":domain._messages["field.label"],ITEM_BEING_USED_BY_RESOURCE:domain._messages.ITEM_BEING_USED_BY_RESOURCE,resourcesWithNoAccess:domain._messages.resourcesWithNoAccess}):this._errorMessage;this._showConfirmation&&(t.length||domainUtil.indexOfNoAccessMessage(e.errorMessage,domain._messages.resourcesWithNoAccess)>-1)?domain.confirmDialog.show(this._INVALID_DESIGN_TEMPLATE_DOM_ID,this._onOk.bind(this),this._onCancel.bind(this),_.bind(function(e){this._showAffectedResources(e,i)},this),domain.confirmDialog.MODE_YES_NO):domain.detailsDialog.show(i)}},_onOk:function(){this._callback&&this._callback()},_onCancel:function(){},_showAffectedResources:function(e,t){return domain.elementClicked(e,this._INVALID_DESIGN_LINK_ID)?(domain.detailsDialog.show(t),!0):void 0}},dd.emptySetsValidator={_EMPTY_SETS_TEMPLATE_DOM_ID:"emptySetsConfirmMessage",_EMPTY_SETS_LINK_ID:"#emptySetsDetails",_callback:null,_emptySets:null,validate:function(e){dd.emptySetsValidator._validate.bind(dd.emptySetsValidator,e)()},_validate:function(e){this._callback=e,dd.checkForEmptySets.bind(dd,this._checkCallback.bind(this))()},_checkCallback:function(e){e&&e.first()?(this._emptySets=e,domain.confirmDialog.show(this._EMPTY_SETS_TEMPLATE_DOM_ID,this._onOk.bind(this),this._onCancel.bind(this),this._showAffectedResources.bind(this))):this._callback&&this._callback()},_onOk:function(){dd.deleteEmptySets.bind(dd,this._emptySets,this._callback)()},_onCancel:function(){this._callback&&this._callback()},_showAffectedResources:function(e){return domain.elementClicked(e,this._EMPTY_SETS_LINK_ID)?(domain.detailsDialog.show(this._emptySets),!0):void 0}},dd.exportSchemaValidator={_EXPORT_SCHEMA_PREFIXES_TEMPLATE_DOM_ID:"exportSchemaPrefixesConfirmMessage",_callback:null,validate:function(e){dd.exportSchemaValidator._validate.bind(dd.exportSchemaValidator,e)()},_validate:function(e){this._callback=e,dd.getCheckDesignValidator().validate(!0,this._checkDesignValidatorCallback.bind(this))},_checkDesignValidatorCallback:function(){dd.hasSchemas?domain.confirmDialog.show(this._EXPORT_SCHEMA_PREFIXES_TEMPLATE_DOM_ID,this._onOk.bind(this),this._onCancel.bind(this),null,domain.confirmDialog.MODE_YES_NO):this._callback&&this._callback()},_onOk:function(){this._callback&&this._callback(!0)},_onCancel:function(){this._callback&&this._callback(!1)}},dd.exportBundlesValidator={_EXPORT_BUNDLES_TEMPLATE_DOM_ID:"exportBundlesConfirmMessage",_GENERATE_LABEL_KEYS_PATTERN:"#autoGenerateLabelKeys",_GENERATE_LABEL_KEYS_ID:"generateLabelKeys",_GENERATE_DESCR_KEYS_PATTENR:"#autoGenerateDescriptionKeys",_GENERATE_DESCR_KEYS_ID:"generateDescriptionKeys",_callback:null,_generateLabelKeys:!1,_generateDescrKeys:!1,validate:function(e){dd.exportBundlesValidator._validate.bind(dd.exportBundlesValidator,e)()},_validate:function(e){this._callback=e,dd.getCheckDesignValidator().validate(!0,this._checkDesignValidatorCallback.bind(this))},_checkDesignValidatorCallback:function(){domain.confirmDialog.show(this._EXPORT_BUNDLES_TEMPLATE_DOM_ID,this._onOk.bind(this),this._onCancel.bind(this),this._handleCheckBoxes.bind(this))},_onOk:function(){this._callback&&this._callback(this._generateDescrKeys,this._generateLabelKeys)},_onCancel:function(){},_handleCheckBoxes:function(e){return matchMeOrUp($(e),this._GENERATE_LABEL_KEYS_PATTERN)?(this._generateLabelKeys=$F(this._GENERATE_LABEL_KEYS_ID),domain.PROPAGATE_EVENT):matchMeOrUp($(e),this._GENERATE_DESCR_KEYS_PATTENR)?(this._generateDescrKeys=$F(this._GENERATE_DESCR_KEYS_ID),domain.PROPAGATE_EVENT):void 0}},dd.deleteCalcFieldsValidator={_DELETE_CALCFIELDS_TEMPLATE_ID:"calcFieldsConfirmMessage",_CALC_FIELDS_DETAILS_LINK_ID:"#calcFieldsDetails",_involvedFieldsIds:null,_involvedFieldsExpressionIds:null,_nodes:null,_callback:null,_validateForCalcFields:null,init:function(e){dd.deleteCalcFieldsValidator._init.bind(dd.deleteCalcFieldsValidator,e)()},validate:function(e,t,i){dd.deleteCalcFieldsValidator._validate.bind(dd.deleteCalcFieldsValidator,e,t,i)()},_init:function(e){this._validateForCalcFields=e},_validate:function(e,t,i){this._nodes=e,this._callback=i;var a=Object.toJSON(e.collect(function(e){return e.param.extra.datasourceId+"."+e.param.extra.itemId}));this._validateForCalcFields(a,t,this._validationCallback.bind(this))},_validationCallback:function(e){this._involvedFieldsIds=[],this._involvedFieldsExpressionIds=[],"success"===e?this._onOk():(this._involvedFieldsIds=e.involvedFieldsIds,this._involvedFieldsExpressionIds=e.involvedFieldsExpressionIds,domain.confirmDialog.show(this._DELETE_CALCFIELDS_TEMPLATE_ID,this._onOk.bind(this),this._onCancel.bind(this),this._showAffectedResources.bind(this)))},_onOk:function(){this._callback&&this._callback(this._involvedFieldsIds,this._involvedFieldsExpressionIds)},_onCancel:function(){},_showAffectedResources:function(e){return domain.elementClicked(e,this._CALC_FIELDS_DETAILS_LINK_ID)?(domain.detailsDialog.show(this._involvedFieldsExpressionIds),!0):void 0}},dd.deleteFiltersValidator={_DELETE_FILTERS_TEMPLATE_ID:"deleteFiltersConfirmMessage",_FILTER_DETAILS_LINK_ID:"#filtersDetails",_tablesAffectedInFilters:null,_nodes:null,_callback:null,_getTablesUsedForFilters:null,init:function(e){dd.deleteFiltersValidator._init.bind(dd.deleteFiltersValidator,e)()},validate:function(e,t){dd.deleteFiltersValidator._validate.bind(dd.deleteFiltersValidator,e,t)()},_init:function(e){this._getTablesUsedForFilters=e},_validate:function(e,t){this._callback=t,this._tablesAffectedInFilters=this._getTablesUsedForFilters(e),this._tablesAffectedInFilters.first()?domain.confirmDialog.show(this._DELETE_FILTERS_TEMPLATE_ID,this._onOk.bind(this),this._onCancel.bind(this),this._showAffectedResources.bind(this)):this._onOk()},_onOk:function(){this._callback&&this._callback()},_onCancel:function(){},_showAffectedResources:function(e){return domain.elementClicked(e,this._FILTER_DETAILS_LINK_ID)?(domain.detailsDialog.show(this._tablesAffectedInFilters),!0):void 0}},dd.calcFieldsAndFiltersValidator={init:function(e,t){dd.deleteCalcFieldsValidator.init(e),dd.deleteFiltersValidator.init(t)},validate:function(e,t,i){dd.deleteCalcFieldsValidator.validate(e,t,dd.calcFieldsAndFiltersValidator._deleteCalcFieldsCallback.bind(dd.calcFieldsAndFiltersValidator,i,e))},_deleteCalcFieldsCallback:function(e,t,i,a){dd.deleteFiltersValidator.validate(t,this._deleteFiltersCallback.bind(this,e,i,a))},_deleteFiltersCallback:function(e,t,i){e&&e(t,i)}},define("domain.designer.validators",["domain.designer"],function(e){return function(){var t;return t||e.dd}}(this));var DateAndTimePicker;require(["components/dateAndTime/DateAndTimePicker"],function(e){DateAndTimePicker=e}),domain.typesMap={Integer:"number",Decimal:"number",BigDecimal:"number",Time:"date",Date:"date",Timestamp:"date",String:"string",Boolean:"boolean"},domain.javaNumericTypesValidation={"java.lang.Double":{min:-(1/0),max:1/0},"java.math.BigDecimal":{min:-(1/0),max:1/0},"java.lang.Long":{min:"-9223372036854775808",max:"9223372036854775807"},"java.lang.Integer":{min:"-2147483648",max:"2147483647"},"java.lang.Short":{min:"-32768",max:"32767"},"java.lang.Byte":{min:"-128",max:"127"}},domain.getNumberBounds=function(e){return domain.javaNumericTypesValidation[e]},domain.filter={CALENDAR_DATE_FORMAT:"M dd yy",CALENDAR_TIMESTAMP_FORMAT:"M dd yy",CALENDAR_TIME_FORMAT:"HH:mm:ss",init:function(e){this.TIMEZONE_OFFSET=e.timeOffset,this.FILTER_DATE_FORMAT=e.dateFormat||"MMM dd yyyy",this.FILTER_TIMESTAMP_FORMAT=e.dateTimeFormat||"MMM dd yyyy HH:mm:ss",this.FILTER_TIME_FORMAT=e.timeFormat||"HH:mm:ss",this.CALENDAR_DATE_FORMAT=e.calendarDateFormat||"M dd yy",this.CALENDAR_TIMESTAMP_FORMAT=e.calendarDateTimeFormat||"M dd yy",this.CALENDAR_TIME_FORMAT=e.calendarTimeFormat||"HH:mm:ss",this.DECIMAL_SEPARATOR=e.decimalSeparator||".",this.GROUPING_SEPARATOR=e.groupingSeparator||",",this.numberFormat=domain.NumberFormat(this.DECIMAL_SEPARATOR,this.GROUPING_SEPARATOR),MONTH_NAMES=Calendar._SMN,DAY_NAMES=Calendar._SDN,this.ATTRIBUTES_PATTERN=new RegExp("\\s*attribute\\s*\\(\\s*'[^\\/'\\s][^\\/']*'(?:\\s*,\\s*'[^\\/'\\s][^\\/']*')*\\s*\\)\\s*"),this.ATTRIBUTE_VALUE_PATTERN=new RegExp("'(.*)'"),domain.javaToDataTypeMap=e.javaToDataTypeMap},toNumber:function(e){return this.numberFormat.toNumber(e)},normalizeNumberEntry:function(e){return this.numberFormat.normalizeNumberEntry(e)},toString:function(e){var t=typeof e;switch(t){case"undefined":case"function":case"unknown":return"{''}";case"boolean":case"number":case"string":return"{"+e.toString()+"}"}return null===e?"{''}":Object.isArray(e)?"{"+this.arrayToString(e)+"}":void 0},arrayToString:function(e){return e.collect(function(e){return isNotNullORUndefined(e)&&""!==e?e:"''"}).join(", ")}},domain.FilterItem=function(e){if(!e||!e.node&&!e.json)throw"Trying to create FilterItem with empty input";this.fieldId=null,this.id=null,this.name=null,this.type=null,this.value=null,this.comparison="",this.locked=null,this.dataType=null,this.javaType=null,this.index=1,e.node?this._initNode(e.node):this._initJson(e.json)},_.extend(domain.FilterItem.prototype,{_initNode:function(e){if(e&&e.param&&e.param.extra){var t=e.param.extra;this.setFieldId(e.param.id),this.name=e.name,this.value=[],this.locked=!1,this.javaType=t.JavaType,domain.javaToDataTypeMap&&this.javaType&&(t.dataType=domain.javaToDataTypeMap[this.javaType]),this.dataType=t.dataType,this.type=domain.typesMap[this.dataType]}},_initJson:function(e){e&&(this.init=!0,this.setFieldId(e.fieldId),this.name=e.fieldName,this.type=e.ruleTypeId||e.ruleType,this.setValues(e.value||e.values),this.locked=!e.isParameter,this.comparison=e.comparisonId||e.comparison,this.dataType=e.dataType,this.javaType=e.javaType||e.JavaType)},setFieldId:function(e){this.fieldId=e,this.id=this.normalizeIdentifier(e)},setValues:function(e){if("field"===this.type){this.field2Id=e[0];var t=_.find(dynamicTree.nodes,function(t){return t.param.id===e[0]});this.name2=t&&t.name}else"string"===this.type&&null===e[0]&&(e=[domain.getMessage("filter_null_value")]);this.value=e},getValues:function(){return"field"===this.type?[this.field2Id]:this.value},normalizeIdentifier:function(e){return e&&e.length>0?e.gsub(/[.]/,"_").gsub(/[\W]/,""):e},updateIndex:function(e){this.index=e,this.id+="_"+e,this.init||(this.name+="_"+e)},toJSON:function(){return{fieldId:this.fieldId,fieldName:this.name,ruleTypeId:this.type,value:this.getValues(),isParameter:!this.locked,comparisonId:this.comparison,dataType:this.dataType,javaType:this.javaType}},initFieldFilterItem:function(e){this.type="field",this.field2Id=e.fieldId,this.name2=e.name,this.value=[this.name2]}}),domain.FilterList=function(e){if(this._valueList=[],this._keyPositionMapping={},e&&"object"==typeof e)for(var t in e)this.set(t,e[t])},_.extend(domain.FilterList.prototype,{reIndex:function(e,t){var i;for(var a in this._keyPositionMapping)i=this._keyPositionMapping[a],i>e&&(this._keyPositionMapping[a]=i+t)},unset:function(e){this._valueList.splice(this._keyPositionMapping[e],1),this.reIndex(this._keyPositionMapping[e],-1),delete this._keyPositionMapping[e]},set:function(e,t,i){this._keyPositionMapping[e]>=0?this._valueList.splice(this._keyPositionMapping[e],1,t):(i=i>=0?i:this._valueList.length,this._valueList.splice(i,0,t),i<this._valueList.length-1&&this.reIndex(i-1,1),this._keyPositionMapping[e]=i)},get:function(e){return this._valueList[this._keyPositionMapping[e]]},size:function(){return this._valueList.length},values:function(){return this._valueList.clone()},collect:function(e){return _.collect.call(_,this._valueList,e)}}),domain.FilterEditor=function(e,t){this.filterValue=e,t&&(this.flowExecutionKey=t),this.init()},_.extend(domain.FilterEditor.prototype,{EDITOR_TEMPLATE:"editorTemplate",create:function(e,t){if(!e||!e.type)return null;var i=null;switch(e.type){case"string":i=new domain.StringFilterEditor(e,t);break;case"number":i=new domain.NumberFilterEditor(e);break;case"date":case"time":i=new domain.DateFilterEditor(e);break;case"boolean":i=new domain.BooleanFilterEditor(e);break;case"field":i=new domain.FieldFilterEditor(e);break;default:throw"Unsupported editor type: [#{editorType}]".interpolate({editorType:e.type})}return i},init:function(){this.valueEditorsCache={},this.valueEditorsFactory=this.createValueEditorsFactory(),this.initTemplate(),this.initComparisons(this.getFirstComparison()),this.initEventHandlers()},createValueEditorsFactory:function(){return{}},afterDraw:function(){this.fillinTemplate()},beforeRemove:function(){this.removeEventHandlers()},initTemplate:function(){this.editorTemplate=this._cloneTemplate(this.EDITOR_TEMPLATE),this.fieldNameElement=this.editorTemplate.select(".fieldName").first()},fillinTemplate:function(){this.fieldNameElement.update(xssUtil.escape(this.getOriginalValue().name)),this.updateFilterValueEditor()},initComparisons:function(e){this._comparisons=this.createComparisons(),this.comparisonId=e,this.comparisonsSelect=this.editorTemplate.select("#fieldAndOperation select")[0],this._comparisons.each(function(t,i){var a={id:t,title:domain.getMessage(t)};t===e&&(a.selected="selected",this.selectedIndex=i);var n=new Element("option",a).insert(domain.getMessage(t));this.comparisonsSelect.insert(n)}.bind(this))},getFirstComparison:function(){return this.getOriginalValue().comparison||"equals"},initEventHandlers:function(){this.comparisonsSelect.observe("change",this.comparisonSelectedHandler.bindAsEventListener(this)),this.getTemplate().observe("submit",function(e){Event.stop(e)})},removeEventHandlers:function(){Event.stopObserving(this.comparisonsSelect),Event.stopObserving(this.getTemplate())},comparisonSelectedHandler:function(e){this.comparisonId=domain.getSelectedOptionId(e.element()),this.updateFilterValueEditor()},updateFilterValueEditor:function(){this.valueEditor=this.createValueEditor(this.comparisonId);var e=this.valueEditor.getTemplate();this.editorTemplate.select("#values")[0].replace(e),this.valueEditor.afterDraw()},createValueEditor:function(e){if(!e)return null;var t=this.getFactoryKey(e),i=this.valueEditorsCache[t];if(!i)try{i=this.valueEditorsFactory[t](this.getOriginalValue.bind(this),e,this.flowExecutionKey),this.valueEditorsCache[t]=i}catch(a){throw"Editor for #{name} is undefined".interpolate({name:t})}return i},processTemplate:function(e){var t=e.select(".fieldName")[0],i=e.select(".operation")[0],a=e.select(".value")[0],n=e.select(".lock")[0],o=this.getValue(),r=o.getOriginalValue();t.update(xssUtil.escape(r.name)),i.update(xssUtil.escape(domain.getMessage(r.comparison))),a.update(xssUtil.escape(o.getFormattedValue())),o.lockStatusElement&&n.update(r.locked?xssUtil.escape(domain.getMessage("domain.filter.locked")):xssUtil.escape(domain.getMessage("domain.filter.unlocked")));var d="f"+r.id+"_filter";if(!$$("#"+d)[0]){var l=o.getTemplate();l.removeClassName("hidden"),e.appendChild(l),l.writeAttribute("id",d)}return e},getTemplate:function(){return this.editorTemplate},getOriginalValue:function(){return this.filterValue},getFormattedValue:function(){return domain.filter.toString(this.getOriginalValue().value)},resetToCurrentEditor:function(){this.comparisonId=this.getOriginalValue().comparison,this.comparisonsSelect.selectedIndex=this.selectedIndex},applyEditorValue:function(){this.filterValue=this.getValue(),this.selectedIndex=this.comparisonsSelect.selectedIndex},cancel:function(){this.resetToCurrentEditor(),disableSelectionWithoutCursorStyle($(document.body)),this.valueEditor&&this.valueEditor.cancel()},getValue:function(){var e=deepClone(this.getOriginalValue());return e.value=this._toArray(this.valueEditor.getValue()),e.comparison=this.comparisonId,e},validate:function(){return this.valueEditor.validate()},_cloneTemplate:function(e){return Element.clone(e,!0)||null},_toArray:function(e){return Object.isArray(e)?e:[e]},handleClick:function(e){this.valueEditor&&domain.FilterValueEditor.handleClick.call(this.valueEditor,e)}}),domain.StringFilterEditor=function(e,t){domain.FilterEditor.call(this,e,t)},domain.StringFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.StringFilterEditor.addMethod("createComparisons",function(){return["isOneOf","isNotOneOf","equals","doesNotEqual","contains","doesNotContain","startsWith","doesNotStartWith","endsWith","doesNotEndWith"]}),domain.StringFilterEditor.addMethod("getFactoryKey",function(e){switch(e){case"isOneOf":case"isNotOneOf":return"MultipleValuesEditor";case"equals":case"doesNotEqual":return"ComboSelectEditor";case"contains":case"doesNotContain":case"startsWith":case"doesNotStartWith":case"endsWith":case"doesNotEndWith":return"StringValueEditor";default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}}),domain.StringFilterEditor.addMethod("createValueEditorsFactory",function(){return{MultipleValuesEditor:function(e,t,i){return new domain.MultipleValuesEditor(e,t,i)},ComboSelectEditor:function(e,t,i){return new domain.ComboSelectEditor(e,t,i)},StringValueEditor:function(e,t,i){return new domain.StringValueEditor(e,t,i)}}}),domain.NumberFilterEditor=function(e){domain.FilterEditor.call(this,e)},domain.NumberFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.NumberFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isGreaterThan","lessThan","isGreaterThanOrEqualTo","isLessThanOrEqualTo","isBetween","isNotBetween"]}),domain.NumberFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isGreaterThan":case"lessThan":case"isGreaterThanOrEqualTo":case"isLessThanOrEqualTo":t=new domain.NumberValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new domain.NumberRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.NumberFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return e.value[0]}}),domain.NumberFilterEditor.addMethod("updateFilterValueEditor",function(){domain.FilterEditor.prototype.updateFilterValueEditor.call(this),this.registerBlurHandlers()}),domain.NumberFilterEditor.addMethod("registerBlurHandlers",function(){var e=this.valueEditor.getValueElement();!Object.isArray(e)&&(e=[e]),e.invoke("observe","blur",function(e){var t=this.getValue(),i=domain.filter.normalizeNumberEntry(t);t!=i&&this.setValue(i)})}),domain.BooleanFilterEditor=function(e){domain.FilterEditor.call(this,e)},domain.BooleanFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.BooleanFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo"]}),domain.BooleanFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":t=new domain.BooleanSelectEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.DateFilterEditor=function(e,t){domain.FilterEditor.call(this,e,t)},domain.DateFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.DateFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore","isBetween","isNotBetween"]}),domain.DateFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isAfter":case"isBefore":case"isOnOrAfter":case"isOnOrBefore":t=new domain.DateValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new domain.DateRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.DateFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return domain.FilterEditor.prototype.getFormattedValue.call(this)}}),domain.TimeFilterEditor=function(e,t){domain.FilterEditor.call(this,e,t)},domain.TimeFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),domain.TimeFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore","isBetween","isNotBetween"]}),domain.TimeFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isAfter":case"isBefore":case"isOnOrAfter":case"isOnOrBefore":t=new domain.StringValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new domain.TimeRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),domain.DateFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return domain.FilterEditor.prototype.getFormattedValue.call(this)}}),domain.FieldFilterEditor=function(e,t){this.newFilterValue=deepClone(e),domain.FilterEditor.call(this,e,t)},domain.FieldFilterEditor.prototype=deepClone(domain.FilterEditor.prototype),
domain.FieldFilterEditor.addMethod("createComparisons",function(){switch(domain.typesMap[this.getOriginalValue().dataType]){case"string":return["equals","contains","startsWith","endsWith","doesNotEqual","doesNotContain"];case"number":return["equals","isNotEqualTo","isGreaterThan","lessThan","isGreaterThanOrEqualTo","isLessThanOrEqualTo"];case"date":return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore"];case"boolean":return["equals","isNotEqualTo"];default:throw"Unsupported editor type: [#{editorType}]".interpolate({editorType:filterValue.type})}}),domain.FieldFilterEditor.addMethod("initTemplate",function(){this.editorTemplate=this._cloneTemplate(this.EDITOR_TEMPLATE);var e=this.editorTemplate.down(".checkBox.lock");e&&e.remove();var t=this._cloneTemplate("fieldEditor");t.writeAttribute("id","fieldAndOperation"),t.removeClassName("hidden"),this.editorTemplate.select("#fieldAndOperation").first().replace(t),this.fieldNameElement=this.editorTemplate.select(".fieldName").first(),this.fieldValueElement=this.editorTemplate.select(".fieldName")[1]}),domain.FieldFilterEditor.addMethod("handleClick",function(e){matchAny(e,["button#swap"],!0)&&this.swapClickHandler()}),domain.FieldFilterEditor.addMethod("fillinTemplate",function(){var e=this.newFilterValue;this.fieldNameElement.update(xssUtil.escape(e.name)),this.fieldValueElement.update(xssUtil.escape(e.name2))}),domain.FieldFilterEditor.addMethod("getValue",function(){return this.newFilterValue.comparison=this.comparisonId,this.newFilterValue.locked=!0,this.newFilterValue}),domain.FieldFilterEditor.addMethod("cancel",function(){this.resetToCurrentEditor(),this.newFilterValue=deepClone(this.getOriginalValue())}),domain.FieldFilterEditor.addMethod("getFormattedValue",function(){return"{"+String(this.getOriginalValue().name2)+"}"}),domain.FieldFilterEditor.addMethod("validate",function(){return!0}),domain.FieldFilterEditor.addMethod("swapClickHandler",function(){var e=this.newFilterValue,t=e.name,i=e.fieldId;return e.name=e.name2,e.fieldId=e.field2Id,e.name2=t,e.field2Id=i,e.value=[e.name],this.fillinTemplate(),!0}),domain.FieldFilterEditor.addMethod("comparisonSelectedHandler",function(e){this.comparisonId=domain.getSelectedOptionId(e.element())}),domain.FilterValueEditor=function(e,t){this.getOriginalValue=e,this.currentComparisonId=t,this.init()},domain.FilterValueEditor.addMethod("init",function(){this.initTemplate(),this.afterTemplateInitialization(),this.initValidators(),this.initEventHandlers(),this.clickHandlersHash=this.createHandlersHash()}),domain.FilterValueEditor.addMethod("initTemplate",function(){this.template=this.createTemplate(),this.initValueElements()}),domain.FilterValueEditor.addMethod("createTemplate",function(){var e=Element.clone(this.valueEditorId,!0);return e.writeAttribute("id","values"),e.removeClassName("hidden"),e}),domain.FilterValueEditor.addMethod("afterTemplateInitialization",function(){}),domain.FilterValueEditor.addMethod("fillinTemplate",function(){this.currentComparisonId===this.getOriginalValue().comparison&&this.setValue(this.getOriginalValue().value),this.setTitle(this.currentComparisonId)}),domain.FilterValueEditor.addMethod("setTitle",function(e){var t=this.getValueElement();!Object.isArray(t)&&(t=[t]),t&&t.each(function(t){(t.up("label")||t).writeAttribute("title",this.getTitleMessage(e))}.bind(this))}),domain.FilterValueEditor.addMethod("getTitleMessage",function(){return domain.getMessage("filter_default_title")}),domain.FilterValueEditor.addMethod("initValidators",function(){this.validators=this.createCommonValidators().concat(this.createValidators())}),domain.FilterValueEditor.addMethod("createCommonValidators",function(){return[{validator:function(){return domain.valueNotEmptyValidator(this.getValue(),domain.getMessage("value_should_be_not_empty"))}.bind(this),element:this.getValueElement()}]}),domain.FilterValueEditor.addMethod("createValidators",function(){return[]}),domain.FilterValueEditor.addMethod("validate",function(){return this.removeMalicious(),ValidationModule.validate(this.validators)}),domain.FilterValueEditor.addMethod("removeMalicious",function(){this.setValue(this.stripValue(this.getValue()))}),domain.FilterValueEditor.handleClick=function(e){var t=_.find(this.clickHandlersHash,function(t,i){return e.match(i)});t&&t.call(this,e)},domain.FilterValueEditor.addMethod("createHandlersHash",function(){return{}}),domain.FilterValueEditor.addMethod("afterDraw",function(){this.fillinTemplate()}),domain.FilterValueEditor.addMethod("initValueElements",function(){}),domain.FilterValueEditor.addMethod("initEventHandlers",function(){}),domain.FilterValueEditor.addMethod("cancel",function(){}),domain.FilterValueEditor.addMethod("getTemplate",function(){return this.template}),domain.FilterValueEditor.addMethod("setValue",function(e){this.getValueElement().setValue(String(e[0]))}),domain.FilterValueEditor.addMethod("getValue",function(){return this.getValueElement().getValue()}),domain.FilterValueEditor.addMethod("stripValue",function(e){var t=function(e){return e?e.strip().stripScripts():""};return Object.isArray(e)?e.collect(t):[t(e)]}),domain.FilterValueEditor.addMethod("isTimestampField",function(){return"Timestamp"===this.getOriginalValue().dataType}),domain.FilterValueEditor.addMethod("isTimeField",function(){return"Time"===this.getOriginalValue().dataType}),domain.FilterValueEditor.addMethod("_getControlName",function(){return this.isTimestampField()?"datetimepicker":this.isTimeField()?"timepicker":"datepicker"}),domain.FilterValueEditor.addMethod("getValueElement",function(){}),domain.SingleDictionaryEditor=function(e,t,i){this.searchParams={limitType:"contains",itemId:e().fieldId,searchWord:""},this.flowExecutionKey=i,domain.FilterValueEditor.apply(this,arguments)},domain.SingleDictionaryEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.SingleDictionaryEditor.addMethod("afterTemplateInitialization",function(){this.retrieveAvailableDictionaryValues(this.searchParams)}),domain.SingleDictionaryEditor.addMethod("initValueElements",function(){this.searchInputElement=this.getTemplate().select(".searchLockup input")[0],this.searchButtonElement=this.getTemplate().select(".searchLockup > .search.button")[0],this.searchClearElement=this.getTemplate().select(".searchLockup .button.searchClear")[0]}),domain.SingleDictionaryEditor.addMethod("initEventHandlers",function(){this.searchInputElement.observe("keyup",this.handleKeyup.bind(this))}),domain.SingleDictionaryEditor.addMethod("handleKeyup",function(e){switch(e.keyCode){case Event.KEY_TAB:case Event.KEY_ESC:case Event.KEY_LEFT:case Event.KEY_UP:case Event.KEY_RIGHT:case Event.KEY_DOWN:case Event.KEY_DELETE:case Event.KEY_HOME:case Event.KEY_END:case Event.KEY_PAGEUP:case Event.KEY_PAGEDOWN:case Event.KEY_INSERT:return!0;case Event.KEY_RETURN:this.doSearch();break;default:this.onCharacterPressed(e)}return!0}),domain.SingleDictionaryEditor.addMethod("createHandlersHash",function(){return{".button.search":function(){this.doSearch()},".button.searchClear":function(){this.onClearButtonClicked(),this.doSearch(this.onClearButtonClicked.bind(this))}}}),domain.SingleDictionaryEditor.addMethod("onCharacterPressed",function(){this.updateSearchClearButtonState()}),domain.SingleDictionaryEditor.addMethod("updateSearchClearButtonState",function(){this.searchInputElement.getValue().blank()?this.searchClearElement.removeClassName(layoutModule.UP_CLASS):this.searchClearElement.addClassName(layoutModule.UP_CLASS)}),domain.SingleDictionaryEditor.addMethod("doSearch",function(e){ValidationModule.hideError(this.getAvailableValueElement()),this.searchParams.itemId=this.getOriginalValue().fieldId,this.searchParams.searchWord=this.searchInputElement.getValue(),this.retrieveAvailableDictionaryValues(this.searchParams,e)}),domain.SingleDictionaryEditor.addMethod("onClearButtonClicked",function(){this.setSearchValue("")}),domain.SingleDictionaryEditor.addMethod("retrieveAvailableDictionaryValues",function(e,t){domain.sendAjaxRequest({flowExecutionKey:this.flowExecutionKey,eventId:"availableValues"},e,this.handleAvailableValuesRetrieved.bindAsEventListener(this,t))}),domain.SingleDictionaryEditor.addMethod("handleAvailableValuesRetrieved",function(e,t){if(!e||"object"!=typeof e){if("INFO:TOO_MANY_ROWS"===e)return ValidationModule.showError(this.getAvailableValueElement(),domain.getMessage("domain.filter.too_many_records")),void this.getAvailableValueElement().update("");e=[]}try{this.updateDictionaryValuesSelect(e),Object.isFunction(t)&&t()}catch(i){throw"Available values response handling error : #{error}".interpolate({error:i})}}),domain.SingleDictionaryEditor.addMethod("initValidators",function(){this.validators=this.createValidators()}),domain.SingleDictionaryEditor.addMethod("setSearchValue",function(e){this.searchInputElement.setValue(e),this.updateSearchClearButtonState()}),domain.SingleDictionaryEditor.addMethod("afterValueSet",function(){this.updateSearchClearButtonState()}),domain.MultipleValuesEditor=function(e,t,i){domain.SingleDictionaryEditor.apply(this,arguments)},domain.MultipleValuesEditor.prototype=deepClone(domain.SingleDictionaryEditor.prototype),domain.MultipleValuesEditor.addVar("valueEditorId","multipleValues"),domain.MultipleValuesEditor.addMethod("initValueElements",function(){domain.SingleDictionaryEditor.prototype.initValueElements.apply(this,arguments),this.availableValuesElement=this.getTemplate().select("select.availableValues")[0],this.selectedValuesElement=this.getTemplate().select("select.selectedValues")[0]}),domain.MultipleValuesEditor.addMethod("initEventHandlers",function(){domain.SingleDictionaryEditor.prototype.initEventHandlers.apply(this,arguments);var e=isIE()?"click":"mouseup";e=isIPad()?"blur":e;var t=this.getTemplate();t.on(e,"select.availableValues",domain.moveOption.bindAsEventListener(this,function(){return this.selectedValuesElement}.bind(this))),t.on(e,"select.selectedValues",domain.moveOption.bindAsEventListener(this,function(){return this.availableValuesElement}.bind(this)))}),domain.MultipleValuesEditor.addMethod("updateDictionaryValuesSelect",function(e){var t=domain.getSelectValues(this.selectedValuesElement),i=_.difference(e,t),a=domain.createSelectWithOptions(i,{"class":this.availableValuesElement.readAttribute("class"),multiple:"multiple"});this.availableValuesElement;this.availableValuesElement.replace(a),this.availableValuesElement=this.getTemplate().select("select.availableValues")[0]}),domain.moveOption=domain.MultipleValuesEditor.moveSelectOption=function(e,t){function i(e,i){e.remove();var a=_.find(i.options,function(t){return t.value>e.value}),n=xssUtil.escape(e.text);a?$(a).insert({before:new Element("option",{value:e.value,title:n}).update(n)}):i.insert(new Element("option",{value:e.value,title:n}).update(n)),t.focus()}var a=e.element(),t=t(),n=a.selectedIndex>-1?$(a.options[a.selectedIndex]):e.element();isIPad()?a.childElements().each(function(e){e.selected&&i(e,t)}):Object.isUndefined(n.selectedIndex)&&i(n,t)},domain.MultipleValuesEditor.addMethod("createValidators",function(){return[{validator:function(e){return domain.baseValidator(function(e){return 0===e.options.length}.curry(this.selectedValuesElement),domain.getMessage("value_should_be_not_empty"))}.bind(this),element:this.selectedValuesElement}]}),domain.MultipleValuesEditor.addMethod("removeMalicious",function(){}),domain.MultipleValuesEditor.addMethod("cancel",function(){ValidationModule.hideError(this.selectedValuesElement),this.reloadAvailable=!0}),domain.MultipleValuesEditor.addMethod("setValue",function(e){this.reloadAvailable&&this.afterTemplateInitialization(),domain.setSelectOptions(this.selectedValuesElement,e),this.afterValueSet()}),domain.MultipleValuesEditor.addMethod("getAvailableValueElement",function(){return this.availableValuesElement}),domain.MultipleValuesEditor.addMethod("getValueElement",function(){return this.selectedValuesElement}),domain.MultipleValuesEditor.addMethod("getValue",function(){return domain.getSelectValues(this.selectedValuesElement)}),domain.MultipleValuesEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_multiple_values_title",{comparison:domain.getMessage(e)})}),domain.ComboSelectEditor=function(e,t,i){domain.SingleDictionaryEditor.apply(this,arguments)},domain.ComboSelectEditor.prototype=deepClone(domain.SingleDictionaryEditor.prototype),domain.ComboSelectEditor.addVar("valueEditorId","comboValues"),domain.ComboSelectEditor.addMethod("initValueElements",function(){domain.SingleDictionaryEditor.prototype.initValueElements.apply(this,arguments),this.availableValuesElement=this.getTemplate().select("select")[0],this.inputElement=this.searchInputElement}),domain.ComboSelectEditor.addMethod("initEventHandlers",function(){domain.SingleDictionaryEditor.prototype.initEventHandlers.apply(this,arguments),this.initValueChangeHandler(),new Field.Observer(this.inputElement,.3,function(e,t){e.writeAttribute("title",t)})}),domain.ComboSelectEditor.addMethod("initValueChangeHandler",function(){this.availableValuesElement.observe("change",this.valueSelectedHandler.bind(this))}),domain.ComboSelectEditor.addMethod("valueSelectedHandler",function(e){this.setValue(e.element().getValue())}),domain.ComboSelectEditor.addMethod("updateDictionaryValuesSelect",function(e){var t=""===e[0]?[]:[""];Event.stopObserving(this.availableValuesElement),this.availableValuesElement.replace(domain.createSelectWithOptions(t,e)),this.availableValuesElement=this.getTemplate().select("select")[0],this.initValueChangeHandler(),this.availableValuesElement.selectedIndex=0}),domain.ComboSelectEditor.addMethod("onCharacterPressed",function(){domain.SingleDictionaryEditor.prototype.onCharacterPressed.call(this),this.availableValuesElement.selectedIndex=0}),domain.ComboSelectEditor.addMethod("onClearButtonClicked",function(){domain.SingleDictionaryEditor.prototype.onClearButtonClicked.call(this),this.availableValuesElement.selectedIndex=0}),domain.ComboSelectEditor.addMethod("setValue",function(e){Object.isArray(e)&&(e=e[0]),this.inputElement.setValue(e),this.afterValueSet()}),domain.ComboSelectEditor.addMethod("getAvailableValueElement",function(){return this.availableValuesElement}),domain.ComboSelectEditor.addMethod("getValueElement",function(){return this.inputElement}),domain.ComboSelectEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_combo_title",{comparison:domain.getMessage(e)})}),domain.StringValueEditor=function(e,t){domain.FilterValueEditor.apply(this,arguments)},domain.StringValueEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.StringValueEditor.addVar("valueEditorId","stringValues"),domain.StringValueEditor.addMethod("initValueElements",function(){this.stringValueElement=this.getTemplate().select("input")[0]}),domain.StringValueEditor.addMethod("createValidators",function(){return[{validator:function(e){return domain.maxLengthValidator(e,1e3,domain.getMessage("too_long_text"))}.bind(this),element:this.getValueElement()}]}),domain.StringValueEditor.addMethod("getValueElement",function(){return this.stringValueElement}),domain.StringValueEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_string_title",{comparison:domain.getMessage(e)})}),domain.NumberValueEditor=function(e,t){domain.StringValueEditor.apply(this,arguments)},domain.NumberValueEditor.prototype=deepClone(domain.StringValueEditor.prototype),domain.NumberValueEditor.addMethod("createValidators",function(){var e=this.getOriginalValue().javaType,t=this.getOriginalValue().dataType,i=domain.getNumberBounds(e)||{min:-(1/0),max:1/0};return[{validator:function(a){var n=domain.numberValidator(a,domain.filter.numberFormat,domain.getMessage("wrong_number_format",{value:a}));return n.isValid&&(n=domain.baseValidator(function(){return"Integer"===t&&domain.filter.numberFormat.isInteger(a)},domain.getMessage("domain.filter.incorrect_integer_value")),n.isValid&&(n=domain.numberBoundsValidator(domain.filter.toNumber(a),i,domain.getMessage("number_out_of_bounds",{type:e})))),n},element:this.getValueElement()}]}),domain.NumberValueEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_number_title",{comparison:domain.getMessage(e)})}),domain.ValueRangeEditor=function(e,t){domain.FilterValueEditor.apply(this,arguments)},domain.ValueRangeEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.ValueRangeEditor.addMethod("initValueElements",function(){this.rangeValueElements=_.collect(this.getValueRangeIds(),function(e){return this.getTemplate().select("#"+e.inputId)[0]},this)}),domain.ValueRangeEditor.addMethod("createCommonValidators",function(){return _.collect(this.getValueRangeIds(),function(e,t){return{validator:function(e){return domain.valueNotEmptyValidator(this.getElementValue(e),domain.getMessage("value_should_be_not_empty"))}.bind(this,t),element:this.getElement(t)}},this)}),domain.ValueRangeEditor.addMethod("setValue",function(e){_.each(this.getValueRangeIds(),function(t,i){this.getElement(i).setValue(e[i])},this)}),domain.ValueRangeEditor.addMethod("getElement",function(e){return this.rangeValueElements[e]}),domain.ValueRangeEditor.addMethod("getElementValue",function(e){return this.getElement(e).getValue()}),domain.ValueRangeEditor.addMethod("getValue",function(){return _.collect(this.getValueRangeIds(),function(e,t){return this.getElementValue(t)},this)}),domain.ValueRangeEditor.addMethod("getValueElement",function(){return this.rangeValueElements}),domain.ValueRangeEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_range_title",{comparison:domain.getMessage(e)})}),domain.NumberRangeEditor=function(e,t){var i=e().id;this.valueEditorId="numberRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.numberRangeNames=_.collect([1,2],function(e){var t=this.RANGE_INPUT_ID+"_"+e;return{standardInputId:t,inputId:i+"_"+t}},this),domain.ValueRangeEditor.apply(this,arguments)},domain.NumberRangeEditor.prototype=deepClone(domain.ValueRangeEditor.prototype),domain.NumberRangeEditor.addMethod("getValueRangeIds",function(){return this.numberRangeNames}),domain.NumberRangeEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return _.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),domain.NumberRangeEditor.addMethod("createValidators",function(){var e=this.getOriginalValue().javaType,t=domain.getNumberBounds(e)||{min:-(1/0),max:1/0},i=this.getOriginalValue().dataType;return _.collect(this.getValueRangeIds(),function(a,n){return{validator:function(a){var n,o=this.getElementValue(a);return o.match(domain.filter.ATTRIBUTES_PATTERN)?n=domain.baseValidator(function(){return!1}):(n=domain.numberValidator(o,domain.filter.numberFormat,domain.getMessage("wrong_number_format",{value:o})),n.isValid&&(n=domain.baseValidator(function(){return"Integer"===i&&domain.filter.numberFormat.isInteger(o)},domain.getMessage("domain.filter.incorrect_integer_value")),n.isValid&&(n=domain.numberBoundsValidator(domain.filter.toNumber(o),t,domain.getMessage("number_out_of_bounds",{type:e}))))),n}.bind(this,n),element:this.getElement(n)}},this).concat({validator:function(){var e,t=this.getElementValue(0),i=this.getElementValue(1),a=domain.filter.ATTRIBUTES_PATTERN,n=domain.filter.ATTRIBUTE_VALUE_PATTERN,o=t.match(a),r=i.match(a),d=t.match(n),l=i.match(n);return e=o&&r?domain.baseValidator(function(){return d[1]===l[1]},domain.getMessage("number_range_error",{from:t,to:i})):o||r?domain.baseValidator(function(){return!1}):domain.rangeValidator(domain.filter.toNumber(t),domain.filter.toNumber(i),domain.getMessage("number_range_error",{from:t,to:i}))}.bind(this),element:this.getElement(1)})}),domain.DateValueEditor=function(e,t){"Date"===e().dataType?(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_DATE_FORMAT):"Time"===e().dataType?(this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIME_FORMAT):(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIMESTAMP_FORMAT),this.timeZoneOffset=domain.filter.TIMEZONE_OFFSET,this.valueEditorId="dateValues",this.CALENDAR_INPUT_ID="calendar_input",this.CALENDAR_BUTTON_ID="calendar_button",this.dateInputName=e().id+this.CALENDAR_INPUT_ID,this.dateButtonName=e().id+this.CALENDAR_BUTTON_ID,domain.FilterValueEditor.apply(this,arguments)},domain.DateValueEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.DateValueEditor.addMethod("initValueElements",function(){this.dateValueElement=this.getTemplate().select("#"+this.dateInputName)[0]}),domain.DateValueEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return e.select("#"+this.CALENDAR_INPUT_ID)[0].writeAttribute("id",this.dateInputName),e}),domain.DateValueEditor.addMethod("afterDraw",function(){var e=jQuery("#"+this.dateInputName),t=this._getControlName();this.picker=new DateAndTimePicker({el:e[0],showOn:"button",buttonText:"",dateFormat:"timepicker"===t?null:this.dateFormat,timeFormat:"datepicker"===t?null:this.timeFormat,showSecond:this.isTimestampField()||this.isTimeField()}),e.next().addClass("button").addClass("picker"),e[0].getValue=function(){return jQuery(this).val()},this.fillinTemplate()}),domain.DateValueEditor.addMethod("createValidators",function(){return[{validator:function(e){return this.isTimestampField()&&0!==getDateFromFormat(e,domain.filter.FILTER_DATE_FORMAT)&&(e+=" 00:00"),domain.dateValidator(e,this.getOriginalValue().dateFormat,domain.getMessage("wrong_date_format",{value:e}))}.bind(this),element:this.getValueElement()}]}),domain.DateValueEditor.addMethod("getValueElement",function(){return this.dateValueElement}),domain.DateValueEditor.addMethod("getTitleMessage",function(e){return domain.getMessage("filter_date_title",{comparison:domain.getMessage(e)})}),domain.DateRangeEditor=function(e,t){"Date"===e().dataType?(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,e().dateFormat=domain.filter.FILTER_DATE_FORMAT):"Time"===e().dataType?(this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIME_FORMAT):(this.dateFormat=domain.filter.CALENDAR_DATE_FORMAT,this.timeFormat=domain.filter.CALENDAR_TIME_FORMAT,e().dateFormat=domain.filter.FILTER_TIMESTAMP_FORMAT),this.timeZoneOffset=domain.filter.TIMEZONE_OFFSET;var i=e().id;this.valueEditorId="dateRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.dateRangeNames=_.collect([1,2],function(e){var t=this.RANGE_INPUT_ID+"_"+e,a=t+this.BUTTON_SUFFIX;return{standardInputId:t,inputId:i+"_"+t,standardButtonId:a,buttonId:i+"_"+a}},this),domain.ValueRangeEditor.apply(this,arguments)},domain.DateRangeEditor.prototype=deepClone(domain.ValueRangeEditor.prototype),domain.DateRangeEditor.addMethod("getValueRangeIds",function(){return this.dateRangeNames}),domain.DateRangeEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return _.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),domain.DateRangeEditor.addMethod("afterDraw",function(){_.each(this.getValueRangeIds(),function(e){var t=jQuery("#"+e.inputId),i=this._getControlName();this.picker=new DateAndTimePicker({el:t[0],showOn:"button",buttonText:"",dateFormat:"timepicker"===i?null:this.dateFormat,timeFormat:"datepicker"===i?null:this.timeFormat,showSecond:this.isTimestampField()||this.isTimeField()}),t.next().addClass("button").addClass("picker"),t[0].getValue=function(){return jQuery(this).val()}},this),this.fillinTemplate()}),domain.DateRangeEditor.addMethod("createValidators",function(){return _.collect(this.getValueRangeIds(),function(e,t){return{validator:function(e){var t=this.getElementValue(e);return this.isTimestampField()&&0!==getDateFromFormat(t,domain.filter.FILTER_DATE_FORMAT)&&(t+=" 00:00"),domain.dateValidator(t,this.getOriginalValue().dateFormat,domain.getMessage("wrong_date_format",{value:t}))}.bind(this,t),element:this.getElement(t)}},this).concat({validator:function(){var e=this.getElementValue(0),t=this.getElementValue(1);return domain.rangeValidator(getDateFromFormat(e,this.getOriginalValue().dateFormat),getDateFromFormat(t,this.getOriginalValue().dateFormat),domain.getMessage("date_range_error",{from:e,to:t}))}.bind(this),element:this.getElement(1)})}),domain.TimeRangeEditor=function(e,t){var i=e().id;this.valueEditorId="numberRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.numberRangeNames=_.collect([1,2],function(e){var t=this.RANGE_INPUT_ID+"_"+e;return{standardInputId:t,inputId:i+"_"+t}},this),domain.ValueRangeEditor.apply(this,arguments)},domain.TimeRangeEditor.prototype=deepClone(domain.ValueRangeEditor.prototype),domain.TimeRangeEditor.addMethod("getValueRangeIds",function(){return this.numberRangeNames}),domain.TimeRangeEditor.addMethod("createTemplate",function(){var e=domain.FilterValueEditor.prototype.createTemplate.call(this);return _.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),domain.BooleanSelectEditor=function(e,t){domain.FilterValueEditor.apply(this,arguments),this.setID(e().id),this.initBooleanLastValueMap(),this.setInitialSelectValue()},domain.BooleanSelectEditor.prototype=deepClone(domain.FilterValueEditor.prototype),domain.BooleanSelectEditor.addVar("valueEditorId","booleanComboValues"),domain.BooleanSelectEditor.addMethod("initValueElements",function(){this.selectElement=this.getTemplate().select("select")[0],this.inputElement=this.getTemplate().select("input")[0],this.inputElement.validatorMessageContainer=this.getTemplate().select("div.errorContainer")[0],this.setValueList(),this.initEvents()}),domain.BooleanSelectEditor.addMethod("setLastValue",function(e){domain.booleanLastValueMap[this.id]=e}),domain.BooleanSelectEditor.addMethod("initBooleanLastValueMap",function(){domain.booleanLastValueMap=domain.booleanLastValueMap||[]}),domain.BooleanSelectEditor.addMethod("setInitialSelectValue",function(){this.selectElement.setValue(domain.booleanLastValueMap[this.id])}),domain.BooleanSelectEditor.addMethod("setID",function(e){this.id=e}),domain.BooleanSelectEditor.addMethod("initEvents",function(){var e=this;this.selectElement.observe("change",function(t){var i=t.element().getValue(),a=i===domain.getMessage("filter_empty_string")?"":i;e.inputElement.setValue(a),e.setLastValue(a)}),this.inputElement.observe("keyup",function(t){e.selectElement.setValue(domain.getMessage("filter_empty_string"))}),this.inputElement.observe("change",function(t){e.setLastValue(t.element().getValue())})}),domain.BooleanSelectEditor.addMethod("setValueList",function(){domain.setSelectOptions(this.selectElement,[domain.getMessage("filter_empty_string"),"true","false"])}),domain.BooleanSelectEditor.addMethod("createValidators",function(){var e=this;return[{validator:function(t){var i=domain.baseValidator(function(t){return""===e.inputElement.value},domain.getMessage("value_should_be_not_empty"));return i.isValid?(isMatchingPattern=t.match(domain.filter.ATTRIBUTES_PATTERN)||"true"===t||"false"===t,{isValid:isMatchingPattern,errorMessage:domain.getMessage("domain.filter.incorrect_attribute_pattern")}):i}.bind(e),element:e.inputElement}]}),domain.BooleanSelectEditor.addMethod("getValueElement",function(){return this.inputElement}),domain.FilterModelController=function(e,t,i){domain.filter.init(i),this.PRE_FILTERS_PANEL="preFilters",this.FILTERS_LIST_ID=e,this.FILTER_EDITOR_CANCEL_BUTTON_ID="filterEditorCancel",this.FILTER_EDITOR_OK_BUTTON_ID="filterEditorOk",this.CREATE_MODE="create",this.UPDATE_MODE="update",this.targetHiddenFieldId="slRules",this.initParams=i,this.filterEditor=t,this._filterEditorsMap=null,this._currentFilter=null,this.mode=null},domain.FilterModelController.addMethod("init",function(){if(this._list=new dynamicList.List(this.FILTERS_LIST_ID,{listTemplateDomId:"list_domain_chooser_filter",itemTemplateDomId:"list_domain_chooser_filter:leaf",excludeFromSelectionTriggers:[".leaf *"],excludeFromEventHandling:!0}),isIPad()){var e=$(this.FILTERS_LIST_ID);new TouchController(e,e.up())}try{this._filterEditorsMap=new domain.FilterList,this.initFilters()}catch(t){window.console&&console.error("Filters initialization failed. Error : #{error}".interpolate({error:t}))}finally{this.updateHiddenField(),this._initListEvents(),this.drawList()}}),domain.FilterModelController.addMethod("initFilters",function(){this.initParams.filtersJson.each(function(e){this.addNewToFilterEditorsMap(this.filterEditor.prototype.create(new domain.FilterItem({json:e}),this.initParams.flowExecutionKey))}.bind(this))}),domain.FilterModelController.addMethod("initDropContainer",function(e){var t={onDrop:this.onDropHandler.bind(this)};e&&(t.accept=e),Droppables.add($(this.PRE_FILTERS_PANEL),t)}),domain.FilterModelController.addMethod("onDropHandler",function(e){var t=e.node;if(t){var i=domain.getSelectedTreeNodes(dynamicTree.trees[t.getTreeId()]);try{1===i.length?this.addFilter(new domain.FilterItem({node:t})):2===i.length&&this.addFieldFilter(i)}catch(a){console&&console.error(a)}}}),domain.FilterModelController.addMethod("addNewToFilterEditorsMap",function(e,t){if(e){var i=e.getOriginalValue();this.mode!==this.UPDATE_MODE&&this._updateIdIfFilterPresent(i),this._filterEditorsMap.set(i.id,e,t)}}),domain.FilterModelController.addMethod("_prepareListItem",function(e){var t=new dynamicList.ListItem({cssClassName:layoutModule.LEAF_CLASS,value:e});return t.processTemplate=e.processTemplate,t}),domain.FilterModelController.addMethod("drawList",function(){var e=this._filterEditorsMap.values().collect(this._prepareListItem);this.getList().setItems(e),this.getList().show()}),domain.FilterModelController.addMethod("refreshScroll",function(){var e=layoutModule.scrolls.get(this.PRE_FILTERS_PANEL);e&&e.refresh()}),domain.FilterModelController.addMethod("addFieldFilter",function(e){if(domain.areNodesFromSameIsland(e)){var t=e.collect(function(e){return new domain.FilterItem({node:e})}),i=t.first();i.type===t[1].type&&(i.initFieldFilterItem(t[1]),this.addFilter(i))}}),domain.FilterModelController.addMethod("addFilter",function(e){try{this.cancelPreviousEditing(),this._updateIdIfFilterPresent(e);var t=this.filterEditor.prototype.create(e,this.initParams.flowExecutionKey),i=this._prepareListItem(t);this.setCurrentFilter(i),this.getList().insertItems(0,[i]),this.getList().refresh(),$(this.FILTERS_LIST_ID).up().scrollTop=0,this.editMode(i),this.mode=this.CREATE_MODE}catch(a){throw this.setCurrentFilter(null),"Unknown filter creation error: #{error}".interpolate({error:a})}}),domain.FilterModelController.addMethod("editFilter",function(e){this.cancelPreviousEditing(),e.getValue().resetToCurrentEditor(),this.editMode(e),this.mode=this.UPDATE_MODE}),domain.FilterModelController.addMethod("cancelPreviousEditing",function(){if(this._currentFilter){var e=this._currentFilter.getValue();e.cancel();var t=e.getOriginalValue();this._filterEditorsMap.get(t.id)?(this._setItemClassName(this._currentFilter,""),this._currentFilter.refresh()):this.getList().removeItems([this._currentFilter]),this.setCurrentFilter(null)}}),domain.FilterModelController.addMethod("removeFilter",function(e){if(e){var t=e.getValue();t.beforeRemove(),this._filterEditorsMap.unset(t.getOriginalValue().id),this.getList().removeItems([e]),this.refreshScroll(),this.updateHiddenField()}}),domain.FilterModelController.addMethod("editMode",function(e){this.setCurrentFilter(e),this._setItemClassName(e,"editMode"),e.getValue().afterDraw(),this.refreshScroll(),enableSelection($(document.body))}),domain.FilterModelController.addMethod("saveFilter",function(e){
var t=e.getValue();t.validate()&&(t.applyEditorValue(),this.addNewToFilterEditorsMap(t,0),this.cancelPreviousEditing(),this.updateHiddenField())}),domain.FilterModelController.addMethod("getList",function(){return this._list}),domain.FilterModelController.addVar("listEventFactory",{"item:click":function(e){Event.stop(e);var t=Event.extend(e.memo.targetEvent),i=t.element(),a=e.memo.item,n=[i].concat(i.ancestors().slice(0,2)),o=_.any(this._editorElementsMap,function(e,i){return Selector.findElement(n,i,0)?(Event.stop(t),e.call(this,a),!0):!1},this);if(!o){var r=a.getValue();r.handleClick(i)}}}),domain.FilterModelController.addVar("_editorElementsMap",{"#filterEditorOk":function(e){this.saveFilter(e)},"#filterEditorCancel":function(){this.cancelPreviousEditing()},".change":function(e){this.editFilter(e)},".remove":function(e){this.removeFilter(e)}}),domain.FilterModelController.addVar("treeEventFactory",{"leaf:dblclick":function(e){var t=e.memo.node;if(Event.stop(e),t){var i=domain.getSelectedTreeNodes(dynamicTree.trees[t.getTreeId()]);try{2===i.length?this.addFieldFilter(i):this.addFilter(new domain.FilterItem({node:t}))}catch(a){console&&console.error(a)}}}}),domain.FilterModelController.addMethod("setCurrentFilter",function(e){this._currentFilter=e}),domain.FilterModelController.addMethod("_setItemClassName",function(e,t){e.setCssClassName(t),e.refreshStyle()}),domain.FilterModelController.addMethod("_initListEvents",function(){for(var e in this.listEventFactory)this._list.observe(e,this.listEventFactory[e].bindAsEventListener(this))}),domain.FilterModelController.addMethod("_updateIdIfFilterPresent",function(e){var t=this._filterEditorsMap.get(e.id);return t&&e.updateIndex(++t.getOriginalValue().index),e}),domain.FilterModelController.addMethod("updateHiddenField",function(){var e=Object.toJSON(this._filterEditorsMap.collect(function(e){return e.getOriginalValue()}));$$("#"+this.targetHiddenFieldId)[0].writeAttribute("value",e)}),domain.setSelectOptions=function(e,t){if(!Object.isElement(e)||!t||!Object.isArray(t))return e;var i=new Date;e.update("");var a=[];return domain.appendOptions(a,t),e.update(a.join("")),isIE()&&(e.className=e.className),window.console&&window.console.log("Select input update time : "+(new Date-i)+" ms."),e},domain.createSelectWithOptions=function(){var e=new Date,t=arguments[arguments.length-1],i="";_.isArray(t)||"object"!=typeof t||(i=_.reduce(t||{},function(e,t,i){return e+=i+'="'+t+'" '},""));for(var a=["<select "+i+">"],n=0;n<arguments.length;n++){var o=arguments[n];o&&_.isArray(o)&&domain.appendOptions(a,o)}return a.push("</select>"),window.console&&window.console.log("String conversion time : "+(new Date-e)+" ms."),a.join("")},domain.appendOptions=function(e,t){for(var i,a,n=0;n<t.length;n++){i=a=null!==t[n]?t[n].replace(/'/g,"&#39;"):domain.getMessage("filter_null_value"),""===t[n]&&(i=domain.getMessage("filter_empty_string"));var o=xssUtil.escape(i);e.push("<option title='"+o+"' value='"+a+"'>"+o+"</option>")}},domain.getSelectValues=function(e){return _.map(e.options,function(e){return e.readAttribute("value")})},domain.getSelectedOptionId=function(e){if(!Object.isElement(e))return null;var t=e.options[e.selectedIndex];return t.readAttribute("id")},domain.getSelectedTreeNodes=function(e){var t=e.selectedNodes;if(Object.isArray(t))return t.findAll(function(e){return!e.isParent()})},define("domain.filters",["domain.components"],function(e){return function(){var t;return t||e.domain.filter}}(this)),dd.filters={PAGE:"filters",getValidationPostData:function(){return{page:this.PAGE}},fillForm:function(){$("unsavedChangesPresent").writeAttribute("value",dd.isUnsavedChangesPresent().toString())},init:function(e){dd.formDomId="preFiltersForm",this.filterModelController=new domain.FilterModelController("filtersListId",domain.FilterEditor,e);var t=dd.filters.fields;t.init(this.filterModelController,function(){this.filterModelController.init(),this.filterModelController.updateHiddenField=function(){domain.FilterModelController.prototype.updateHiddenField.call(this.filterModelController),dd.setUnsavedChangesPresent(!0)}.bind(this),this.filterModelController.initDropContainer(["draggable"])}.bind(this)),domain.resetTreeSelectionHandler.init(["#"+t.ITEMS_TREE_DOM_ID],function(){return[t.itemsTree]})}};var dd_filters=dd.filters;dd_filters.fields={ITEMS_TREE_DOM_ID:"fieldsTreeRoot",TREE_DATA_PROVIDER:"filtersJoinTreeDataProvider",itemsTree:null,init:function(e,t){this.filterModel=e,this.itemsTree=domain.createItemsTree({treeId:this.ITEMS_TREE_DOM_ID,providerId:this.TREE_DATA_PROVIDER,templateDomId:"list_responsive_collapsible_type_tables",nodeClass:domain.TablesNode,selectOnMousedown:!0,dragPattern:".leaf .draggable"}),this.itemsTree.showTree(10,function(){dd_filters.fields.initTreeEvents(),t()},domain.treeErrorHandler)},initTreeEvents:function(){_.each(this.filterModel.treeEventFactory,function(e,t){this.itemsTree.observe(t,_.bind(e,this.filterModel))},this)}},"undefined"==typeof require&&document.observe("dom:loaded",dd.initialize.bind(dd)),define("domain.designer.filters",["domain.filters","domain.designer.validators"],function(e){return function(){var t;return t||e.dd_filters}}(this));var MONTH_NAMES=new Array("January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),DAY_NAMES=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat");define("dateFormatter",function(e){return function(){var t;return t||e.window}}(this)),define("domain/domainDesignerFiltersMain",["require","!domReady","underscore","jquery","domain.components","domain.designer.validators","jrs.configs","domain.designer.filters","dateFormatter"],function(e){"use strict";var t=e("!domReady"),i=e("underscore"),a=e("jquery"),n=e("domain.components"),o=e("domain.designer.validators"),r=e("jrs.configs");e("domain.designer.filters"),e("dateFormatter"),t(function(){"undefined"==typeof window.localContext&&(window.localContext={}),i.extend(window.localContext,r.domainDesigner.localContext),i.extend(n._messages,r.domainDesigner.domain._messages),a("body").addClass("jr"),o.initialize()})});