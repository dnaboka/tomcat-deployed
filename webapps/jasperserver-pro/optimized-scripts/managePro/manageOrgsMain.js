function RegExpRepresenter(e){this.charMap={"\\s":" "},this.expressionTokens=this.__parse(e)}function invokeServerAction(e,t){var i=orgModule.serverActionFactory[e];if(!i)throw new Error("No server action found for action name '"+e+"'");var n=i.call(orgModule.serverActionFactory,t);n.invokeAction()}function invokeClientAction(e,t){var i=orgModule.clientActionFactory[e];if(i){var n=i.call(orgModule.clientActionFactory,t);return n.invokeAction()}throw new Error("No client action found for action name '"+e+"'")}function invokeOrgAction(e,t){var i=orgModule.orgActionFactory[e](t);i.invokeAction()}function invokeOrgManagerAction(e,t){var i=orgModule.orgManager.actionFactory[e](t);i.invokeAction()}function canAddOrg(){return!_.isUndefined(orgModule.manager.tenantsTree.getTenant())}function canDeleteAll(){return orgModule.entityList.getSelectedEntities().length>0}function canDeleteUser(){return orgModule.entityList.getSelectedEntities().length>0}define("tools.infiniteScroll",["require","prototype","utils.common"],function(e){"use strict";e("prototype"),e("utils.common");var t=function(e){this._id=e.id,this._contentId=e.contentId?e.contentId:void 0,this._scroll=e.scroll,this._loadFactor=e.loadFactor?e.loadFactor:.95,this._lastContentHeight=0,this._loading=!1,e.control?void 0!==e.control.length&&e.control.length>1?this._control=$(e.control[0]):this._control=$(e.control):this._control=this._scroll?this._scroll.parent:$(this._id),this._scroll?this._content=this._scroll.element:e.content?void 0!==e.content.length&&e.content.length>1?this._content=$(e.content[0]):this._content=$(e.content):this._content=this._contentId?$(this._contentId):this._control.childElements()[0],this._eventType=isSupportsTouch()?"touchmove":"scroll",this._control.observe(this._eventType,this._onScrollHandler.bind(this))};return t.addMethod("destroy",function(){this._control&&this._control.stopObserving(this._eventType,this._handler)}),t.addMethod("_onScrollHandler",function(e){var t=this._scroll?-1*this._scroll.y:this._control.scrollTop,i=this._content.getHeight(),n=this._control.getHeight();i!=this._lastContentHeight&&(this._loading=!1);var o=!this._loading&&0!=i;o=this._scroll?o&&this._scroll.isBottom():o&&(n+t)/i>this._loadFactor,o&&(this._loading=!0,this._lastContentHeight=i,isIPad()&&this.wait(),this.onLoad())}),t.addMethod("onLoad",doNothing),t.addMethod("reset",function(){isIPad()?this._scroll.reset():this._control.scrollTop=0,this._loading=!1}),t.addMethod("wait",function(){if(!this._waitIndicator){this._waitIndicator=new Element("div",{"class":"dimmer resultsOverlay"});var e=this._control.getDimensions(),t=this._control.positionedOffset();this._waitIndicator.setStyle({zIndex:"4000",top:t.top+"px",left:t.left+"px",height:e.height+"px",width:e.width+"px"}),this._control.insert({after:this._waitIndicator})}this._waitIndicator.show()}),t.addMethod("stopWaiting",function(){this._waitIndicator&&this._waitIndicator.hide()}),window.InfiniteScroll=t,t});var toolbarButtonModule={UP:"up",DOWN:"down",OVER:"over",DISABLED:"disabled",PRESSED:"pressed",CONTENT_PREFIX:"toolbar_",MenuClass:"menu vertical dropDown",TOOLBAR_MENU_CLASS:"menu vertical dropDown fitable",ACTION_MODEL_TAG:"adhocActionModel",CAPSULE_PATTERN:"capsule",showButtonMenu:function(e,t){t=jQuery(t);var i=this.CONTENT_PREFIX+t.attr("id"),n="adhocActionModel"==this.ACTION_MODEL_TAG?this.actionModel:this.ACTION_MODEL_TAG;actionModel.showDropDownMenu(e,t,i,this.TOOLBAR_MENU_CLASS,n)},setActionModel:function(e){this.actionModel=e},isToolBarButton:function(e){return e?jQuery(e).hasClass("capsule"):!1},enable:function(e,t){buttonManager.enable(e)},disable:function(e){buttonManager.disable(e)},setButtonState:function(e,t){t?this.enable(e):this.disable(e)}};define("components.toolbarButtons",["jquery","prototype"],function(e){return function(){var t;return t||e.toolbarButtonModule}}(this)),toolbarButtonModule.initialize=function(e){toolbarButtonModule.actionMap=e,jQuery(".toolbar").on("mouseup mouseover mouseout","button",function(e){jQuery(this).prop("disabled")||toolbarButtonModule["mouse"+e.type.substring(5,6).toUpperCase()+e.type.substring(6)+"Handler"](e,this)}),isFirefox()&&jQuery(".toolbar li").each(function(e,t){jQuery(t).css("padding","0 2px")})},toolbarButtonModule.mouseUpHandler=function(e,t){var i=t.className.indexOf("capsule")>=0?toolbarButtonModule.actionMap[t.id]:null;if(i){var n=getAsFunction(i);n(e),e.stopPropagation()}},toolbarButtonModule.mouseOverHandler=function(e,t){t.className.indexOf("capsule")>=0&&t.className.indexOf("mutton")>=0&&!buttonManager.isDisabled(t)&&toolbarButtonModule.showButtonMenu(e.originalEvent,t)},toolbarButtonModule.mouseOutHandler=function(e,t){},define("components.toolbar",["jquery","prototype","utils.common","components.toolbarButtons"],function(e){return function(){var t;return t||e.toolbarButtonModule}}(this));var orgModule={TREE_ID:"orgTree",COOKIE_NAME:"selectedTenant",messages:[],ActionMap:{SEARCH:"search",BROWSE:"browse",NEXT:"next",SELECT_AND_GET_DETAILS:"selectAndGetDetails",SEARCH_AVAILABLE:"searchAvailable",SEARCH_ASSIGNED:"searchAssigned",NEXT_AVAILABLE:"nextAvailable",NEXT_ASSIGNED:"nextAssigned",CREATE:"create",UPDATE:"update",DELETE:"delete",DELETE_ALL:"deleteAll",EXIST:"exist"},Event:{ORG_BROWSE:"org:browse",ENTITY_SEARCH:"entity:search",ENTITY_NEXT:"entity:next",ENTITY_SELECT_AND_GET_DETAILS:"entity:selectAndGetDetails",RESULT_CHANGED:"result:changed",RESULT_NEXT:"result:next",ENTITY_DETAILS_LOADED:"entity:detailsLoaded",SEARCH_AVAILABLE_LOADED:"searchAvailable:loaded",SEARCH_ASSIGNED_LOADED:"searchAssigned:loaded",NEXT_AVAILABLE_LOADED:"nextAvailable:loaded",NEXT_ASSIGNED_LOADED:"nextAssigned:loaded",SERVER_ERROR:"server:error",SERVER_UNAVAILABLE:"server:unavailable",ENTITY_CREATED:"entity:created",ENTITY_UPDATED:"entity:updated",ENTITY_DELETED:"entity:deleted",ENTITIES_DELETED:"entities:deleted"},observe:function(e,t){this._getContainer().observe(e,t)},stopObserving:function(e,t){this._getContainer().stopObserving(e,t)},fire:function(e,t){this._getContainer().fire(e,t)},getMessage:function(e,t){var i=orgModule.messages[e];return i?new Template(i).evaluate(t?t:{}):""},_comparator:function(e,t){return e>t?1:t>e?-1:0},_getContainer:function(){return this._container||(this._container=document.body),this._container},Configuration:{nameSeparator:"|",userDefaultRole:"ROLE_USER",userNameNotSupportedSymbols:"[|]",roleNameNotSupportedSymbols:"[|]",emailRegExpPattern:"^[\\p{L}\\p{M}\\p{N}._%'-\\@\\,\\;\\s]+$",superuserRole:"ROLE_SUPERUSER",adminRole:"ROLE_ADMINISTRATOR",anonymousRole:"ROLE_ANONYMOUS"}};orgModule.systemRoles=[orgModule.Configuration.userDefaultRole,orgModule.Configuration.superuserRole,orgModule.Configuration.adminRole,orgModule.Configuration.anonymousRole],orgModule.Organization=function(e){if(!e)throw new Error("Can't create Organization from undefined json or node");e.param?(this.id=e.param.id,this.name=e.name,this.uri=e.param.uri,this.treeNode=e):(this.id=e.tenantId||e.id,this.name=e.tenantName,this.alias=e.tenantAlias||e.alias,this.desc=e.tenantDesc,this.uri=e.tenantUri,this.parentId=e.parentId,this.subTenantCount=e.subTenantCount)},orgModule.Organization.addMethod("isRoot",function(e){return"organizations"==this.id}),orgModule.Organization.addMethod("getNameWithTenant",function(){return this.id}),orgModule.Organization.addMethod("getDisplayName",function(){return this.name}),orgModule.Organization.addMethod("equals",function(e){return e&&this.id==e.id}),orgModule.Organization.addMethod("toJSON",function(e){return{tenantId:this.id,tenantName:this.name,tenantAlias:this.alias,tenantDesc:this.desc,parentId:this.parentId,tenantUri:this.uri}}),orgModule.Organization.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.organization),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({tenantId:this.id}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.Permission=function(e){this.isInherited=!!e.isInherited,e.permission&&(this.permission=e.permission),e.inheritedPermission&&(this.inheritedPermission=e.inheritedPermission),this.isDisabled=!!e.isDisabled},orgModule.Permission.addMethod("getResolvedPermission",function(){return this.isInherited?this.inheritedPermission:this.permission}),orgModule.Permission.addMethod("toJSON",function(){return{permission:this.permission,isInherited:this.isInherited,inheritedPermission:this.inheritedPermission,newPermission:this.newPermission}}),orgModule.Permission.addMethod("toData",function(){return{permission:this.permission,isInherited:this.isInherited,inheritedPermission:this.inheritedPermission,newPermission:this.newPermission}}),orgModule.User=function(e){e&&(this.userName=e.userName,this.fullName=e.fullName,this.password=e.password||"",this.confirmPassword=e.confirmPassword||"",this.tenantId=e.tenantId,this.email=e.email,this.enabled=e.enabled,this.external=e.external,this.roles=[],e.roles&&e.roles.each(function(e){this.roles.push(new orgModule.Role(e))}.bind(this)),e.permissionToDisplay&&(this.permission=new orgModule.Permission(e.permissionToDisplay)))},orgModule.User.addVar("FLOW_ID","userListFlow"),orgModule.User.addMethod("getDisplayName",function(){return this.userName}),orgModule.User.addMethod("getNameWithTenant",function(){return this.tenantId&&!this.tenantId.blank()?this.userName+orgModule.Configuration.userNameSeparator+this.tenantId:this.userName}),orgModule.User.addMethod("getManagerURL",function(){return"flow.html?"+Object.toQueryString({_flowId:this.FLOW_ID,text:"undefined"!=typeof this.userName?encodeURIComponent(this.userName):this.userName,tenantId:"undefined"!=typeof this.tenantId?encodeURIComponent(this.tenantId):this.tenantId})}),orgModule.User.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.user),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({text:this.userName,tenantId:this.tenantId}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.User.addMethod("equals",function(e){return e&&this.userName==e.userName&&this.tenantId==e.tenantId}),orgModule.User.addMethod("toPermissionData",function(e){return{userName:this.userName,tenantId:this.tenantId,permissionToDisplay:this.permission.toData()}}),orgModule.Role=function(e){e&&(this.roleName=e.roleName,this.external=e.external,this.tenantId=e.tenantId),e.permissionToDisplay&&(this.permission=new orgModule.Permission(e.permissionToDisplay))},orgModule.Role.addVar("FLOW_ID","roleListFlow"),orgModule.Role.addMethod("getDisplayName",function(){return this.roleName}),orgModule.Role.addMethod("getNameWithTenant",function(){return this.tenantId&&!this.tenantId.blank()?this.roleName+orgModule.Configuration.userNameSeparator+this.tenantId:this.roleName}),orgModule.Role.addMethod("getManagerURL",function(){return"flow.html?"+Object.toQueryString({_flowId:this.FLOW_ID,text:"undefined"!=typeof this.roleName?encodeURIComponent(this.roleName):this.roleName,tenantId:"undefined"!=typeof this.tenantId?encodeURIComponent(this.tenantId):this.tenantId})}),orgModule.Role.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.role),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({text:this.roleName,tenantId:this.tenantId}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.Role.addMethod("equals",function(e){return e&&this.roleName==e.roleName&&this.tenantId==e.tenantId}),orgModule.Role.addMethod("toPermissionData",function(e){return{roleName:this.roleName,tenantId:this.tenantId,permissionToDisplay:this.permission.toData()}}),orgModule.initTenantsTreeEvents=function(){orgModule.manager.tenantsTree.on("selection:change",function(e){if(!orgModule.manager.lastSelectedOrg||orgModule.manager.lastSelectedOrg.id!==e.id){var t=new orgModule.Organization(e),i=orgModule.properties;orgModule.manager.tenantsTree.setTenant(t),window.localStorage&&localStorage.setItem(orgModule.COOKIE_NAME,JSON.stringify(e)),orgModule.fire(orgModule.Event.ORG_BROWSE,{organization:t,entityEvent:!1}),orgModule.orgManager&&(i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID]),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.id,entityEvent:!1})),(orgModule.userManager||orgModule.roleManager)&&(i.hide(),i.unlock())}}),orgModule.manager.tenantsTree.on("import:finished",function(e){var t=orgModule.properties;orgModule.fire(orgModule.Event.ORG_BROWSE,{force:!0,entityEvent:!1}),orgModule.orgManager&&(t.changeDisable(!1,["#"+t._EDIT_BUTTON_ID]),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{refreshAttributes:!0,entityId:e,entityEvent:!1}))})},orgModule.entityList={ID_PATTERN:".ID > a",_listId:"entitiesList",_containerId:"listContainer",_searchBoxId:"secondarySearchBox",initialize:function(e){this.list=new dynamicList.List(this._listId,{listTemplateDomId:e.listTemplateId,itemTemplateDomId:e.itemTemplateId,multiSelect:!0,selectionDefaultsToCursor:!0,comparator:function(e,t){return orgModule._comparator(e.getLabel(),t.getLabel())}}),this._initEvents(),this._infiniteScroll=new InfiniteScroll({id:this._containerId,contentId:this._listId}),this._searchBox=new SearchBox({id:this._searchBoxId}),e.text&&this._searchBox.setText(e.text),this._infiniteScroll.onLoad=function(){orgModule.fire(orgModule.Event.ENTITY_NEXT,{})},this._searchBox.onSearch=function(e){orgModule.fire(orgModule.Event.ENTITY_SEARCH,{text:e})},orgModule.toolbar.initialize(e.toolbarModel),this.toolbar=orgModule.toolbar,this.list.show()},_initEvents:function(){this.list.observe("item:selected",function(e){var t=e.memo.item,i=orgModule.properties;this.lastSelectedName=t.getValue().getNameWithTenant(),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.getValue().id,entityEvent:!0}),i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID])}.bindAsEventListener(this)),this.list.observe("item:unselected",function(e){var t=orgModule.manager.tenantsTree,i=orgModule.properties;i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID]),!i.locked&&t?orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.getTenant().id,entityEvent:!0,isCtrlHeld:e.memo.isCtrlHeld}):(i.hide(),this.toolbar.refresh())}.bindAsEventListener(this)),this.list.observe("item:beforeSelectOrUnselect",function(e){var t=e.memo.item;e.stopSelectOrUnselect=!invokeClientAction("cancelIfEdit",{entity:t.getValue(),showConfirm:e.memo.showConfirm})}.bindAsEventListener(this))},_createEntityItem:function(e){var t=new dynamicList.ListItem({label:e.getDisplayName(),value:e}),i=this;return t.processTemplate=function(e){var t=e.select(i.ID_PATTERN)[0];return t.update(xssUtil.escape(this.getValue().getDisplayName())),e},t},getSearchText:function(){return this._searchBox.getText()},setSearchText:function(e){return this._searchBox.setText(e)},getSelectedEntities:function(){return this.list?this.list.getSelectedItems().collect(function(e){return e.getValue()}):[]},setEntities:function(e){var t=e.collect(this._createEntityItem.bind(this));this._infiniteScroll.reset(),this.list.setItems(t),this.list.show(),this.toolbar.refresh()},findEntity:function(e){var t=this.list.getItems(),i=orgModule.properties.options||orgModule.userManager.options;return i._.find(t,function(t){return t.getValue().fullName===e})},addEntities:function(e){var t=e.collect(this._createEntityItem.bind(this));this.list.addItems(t),this.list.refresh(),this.toolbar.refresh()},selectEntity:function(e){var t=this.list.getItems(),i=t.detect(function(t){return t.getValue().getNameWithTenant()==e});i&&(i.isSelected()&&i.deselect(),i.select(),this.lastSelectedName=i.getValue().getNameWithTenant())},restoreSelectedEntity:function(e){this.selectEntity(this.lastSelectedName?this.lastSelectedName:e)},deselectAll:function(){this.list.resetSelected()},update:function(e,t){var i=this.list.getItems(),n=i.findAll(function(t){return t.getValue().getNameWithTenant()==e});n.each(function(e){e.setValue(t),e.refresh()})},remove:function(e){var t,i=this.list.getItems();t=isArray(e)?i.findAll(function(t){return e.include(t.getValue().getNameWithTenant())}):i.findAll(function(t){return t.getValue().getNameWithTenant()==e}),this.list.resetSelected(),this.list.removeItems(t)}},orgModule.properties={_EDIT_MODE_CLASS:"editMode",_moveButtonsId:"moveButtons",_id:"properties",_value:null,isEditMode:!1,_NOTHING_TO_DISPLAY_ID:"nothingToDisplay",_ASSIGNED_VIEW_ID:"assignedView",_ASSIGNED_VIEW_LIST_ID:"assignedViewList",_ASSIGNED_ID:"assigned",_AVAILABLE_ID:"available",_ASSIGNED_LIST_ID:"assignedList",_AVAILABLE_LIST_ID:"availableList",_ATTRIBUTES_LIST_ID:"attributesTab",_EDIT_BUTTON_ID:"edit",_SAVE_BUTTON_ID:"save",_CANCEL_BUTTON_ID:"cancel",_DELETE_BUTTON_ID:"delete",_REMOVE_FROM_ASSIGNED_BUTTON_ID:"removeFromAssigned",_ADD_TO_ASSIGNED_BUTTON_ID:"addToAssigned",_BUTTONS_CONTAINER_ID:"propertiesButtons",_MOVE_BUTTONS_CONTAINER_ID:"moveButtons",_DND_CLASS:".draggable",_DROP_CLASS:"wrap",buttonsFunctions:{},initialize:function(e){var t=e.attributesTypesEnum;if(this.options=e,this.locked=!1,this.hide(),this.processTemplate(e),this._toggleButton(),e.attributes){var i=!orgModule.userManager&&orgModule.orgManager?t.TENANT:t.USER,n=e.attributesViewOptionsFactory,o=e.scrollEventTrait,s=e.AttributesViewFacade;this.options._.extend(this,o),this.attributesFacade=new s(n({context:e.attributes.context,container:jQuery("#attributesTab"),type:i}))}this.options.showAssigned&&this.initDnD(),this.initEvents(),this.initButtonsFunctions(),this.options.ConfirmationDialog&&this._initConfirmationDialog()},_initConfirmationDialog:function(){var e=this,t=this.options.i18n;this.confirmationDialog=new this.options.ConfirmationDialog({title:t["attributes.confirm.dialog.title"],text:t["attributes.confirm.cancel.dialog.text"]}),this.confirmationDialog.on("button:yes",function(){e.cancelOnEdit()})},_toggleButton:function(){var e=this.isChanged(),t=this.attributesFacade&&this.attributesFacade.containsUnsavedItems()||e;t?this.saveButton.removeAttribute("disabled"):this.saveButton.removeClassName("over").setAttribute("disabled","disabled")},show:function(e,t){if(!this.locked){if(this.attributesFacade){var i=this,n=e&&e.isRoot&&e.isRoot(),o=n?this.options._.extend({},e,{id:null}):e;this.attributesFacade.getCurrentView().setContext(o,t).done(function(){i.attributesFacade.render(n)})}var s=$(this._NOTHING_TO_DISPLAY_ID);s.addClassName(layoutModule.HIDDEN_CLASS),document.body.removeClassName(layoutModule.NOTHING_TO_DISPLAY_CLASS),this._value=e,this.changeMode(!1)}},hide:function(){if(!this.locked){var e=$(this._NOTHING_TO_DISPLAY_ID);e.removeClassName(layoutModule.HIDDEN_CLASS),centerElement(e,{horz:!0,vert:!0}),document.body.addClassName(layoutModule.NOTHING_TO_DISPLAY_CLASS),this._value=null,this.changeMode(!1)}},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},setDetailsLoadedEntity:function(e){this.detailsLoadedEntity=e},getDetailsLoadedEntity:function(){return this.detailsLoadedEntity},processTemplate:function(e){if(this.editButton=$(this._EDIT_BUTTON_ID),this.saveButton=$(this._SAVE_BUTTON_ID),this.cancelButton=$(this._CANCEL_BUTTON_ID),this.deleteButton=$(this._DELETE_BUTTON_ID),this.options.showAssigned){this.removeFromAssigned=$(this._REMOVE_FROM_ASSIGNED_BUTTON_ID),this.addToAssigned=$(this._ADD_TO_ASSIGNED_BUTTON_ID),this.assignedViewList=new dynamicList.List(this._ASSIGNED_VIEW_LIST_ID,{listTemplateDomId:e.viewAssignedListTemplateDomId,itemTemplateDomId:e.viewAssignedItemTemplateDomId,comparator:this.assignedComparator,allowSelections:!1,selectionDefaultsToCursor:!1});var t={listTemplateDomId:"list_responsive_collapsible_fields",itemTemplateDomId:"list_responsive_collapsible_fields:fields",comparator:this.assignedComparator,dragPattern:this._DND_CLASS,allowSelections:!0,selectionDefaultsToCursor:!0,multiSelect:!0,selectOnMousedown:!0,setCursorOnMouseDown:!0};this.assignedList=new dynamicList.List(this._ASSIGNED_LIST_ID,Object.extend({},t,{allowSelections:!1,selectionDefaultsToCursor:!1})),this.availableList=new dynamicList.List(this._AVAILABLE_LIST_ID,t),e.searchAssigned&&(this.assignedViewSearchBox=new SearchBox({id:$(this._ASSIGNED_VIEW_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.assignedViewSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:e})}),this.availableSearchBox=new SearchBox({id:$(this._AVAILABLE_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.availableSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_AVAILABLE,{text:e})},this.assignedSearchBox=new SearchBox({id:$(this._ASSIGNED_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.assignedSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:e})},e.searchAssigned&&(this.assignedViewInfiniteScroll=new InfiniteScroll({id:$($(this._ASSIGNED_VIEW_LIST_ID).parentNode).identify(),contentId:this._ASSIGNED_VIEW_LIST_ID}),this.assignedViewInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_ASSIGNED,{})}),this.availableInfiniteScroll=new InfiniteScroll({id:$($(this._AVAILABLE_LIST_ID).parentNode).identify(),contentId:this._AVAILABLE_LIST_ID}),this.availableInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_AVAILABLE,{})},this.assignedInfiniteScroll=new InfiniteScroll({id:$($(this._ASSIGNED_LIST_ID).parentNode).identify(),contentId:this._ASSIGNED_LIST_ID}),this.assignedInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_ASSIGNED,{})}}},initDnD:function(){Droppables.add($(this._ASSIGNED_LIST_ID).up(),{accept:[this._DROP_CLASS],hoverclass:layoutModule.DROP_TARGET_CLASS,onDrop:function(e,t,i){e.items&&this._addToAssigned()}.bind(this)}),Droppables.add($(this._AVAILABLE_LIST_ID).up(),{accept:[this._DROP_CLASS],hoverclass:layoutModule.DROP_TARGET_CLASS,onDrop:function(e,t,i){e.items&&this._removeFromAssigned()}.bind(this)})},initEvents:function(){function e(){(this.assignedList.getSelectedItems().length>0?buttonManager.enable:buttonManager.disable)(this.removeFromAssigned)}function t(){(this.availableList.getSelectedItems().length>0?buttonManager.enable:buttonManager.disable)(this.addToAssigned)}$(this._BUTTONS_CONTAINER_ID).observe("click",function(e){var t=e.element(),i=matchAny(t,[layoutModule.BUTTON_PATTERN],!0);i&&this.buttonsFunctions[i.identify()]&&this.buttonsFunctions[i.identify()].call(this),e.stop()}.bindAsEventListener(this)),this.options.showAssigned&&($(this._MOVE_BUTTONS_CONTAINER_ID).observe("click",function(e){var t=e.element(),i=matchAny(t,[layoutModule.BUTTON_PATTERN],!0);i&&(i==this.removeFromAssigned?this._removeFromAssigned():i==this.addToAssigned&&this._addToAssigned()),e.stop()}.bindAsEventListener(this)),this.assignedList.observe("item:selected",e.bindAsEventListener(this)),this.assignedList.observe("item:unselected",e.bindAsEventListener(this)),this.assignedList.observe("item:dblclick",function(e){this._removeFromAssigned()}.bindAsEventListener(this)),this.availableList.observe("item:selected",t.bindAsEventListener(this)),this.availableList.observe("item:unselected",t.bindAsEventListener(this)),this.availableList.observe("item:dblclick",function(e){this._addToAssigned()}.bindAsEventListener(this))),this.attributesFacade&&this.attributesFacade.on("change",this.options._.bind(this._toggleButton,this))},initButtonsFunctions:function(){this.buttonsFunctions[this._EDIT_BUTTON_ID]=function(){this.changeMode(!0)},this.buttonsFunctions[this._SAVE_BUTTON_ID]=function(){var e=this,t=new jQuery.Deferred;this.validate()&&(this.attributesFacade?this.attributesFacade.getCurrentView().saveChildren().done(function(){t.resolve()}).fail(function(){t.reject(),jQuery(".tab[tabid='#attributesTab']").trigger("mouseup")}):t.resolve(),t.done(function(){e.save(e._value)}))},this.buttonsFunctions[this._CANCEL_BUTTON_ID]=function(){this.attributesFacade?this.isChanged()?this.confirmationDialog.open():this.cancelOnEdit():invokeClientAction("cancelIfEdit",{entity:this.getValue()})},this.buttonsFunctions[this._DELETE_BUTTON_ID]=function(){this._deleteEntity()},this.buttonsFunctions[this._REMOVE_FROM_ASSIGNED_BUTTON_ID]=function(){this._removeFromAssigned()},this.buttonsFunctions[this._ADD_TO_ASSIGNED_BUTTON_ID]=function(){this._addFromAssigned()}},cancelOnEdit:function(){var e=this;this.isEditMode&&this.cancel().done(function(){e.unlock(),e.changeMode(!1),e._toggleButton()})},changeMode:function(e){this.isEditMode=e;var t,i,n,o;if(this.attributesFacade){i=$("attributesTab");var s=!!this._value&&"organizations"===this._value.id;this.detachScrollEvent(this.attributesFacade.getCurrentView().$container.parent()),this.attributesFacade.toggleMode(e,s),e&&this.initScrollEvent(this.attributesFacade.getCurrentView()),t=$$(".tertiary")[0],n=$("propertiesTab"),o=jQuery(".control.tabSet.anchor")}e?($(this._id).addClassName(this._EDIT_MODE_CLASS),t&&(t.down(".selected").removeClassName("selected"),t.down("li",0).addClassName("selected"),t.addClassName("tabbed"),i.addClassName("hidden"),n.removeClassName("hidden"),o.removeClass("attributesAnchor")),this._assigned=[],this._unassigned=[],this.options.showAssigned&&(centerElement($(this._moveButtonsId),{horz:!0}),$(this._moveButtonsId).style.zIndex=1e3,this.assignedList.setItems([]),this.assignedList.show(),this.availableList.setItems([]),this.availableList.show(),buttonManager.disable(this.removeFromAssigned),buttonManager.disable(this.addToAssigned),this.assignedSearchBox.setText(""),this.availableSearchBox.setText(""),invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:this.assignedSearchBox.getText()}),invokeServerAction(orgModule.ActionMap.SEARCH_AVAILABLE,{text:this.availableSearchBox.getText()})),this._editEntity(),this._toggleButton()):($(this._id).removeClassName(this._EDIT_MODE_CLASS),t&&(i.removeClassName("hidden"),n.removeClassName("hidden"),t.removeClassName("tabbed")),this.options.searchAssigned&&this.assignedViewSearchBox&&this.assignedViewSearchBox.setText(""),this.changeDisable(this.canEdit(),["#"+this._EDIT_BUTTON_ID]),this.changeDisable(this.canDelete(),["#"+this._DELETE_BUTTON_ID]),this._showEntity(),this._assigned=[],this._unassigned=[])},canEdit:function(){return!0},canDelete:function(){var e=orgModule.manager.tree&&orgModule.manager.tree.getOrganization();return e&&"/"===e.uri&&!orgModule.entityList.getSelectedEntities().length?!1:!0},setValuesProperty:function(e,t){this._value[e]=t},getValue:function(){return this._value},setProperties:function(e){},isChanged:function(e){},save:function(e){},validate:function(){return!0},assignedComparator:function(e,t){var i=e.getLabel(),n=t.getLabel();return i>n?1:n>i?-1:0},_moveEntities:function(e){var t,i,n,o;e?(t=this._unassigned,n=this.availableList,i=this._assigned,o=this.assignedList):(t=this._assigned,n=this.assignedList,i=this._unassigned,o=this.availableList);var s=n.getSelectedItems(),r=s.collect(function(e){return e.getValue()});i=i.concat(r.collect(function(t){return t.available==e?t:null})).compact(),t=t.reject(function(e){return r.detect(function(t){return e.equals(t)})}),n.removeItems(s),o.addItems(s,!0),o.refresh(),e?(this._unassigned=t,this._assigned=i):(this._assigned=t,this._unassigned=i)},_addToAssigned:function(){this._moveEntities(!0)},_removeFromAssigned:function(){this._moveEntities(!1)},_entitiesToItems:function(e,t){return e=e?e:[],e.collect(function(e){var i="",n=[],o="orgTooltip";e instanceof orgModule.User?(i=e.userName,e.fullName&&e.fullName.length>0&&(n=[e.fullName]),o=e.tenantId?"fullNameAndOrgTooltip":"fullNameTooltip"):e instanceof orgModule.Role&&(i=e.roleName,o=e.tenantId?"orgTooltip":void 0),e.tenantId&&e.tenantId.length>0&&n.push(e.tenantId),e.available=!!t;var s=new dynamicList.ListItem({label:i,value:e});return this.isEditMode?s.processTemplate=function(e){return n.length>0&&new JSTooltip(e,{text:xssUtil.escape(n),templateId:o}),dynamicList.ListItem.prototype.processTemplate.call(this,e)}:s.processTemplate=function(e){var t=e.select("a")[0];return t.insert(xssUtil.escape(this.getLabel())),t.writeAttribute("href",this.getValue().getManagerURL()),n.length>0&&new JSTooltip(e,{text:xssUtil.escape(n),templateId:o}),e},s}.bind(this))},getAssignedEntities:function(){return this._assigned},getUnassignedEntities:function(){return this._unassigned},setAssignedEntities:function(e){this.assignedViewInfiniteScroll&&this.assignedViewInfiniteScroll.reset(),this.assignedInfiniteScroll&&this.assignedInfiniteScroll.reset();var t=this.isEditMode?this.assignedList:this.assignedViewList,i=this._filterEntities(e,this._unassigned,this._assigned,this.assignedSearchBox.getText());t.setItems(this._entitiesToItems(i)),t.refresh()},addAssignedEntities:function(e){var t=this.isEditMode?this.assignedList:this.assignedViewList,i=this._filterEntities(e,this._unassigned,this._assigned,this.assignedSearchBox.getText());t.addItems(this._entitiesToItems(i)),t.refresh()},setAvailableEntities:function(e){this.availableInfiniteScroll.reset();var t=this._filterEntities(e,this._assigned,this._unassigned,this.availableSearchBox.getText());this.availableList.setItems(this._entitiesToItems(t,!0)),this.availableList.refresh()},addAvailableEntities:function(e){var t=this._filterEntities(e,this._assigned,this._unassigned,this.availableSearchBox.getText());this.availableList.addItems(this._entitiesToItems(t,!0)),this.availableList.refresh()},_filterEntities:function(e,t,i,n){var o=e.reject(function(e){return t.detect(function(t){return t.equals(e)})});return n=n.toLowerCase(),o=o.concat(i.findAll(function(e){return e.getDisplayName().toLowerCase().include(n)}))},changeReadonly:function(e,t){t.each(function(t){$(this._id).select(t)[0].writeAttribute(layoutModule.READONLY_ATTR_NAME,e?null:layoutModule.READONLY_ATTR_NAME)}.bind(this))},resetValidation:function(e){var t=$(this._id);e.each(function(e){ValidationModule.hideError(t.select(e)[0])}.bind(this))},changeDisable:function(e,t){t.each(function(t){e?buttonManager.enable($(this._id).select(t)[0]):buttonManager.disable($(this._id).select(t)[0])}.bind(this))},_deleteEntity:function(){},_editEntity:function(){},_showEntity:function(){}},orgModule.addDialog={show:function(e){},hide:function(e){}},orgModule.Action=function(e,t){Object.isFunction(e)&&(t=t&&Object.isFunction(t)?t:this.beforeInvoke,this.invokeAction=function(){return t()?e.apply(this,arguments):void 0})},orgModule.Action.addMethod("invokeAction",doNothing),orgModule.Action.addMethod("beforeInvoke",function(){return!0}),orgModule.ServerAction=function(e,t){this.actionURL="flow.html?_flowExecutionKey="+localContext.flowExecutionKey+"&_eventId="+e,this.data=Object.toQueryString(t),this.onSuccess=doNothing(),this.onError=doNothing()},orgModule.ServerAction.addMethod("invokeAction",function(){this.beforeInvoke()&&ajaxTargettedUpdate(this.actionURL,{postData:this.data,callback:function(e){e.error?this.onError(e.error):this.onSuccess(e.data)}.bind(this),errorHandler:function(e){return e.getResponseHeader("LoginRequested")?(orgModule.fire(orgModule.Event.SERVER_UNAVAILABLE,{}),!0):baseErrorHandler(e)},mode:AjaxRequester.prototype.EVAL_JSON})}),orgModule.ServerAction.addMethod("beforeInvoke",function(){return!0}),orgModule.toolbar={_actionModel:{},initialize:function(e){this._actionModel=e,toolbarButtonModule.initialize(this._toActionMap(this._actionModel)),this.refresh()},refresh:function(){for(var e in this._actionModel){var t=this._actionModel[e].buttonId,i=toFunction(this._actionModel[e].test);toolbarButtonModule.setButtonState($(t),i())}},_toActionMap:function(e){var t={};for(var i in e){var n=e[i],o=n.buttonId;t[o]=function(e,t){return function(){var i=getAsFunction(e),n=t,o=localContext&&localContext[e];n&&isArray(n)?i.apply(o?localContext:null,n):i.call(o?localContext:null,n)}}(n.action,n.actionArgs);
}return t}},orgModule.createInputRegExValidator=function(e){return{validator:function(t){var i=e.regExp.test(t),n=!i,o=n?"":orgModule.getMessage("unsupportedSymbols",{symbols:e.unsupportedSymbols});return e.isValid=n,{isValid:n,errorMessage:o}},element:e}},orgModule.createBlankValidator=function(e,t,i,n){return{validator:function(e){var i=!e.blank(),n=i?"":orgModule.getMessage(t);return{isValid:i,errorMessage:n}},element:e,onValid:i,onInvalid:n}},orgModule.createMaxLengthValidator=function(e,t,i){return{validator:function(n){var o=e.hasAttribute("maxlength")?e.readAttribute("maxlength"):e.maxlength,s=n.length<parseInt(o),r=s?"":orgModule.getMessage(t);return i&&(r=r.replace(i,o)),{isValid:s,errorMessage:r}},element:e}},orgModule.createSameValidator=function(e,t,i){return{validator:function(e){var n=e===t.getValue(),o=n?"":orgModule.getMessage(i);return{isValid:n,errorMessage:o}},element:e}},orgModule.createRegExpValidator=function(e,t,i){return"string"==typeof i&&(i=window.XRegExp?XRegExp(i):new RegExp(i)),{validator:function(e){var n=i.exec(e),o=!n&&0===e.length||n&&e==n[0],s=o?"":orgModule.getMessage(t);return{isValid:o,errorMessage:s}},element:e}},orgModule.truncateOrgName=function(e){return e&&e.length>0?e.truncate(15):""},RegExpRepresenter.addMethod("__parse",function(e){for(var t=$A(),i=1;i<e.length-1;i++){var n=e.charAt(i);"\\"==n&&(n+=e.charAt(++i)),"\\u"==n&&(n+=e.substring(++i,i+4),i+=3),t.push(n)}return t}),RegExpRepresenter.addMethod("getCharacters",function(){var result=$A();return this.expressionTokens.each(function(token){if(token.startsWith("\\u"))result.push(eval('"'+token+'"'));else if(token.startsWith("\\")){var ch=this.charMap[token];result.push(ch?ch:token.substring(1,token.length))}else result.push(token)}.bind(this)),result}),RegExpRepresenter.addMethod("getRepresentedString",function(){for(var e="",t=this.getCharacters(),i=t.length,n=0;i>n;n++){var o=t[n];e+=" "==o||"."==o||","==o?"["+o+"]":o,i-1>n&&(e+=", ")}return e}),define("mng.common",["jquery","underscore","prototype","utils.common","tools.infiniteScroll","components.list","components.dynamicTree","components.toolbar","common/component/dialog/ConfirmationDialog"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.confirmAndLeave=function(){var e=orgModule.entityList.getSelectedEntities();return orgModule.properties.attributesFacade?!0:invokeClientAction("cancelIfEdit",{entity:e[0],entityEvent:!1})},orgModule.manager={initialize:function(e){this.options=e,this.state=e.state,_.extend(this.state,{id:this.state.tenantId}),isProVersion()&&(this.tenantsTree=new e.TenantsTreeView({container:"#folders .body",currentUser:e.currentUser,removeContextMenuTreePlugin:e.removeContextMenuTreePlugin,selectedTenant:this.state,comparator:function(e,t){return orgModule._comparator(e.tenantName,t.tenantName)}}),orgModule.initTenantsTreeEvents(),this.tenantsTree.render()),orgModule.observe("org:browse",function(e){var t;this.tenantsTree&&(t=this.tenantsTree.getTenant());var i=e.memo.entityEvent,n=e.memo.force;if(n||!this.lastSelectedOrg||this.lastSelectedOrg.id!=t.id){var o=orgModule.entityList.getSelectedEntities();invokeClientAction("cancelIfEdit",{entity:o[0]||t,entityEvent:i})?(invokeServerAction(orgModule.ActionMap.BROWSE,{tenantId:t?t.id:null}),this.lastSelectedOrg=t):this.lastSelectedOrg&&this.tenantsTree.selectTenant(this.lastSelectedOrg.id)}}.bindAsEventListener(this)),orgModule.observe("entity:search",function(e){var t,i=orgModule.entityList.getSelectedEntities(),n=e.memo.text;this.tenantsTree&&(t=this.tenantsTree.getTenant()),invokeClientAction("cancelIfEdit",{entity:i[0]||t})?(invokeServerAction(orgModule.ActionMap.SEARCH,{text:n}),this.lastSearchText=n):0===n.length&&this.lastSearchText&&0!==this.lastSearchText.length&&orgModule.entityList.setSearchText(this.lastSearchText)}.bindAsEventListener(this)),orgModule.observe("entity:next",function(e){invokeServerAction(orgModule.ActionMap.NEXT,{})}.bindAsEventListener(this)),orgModule.observe("entity:selectAndGetDetails",function(e){var t=e.memo.entityEvent,i=e.memo.isCtrlHeld,n=e.memo.cancelIfEdit,o=orgModule.entityList.getSelectedEntities(),s=Boolean(e.memo.refreshAttributes);if(o.length>1)orgModule.properties.hide();else{var r,a=o[0];if(r=a&&t?a.getNameWithTenant():(!t||i||n)&&e.memo.entityId,!a&&(orgModule.userManager||!orgModule.userManager&&orgModule.roleManager)&&i)return void orgModule.properties.hide();r&&invokeServerAction(orgModule.ActionMap.SELECT_AND_GET_DETAILS,{refreshAttributes:s,entity:r})}}.bindAsEventListener(this)),orgModule.observe("result:changed",function(t){var i=t.memo.responseData;orgModule.entityList.setEntities(i.entities.collect(this.entityJsonToObject)),e.defaultEntity&&orgModule.entityList.restoreSelectedEntity(e.defaultEntity)}.bindAsEventListener(this)),orgModule.observe("result:next",function(e){var t=e.memo.responseData;t.entities.length>0&&orgModule.entityList.addEntities(t.entities.collect(this.entityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("entity:detailsLoaded",function(e){var t=this.entityJsonToObject(e.memo.responseData),i=orgModule.properties,n=e.memo.inputData.refreshAttributes;orgModule.entityList.update(t.getNameWithTenant(),t),i.setDetailsLoadedEntity(t),i.show(t,n),!i.locked&&i.setProperties(t),orgModule.entityList.toolbar.refresh(),i.unlock()}.bindAsEventListener(this)),orgModule.observe("searchAvailable:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&orgModule.properties.setAvailableEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("searchAssigned:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&orgModule.properties.setAssignedEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("nextAvailable:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&t.entities.length>0&&orgModule.properties.addAvailableEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("nextAssigned:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&t.entities.length>0&&orgModule.properties.addAssignedEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("server:error",function(e){var t=e.memo.responseData;t&&alert(t.message+"\n\n"+t.description?t.description:"")}),orgModule.observe("entity:created",function(e){orgModule.addDialog.hide();var t=e.memo.inputData.entity;if(t){var i=this.entityJsonToObject(t.evalJSON());orgModule.entityList.addEntities([i]),orgModule.entityList.deselectAll(),orgModule.entityList.selectEntity(i.getNameWithTenant())}}.bindAsEventListener(this)),orgModule.observe("entity:updated",function(e){var t=this,i=e.memo.inputData.entityName,n=e.memo.responseData;n.roles||(n=e.memo.unencryptedEntity),n||(n=e.memo.inputData.entity);var o=orgModule.properties.attributesFacade||{},s=o.designer&&o.designer.saveDfD;orgModule.properties.isEditMode&&(s?s.done(function(){orgModule.properties.changeMode(!1)}):orgModule.properties.changeMode(!1)),n&&(s?s.done(function(){t.updateEntityList(n,i)}):this.updateEntityList(n,i))}.bindAsEventListener(this)),orgModule.observe("entity:deleted",function(e){var t=e.memo.inputData.entity;orgModule.entityList.remove(t)}.bindAsEventListener(this)),orgModule.observe("entities:deleted",function(e){var t=e.memo.inputData.entities;t&&orgModule.entityList.remove(t.evalJSON())}.bindAsEventListener(this))},updateEntityList:function(e,t){var i=this.entityJsonToObject(e.evalJSON?e.evalJSON():e);orgModule.entityList.update(t,i),orgModule.entityList.selectEntity(i.getNameWithTenant?i.getNameWithTenant():t)},entityJsonToObject:function(e){},relatedEntityJsonToObject:function(e){},reloadEntities:function(){orgModule.fire(orgModule.Event.ORG_BROWSE,{})},isUserSuperuser:function(){var e=isProVersion()?orgModule.Configuration.superuserRole:orgModule.Configuration.adminRole,t=this.options.currentUserRoles;return null!=t.detect(function(t){return t.roleName==e&&!t.tenantId})}},define("mng.main",["jquery","mng.common"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.orgManager={NAME_REG_EXP:null,ID_REG_EXP:null,ID_REG_EXP_FOR_REPLACEMENT:null,ALIAS_REG_EXP:null,ALIAS_REG_EXP_FOR_REPLACEMENT:null,Event:{},Action:{ALIAS_EXIST:"aliasExist"},initialize:function(e){layoutModule.resizeOnClient("folders","organizations","properties"),webHelpModule.setCurrentContext("admin");var t=_.extend(e,localContext.orgMngInitOptions);this.NAME_REG_EXP=new RegExp(orgModule.Configuration.tenantNameNotSupportedSymbols),this.ID_REG_EXP=new RegExp(orgModule.Configuration.tenantIdNotSupportedSymbols),this.ID_REG_EXP_FOR_REPLACEMENT=new RegExp(orgModule.Configuration.tenantIdNotSupportedSymbols,"g"),this.ALIAS_REG_EXP=new RegExp(orgModule.Configuration.tenantIdNotSupportedSymbols),this.ALIAS_REG_EXP_FOR_REPLACEMENT=new RegExp(orgModule.Configuration.tenantIdNotSupportedSymbols,"g"),orgModule.manager.initialize(t),orgModule.manager.entityJsonToObject=function(e){return new orgModule.Organization(e)},this.orgList.initialize({toolbarModel:this.actionModel,text:orgModule.manager.state.text}),orgModule.addDialog.show=function(e){this.addDialog.show(e)}.bind(this),orgModule.addDialog.hide=function(e){this.addDialog.hide(e)}.bind(this),this.properties.initialize(e),this.addDialog.initialize(),orgModule.observe("entity:created",function(e){var t=orgModule.orgManager.addDialog.organization,i=JSON.parse(e.memo.inputData.entity),n=t.isRoot()?"organizations":t.id;i.tenantFolderUri=t.isRoot()?"/"+n+"/"+i.tenantName:t.uri+"/"+i.tenantName,i.parentId=i.parentId||n,orgModule.manager.tenantsTree.addTenant(n,i)}.bindAsEventListener(this)),orgModule.observe("entity:updated",function(e){var t=JSON.parse(e.memo.inputData.entity);if(t){var i=orgModule.manager.tenantsTree,n=orgModule.entityList.getSelectedEntities(),o=i.getTenant(),s=_.isObject(o.parentId)?o.parentId.parentId:o.parentId,r=n.length&&t.tenantId!==o.id?o.id:s,a=!n.length||t.tenantId===o.id;orgModule.manager.tenantsTree.setTenant("name",t.tenantName),orgModule.properties.setValuesProperty("name",t.tenantName),t.tenantName!==o.name&&orgModule.manager.tenantsTree.updateTenant(r,t,a)}}.bindAsEventListener(this)),orgModule.observe("searchAssigned:loaded",function(e){var t=e.memo.responseData;this.properties.setAssigned(t.usersCount,t.rolesCount)}.bindAsEventListener(this)),orgModule.observe("entity:detailsLoaded",function(e){invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:""})}.bindAsEventListener(this)),orgModule.observe("entity:deleted",function(e){var t=orgModule.manager.tenantsTree,i=e.memo.inputData,n=i.entity,o=i.entityEvent,s=t.getTenant(),r=o?s.id:s.parentId;t.removeTenant(n,r),!o&&t.selectTenant(r),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:r,entityEvent:!1})}.bindAsEventListener(this)),orgModule.observe("entities:deleted",function(e){var t=orgModule.manager.tenantsTree,i=t.getTenant().id,n=JSON.parse(e.memo.inputData.entities);t.removeTenant(n,i),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:i,entityEvent:!0})}.bindAsEventListener(this)),orgModule.observe("server:unavailable",function(e){var t=orgModule.manager.tenantsTree,i=t?t.getTenant().id:null,n=new orgModule.Organization({tenantId:i});n.navigateToManager()}.bindAsEventListener(this))},actionModel:{ADD:{buttonId:"addNewOrgBtn",action:invokeClientAction,actionArgs:"create",test:canAddOrg},DELETE:{buttonId:"deleteAllOrgsBtn",action:invokeClientAction,actionArgs:"deleteAll",test:canDeleteAll}}},"undefined"==typeof require&&document.observe("dom:loaded",orgModule.orgManager.initialize.bind(orgModule.orgManager)),define("org.mng.main",["jquery","mng.main"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.serverActionFactory={browse:function(e){return this.createAction(orgModule.ActionMap.BROWSE,e)},search:function(e){return this.createAction(orgModule.ActionMap.SEARCH,e)},next:function(e){return this.createAction(orgModule.ActionMap.NEXT,e)},selectAndGetDetails:function(e){return this.createAction(orgModule.ActionMap.SELECT_AND_GET_DETAILS,e)},searchAvailable:function(e){return this.createAction(orgModule.ActionMap.SEARCH_AVAILABLE,e)},searchAssigned:function(e){return this.createAction(orgModule.ActionMap.SEARCH_ASSIGNED,e)},nextAvailable:function(e){return this.createAction(orgModule.ActionMap.NEXT_AVAILABLE,e)},nextAssigned:function(e){return this.createAction(orgModule.ActionMap.NEXT_ASSIGNED,e)},create:function(e){var t=e.entity,i={entity:Object.toJSON(t)};return this.createAction(orgModule.ActionMap.CREATE,i)},update:function(e){var t=e.entityName,i={entityName:t,entity:Object.toJSON(e.entity),assignedEntities:Object.toJSON(e.assigned),unassignedEntities:Object.toJSON(e.unassigned)};return this.createAction(orgModule.ActionMap.UPDATE,i,e.unencryptedEntity)},deleteAll:function(e){var t=e.entities,i={entities:Object.toJSON(t.collect(function(e){return e.getNameWithTenant()}))};return this.createAction(orgModule.ActionMap.DELETE_ALL,i)},"delete":function(e){var t=e.entity,i=e.entityEvent,n={entity:t.getNameWithTenant(),entityEvent:i};return this.createAction(orgModule.ActionMap.DELETE,n)},exist:function(e){var t=e.entity,i={entityName:t.getNameWithTenant()},n=new orgModule.ServerAction(orgModule.ActionMap.EXIST,i);return n.onSuccess=function(t){t.exist?e.onExist&&e.onExist(t.uniqueId):e.onNotExist&&e.onNotExist()},n.onError=function(t){orgModule.fire(orgModule.Event.SERVER_ERROR,{inputData:e,responseData:t})},n},createAction:function(e,t,i){var n,o=new orgModule.ServerAction(e,t);if(e==orgModule.ActionMap.BROWSE)n=orgModule.Event.RESULT_CHANGED;else if(e==orgModule.ActionMap.SEARCH)n=orgModule.Event.RESULT_CHANGED;else if(e==orgModule.ActionMap.NEXT)n=orgModule.Event.RESULT_NEXT;else if(e==orgModule.ActionMap.SELECT_AND_GET_DETAILS)n=orgModule.Event.ENTITY_DETAILS_LOADED;else if(e==orgModule.ActionMap.SEARCH_AVAILABLE)n=orgModule.Event.SEARCH_AVAILABLE_LOADED;else if(e==orgModule.ActionMap.SEARCH_ASSIGNED)n=orgModule.Event.SEARCH_ASSIGNED_LOADED;else if(e==orgModule.ActionMap.NEXT_AVAILABLE)n=orgModule.Event.NEXT_AVAILABLE_LOADED;else if(e==orgModule.ActionMap.NEXT_ASSIGNED)n=orgModule.Event.NEXT_ASSIGNED_LOADED;else if(e==orgModule.ActionMap.CREATE)n=orgModule.Event.ENTITY_CREATED;else if(e==orgModule.ActionMap.UPDATE)n=orgModule.Event.ENTITY_UPDATED;else if(e==orgModule.ActionMap.DELETE_ALL)n=orgModule.Event.ENTITIES_DELETED;else{if(e!=orgModule.ActionMap.DELETE)throw new Error("Unexpected action name '"+e+"'");n=orgModule.Event.ENTITY_DELETED}return o.onSuccess=function(e){orgModule.fire(n,{inputData:t,unencryptedEntity:i,responseData:e})},o.onError=function(e){orgModule.fire(orgModule.Event.SERVER_ERROR,{inputData:t,unencryptedEntity:i,responseData:e})},o}},orgModule.clientActionFactory={create:function(){var e;orgModule.manager.tenantsTree&&(e=orgModule.manager.tenantsTree.getTenant());var t=orgModule.entityList.getSelectedEntities(),i=function(){return invokeClientAction("cancelIfEdit",{entity:t[0]})};return new orgModule.Action(function(){orgModule.entityList.deselectAll(),orgModule.addDialog.show(e)},i)},deleteAll:function(){var e=orgModule.entityList.getSelectedEntities(),t=function(){return invokeClientAction("cancelIfEdit",{entity:e[0]})};return new orgModule.Action(function(){var t=orgModule.getMessage("deleteAllMessage",{count:e.length});require(["common/component/dialog/ConfirmationDialog"],function(i){var n=new i({text:t});n.on("button:yes",function(){invokeServerAction(orgModule.ActionMap.DELETE_ALL,{entities:e})}),n.open()})},t)},"delete":function(e){var t=e.entity,i=e.entityEvent;return new orgModule.Action(function(){var e=orgModule.getMessage("deleteMessage",{entity:t.getDisplayName()});require(["common/component/dialog/ConfirmationDialog"],function(n){var o=new n({text:e});o.on("button:yes",function(){invokeServerAction(orgModule.ActionMap.DELETE,{entity:t,entityEvent:i})}),o.open()})})},cancelIfEdit:function(e){e=e||{};var t=e.entity||orgModule.manager.tenantsTree&&orgModule.manager.tenantsTree.getTenant(),i="undefined"==typeof e.showConfirm?!0:e.showConfirm,n="undefined"==typeof e.entityEvent?!0:e.entityEvent,o=orgModule.properties;return new orgModule.Action(function(){return o.locked&&n||!(!o.isChanged()||i&&confirm(orgModule.getMessage("cancelEdit",{entity:t.getDisplayName()})))?(!n&&o.lock(),!1):(o.isEditMode&&(o.lock(),o.cancel().done(function(){var e=o.getDetailsLoadedEntity(),t=orgModule.userManager?orgModule.entityList.findEntity(e.fullName):!0;o.unlock(),t?orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:e.id,cancelIfEdit:!0,entityEvent:!0}):o.hide()})),!0)})}},define("mng.common.actions",["jquery","prototype","mng.common"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.orgManager.orgList={LIST_TEMPLATE_ID:"tabular_threeColumn",ITEM_TEMPLATE_ID:"tabular_threeColumn:leaf",ORG_ID_PATTERN:".ID > a",ORG_NAME_PATTERN:".name",ORG_ORGANIZATIONS_PATTERN:".organization",initialize:function(e){orgModule.entityList.initialize({listTemplateId:this.LIST_TEMPLATE_ID,itemTemplateId:this.ITEM_TEMPLATE_ID,toolbarModel:e.toolbarModel,text:e.text}),orgModule.entityList._createEntityItem=function(e){var t=new dynamicList.ListItem({label:e.id,value:e});return t.processTemplate=function(e){var t=orgModule.orgManager.orgList,i=e.select(t.ORG_ID_PATTERN)[0],n=e.select(t.ORG_NAME_PATTERN)[0],o=e.select(t.ORG_ORGANIZATIONS_PATTERN)[0];i.update(xssUtil.escape(this.getValue().id)),n.update(xssUtil.escape(this.getValue().name));var s=this.getValue().subTenantCount;return s=s||0,o.update(xssUtil.escape(orgModule.getMessage("MT_SUB_TENANT_COUNT",{count:s}))),e},t}}},orgModule.orgManager.addDialog={_ADD_ORGANIZATION_ID:"addOrganization",_ADD_BUTTON_ID:"addOrgBtn",_CANCEL_BUTTON_ID:"cancelOrgBtn",_ORG_NAME_ID:"addOrgName",_ORG_ID_ID:"addOrgID",_ORG_ALIAS_ID:"addOrgAlias",_ORG_DESC_ID:"addOrgDesc",_ADD_BUTTON_TITLE_PATTERN:".wrap",initialize:function(){this.addOrganization=$(this._ADD_ORGANIZATION_ID),this.addBtn=$(this._ADD_BUTTON_ID),this.cancelBtn=$(this._CANCEL_BUTTON_ID),this.orgName=$(this._ORG_NAME_ID),this.orgId=$(this._ORG_ID_ID),this.orgAlias=$(this._ORG_ALIAS_ID),this.orgDesc=$(this._ORG_DESC_ID),this.idUnsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantIdNotSupportedSymbols).getRepresentedString(),this.aliasUnsupportedSymbols=this.idUnsupportedSymbols,this.nameUnsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantNameNotSupportedSymbols).getRepresentedString(),this.orgId.regExp=orgModule.orgManager.ID_REG_EXP,this.orgId.regExpForReplacement=orgModule.orgManager.ID_REG_EXP_FOR_REPLACEMENT,this.orgName.regExp=orgModule.orgManager.NAME_REG_EXP,this.orgAlias.regExp=orgModule.orgManager.ALIAS_REG_EXP,this.orgAlias.regExpForReplacement=orgModule.orgManager.ALIAS_REG_EXP_FOR_REPLACEMENT,this.orgId.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantIdNotSupportedSymbols).getRepresentedString(),this.orgName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantNameNotSupportedSymbols).getRepresentedString(),this.orgAlias.unsupportedSymbols=this.orgId.unsupportedSymbols,this.orgId.inputValidator=orgModule.createInputRegExValidator(this.orgId),this.orgName.inputValidator=orgModule.createInputRegExValidator(this.orgName),this.orgAlias.inputValidator=orgModule.createInputRegExValidator(this.orgAlias),this.addOrganization.observe("keyup",function(e){var t=e.element();if([this.orgId,this.orgName,this.orgAlias].include(t)){if(ValidationModule.validate(t.inputValidator),this.orgName==t){var i=this.orgName;[this.orgId,this.orgAlias].each(function(e){e.changedByUser||(e.regExp.test(i.getValue())?e.setValue(i.getValue().replace(e.regExpForReplacement,"_")):e.setValue(i.getValue()))})}else t.changedByUser||(t.changedByUser=t.getValue()!=t.prevValue);e.stop()}}.bindAsEventListener(this)),this.addOrganization.observe("keydown",function(e){var t=e.element();[this.orgId,this.orgAlias].include(t)&&(t.prevValue=t.getValue())}.bindAsEventListener(this))},_clickButtonHandler:function(e){var t=matchAny(e.element(),[layoutModule.BUTTON_PATTERN],!0);if(t==this.addBtn){var i=this,n=function(e){i.addOrganization.stopObserving("click"),orgModule.stopObserving("entity:created",n)};orgModule.observe("entity:created",n),this._doAdd()}else t==this.cancelBtn&&(this.hide(),this.addOrganization.stopObserving("click"))},show:function(e){this.organization=e,[this.orgName,this.orgId,this.orgAlias,this.orgDesc].each(function(e){ValidationModule.hideError(e),e.changedByUser=!1});var t=this.addBtn.select(this._ADD_BUTTON_TITLE_PATTERN)[0];if(t){var i=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addOrgTo",{organizationName:orgModule.truncateOrgName(this.organization.id)}):orgModule.getMessage("addOrg");t.update(i)}this.addBtn.title=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addOrgTo",{organizationName:this.organization.id}):orgModule.getMessage("addOrg"),dialogs.popup.show(this.addOrganization,!0),this.addOrganization.observe("click",this._clickButtonHandler.bindAsEventListener(this));try{this.orgName.focus()}catch(n){}},hide:function(){dialogs.popup.hide(this.addOrganization),this.orgName.setValue(""),this.orgId.setValue(""),this.orgAlias.setValue(""),this.orgDesc.setValue("")},_validate:function(){return ValidationModule.validateLegacy([orgModule.createBlankValidator(this.orgId,"orgIdIsEmpty"),orgModule.createBlankValidator(this.orgName,"orgNameIsEmpty"),orgModule.createBlankValidator(this.orgAlias,"orgAliasIsEmpty"),this.orgId.inputValidator,this.orgName.inputValidator,this.orgAlias.inputValidator,orgModule.createMaxLengthValidator(this.orgDesc,"error.length.description","{0,number,integer}")])},_autoFill:function(){},_doAdd:function(){if(this._validate()){var e=new orgModule.Organization({tenantId:this.orgId.getValue(),tenantName:this.orgName.getValue(),tenantDesc:this.orgDesc.getValue(),tenantAlias:this.orgAlias.getValue()});return this.organization&&!this.organization.isRoot()&&(e.parentId=this.organization.id),this._checkId(e,function(e){this._checkAlias(e,function(e){invokeServerAction(orgModule.ActionMap.CREATE,{entity:e.toJSON()})})}.bind(this)),!0}return!1},_checkId:function(e,t){invokeServerAction(orgModule.ActionMap.EXIST,{entity:e,onExist:function(e){ValidationModule.showError(this.orgId,orgModule.getMessage("orgIdIsAlreadyInUse",{id:e}))}.bind(this),onNotExist:function(){ValidationModule.hideError(this.orgId),Object.isFunction(t)&&t(e)}.bind(this)})},_checkAlias:function(e,t){e.alias.blank()?Object.isFunction(t)&&t(e):invokeOrgAction(orgModule.orgManager.Action.ALIAS_EXIST,{org:e,onExist:function(e){ValidationModule.showError(this.orgAlias,orgModule.getMessage("orgAliasIsAlreadyInUse",{alias:e}))}.bind(this),onNotExist:function(){ValidationModule.hideError(this.orgAlias),Object.isFunction(t)&&t(e)}.bind(this)})}},orgModule.orgManager.properties={NAME_PATTERN:"#orgName",ID_PATTERN:"#orgID",ALIAS_PATTERN:"#orgAlias",DESC_PATTERN:"#orgDesc",MANAGE_USERS_PATTERN:"#manageUsers",MANAGE_ROLES_PATTERN:"#manageRoles",ASSIGNED_USERS_PATTERN:"#assignedUsers",ASSIGNED_ROLES_PATTERN:"#assignedRoles",org:null,initialize:function(e){var t=$(orgModule.properties._id);this.orgName=t.select(this.NAME_PATTERN)[0],this.orgId=t.select(this.ID_PATTERN)[0],this.orgAlias=t.select(this.ALIAS_PATTERN)[0],this.orgDesc=t.select(this.DESC_PATTERN)[0],this.assignedUsers=t.select(this.ASSIGNED_USERS_PATTERN)[0],this.assignedRoles=t.select(this.ASSIGNED_ROLES_PATTERN)[0],this.manageUsers=t.select(this.MANAGE_USERS_PATTERN)[0],this.manageRoles=t.select(this.MANAGE_ROLES_PATTERN)[0],this.orgName.regExp=orgModule.orgManager.NAME_REG_EXP,this.orgAlias.regExp=orgModule.orgManager.ALIAS_REG_EXP,this.orgName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantNameNotSupportedSymbols).getRepresentedString(),this.orgAlias.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantIdNotSupportedSymbols).getRepresentedString(),this.orgName.inputValidator=orgModule.createInputRegExValidator(this.orgName),this.orgAlias.inputValidator=orgModule.createInputRegExValidator(this.orgAlias),this._validators=[orgModule.createBlankValidator(this.orgName,"orgNameIsEmpty"),orgModule.createBlankValidator(this.orgAlias,"orgAliasIsEmpty"),this.orgName.inputValidator,this.orgAlias.inputValidator,orgModule.createMaxLengthValidator(this.orgDesc,"error.length.description","{0,number,integer}")],orgModule.properties.initialize(e._.extend(e,{viewAssignedListTemplateDomId:"list_type_attributes",viewAssignedItemTemplateDomId:"list_type_attributes:role",searchAssigned:!1,attributes:{context:{urlGETTemplate:"rest_v2/attributes?_embedded=permission&includeInherited=true{{#id}}&holder=tenant:/{{id}}{{/id}}&group=custom&excludeGroup=serverSettings",urlPUTTemplate:"rest_v2{{#id}}/organizations/{{id}}{{/id}}/attributes?_embedded=permission"}},showAssigned:!1})),this._initCustomEvents(),orgModule.properties.setProperties=function(e){var t=orgModule.orgManager.properties;t.orgName.setValue(e.name),t.orgId.setValue(e.id),t.orgAlias.setValue(e.alias),t.orgDesc.setValue(e.desc)},orgModule.properties._deleteEntity=function(){invokeClientAction("delete",{entity:this._value,entityEvent:!!orgModule.entityList.getSelectedEntities().length})},orgModule.properties._editEntity=function(){var e=orgModule.orgManager.properties;this.resetValidation([e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN]),this.changeReadonly(!0,[e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN])},orgModule.properties._showEntity=function(){var e=orgModule.orgManager.properties;this.resetValidation([e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN]),this.changeReadonly(!1,[e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN])},orgModule.properties.validate=function(){var e=orgModule.orgManager.properties,t=e._toOrg(this._value);return ValidationModule.validateLegacy(e._validators)&&(invokeOrgAction("aliasExist",{org:t,onExist:function(t){ValidationModule.showError(e.orgAlias,orgModule.getMessage("orgAliasIsAlreadyInUse",{alias:t}))}.bind(this),onNotExist:function(){ValidationModule.hideError(e.orgAlias),this.save(t)}.bind(this)}),orgModule.properties.attributesFacade)?!0:void 0},orgModule.properties.isChanged=function(){var e=orgModule.orgManager.properties,t=orgModule.properties.attributesFacade.containsUnsavedItems(),i=this._value,n=e._toOrg(this._value);return this.isEditMode&&(t||i.name!=n.name||i.alias!=n.alias||i.desc!=n.desc)},orgModule.properties.save=function(e){var t=orgModule.orgManager.properties,i=t._toOrg(e);invokeServerAction("update",{entityName:this._value.getNameWithTenant(),entity:i,assigned:[],unassigned:[]})},orgModule.properties.cancel=function(){var e=new jQuery.Deferred;return this.setProperties(this._value),this.attributesFacade?this.attributesFacade.cancel():e.resolve()},orgModule.properties.manageUsers=function(){primaryNavModule.navigationPaths.user.params+="&tenantId="+encodeUriParameter(this._value.id),primaryNavModule.navigationOption("user")},orgModule.properties.manageRoles=function(){primaryNavModule.navigationPaths.role.params+="&tenantId="+encodeUriParameter(this._value.id),primaryNavModule.navigationOption("role")}},_initCustomEvents:function(e){var t=(orgModule.orgManager.properties,$(orgModule.properties._id));t.observe("keyup",function(e){var t=e.element();matchAny(t,[this.NAME_PATTERN,this.ALIAS_PATTERN])&&(t.inputValidator&&ValidationModule.validate([t.inputValidator]),e.stop()),orgModule.properties._toggleButton()}.bindAsEventListener(this)),t.observe("click",function(e){var t=e.element();t==this.manageUsers?(orgModule.properties.manageUsers(),e.stop()):t==this.manageRoles&&(orgModule.properties.manageRoles(),e.stop())}.bindAsEventListener(this)),orgModule.properties._toggleButton()},_toOrg:function(e){e=e||{};var t=new orgModule.Organization({tenantName:this.orgName.getValue(),tenantId:this.orgId.getValue(),tenantAlias:this.orgAlias.getValue(),tenantDesc:this.orgDesc.getValue(),tenantUri:e.uri});return e.parentId&&(t.parentId=e.parentId),t},setAssigned:function(e,t){this.assignedUsers.update(e),this.assignedRoles.update(t)}},define("org.mng.components",["jquery","org.mng.main","mng.common.actions"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.orgActionFactory={aliasExist:function(e){var t=e.org,i={entityName:t.getNameWithTenant(),alias:t.alias},n=new orgModule.ServerAction(orgModule.orgManager.Action.ALIAS_EXIST,i);return n.onSuccess=function(t){t.exist?e.onExist&&e.onExist(t.uniqueAlias):e.onNotExist&&e.onNotExist()},n.onError=function(t){orgModule.fire(orgModule.Event.SERVER_ERROR,{inputData:e,responseData:t})},n}},orgModule.orgManager.actionFactory={},define("org.mng.actions",["jquery","org.mng.main","mng.common.actions"],function(e){return function(){var t;return t||e.orgModule}}(this)),define("common/enum/httpStatusCodes",{100:"continue",101:"switchingProtocols",200:"ok",201:"created",202:"accepted",203:"nonAuthoritativeInformation",204:"noContent",205:"resetContent",206:"partialContent",300:"multipleChoices",301:"movedPermanently",302:"found",303:"seeOther",304:"notModified",305:"useProxy",307:"temporaryRedirect",400:"badRequest",401:"unauthorized",402:"paymentRequired",403:"forbidden",404:"notFound",405:"methodNotAllowed",406:"notAcceptable",407:"proxyAuthenticationRequired",408:"requestTimeout",409:"conflict",410:"gone",411:"lengthRequired",412:"preconditionFailed",413:"requestEntityTooLarge",414:"requestUriTooLong",415:"unsupportedMediaType",416:"requestedRangeNotSatisfiable",417:"expectationFailed",500:"internalServerError",501:"notImplemented",502:"badGateway",503:"serviceUnavailable",504:"gatewayTimeout",505:"httpVersionNotSupported"}),define("common/enum/errorCodes",["require"],function(e){"use strict";return{UNEXPECTED_ERROR:"unexpected.error",INVALID_RESOURCE_TYPE:"invalid.resource.type"}}),define("common/model/BaseModel",["require","underscore","backbone","common/enum/httpStatusCodes","common/enum/errorCodes"],function(e){"use strict";var t=e("underscore"),i=e("backbone"),n=e("common/enum/httpStatusCodes"),o=e("common/enum/errorCodes"),s=i.Model.extend({initialize:function(){this.on("error",s.unifyServerErrors)},serialize:function(){return t.clone(this.attributes)}},{unifyServerErrors:function(e,t){var i=n[t.status],o=s.createServerError(t);e.trigger("error:"+i,e,o,t),e.trigger("error:all",e,o,t)},createServerError:function(e){var t;try{t=JSON.parse(e.responseText)}catch(i){t={message:"Can't parse server response",errorCode:o.UNEXPECTED_ERROR,parameters:[]}}return t}});return s}),define("tenantImportExport/export/model/ResourcesModel",["require","backbone","request"],function(e){var t=e("backbone"),i=e("request");return t.Model.extend({url:"rest_v2/settings/exportResourceOptions",fetch:function(){return i({url:this.url,type:"GET"})}})}),define("tenantImportExport/export/enum/exportTypesEnum",{ROOT_TENANT:"rootTenant",TENANT:"tenant",SERVER_CE:"serverCE",SERVER_PRO:"serverPRO",REPOSITORY:"repository"}),define("tenantImportExport/export/factory/exportModelAttributesFactory",["require","underscore","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("underscore"),i=e("tenantImportExport/export/enum/exportTypesEnum"),n={},o={roles:null,users:null,everything:!0,userForRoles:!1,rolesForUser:!1,includeReports:!0,includeOtherResourceFiles:!0,includeDataSources:!0,includeDependentObjects:!0,includeAttributes:!0,includeAttributeValues:!0},s={includeAccessEvents:!1,includeAuditEvents:!1,includeMonitoringEvents:!1},r={includeDomains:!0,includeAdHocViews:!0,includeDashboards:!0},a={includeSubOrganizations:!0},l={includeServerSettings:!0};return n[i.ROOT_TENANT]=t.extend({},o,s,r,a,l),n[i.TENANT]=t.extend({},o,r,a),n[i.SERVER_PRO]=t.extend({},o,s,r,a,l),n[i.SERVER_CE]=t.extend({},o,l,{
includeAccessEvents:!0}),function(e){return n[e]}}),define("tenantImportExport/export/model/ExportModel",["require","jquery","underscore","backbone","backbone.validation","jrs.configs","bundle!ImportExportValidationBundle","common/util/i18nMessage","common/model/BaseModel","../model/ResourcesModel","tenantImportExport/export/factory/exportModelAttributesFactory","tenantImportExport/export/enum/exportTypesEnum"],function(e){function t(e){var t,i,o=[];return e.get("everything")?(o.push("everything"),e.get("includeAccessEvents")&&o.push("include-access-events")):(t=n(e)&&e.get("includeRepositoryPermissions")&&!r.isEmpty(e.get("uris")),i=!e.get("includeAttributeValues")||!e.get("includeAttributes"),e.get("userForRoles")&&o.push("role-users"),e.get("rolesForUser")&&o.push("users-roles"),t&&o.push("repository-permissions"),!e.get("includeSubOrganizations")&&o.push("skip-suborganizations"),e.get("includeAttributes")&&o.push("include-attributes"),i&&o.push("skip-attribute-values"),e.get("includeServerSettings")&&o.push("include-server-settings"),(!n(e)||!e.get("includeDependentObjects"))&&o.push("skip-dependent-resources")),e.get("includeAuditEvents")&&o.push("include-audit-events"),e.get("includeMonitoringEvents")&&o.push("include-monitoring-events"),e.get("encryptFile")&&o.push("encrypted"),o}function i(e){var t=[],i=new s.Deferred;return!e.get("everything")&&n(e)?e.resources.fetch().done(function(n){for(var o in v)e.get(o)&&t.push(n[v[o]]);i.resolve(r.flatten(t))}):i.resolve(null),i}function n(e){var t=r.keys(v);return r.filter(t,function(t){return e.get(t)}).length}function o(e){var t=d.organizationsFolderUri||"/organizations",i=d.orgTemplateFolderUri||"/org_template",n=new RegExp("^("+t+"(?!"+i+")/([^/]+))+");return n.exec(e)}var s=e("jquery"),r=e("underscore"),a=e("backbone"),l=e("backbone.validation"),d=e("jrs.configs"),u=e("bundle!ImportExportValidationBundle"),c=e("common/util/i18nMessage").extend({bundle:u}),h=e("common/model/BaseModel"),p=e("../model/ResourcesModel"),m=e("tenantImportExport/export/factory/exportModelAttributesFactory"),g=e("tenantImportExport/export/enum/exportTypesEnum"),f=256,v={includeReports:"report",includeDomains:"domain",includeAdHocViews:"adhocDataView",includeDataSources:"dataSource",includeDashboards:"dashboard",includeOtherResourceFiles:"others"},b=h.extend({defaults:{uris:["/"],fileName:"export.zip",encryptFile:!1,includeRepositoryPermissions:!0,includeScheduledReportJobs:!0,includeDependencies:!0,includeFullResourcePath:!0},validation:{fileName:[{required:!0,msg:new c("export.file.name.empty")},{maxLength:f,msg:new c("export.file.name.too.long",f)},{fn:function(e){return/[\\/?*%:|"<>]/g.test(e)?new c("export.file.name.contains.not.supported.characters"):/^[\.]{1,2}$/g.test(e)?new c("export.file.name.not.valid"):void 0}}],uris:[{fn:function(){var e=this.toExportTask();return!(e.uris||e.roles||e.users||r.filter(e.parameters,function(e){return"role-users"!==e&&"users-roles"!==e}).length)}}]},initialize:function(){h.prototype.initialize.call(this),r.bindAll(this),this.resources=new p},url:function(){return"rest_v2/export"},save:function(){var e=new s.Deferred,t=new a.Model,n=this;t.url=this.url;var o={};return i(this).done(function(i){i&&(o.resourceTypes=i),t.save(r.extend(n.toExportTask(),o)).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t),n.trigger("error",n,t)})}),e},cancel:function(){var e=this.url()+"/"+this.id;this.destroy({url:e})},toExportTask:function(){var e=this.get("everything"),i=this.get("roles"),s=this.get("users"),a=r.clone(this.get("uris")),l=e||this.get("includeReports")&&this.get("includeScheduledReportJobs"),d={uris:a,scheduledJobs:this.get("includeScheduledReportJobs")?a:null,parameters:[]};this.get("includeRepositoryPermissions")&&d.parameters.push("repository-permissions"),!this.get("includeDependencies")&&d.parameters.push("skip-dependent-resources");var u=o(a&&a[0]);u&&!this.get("includeFullResourcePath")&&(d.organization=u.last(),d.parameters.push("skip-suborganizations","skip-attribute-values"),d.uris=r.map(a,function(e){return e.replace(u.first(),"")}),d.scheduledJobs=this.get("includeScheduledReportJobs")?d.uris:null);var c={uris:n(this)?a:null,roles:r.isEmpty(i)?null:i,users:r.isEmpty(s)?null:s,scheduledJobs:l?a:null,organization:this.get("organization"),parameters:t(this)};return this.type!==g.REPOSITORY?c:d},reset:function(e,t){this.type=t;var i=r.extend({},this.defaults,m(t));this.clear().set(r.extend({},i,e))}});return r.extend(b.prototype,l.mixin),b}),define("tenantImportExport/export/model/ExportStateModel",["require","underscore","common/model/BaseModel"],function(e){var t=e("underscore"),i=e("common/model/BaseModel"),n={INPROGRESS:"inprogress",READY:"finished",FAILED:"failed",PENDING:"pending",CANCELLED:"cancelled"};return i.extend({url:function(){return"rest_v2/export/"+this.id+"/state"},initialize:function(e){i.prototype.initialize.call(this),this.on("change:phase",function(e,i){i==n.INPROGRESS&&t.isUndefined(e.interval)?e.interval=window.setInterval(function(){e.fetch({cache:!1}).fail(t.bind(e.stopPolling,e))},1e3):e.stopPolling()})},stopPolling:function(){t.isUndefined(this.interval)||(window.clearInterval(this.interval),this.interval=void 0)}},{STATE:n})}),define("tenantImportExport/export/model/AuthorityPickerModel",["require","jquery","backbone","components.templateengine","underscore"],function(e){"use strict";var t=e("jquery"),i=e("backbone"),n=e("components.templateengine"),o=e("underscore");return i.Model.extend({defaults:{items:[]},url:function(){return n.renderUrl(this.urlTemplate,this.context,!0)},parse:function(e){return{items:e?e.role?e.role:e.user:[]}},defaultErrorHandler:function(e,i){var n;try{n=t.parseJSON(i.responseText)}catch(o){n=null}this.trigger("error:server",i.status,n,e)},setContext:function(e){this.context=o.extend(this.context||{},e),this.fetch({error:o.bind(this.defaultErrorHandler,this)})}},{instance:function(e,t){var i=new this;return i.urlTemplate=e,t&&i.setContext(t),i}})}),define("text!tenantImportExport/export/template/authorityPickerTemplate.htm",[],function(){return'<div class="control combo {{- customClass}} " title="{{- title}}">\n    <span class="wrap">{{- title}}</span>\n        <span class="control searchLockup ">\n            <div class="wrap">\n                <input type="text" tabindex="">\n            </div>\n            <b class="right">\n                <a class="button searchClear"></a>\n            </b>\n            <a class="button search up"></a>\n        </span>\n\n    <div class="authorityPicker" onselectstart="return false">\n        <div class="selectBorder upper"></div>\n        <ul class="list"></ul>\n        <div class="selectBorder lower"></div>\n    </div>\n\n    <div class="button-select-all" title="{{- selectLabel }}">\n        <i class="icon"></i>\n        <a class="label">\n            <span class="text">{{- selectLabel }}</span>\n        </a>\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm",[],function(){return'{{ for (var i = 0, l = items.length; i<l; i++){ }}\n<li class="leaf">\n    <div class=""><span class="leftColumn">{{- items[i].name}}{{- items[i].username}}</span>\n        {{ if (items[i].tenantId){ }}\n            <span class="rightColumn">{{- items[i].tenantId }}</span>\n        {{ } }}\n    </div>\n</li>\n{{ } }}\n'}),define("tenantImportExport/export/view/AuthorityPickerView",["require","jquery","backbone","text!tenantImportExport/export/template/authorityPickerTemplate.htm","text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm","underscore"],function(e){"use strict";function t(e,t,i){return i<=Math.max(e,t)&&i>=Math.min(e,t)}var i=e("jquery"),n=e("backbone"),o=e("text!tenantImportExport/export/template/authorityPickerTemplate.htm"),s=e("text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm"),r=e("underscore");return n.View.extend({events:{"click .button.search":"search","click .button.searchClear":"clear","click .button-select-all":"_selectAllHandler","keydown input[type=text]":"keyHandler","mousedown li":"selectionStarted","mouseenter li":"mouseEntered","mouseleave li":"mouseLeave","mouseup ul":"selectionFinished","mouseenter ul":"stopScroll","mouseleave ul":"startScroll"},cursor:-1,baseCursor:-1,selecting:!1,scrollSpeed:30,initialize:function(e){this.model.on("change",r.bind(this.renderList,this)),this.model.on("error:server",r.bind(function(){this.trigger("error:server",arguments)},this)),this.upHandler=r.bind(function(e){this.stopScroll(e),this.selecting=!1},this),this.el=!1,this.initOptions=e},render:function(){return this.mainTemplate||(this.mainTemplate=r.template(o)),this.optionsTemplate||(this.optionsTemplate=r.template(s)),this.el||(this.$el=i("<div/>").html(this.mainTemplate(this.initOptions)).children(),this.el=this.$el[0],this.subEl=this.$el.find(".authorityPicker ul"),this.delegateEvents()),this.model.context||this.model.setContext(),this},renderList:function(){return this.subEl.html(this.optionsTemplate(this.model.attributes)).find("li").each(function(e,t){i(t).attr("index",e)}),this.cursor=-1,this.baseCursor=-1,this.scrollSpeed=this.subEl.find("li:eq(0)").height(),this.subEl.scrollTop(0),this.trigger("change:selection",[]),this},getSelected:function(){return r.reduce(this.subEl.find(".selected"),function(e,t){return e.push(r.pluck(i(t).find("span"),"innerHTML").join("|")),e},[])},search:function(){var e=this.$el.find("input[type=text]").val();this.model.setContext({searchString:e}),e?this.$el.find(".button.searchClear").addClass("up"):this.$el.find(".button.searchClear").removeClass("up")},_selectAllHandler:function(){this.selectAll()},clear:function(){this.$el.find("input[type=text]").val(""),this.search()},keyHandler:function(e){13===e.which&&this.search()},setDisabled:function(e){var t=this.$el.find(".button-select-all").children();e?(this.subEl.addClass("disabled"),t.addClass("disabled"),this.undelegateEvents()):(this.subEl.removeClass("disabled"),t.removeClass("disabled"),this.delegateEvents()),this.$el.find("input[type=text]").attr("disabled",e)},highlightSet:function(e){this.subEl.find("li").each(function(t,n){n=i(n),n.toggleClass("highlighted",r.contains(e,r.pluck(n.find("span"),"innerHTML").join("|")))})},selectAll:function(e){this.subEl.find("li").each(function(e,t){i(t).addClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectNone:function(e){this.subEl.find("li").each(function(e,t){i(t).removeClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectInverse:function(e){this.subEl.find("li").each(function(e,t){i(t).toggleClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectItem:function(e,t){this.subEl.find("li[index="+e+"]").addClass("selected"),t||this.trigger("change:selection",this.getSelected())},unSelectItem:function(e,t){this.subEl.find("li[index="+e+"]").removeClass("selected"),t||this.trigger("change:selection",this.getSelected())},selectRange:function(e,t,n){var o=Math.min(e,t),s=Math.max(e,t);this.subEl.find("li:lt("+(s+1)+")").each(function(e,t){e>=o&&i(t).addClass("selected")}),n||this.trigger("change:selection",this.getSelected())},selectionStarted:function(e){this.selecting=!0,e.ctrlKey||e.metaKey||this.selectNone(!0);var t=+i(e.target).parents("li").toggleClass("selected").attr("index");e.shiftKey?-1!=this.cursor&&this.selectRange(this.cursor,t,!0):(this.cursor=t,this.baseCursor=this.cursor)},mouseEntered:function(e){this.selecting&&(this.cursor=+i(e.target).parents("li").addClass("selected").attr("index"))},mouseLeave:function(e){if(this.selecting){var n=i(e.target).parents("li"),o=i(e.relatedTarget).parents("li");t(this.cursor,this.baseCursor,+o.attr("index"))&&n.removeClass("selected")}},selectionFinished:function(e){this.selecting=!1,this.trigger("change:selection",this.getSelected())},startScroll:function(e){if(this.selecting){if(i(e.relatedTarget).hasClass("upper"))this.direction=-1;else{if(!i(e.relatedTarget).hasClass("lower"))return void(this.selecting=!1);this.direction=1}i(document.body).on("mouseup",this.upHandler),this.scrollTimer=setInterval(r.bind(this.scrollList,this),200)}},stopScroll:function(e){this.selecting&&(clearInterval(this.scrollTimer),this.direction=0,i(document.body).off("mouseup",this.upHandler))},scrollList:function(){this.subEl.scrollTop(+this.subEl.scrollTop()+this.scrollSpeed*this.direction),t(this.cursor,this.baseCursor,this.cursor+this.direction)?this.unSelectItem(this.cursor,!0):this.selectItem(this.cursor+this.direction,!0),this.cursor=this.cursor+this.direction}})}),define("text!tenantImportExport/export/template/loadingDialogTemplate.htm",[],function(){return'<div class="panel dialog loading overlay moveable centered_horz centered_vert {{- additionalCssClasses }}" tabindex="-1">\n    <div class="content">\n        <div class="header mover">\n            <div class="title">{{- title }}</div>\n        </div>\n        <div class="body">\n            <p class="message"></p>\n        </div>\n    </div>\n</div>\n'}),define("tenantImportExport/export/view/LoadingDialog",["require","common/component/dialog/Dialog","underscore","bundle!CommonBundle","text!tenantImportExport/export/template/loadingDialogTemplate.htm"],function(e){var t=e("common/component/dialog/Dialog"),i=e("underscore"),n=e("bundle!CommonBundle"),o=e("text!tenantImportExport/export/template/loadingDialogTemplate.htm");return t.extend({defaultTemplate:o,constructor:function(e){i.defaults(e,{contentContainer:".body > .message",title:n["dialog.overlay.title"],modal:!0}),t.call(this,e)}})}),define("text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm",[],function(){return'{{ if (message) { }}<p class="message">{{- message }}</p> {{ } }}\n<div class="control groupBox">\n    <ol class="list tabular oneColumn">\n        {{ for (var i = 0; i<items.length; i++) { }}\n        <li class="leaf {{-  i === 0 ? \' first\' : \'\' }} {{- i === items.length - 1 ? \'last\' : \'\' }}" tabindex="-1">\n            <div class="wrap">\n                <div class="column one">\n                    <p class="uri">{{- items[i] }} </p>\n                </div>\n            </div>\n        </li>\n        {{ } }}\n    </ol>\n\n</div>\n\n'}),define("tenantImportExport/view/BaseWarningDialogView",["require","jquery","underscore","common/component/dialog/Dialog","bundle!ImportExportBundle","text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm"],function(e){var t=(e("jquery"),e("underscore")),i=e("common/component/dialog/Dialog"),n=e("bundle!ImportExportBundle"),o=e("text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm");return i.extend({events:{resize:"onResizeHeight"},onResizeHeight:function(){this.$contentContainer.height(this.$el.height()-this._resizableContainerShiftHeight),this.$(".control.groupBox").css("min-height",this.$contentContainer.height()-this.$(".message").outerHeight(!0))},constructor:function(e){e=e||{},this.options=e,i.prototype.constructor.call(this,{modal:!0,resizable:e.resizable,minWidth:e.minWidth,minHeight:e.minHeight,additionalCssClasses:e.additionalCssClasses||"dependent-resources-dialog jr-uWidth-725px jr-uHeight-500px",title:e.title||n["dialog.broken.dependencies.title"],content:"",buttons:e.buttons}),this.template=t.template(e.template||o)},open:function(e){this.setContent(this.template(t.defaults(e,{message:""}))),i.prototype.open.apply(this,arguments),this.$contentContainer.scrollTop(0),this._resizableContainerShiftHeight=this.$(".jr-mDialog-footer").outerHeight()+this.$(".jr-mDialog-header").outerHeight()+this.$contentContainer.outerHeight()-this.$contentContainer.height()}})}),define("tenantImportExport/export/view/ExportDependentResourcesDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,buttons:[{label:n["export.button.continue"],action:"export",primary:!0},{label:i["button.cancel"],action:"cancel",primary:!1}]}),o.prototype.constructor.call(this,e),this.on("button:export",t.bind(this.close,this)),this.on("button:cancel",t.bind(this.close,this))},open:function(e){t.extend(e,{message:n["export.dialog.broken.dependencies.intro"]}),o.prototype.open.call(this,e)}})}),define("text!common/component/notification/template/notificationTemplate.htm",[],function(){return'<div class="notificationAlert">\n    <p class="notificationMessage">\n        <span>{{- message }}</span>\n        <span class="close">| <a href="#">{{- i18n[\'notification.button.close\'] }}</a></span>\n    </p>\n</div>'}),define("common/component/notification/Notification",["require","underscore","jquery","backbone","bundle!js-sdk/CommonBundle","text!./template/notificationTemplate.htm","css!notifications"],function(e){"use strict";var t,i,n=e("underscore"),o=e("jquery"),s=e("backbone"),r=e("bundle!js-sdk/CommonBundle"),a=e("text!./template/notificationTemplate.htm");e("css!notifications");var l={SUCCESS:"success",WARNING:"warning"},d=2e3,u={};return u[l.WARNING]=l.WARNING,i=s.View.extend({template:n.template(a),events:{"click .close a":"hide"},el:function(){return this.template({message:this.message,i18n:r})},initialize:function(){this.render()},render:function(){return o("body").append(this.$el),this.$el.hide(),this.$messageContainer=this.$(".notificationMessage > span:first-child"),this},show:function(e){return e=n.extend({type:l.WARNING,delay:d},e),this.$messageContainer.text(e.message),this.$messageContainer.removeClass().attr({"class":u[e.type]}),this.$el.slideDown(),e.delay&&n.delay(n.bind(this.hide,this),e.delay),this},hide:function(){return arguments.length&&arguments[0].preventDefault&&arguments[0].preventDefault(),this.$el.slideUp(),this},remove:function(){s.View.prototype.remove.apply(this,arguments)}},{show:function(){return t||(t=new i),t.show.apply(t,arguments)},hide:function(){return t||(t=new i),t.hide.apply(t,arguments)}})}),define("common/view/mixin/epoxyCustomBindingHandlers",["require"],function(e){return{}}),define("common/view/mixin/epoxyCustomBindingFilters",["require"],function(e){return{}}),define("common/view/mixin/epoxyViewMixin",["require","backbone.epoxy","underscore","./epoxyCustomBindingHandlers","./epoxyCustomBindingFilters"],function(e){var t=e("backbone.epoxy"),i=e("underscore"),n=e("./epoxyCustomBindingHandlers"),o=e("./epoxyCustomBindingFilters");return{epoxifyView:function(){var e=this.remove;t.View.mixin(this),e&&(this.remove=e),this.bindingFilters?this.bindingFilters=i.extend({},o,this.bindingFilters):o,this.bindingHandlers?this.bindingHandlers=i.extend({},n,this.bindingHandlers):n},applyEpoxyBindings:function(){this.applyBindings&&this.applyBindings()},removeEpoxyBindings:function(){this.removeBindings&&this.removeBindings()}}}),define("text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm",[],function(){return'<div class="section resources tenant-options">\n    <p class="title">{{- i18n["export.dialog.resources"] }}</p>\n\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.data.sources"] }}</label>\n            <input class="includeDataSources" name="includeDataSources" type="checkbox"\n                   data-bind="checked:includeDataSources, disabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.domains"] }}</label>\n            <input class="includeDomains" name="includeDomains" type="checkbox"\n                   data-bind="checked:includeDomains, disabled:everything">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.ad.hoc.views"] }}</label>\n            <input class="includeAdHocViews" name="includeAdHocViews" type="checkbox"\n                   data-bind="checked:includeAdHocViews, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.reports"] }}</label>\n            <input class="includeReports" name="includeReports" type="checkbox"\n                   data-bind="checked:includeReports, disabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.dashboards"] }}</label>\n            <input class="includeDashboards" name="includeDashboards" type="checkbox"\n                   data-bind="checked:includeDashboards, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.scheduled.report.jobs"] }}</label>\n            <input class="includeScheduledReportJobs" name="includeScheduledReportJobs" type="checkbox"\n                   data-bind="checked:includeScheduledReportJobs, enabled:enableReportJobs">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.other.resources"] }}</label>\n            <input class="includeOtherResourceFiles" name="includeOtherResourceFiles" type="checkbox"\n                   data-bind="checked:includeOtherResourceFiles, disabled:everything">\n        </div>\n    </div>\n</div>\n\n<div class="section assets tenant-options">\n    <p class="title">{{- i18n["export.dialog.assets"] }}</p>\n\n    <div class="group">\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.sub.organizations"] }}</label>\n            <input class="includeSubOrganizations" name="includeSubOrganizations" type="checkbox"\n                   data-bind="checked:includeSubOrganizations, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.dependent.objects"] }}</label>\n            <input class="includeDependentObjects" name="includeDependentObjects" type="checkbox"\n                   data-bind="checked:includeDependentObjects, enabled:someResourceIsChecked">\n        </div>\n\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.repository.permissions"] }}</label>\n            <input class="includeRepositoryPermissions" name="includeRepositoryPermissions" type="checkbox"\n                   data-bind="checked:includeRepositoryPermissions, enabled:someResourceIsChecked">\n        </div>\n        {{ if (isServerOrRootType) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.server.settings"] }}</label>\n            <input class="includeServerSettings" name="includeServerSettings" type="checkbox"\n                   data-bind="checked:includeServerSettings, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.attributes"] }}</label>\n            <input class="includeAttributes" name="includeAttributes" type="checkbox"\n                   data-bind="checked:includeAttributes, disabled:everything">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.attribute.values"] }}</label>\n            <input class="includeAttributeValues" name="includeAttributeValues" type="checkbox"\n                   data-bind="checked:includeAttributeValues, enabled:enableAttributesValues">\n        </div>\n    </div>\n</div>\n'}),define("text!tenantImportExport/export/template/eventsToIncludeTemplate.htm",[],function(){return'<div class="section events">\n    <p class="title">{{- i18n["export.dialog.events"] }}</p>\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.access.events"] }}</label>\n            <input class="includeAccessEvents" name="includeAccessEvents" type="checkbox" data-bind="checked:includeAccessEvents, enabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.audit.events"] }}</label>\n            <input class="includeAuditEvents" name="includeAuditEvents" type="checkbox" data-bind="checked:includeAuditEvents">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.monitoring.events"] }}</label>\n            <input class="includeMonitoringEvents" name="includeMonitoringEvents" type="checkbox" data-bind="checked:includeMonitoringEvents">\n        </div>\n        {{ } }}\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/exportDataFileTemplate.htm",[],function(){return'<div class="section file-name">\n    {{ if (!isRepository) { }} <p class="title">{{- i18n["export.dialog.file.properties"] }}</p> {{ } }}\n    <div class="group">\n        <div class="control input" data-bind="validationErrorClass:fileName" data-model-attr="fileName">\n            <span class="wrap">{{- i18n["export.dialog.file.properties.data.file.name"]}}</span>\n            <input type="text" class="fileName"  data-bind="value:fileName, events:[\'keyup\']"/>\n            <span class="message warning fileNameMessage" data-bind="validationErrorText:fileName" data-model-attr="fileName"></span>\n        </div>\n\n        {{ if (0) { }}\n        <div class="control checkBox encryptFileWrapper">\n            <label class="wrap" title="">{{- i18n["export.dialog.file.properties.encrypt.file"] }}</label>\n            <input class="encryptFile" name="encryptFile" type="checkbox" data-bind="checked:encryptFile">\n        </div>\n        {{ } }}\n    </div>\n</div>\n'}),define("text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm",[],function(){return'<div class="section roles-users">\n    <p class="title">{{- i18n["export.dialog.roles.users"] }}</p>\n    <div class="group rolesAndUsers">\n        <div class="control radio">\n            <label class="wrap" title="" for="selectedUsersRoles">{{- i18n["export.dialog.roles.users.selected.roles.users"] }}</label>\n            <input id="selectedUsersRoles" class="selectedUsersRoles" name="sample" type="radio" data-bind="disabled:everything" checked="checked">\n        </div>\n        <div class="control radio">\n            <label class="wrap" title="" for="usersWithSelectedRoles">{{- i18n["export.dialog.roles.users.users.with.selected.roles"] }}</label>\n            <input id="usersWithSelectedRoles" class="usersWithSelectedRoles" name="sample" type="radio" data-bind="disabled:everything">\n        </div>\n        <div class="control radio">\n            <label class="wrap" title="" for="rolesWithSelectedUsers">{{- i18n["export.dialog.roles.users.roles.with.selected.users"] }}</label>\n            <input id="rolesWithSelectedUsers" class="rolesWithSelectedUsers" name="sample" type="radio" data-bind="disabled:everything">\n        </div>\n    </div>\n    <div class="group">\n        <div class="selectRolesUsers column two control pickWells"></div>\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm",[],function(){return'<div class="export-options">\n    {{ if (!isRepository) { }}\n    <p class="title export-options-title">{{- i18n["export.dialog.options"] }}</p>\n    <div class="section everything">\n        <div class="control checkBox everything">\n            <label class="wrap" title="">{{- i18n["export.dialog.everything"] }}</label>\n            <input class="everything" name="everything" type="checkbox" data-bind="checked:everything">\n        </div>\n    </div>\n    {{ } }}\n</div>'}),define("text!tenantImportExport/export/template/repositoryExportTemplate.htm",[],function(){return'<div class="section resources">\n    <p>{{- i18n["export.dialog.options"] }}</p>\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.report.jobs"] }}</label>\n            <input class="includeScheduledReportJobs" name="includeScheduledReportJobs" type="checkbox" data-bind="checked:includeScheduledReportJobs">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.permissions"] }}</label>\n            <input class="includeRepositoryPermissions" name="includeRepositoryPermissions" type="checkbox" data-bind="checked:includeRepositoryPermissions">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.dependencies"] }} </label>\n            <input class="includeDependencies" name="includeDependencies" type="checkbox" data-bind="checked:includeDependencies">\n        </div>\n        {{ if (isSubOrgLevel) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.full.repo.path"] }}</label>\n            <input class="includeFullResourcePath" name="includeFullResourcePath" type="checkbox" data-bind="checked:includeFullResourcePath">\n        </div>\n        {{ } }}\n    </div>\n</div>'}),define("tenantImportExport/export/factory/exportTemplateFactory",["require","jquery","text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm","text!tenantImportExport/export/template/eventsToIncludeTemplate.htm","text!tenantImportExport/export/template/exportDataFileTemplate.htm","text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm","text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm","text!tenantImportExport/export/template/repositoryExportTemplate.htm","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("jquery"),i=e("text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm"),n=e("text!tenantImportExport/export/template/eventsToIncludeTemplate.htm"),o=e("text!tenantImportExport/export/template/exportDataFileTemplate.htm"),s=e("text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm"),r=e("text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm"),a=e("text!tenantImportExport/export/template/repositoryExportTemplate.htm"),l=e("tenantImportExport/export/enum/exportTypesEnum"),d={};return d[l.ROOT_TENANT]=[s,i,n].join(""),d[l.TENANT]=[s,i].join(""),d[l.SERVER_PRO]=[s,i,n].join(""),d[l.SERVER_CE]=[s,i,n].join(""),d[l.REPOSITORY]=[a].join(""),function(e){return e=e||{},o+t(r).append(d[e.type])[0].outerHTML}}),define("tenantImportExport/export/view/ExportView",["require","css!importExport","jquery","underscore","backbone","../model/ExportModel","../model/ExportStateModel","../model/AuthorityPickerModel","./AuthorityPickerView","./LoadingDialog","./ExportDependentResourcesDialogView","common/component/notification/Notification","common/view/mixin/epoxyViewMixin","tenantImportExport/export/factory/exportTemplateFactory","tenantImportExport/export/enum/exportTypesEnum","bundle!ImportExportBundle","bundle!CommonBundle"],function(e){"use strict";function t(e){this.rolesList=new u({model:d.instance("rest_v2/{{#tenantId}}organizations/{{{tenantId}}}/{{/tenantId}}roles?q={{{searchString}}}{{#excludeSubOrgs}}&includeSubOrgs=false{{/excludeSubOrgs}}",{tenantId:e.tenantId}),customClass:"selectedRoles",title:v["export.dialog.roles.users.roles.label"],
selectLabel:v["export.dialog.roles.users.select.all.roles.label"]}),this.rolesList.on("change:selection",this.bindWithRoles),this.rolesList.render(),this.usersList=new u({model:d.instance("rest_v2/{{#tenantId}}organizations/{{{tenantId}}}/{{/tenantId}}users?q={{{searchString}}}{{#excludeSubOrgs}}&includeSubOrgs=false{{/excludeSubOrgs}}",{tenantId:e.tenantId}),customClass:"select selectedUsers",title:v["export.dialog.roles.users.users.label"],selectLabel:v["export.dialog.roles.users.select.all.users.label"]}),this.usersList.on("change:selection",this.bindWithUsers),this.usersList.render(),this.rolesToUsers=d.instance("rest_v2/users?hasAllRequiredRoles=false{{#roles}}&requiredRole={{{.}}}{{/roles}}"),this.rolesToUsers.on("change",this.onRolesToUsersChange),this.usersToRoles=d.instance("rest_v2/roles?hasAllUsers=false{{#users}}&user={{{.}}}{{/users}}"),this.usersToRoles.on("change",this.onUsersToRolesChange),this.changeEnabledState(),this.listenTo(this.model,"change:everything",this.changeEnabledState),this.$el.find(".selectRolesUsers").append(this.rolesList.el).append(this.usersList.el),this.listenTo(this.model,"change:includeSubOrganizations",this.filterAuthoritiesBySubOrgs)}function i(){var e=document.createElement("iframe");e.src=this.model.url()+"/"+this.stateModel.id+"/"+this.model.get("fileName"),e.style.display="none",o("body").append(e)}function n(e){this.model.cancel(),this.stateModel.set("phase",e)}e("css!importExport");var o=e("jquery"),s=e("underscore"),r=e("backbone"),a=e("../model/ExportModel"),l=e("../model/ExportStateModel"),d=e("../model/AuthorityPickerModel"),u=e("./AuthorityPickerView"),c=e("./LoadingDialog"),h=e("./ExportDependentResourcesDialogView"),p=e("common/component/notification/Notification"),m=e("common/view/mixin/epoxyViewMixin"),g=e("tenantImportExport/export/factory/exportTemplateFactory"),f=e("tenantImportExport/export/enum/exportTypesEnum"),v=e("bundle!ImportExportBundle"),b=e("bundle!CommonBundle"),E=r.View.extend({className:"export-view",events:{"change .usersWithSelectedRoles":"includeRolesByUsers","change .rolesWithSelectedUsers":"includeUsersWithRoles","change .selectedUsersRoles":"includeSelectedRolesUsersOnly","click .section .checkBox label":"_clickOnCheckbox"},computeds:{includeAccessEventsChecked:function(){return this.model.get("everything")?this.model.get("includeAccessEvents"):!1},enableAttributesValues:{deps:["everything","includeAttributes"],get:function(e,t){return!e&&t}},enableReportJobs:{deps:["everything","includeReports"],get:function(e,t){return!e&&t}},someResourceIsChecked:{deps:["everything","includeReports","includeAdHocViews","includeDashboards","includeDomains","includeDataSources","includeOtherResourceFiles"],get:function(e,t,i,n,o,s,r){return!e&&(t||i||n||o||s||r)}}},initialize:function(){s.bindAll(this),this.model||(this.model=new a),this.stateModel=new l,this.epoxifyView(),this.loadingDialog=new c({content:b["dialog.overlay.loading"]}),this.notification=new p,this.dependentResourcesDialogView=new h,this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.stateModel,"change:phase",this.handleExportPhase,this),this.listenTo(this.model,"error:unauthorized",window.location.reload),this.listenTo(this.stateModel,"error:unauthorized",window.location.reload);var e={delay:!1,message:v["export.error.cancelled"]},t={delay:!1,message:v["export.error.unexpected"]};this.listenTo(this.model,"error:notFound",s.bind(this.notification.show,this.notification,e)),this.listenTo(this.stateModel,"error:notFound",s.bind(this.notification.show,this.notification,e)),this.listenTo(this.model,"error:internalServerError",s.bind(this.notification.show,this.notification,t)),this.listenTo(this.stateModel,"error:internalServerError",s.bind(this.notification.show,this.notification,t)),this.listenTo(this.model,"error",s.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.stateModel,"error",s.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.dependentResourcesDialogView,"button:export",s.compose(s.bind(this.dependentResourcesDialogView.close,this.dependentResourcesDialogView),s.bind(function(){i.call(this),this._showNotification({message:v["export.finished"],type:"success"})},this))),this.listenTo(this.dependentResourcesDialogView,"button:cancel",s.bind(n,this,l.STATE.CANCELLED))},render:function(e){e=e||{},this.type=e.type;var i=this._isServerLevel(this.type),n=i||this.type===f.ROOT_TENANT;return n?this.$el.addClass("with-events"):this.$el.removeClass("with-events"),this.stopListening(this.model,"change:includeSubOrganizations",this.filterAuthoritiesBySubOrgs),this._resetModel(e),this.template=s.template(g(e))({everything:!1,i18n:v,isServerOrRootType:n,isServerLevel:i,isServerCe:this.type===f.SERVER_CE,isRepository:this.type===f.REPOSITORY,isSubOrgLevel:e.isSubOrgLevel}),this.$el.html(this.template),this.$(".selectRolesUsers").length&&t.call(this,e),this.applyEpoxyBindings(),this},doExport:function(){var e=this;this.model.isValid(!0)&&(this.loadingDialog.open(),this.model.save().done(function(t){e.stateModel.unset("warnings",{silent:!0}),e.stateModel.set(t),e.model.set("id",t.id)}))},handleExportPhase:function(){var e,t=this.stateModel.get("phase"),n=this._getBrokenDependencies();t==l.STATE.READY&&(this.loadingDialog.close(),s.isEmpty(n)?(i.call(this),e={message:v["export.finished"],type:"success"}):this.dependentResourcesDialogView.open({items:n})),t==l.STATE.FAILED&&(e={message:v["export.error.unexpected"]}),t==l.STATE.CANCELLED&&(e={message:v["export.error.cancelled"]}),e&&this._showNotification(e)},filterAuthoritiesBySubOrgs:function(){var e={excludeSubOrgs:!this.model.get("includeSubOrganizations")};this.rolesList.model.setContext(e),this.usersList.model.setContext(e)},bindWithRoles:function(e){this.model.set({roles:e}),this.onUsersToRolesChange(),e.length?this.rolesToUsers.setContext({roles:e}):this.rolesToUsers.set({items:[]})},bindWithUsers:function(e){this.model.set({users:e}),this.onRolesToUsersChange(),e.length?this.usersToRoles.setContext({users:e}):this.usersToRoles.set({items:[]})},changeEnabledState:function(){var e=this.model.get("everything");this.rolesList.setDisabled(e||this.model.get("rolesForUser")),this.usersList.setDisabled(e||this.model.get("userForRoles")),e&&(this.rolesList.selectNone(),this.usersList.selectNone())},includeRolesByUsers:function(e){var t=o(e.target).is(":checked");this.model.set({rolesForUser:!t,userForRoles:t}),this.onRolesToUsersChange(),this._includeUsersOrRoles(!t,t)},includeUsersWithRoles:function(e){var t=o(e.target).is(":checked");this.model.set({rolesForUser:t,userForRoles:!t}),this.onUsersToRolesChange(),this._includeUsersOrRoles(t,!t)},includeSelectedRolesUsersOnly:function(e){o(e.target).is(":checked")&&(this.model.set({userForRoles:!1,rolesForUser:!1}),this.onRolesToUsersChange(),this.onUsersToRolesChange(),this._includeUsersOrRoles(!1,!1))},sendParameters:function(e){this.model.isValid(!0)&&this.model.save()},onRolesToUsersChange:function(){this.model.get("userForRoles")?(this.usersList.highlightSet(s.map(this.rolesToUsers.get("items"),function(e){return e.username+(e.tenantId?"|"+e.tenantId:"")})),this.rolesList.highlightSet([])):this.usersList.highlightSet([])},onUsersToRolesChange:function(){this.model.get("rolesForUser")?(this.rolesList.highlightSet(s.map(this.usersToRoles.get("items"),function(e){return e.name+(e.tenantId?"|"+e.tenantId:"")})),this.usersList.highlightSet([])):this.rolesList.highlightSet([])},_isServerLevel:function(e){return e===f.SERVER_CE||e===f.SERVER_PRO},_includeUsersOrRoles:function(e,t){this.rolesList.setDisabled(e),this.usersList.setDisabled(t),this.rolesList.selectNone(),this.usersList.selectNone()},_showNotification:function(e){e=s.defaults(e,{type:"warning"}),this.loadingDialog.isVisible()&&this.loadingDialog.close(),this.notification.show({delay:!1,message:e.message,type:e.type})},_getBrokenDependencies:function(){var e=this.stateModel.get("warnings"),t=[];return s.each(e,function(e){"export.broken.dependency"===e.code&&t.push(e.parameters)}),s.flatten(s.sortBy(t,function(e){return e}))},_clickOnCheckbox:function(e){var t=o(e.target).next();t[0].disabled||this.model.set(t[0].name,!t[0].checked)},_onModelChange:function(){this.model.isValid(!0)},_resetModel:function(e){var t={organization:this.type==f.REPOSITORY?null:e.tenantId};if(this.type===f.ROOT_TENANT||this.type===f.TENANT){var i=this.type===f.ROOT_TENANT?"root_export.zip":e.tenantId+"_export.zip";s.extend(t,{fileName:i})}this.model.reset(t,this.type)}});return s.extend(E.prototype,m),E}),define("tenantImportExport/export/view/ExportDialogView",["require","jquery","underscore","jrs.configs","common/component/dialog/Dialog","./ExportView","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/export/enum/exportTypesEnum"],function(e){function t(e){return n.isArray(e)?n.pluck(e,"URIString"):[e.URIString]}function i(e){return n.isArray(e)||(e=[e]),!!n.reduce(e,function(e,t){return e||!t.resourceType||t.resourceType.indexOf("ReportUnit")+1||t.resourceType.indexOf("ReportOptions")+1},!1)}var n=(e("jquery"),e("underscore")),o=e("jrs.configs"),s=e("common/component/dialog/Dialog"),r=e("./ExportView"),a=e("bundle!CommonBundle"),l=e("bundle!ImportExportBundle"),d=e("tenantImportExport/export/enum/exportTypesEnum");return s.extend({constructor:function(e){e||(e={}),this.options=e,s.prototype.constructor.call(this,{model:this.model,resizable:!0,modal:!0,content:"",buttons:[{label:a["button.export"],action:"export",primary:!0},{label:a["button.cancel"],action:"cancel",primary:!1}]}),this.on("button:export",n.bind(this._onExportButtonClick,this)),this.on("button:cancel",n.bind(this._closeExportDialog,this))},initialize:function(e){this.exportView=new r,this.listenTo(this.exportView.model,"validated",function(e){e?this.buttons.enable("export"):this.buttons.disable("export")},this),s.prototype.initialize.apply(this,arguments)},openRepoDialog:function(e){var n=t(e),s=o.organizationsFolderUri||"/organizations",r=o.orgTemplateFolderUri||"/org_template",a=new RegExp("^("+s+"/([^/]+))+"),u=new RegExp("^"+s+r+"(/.*)?"),c=!!a.exec(n[0])&&!u.exec(n[0]),h={type:d.REPOSITORY,isSubOrgLevel:c},p=" "+l["export.dialog.repository.title"];this.addCssClasses("repository-export-dialog"),this._openExportDialog(h,p),this.exportView.model.set({uris:n,includeScheduledReportJobs:i(e)})},openTenantDialog:function(e){var t=" "+e.name,i=e.isRoot()?d.ROOT_TENANT:d.TENANT,n={type:i,tenantId:e.id};this.addCssClasses("tenant-export-dialog"),this._openExportDialog(n,t)},fieldIsValid:function(){},fieldIsInvalid:function(e){},_onExportButtonClick:function(){this.exportView.doExport(),this._closeExportDialog()},_closeExportDialog:function(){this.$el.css({width:this.width}),this.close()},_openExportDialog:function(e,t){var i=l["export.dialog.title"]+(t?t:"");this.setContent(this.exportView.render(e).$el),this.setTitle(i),this.exportView.applyEpoxyBindings(),this.exportView.delegateEvents(),s.prototype.open.apply(this,arguments),this.$el.css({minHeight:this.$el.outerHeight()}),this.width=this.$el.outerWidth()}})}),define("tenantImportExport/import/factory/importModelAttributesFactory",["require","underscore","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("underscore"),i=e("tenantImportExport/export/enum/exportTypesEnum"),n={},o={includeAccessEvents:!0,includeAuditEvents:!0,includeMonitoringEvents:!0},s={skipThemes:!0},r={includeServerSettings:!0};return n[i.ROOT_TENANT]=t.extend({},o,s),n[i.TENANT]=t.extend({},s),n[i.SERVER_PRO]=t.extend({},o,s,r),n[i.SERVER_CE]=t.extend({},r,{includeAccessEvents:!0}),function(e){return n[e]}}),define("tenantImportExport/import/enum/brokenDependencyStrategyEnum",{FAIL:"fail",SKIP:"skip",INCLUDE:"include"}),define("common/transport/AjaxFormSubmitter",["require","underscore","request","jquery"],function(e){function t(e){var t,n=null;return e.firstChild.innerText&&""!==e.firstChild.innerText&&e.body?(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e.firstChild.innerText.replace("\r\n-","\r\n"))):t=e,t.firstChild&&(n=t.firstChild.nodeName.toLowerCase()),n&&"html"!==n&&"#comment"!==n?i("xml"===t.firstChild.nodeName.toLowerCase()?t.firstChild.nextSibling:t.firstChild):{errorCode:"unexpected.error"}}function i(e){var t,n;if(e.children)t=e.children;else{t=[];for(var o=0,s=e.childNodes.length;s>o;o++)null===e.childNodes[o].nodeValue&&t.push(e.childNodes[o])}if(0===t.length&&1===e.childNodes.length)return e.childNodes[0].nodeValue;if(t.length>1&&t[0].nodeName===t[1].nodeName){n=[];for(var o=0,s=t.length;s>o;o++)n[o]=i(t[o])}else{n={};for(var o=0,s=t.length;s>o;o++)n[t[o].nodeName]=i(t[o])}return n}function n(e){var t=new a.Deferred;return e.submit(function(i){i.preventDefault(),r({url:e.attr("action"),type:e.attr("method"),data:new FormData(e[0]),cache:!1,contentType:!1,processData:!1,headers:{Accept:"application/json"}}).done(function(e){t.resolve(e)}).fail(function(e){e=e.responseJSON||e||{},s.defaults(e,{errorCode:"error.load.error"}),t.reject(e)}),e.unbind("submit")}),e.submit(),t}function o(e,i){var n=a.Deferred(),o=a("<iframe style='display:none' name='"+i+"'></iframe>");return e.append(o).attr("target",i),o.load(function(){try{n.resolve(t(this.contentWindow.document))}catch(e){n.reject({errorCode:"error.invalid.response"})}o.remove()}),o.on("abort",function(){n.reject({errorCode:"error.load.aborted"}),o.remove()}),o.on("error",function(){n.reject({errorCode:"error.load.error"}),o.remove()}),e.submit(),n}var s=e("underscore"),r=e("request"),a=e("jquery"),l=function(e,i,n,o){this.name=s.uniqueId("uploadTarget"),this.form=a(e),i&&this.form.attr("action",i),n&&this.form.attr("method",n),o&&this.form.attr("enctype",o),this.parceXmlDocToObject=t};return l.prototype.submit=function(){return window.FormData?n(this.form):o(this.form,this.name)},l}),define("tenantImportExport/import/model/ImportModel",["require","underscore","jquery","tenantImportExport/import/factory/importModelAttributesFactory","../enum/brokenDependencyStrategyEnum","common/transport/AjaxFormSubmitter","backbone.validation","common/model/BaseModel"],function(e){var t=e("underscore"),i=e("jquery"),n=e("tenantImportExport/import/factory/importModelAttributesFactory"),o=e("../enum/brokenDependencyStrategyEnum"),s=e("common/transport/AjaxFormSubmitter"),r=e("backbone.validation"),a=e("common/model/BaseModel"),l=a.extend({defaults:{fileName:"",update:!0,skipUserUpdate:!1,mergeOrganization:!1,skipThemes:!0,brokenDependencies:o.FAIL},url:"rest_v2/import",validation:{fileName:[{fn:function(e){return!/\.zip$/.test(e)}}]},initialize:function(e,t){this.form=new s(t.form,this.url,"post","multipart/form-data")},parse:function(){return this.attributes},save:function(){var e,n,o=this;return this.isNew()?(e=new i.Deferred,this.form.submit().done(function(i){o.set("id",i.id),t.isUndefined(i.errorCode)&&t.isUndefined(i.error)?e.resolve(i):e.reject(i)}).fail(function(t){o.trigger("error",t),e.reject(t)})):(n=this._convertParameters(),e=a.prototype.save.call(this,{parameters:n},{url:this.url+"/"+this.id}).fail(t.bind(this.trigger,"error"))),e},cancel:function(){var e=this.url+"/"+this.id;this.destroy({url:e})},reset:function(e,i){var o=t.extend({},this.defaults,n(e),i);this.clear().set(t.extend({},o)),this.id=void 0},_convertParameters:function(){var e=[];return this.get("skipUserUpdate")&&e.push("skip-user-update"),this.get("includeAccessEvents")&&e.push("include-access-events"),this.get("includeAuditEvents")&&e.push("include-audit-events"),this.get("includeMonitoringEvents")&&e.push("include-monitoring-events"),this.get("includeServerSettings")&&e.push("include-server-setting"),this.get("mergeOrganization")&&e.push("merge-organization"),this.get("skipThemes")&&e.push("skip-themes"),this.get("update")&&e.push("update"),e}});return t.extend(l.prototype,r.mixin),l}),define("tenantImportExport/import/model/ImportStateModel",["require","../../export/model/ExportStateModel"],function(e){var t=e("../../export/model/ExportStateModel");return t.extend({url:function(){return"rest_v2/import/"+this.id+"/state"}})}),define("tenantImportExport/import/enum/importPendingStatesEnum",{BROKEN_DEPS:"import.broken.dependencies",TENANT_MISMATCH:"import.organizations.not.match"}),define("text!tenantImportExport/import/template/mergeTenantDialogTemplate.htm",[],function(){return"<p class=\"message\">{{- i18n['import.dialog.merge.tenant.intro'] }}</p>\n\n<p class=\"message imported-tenant\"><b>{{- i18n['import.dialog.merge.tenant.imported'] }} : </b> {{- fileTenantId}} </p>\n<p class=\"message selected-tenant\"><b>{{- i18n['import.dialog.merge.tenant.selected'] }} : </b> {{- selectedTenantId}} </p>\n\n<p class=\"message\">{{- i18n['import.dialog.merge.tenant.outro'] }} {{- selectedTenantId}}</p>\n"}),define("tenantImportExport/import/view/MergeTenantDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView","text!tenantImportExport/import/template/mergeTenantDialogTemplate.htm"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView"),s=e("text!tenantImportExport/import/template/mergeTenantDialogTemplate.htm");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,additionalCssClasses:"merge-tenant-dialog",title:n["import.dialog.merge.tenant.title"],buttons:[{label:n["import.button.continue"],action:"import",primary:!0},{label:i["button.cancel"],action:"cancel",primary:!1}],template:s}),o.prototype.constructor.call(this,e),this.on("button:import",t.bind(this.close,this)),this.on("button:cancel",t.bind(this.close,this))},open:function(e){t.extend(e,{i18n:n}),o.prototype.open.call(this,e)}})}),define("tenantImportExport/import/view/ImportDependentResourcesDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,buttons:[{label:n["import.button.include"],action:"include",primary:!0},{label:n["import.button.skip"],action:"skip",primary:!1},{label:i["button.cancel"],action:"cancel",primary:!1}]}),o.prototype.constructor.call(this,e),this.on("button:include",t.bind(this.close,this)),this.on("button:skip",t.bind(this.close,this)),this.on("button:cancel",t.bind(this.close,this))},open:function(e){t.extend(e,{message:n["import.dialog.broken.dependencies.intro"]}),o.prototype.open.call(this,e)}})}),define("tenantImportExport/import/view/ImportWarningsDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,title:n["import.dialog.warnings.title"],additionalCssClasses:"warnings-dialog",buttons:[{label:i["button.close"],action:"close",primary:!1}]}),o.prototype.constructor.call(this,e),this.on("button:close",t.bind(this.close,this))}})}),define("tenantImportExport/import/factory/warningsFactory",["require","bundle!ImportExportBundle","underscore"],function(e){function t(e,t){var i={};return n.each(e,function(e,n){i[e]=t[n]}),i}var i=e("bundle!ImportExportBundle"),n=e("underscore"),o={};return o["import.resource.uri.too.long"]=[{msg:i["import.resource.uri.too.long"],parameters:["resourceURI"]},{msg:i["import.resource.uri.too.long.length"],parameters:["resourceURI","maxURILength"]}],o["import.access.denied"]=[{msg:i["import.access.denied"],parameters:["resourceURI"]}],o["import.resource.not.found"]=[{msg:i["import.resource.not.found"],parameters:["resourceURI"]}],o["import.resource.different.type.already.exists"]=[{msg:i["import.resource.different.type.already.exists"],parameters:["resourceURI"]}],o["import.resource.uri.not.valid"]=[{msg:i["import.resource.uri.not.valid"],parameters:["resourceURI"]}],o["import.resource.data.missing"]=[{msg:i["import.resource.data.missing"],parameters:["resourceURI"]}],o["import.reference.resource.not.found"]=[{msg:i["import.reference.resource.not.found"],parameters:["resourceURI"]},{msg:i["import.reference.dependent.resource.not.found"],parameters:["dependentResourceURI","resourceURI"]}],o["import.resource.attached.not.exist.org"]=[{msg:i["import.resource.attached.not.exist.org"],parameters:["resourceURI"]}],o["import.folder.attached.not.exist.org"]=[{msg:i["import.folder.attached.not.exist.org"],parameters:["resourceURI"]}],o["import.multi.tenancy.not.supported"]=[{msg:i["import.multi.tenancy.not.supported"],parameters:["organizationId"]}],o["import.report.job.reference.resource.not.found"]=[{msg:i["import.report.job.reference.resource.not.found"],parameters:["resourceURI"]},{msg:i["import.report.job.reference.dependent.resource.not.found"],parameters:["dependentResourceURI","resourceURI"]}],function(e){var i,s=e.code,r=e.parameters,a=o[s];return i=n.template(a[r.length-1].msg)(t(a[r.length-1].parameters,r))}}),define("text!tenantImportExport/import/template/importTemplate.htm",[],function(){return'<input name="organization" class="" type="hidden" data-bind="value:organization"/>\n\n<fieldset class="group">\n    <legend class="">\n        <span>{{- i18n[\'import.file.name\'] }}</span>\n    </legend>\n    <label for="uploadFile">\n        <input name="file" class="upload-file" id="uploadFile" type="file"/>\n    </label>\n</fieldset>\n<fieldset class="group">\n    <legend class="">\n        <span>{{- i18n[\'import.options\'] }}</span>\n    </legend>\n    <ul class="list inputSet">\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="" for="update">{{- i18n[\'import.update\'] }}</label>\n                <input id="update" class="" type="checkbox" value="" name="update" data-bind="checked:update"/>\n            </div>\n            <ul class="list inputSet">\n                <li class="leaf">\n                    <div class="control checkBox">\n                        <label class="wrap" title="">{{- i18n[\'import.skip.user.update\']\n                            }}</label>\n                        <input id="skipUserUpdate" class="" type="checkbox" value="" name="skip-user-update"\n                               data-bind="checked:skipUserUpdate, enabled:update"/>\n                    </div>\n                </li>\n            </ul>\n        </li>\n\n        {{ if (model.includeAuditEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.audit.events\']}}</label>\n                <input id="includeAuditEvents" class="" type="checkbox" name="include-audit-events"\n                       data-bind="checked:includeAuditEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeAccessEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.access.events\']}}</label>\n                <input id="includeAccessEvents" class="" type="checkbox" value="" name="include-access-events"\n                       data-bind="checked:includeAccessEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeMonitoringEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.monitoring.events\'] }}</label>\n                <input id="includeMonitoringEvents" class="" type="checkbox" value="" name="include-monitoring-events"\n                       data-bind="checked:includeMonitoringEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeServerSettings) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap">{{- i18n[\'import.include.configuration.settings\']}}</label>\n                <input class="" type="checkbox" value="" name="include-server-settings"\n                       data-bind="checked:includeServerSettings"/>\n            </div>\n        </li>\n        {{ } if (typeof model.skipThemes !== "undefined") { }}\n\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.themes\']}}</label>\n                <input type="checkbox" value=""\n                       data-bind="checked:not(skipThemes)"/>\n                <input class="hidden" id="skip-themes" type="checkbox"  value="" name="skip-themes"\n                       data-bind="checked:skipThemes"/>\n            </div>\n        </li>\n        {{ } }}\n    </ul>\n</fieldset>\n\n<!-- Hack for correct sending of multipart/form-data in IE. -->\n<!-- Here is the fix https://blog.yorkxin.org/posts/2014/02/06/ajax-with-formdata-is-broken-on-ie10-ie11/ -->\n<input type="hidden" name="_dontcare">'}),define("tenantImportExport/import/view/ImportView",["require","css!importExport.css","jquery","underscore","backbone","../model/ImportModel","../model/ImportStateModel","../enum/importPendingStatesEnum","../enum/brokenDependencyStrategyEnum","../../export/view/LoadingDialog","./MergeTenantDialogView","./ImportDependentResourcesDialogView","./ImportWarningsDialogView","tenantImportExport/import/factory/warningsFactory","common/component/notification/Notification","common/view/mixin/epoxyViewMixin","text!tenantImportExport/import/template/importTemplate.htm","bundle!ImportExportBundle","bundle!CommonBundle"],function(e){"use strict";function t(){var e=this.stateModel.get("warnings");return a.map(e,function(e){return v(e)})}function i(e,i){i=i||"warning";var n=t.call(this);"import.finished"!==e||a.isEmpty(n)||this.warningsDialogView.open({items:n}),this.notification.show({delay:!1,message:_[e]||_["import.error.unexpected"],type:i}),this.trigger("import:finished",this.model.get("organization")),this.model.reset(this.type)}function n(){var e=this.stateModel.get("error");e.errorCode===c.BROKEN_DEPS?this.dependentResourcesDialogView.open({items:e.parameters}):e.errorCode===c.TENANT_MISMATCH&&this.mergeTenantDialogView.open({fileTenantId:e.parameters[0],selectedTenantId:this.model.get("organization")})}function o(e,t){return function(i){e.model.set("brokenDependencies",t),e.doImport()}}function s(e){this.model.cancel(),this.stateModel.set("phase",e)}e("css!importExport.css");var r=e("jquery"),a=e("underscore"),l=e("backbone"),d=e("../model/ImportModel"),u=e("../model/ImportStateModel"),c=e("../enum/importPendingStatesEnum"),h=e("../enum/brokenDependencyStrategyEnum"),p=e("../../export/view/LoadingDialog"),m=e("./MergeTenantDialogView"),g=e("./ImportDependentResourcesDialogView"),f=e("./ImportWarningsDialogView"),v=e("tenantImportExport/import/factory/warningsFactory"),b=e("common/component/notification/Notification"),E=e("common/view/mixin/epoxyViewMixin"),y=e("text!tenantImportExport/import/template/importTemplate.htm"),_=e("bundle!ImportExportBundle"),T=e("bundle!CommonBundle"),M=l.View.extend({tagName:"form",className:"import-view",id:"importDataFile",events:{"change input[type='file']":"validateFile","click .checkBox label":"_clickOnCheckbox"},initialize:function(){this.model||(this.model=new d(null,{form:this.el})),this.stateModel=new u,this.loadingDialog=new p({content:T["dialog.overlay.loading"]}),this.mergeTenantDialogView=new m,this.dependentResourcesDialogView=new g,this.warningsDialogView=new f,this.notification=new b,this.listenTo(this.stateModel,"change:phase",this._handleImportPhase,this);var e={delay:!1,message:_["import.error.cancelled"]},t={delay:!1,message:_["import.error.unexpected"]};this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.model,"error:notFound",a.bind(this.notification.show,this.notification,e)),this.listenTo(this.stateModel,"error:notFound",a.bind(this.notification.show,this.notification,e)),this.listenTo(this.model,"error:internalServerError",a.bind(this.notification.show,this.notification,t)),this.listenTo(this.stateModel,"error:internalServerError",a.bind(this.notification.show,this.notification,t)),this.listenTo(this.model,"error",a.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.stateModel,"error",a.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.mergeTenantDialogView,"button:import",function(){this.model.set("mergeOrganization",!0),this.doImport()},this),this.listenTo(this.mergeTenantDialogView,"button:cancel",a.bind(s,this,u.STATE.CANCELLED)),this.listenTo(this.dependentResourcesDialogView,"button:skip",o(this,h.SKIP)),this.listenTo(this.dependentResourcesDialogView,"button:include",o(this,h.INCLUDE)),this.listenTo(this.dependentResourcesDialogView,"button:cancel",a.bind(s,this,u.STATE.CANCELLED)),this.epoxifyView()},render:function(e){return this.type=e.type,this.model.reset(this.type,{organization:e.tenantId}),this.$el.html(a.template(y)({i18n:_,model:this.model.toJSON()})),this.applyEpoxyBindings(),this},validateFile:function(e){this.model.set("fileName",r(e.target).val());var t=r(e.target),i=t.parent();this.model.isValid(!0)?i.removeClass("error"):i.addClass("error")},doImport:function(){var e=this;this.loadingDialog.open(),this.model.isValid(!0)&&this.model.save().always(function(t){e.stateModel.set(t)})},_handleImportPhase:function(){var e=this.stateModel.get("phase");e!==u.STATE.INPROGRESS&&this.loadingDialog.close(),e===u.STATE.READY&&i.call(this,"import.finished","success")||e===u.STATE.FAILED&&i.call(this,this.stateModel.get("error").errorCode)||e===u.STATE.CANCELLED&&i.call(this,"import.error.cancelled")||e===u.STATE.PENDING&&n.call(this)},_clickOnCheckbox:function(e){var t=r(e.target).next();t[0].disabled||(t[0].checked=!t[0].checked,t.trigger("change"))},_onModelChange:function(){this.model.isValid(!0)}});return a.extend(M.prototype,E),M}),define("tenantImportExport/import/view/ImportDialogView",["require","underscore","common/component/dialog/Dialog","./ImportView","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("underscore"),i=e("common/component/dialog/Dialog"),n=e("./ImportView"),o=e("bundle!CommonBundle"),s=e("bundle!ImportExportBundle"),r=e("tenantImportExport/export/enum/exportTypesEnum");return i.extend({constructor:function(e){e||(e={}),this.options=e,i.prototype.constructor.call(this,{model:this.model,modal:!0,resizable:!0,additionalCssClasses:"tenant-import-dialog",content:"",buttons:[{label:o["button.import"],action:"import",primary:!0},{label:o["button.cancel"],action:"cancel",primary:!1}]}),this.on("button:import",t.bind(this._onImportButtonClick,this)),this.on("button:cancel",t.bind(this._closeImportDialog,this))},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.importView=new n,this.listenTo(this.importView,"import:finished",function(e){this.close(),this.trigger("import:finished",e)}),this.listenTo(this.importView.model,"validated",function(e){e?this.buttons.enable("import"):this.buttons.disable("import")},this)},openDialog:function(e){var t=s["tenant.import.dialog.title"]+" "+e.name,n=e.isRoot()?r.ROOT_TENANT:r.TENANT;e.isRoot()&&this.addCssClasses("tenant"),this.setContent(this.importView.render({type:n,tenantId:e.id}).$el),this.setTitle(t),i.prototype.open.apply(this,arguments),this.importView.applyEpoxyBindings(),this.importView.delegateEvents(),this.$el.css("minHeight",this.$el.outerHeight())},fieldIsValid:function(){},fieldIsInvalid:function(e){},_closeImportDialog:function(){this.$el.css({minHeight:0,height:"auto",width:"auto"}),this.close()},_onImportButtonClick:function(){this.importView.doImport(),this._closeImportDialog();
}})}),define("common/component/panel/trait/collapsiblePanelTrait",["require","underscore","jquery","./abstractPanelTrait"],function(e){"use strict";function t(e,t){!t&&e.stopPropagation(),this.onCollapseControlPressed?this.onCollapseControlPressed(e):this.toggleCollapsedState()}function i(){this.$collapser&&this.$collapser.off("mousedown"),this.$el&&this.$el.find(this.expandOnDblClickSelector).off("dblclick")}var n=e("underscore"),o=e("jquery"),s=e("./abstractPanelTrait");return n.extend({},s,{onConstructor:function(e){this.collapserClass=e.collapserClass||"buttonIconToggle",this.collapserSelector=e.collapserSelector||".buttonIconToggle",this.collapsiblePanelClass=e.collapsiblePanelClass||"collapsiblePanel",this.expandOnDblClickSelector=e.expandOnDblClickSelector||"> p:first",this.allowEventPropagation=!!e.allowMouseDownEventPropagation,this.onCollapseControlPressed=e.onCollapseControlPressed},beforeSetElement:function(){i.call(this)},afterSetElement:function(){this.$el.addClass(this.collapsiblePanelClass),this.$collapser=this.$(this.collapserSelector),this.$collapser.length||(this.$collapser=o("<button></button>").addClass(this.collapserClass),this.$("> .header").prepend(this.$collapser)),this.$collapser.on("mousedown",n.bind(t,this,this.allowEventPropagation)),this.$el.find(this.expandOnDblClickSelector).on("dblclick",n.bind(t,this))},onRemove:function(){i.call(this)}})}),define("common/component/tree/trait/addToSelectionModelTrait",["require","underscore","common/component/list/model/ScalableListModel"],function(e){"use strict";var t=e("underscore"),i=e("common/component/list/model/ScalableListModel");return{afterFetchComplete:function(e,n){i.prototype.afterFetchComplete.apply(this,arguments);var o,s;t.each(e,function(e,t){e.addToSelection&&(e.selected=!0,o=e.value,s=this.get("bufferStartIndex")+t,this.selectionContains&&!this.selectionContains(o,s)&&this.addValueToSelection(o,s),delete e.addToSelection)},this)}}}),define("common/component/tree/plugin/TreePlugin",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.View.extend({dataLayerObtained:function(){},itemsRendered:function(){}},{processors:null,treeInitialized:function(){},treeRemoved:function(){}})}),define("text!common/component/tooltip/template/tooltipTemplate.htm",[],function(){return'<div class="{{- cssClasses }}" style="position: absolute; z-index: 100000;">\n    <div class="content">\n        <div class="body"></div>\n    </div>\n</div>\n'}),define("common/component/tooltip/Tooltip",["require","jquery","underscore","backbone","text!./template/tooltipTemplate.htm"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),o=e("text!./template/tooltipTemplate.htm");return n.View.extend({template:i.template(o),delay:500,offset:{x:10,y:10},attribute:"data-tooltip",cssClasses:"panel info tooltip",contentSelector:".body",triggerEvents:!1,el:function(){return this.template({cssClasses:this.cssClasses})},constructor:function(e){if(e||(e={}),!e.attachTo||0===t(e.attachTo).length)throw new Error("Tooltip should be attached to an element");if(!e.contentTemplate)throw new Error("Tooltip should have contentTemplate");this._shown=!1,this.$attachTo=t(e.attachTo),this.$attachTo[0].tooltip=this,e.delay&&(this.delay=e.delay),e.offset&&(this.offset=e.offset),e.attribute&&(this.attribute=e.attribute),e.cssClasses&&(this.cssClasses=e.cssClasses),this.contentTemplate=e.contentTemplate,this.i18n=e.i18n||{},!i.isUndefined(e.triggerEvents)&&(this.triggerEvents=e.triggerEvents),this.selector="["+this.attribute+"]",i.bindAll(this,"show","_onMouseMove","_onMouseLeave"),this.$attachTo.on("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.on("mouseleave touchend",this.selector,this._onMouseLeave),n.View.prototype.constructor.apply(this,arguments)},_render:function(e,t,o){if(this._event){e=e instanceof n.Model?e.toJSON():e;var s=i.template(this.contentTemplate)({model:e,i18n:this.i18n,options:t||{}});this.$el.find(".body").empty().append(s),this._showTooltip()}o.resolve()},show:function(e,n){var o=new t.Deferred;return this._timer=setTimeout(i.bind(this._render,this,e,n,o),this.delay),o},_showTooltip:function(){t("body").append(this.$el),this._updatePosition(),this._shown=!0,this.triggerEvents&&this.trigger("show",this)},hide:function(){this.contentTemplate&&this._timer&&clearTimeout(this._timer),this.$el.detach(),this._shown=!1,this.triggerEvents&&this.trigger("hide",this)},_updatePosition:function(){var e=this.$el.innerHeight(),i=this.$el.innerWidth(),n=t(window).height(),o=t(window).width(),s=this.offset.y,r=this.offset.x;e+this._event.pageY+this.offset.y+3>=n&&(s=-this.offset.y-e),i+this._event.pageX+this.offset.x+3>=o&&(r=-this.offset.x-i),this.$el.css({top:this._event.pageY+s,left:this._event.pageX+r})},_onMouseMove:function(e){this._event=e},_onMouseLeave:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this._event=null},remove:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this.$attachTo.off("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.off("mouseleave touchend",this.selector,this._onMouseLeave),n.View.prototype.remove.apply(this,arguments)}},{attachTo:function(e,t){var i=this;return t||(t={}),t.attachTo=e||"body",new i(t)},detachFrom:function(e){e=t(e)[0],e.tooltip&&e.tooltip.remove()}})}),define("common/component/tree/plugin/TooltipPlugin",["require","./TreePlugin","underscore","common/component/tooltip/Tooltip"],function(e){"use strict";var t=e("./TreePlugin"),i=e("underscore"),n=e("common/component/tooltip/Tooltip");return t.extend({initialize:function(e){this.tooltip=n.attachTo(e.attachTo,i.omit(e,"el")),this.listensToList=!1,t.prototype.initialize.apply(this,arguments)},itemsRendered:function(e,t){var i=this;this.listensToList||(this.listensToList=!0,this.listenTo(t,"list:item:mouseover",function(e,t){i.tooltip.show(e)}),this.listenTo(t,"list:item:mouseout",function(){i.tooltip.hide()}))},remove:function(){n.detachFrom(this.$el),this.tooltip.remove(),t.prototype.remove.apply(this,arguments)}})}),define("common/component/tree/dataprovider/DataProviderWithSearchCache",["require","underscore","jquery"],function(e){"use strict";var t=e("underscore"),i=e("jquery"),n=999,o=50,s=50,r="criteria",a=2147483647,l=function(e){t.bindAll(this,"getData"),e=e||{},this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.pageSize=e.pageSize||n,this.criteriaKey=e.searchKey||r,this.maxSearchCacheSize=e.maxSearchCacheSize||o,this.getDataByCriteriaHolder={},this.controlGetTotal="undefined"!=typeof e.controlGetTotal?e.controlGetTotal:!1,this.dataConverter=e.dataConverter,this.saveLastCriteria="undefined"!=typeof e.saveLastCriteria?e.saveLastCriteria:!1,this.lastCriteria=null,this.serialRequestsDelay="undefined"!=typeof e.serialRequestsDelay?e.serialRequestsDelay:s,this.serialRequestsDelayedPromise=null,this.request=e.request};return t.extend(l.prototype,{getData:function(e){if(e=e||{},e[this.criteriaKey])return this._getDataByCriteria(e[this.criteriaKey])(e);if("undefined"==typeof e[this.criteriaKey]&&this.saveLastCriteria&&this.lastCriteria)return this._getDataByCriteria(this.lastCriteria)(e);this.lastCriteria=null;var t=i.Deferred(),n=this._getPagesToLoad(e);return n?this._requestData(e,n,t):this._resolveDeferredUsingDataFromCache(t,e),t.promise()},clear:function(){this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.getDataByCriteriaHolder={},this.lastCriteria=null},_requestData:function(e,i,n){var o=(i[i.length-1]-i[0]+1)*this.pageSize,s=t.extend({},e,{offset:i[0]*this.pageSize,limit:o});this.controlGetTotal&&(s.skipGetTotal=!0),o>=a/this.pageSize*this.pageSize&&delete s.limit,this.controlGetTotal&&"number"!=typeof this.dataCacheTotal&&delete s.skipGetTotal,this.serialRequestsDelay>0?(clearTimeout(this.deferredTimeout),this.deferredTimeout=setTimeout(t.bind(this._requestDataDeferred,this,e,s,n),this.serialRequestsDelay)):this._requestDataDeferred(e,s,n)},_requestDataDeferred:function(e,i,n){var o=this._getPagesToLoad(e);o?this.serialRequestsDelayedPromise&&t.isEqual(i,this.serialRequestsDelayedPromise.query)?this.serialRequestsDelayedPromise.promise.done(n.resolve).fail(n.reject):(this.serialRequestsDelayedPromise={promise:n.promise(),query:i},this.request(i).done(t.bind(this._requestDone,this,e,i,n)).fail(n.reject)):this._resolveDeferredUsingDataFromCache(n,e)},_requestDone:function(e,t,i,n){this._putDataToCache(t,n),this.serialRequestsDelayedPromise=null,this._resolveDeferredUsingDataFromCache(i,e)},_resolveDeferredUsingDataFromCache:function(e,t){var i=this._getDataFromCache(t);e.resolve({total:this.dataCacheTotal,data:i})},_getPagesToLoad:function(e){var t,i=this._convertLimitOffsetToFirstLast(e),n=this._findPageIndex(i.first),o=this._findPageIndex(i.last),s=[];for(t=n;o>=t;t++)if(!this.dataCachePages[t]){s.push(t);break}for(t=o;t>=n;t--)if(!this.dataCachePages[t]){s.push(t);break}return s.length>0?s:null},_findPageIndex:function(e){return Math.floor(e/this.pageSize)},_convertLimitOffsetToFirstLast:function(e){var t=e&&e.offset?e.offset:0,i=e&&e.limit?t+e.limit-1:this.dataCacheTotal?this.dataCacheTotal-1:a;return this.dataCacheTotal&&i>this.dataCacheTotal-1&&(i=this.dataCacheTotal-1),{first:t,last:i}},_getDataFromCache:function(e){e=t.defaults(e,{offset:0,limit:a});var i=Math.max(0,e.offset),n=Math.min(i+e.limit,this.dataCacheTotal);return this.dataCache.slice(i,n)},_putDataToCache:function(e,t){var i;for("undefined"!=typeof t.total&&(this.dataCacheTotal=t.total),e.limit=e.limit||a,i=0;i<t.data.length;i++)this.dataCache[i+e.offset]=this.dataConverter?this.dataConverter(t.data[i]):t.data[i];var n=e.offset/this.pageSize,o=Math.floor((Math.min(e.limit,t.data.length)+e.offset-1)/this.pageSize);for(i=n;o>=i;i++)this.dataCachePages[i]=!0},_getDataByCriteria:function(e){if(!this.getDataByCriteriaHolder[e]){var t,i=Number.MAX_VALUE,n=0,o=0;for(var s in this.getDataByCriteriaHolder)if(this.getDataByCriteriaHolder.hasOwnProperty(s)){o+=1;var r=this.getDataByCriteriaHolder[s];r.index<i&&(i=r.index,t=s),r.index>n&&(n=r.index)}o>=this.maxSearchCacheSize&&delete this.getDataByCriteriaHolder[t],this.getDataByCriteriaHolder[e]={getData:this._createDataProviderForCriteria(e),index:n+1}}return this.lastCriteria=e,this.getDataByCriteriaHolder[e].getData},_createDataProviderForCriteria:function(e){var i=this.request,n=this,o=new l({pageSize:this.pageSize,dataConverter:this.dataConverter,serialRequestsDelay:this.serialRequestsDelay,searchKey:this.criteriaKey,controlGetTotal:this.controlGetTotal,request:function(o){var s=t.extend({},o);return s[n.criteriaKey]=e,i(s)}}),s=o.getData;return o.getData=function(e){var i=t.extend({},e);return delete i[n.criteriaKey],s.call(o,i)},o.getData}}),l}),define("common/component/tree/TreeLevel",["require","underscore","common/component/panel/Panel","common/component/panel/trait/collapsiblePanelTrait","common/component/list/view/ListWithSelection","common/component/tree/trait/addToSelectionModelTrait","common/component/list/model/ListWithSelectionModel","common/component/tree/plugin/TooltipPlugin","./dataprovider/DataProviderWithSearchCache"],function(e){"use strict";function t(){this.$el.removeClass(this.loadingClass).addClass(this.openClass),l.invoke(this.plugins,"itemsRendered",this.list.model,this.list);var e=this.list.$("> .j-view-port-chunk > ul > li").addClass(this.cid).length,t=l.isFunction(this.levelHeight)?this.levelHeight():this.levelHeight;t&&e*this.listItemHeight>t?this.list.$el.css({height:t+"px","overflow-y":"auto"}):this.list.$el.css({height:"auto",overflow:"auto"}),this.list._calcViewPortHeight(),this._isReady=!0,this.trigger("ready",this)}function i(e,t){this.listRenderError=!0,this.trigger("listRenderError",e,t,this)}function n(e){var t=[];l.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||a(this),this.trigger("selection:change",t,this,[])}function o(e){var t=[];l.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||a(this),this.trigger("item:dblclick",t)}function s(e,t){for(var i=0;i<t.length;i++)if(t[i]===e)return!0}function r(e,t,i,n){i&&i.exclude&&l.isArray(i.exclude)&&s(e,i.exclude)||(void 0===n||n>0)&&l.chain(e.items).keys().each(function(o){i&&i.exclude&&l.isArray(i.exclude)&&s(e.items[o],i.exclude)||t.call(e.items[o],i),r(e.items[o],t,i,void 0===n?n:--n)})}function a(e,t){t=t&&{exclude:t.exclude},r(e,function(e){this.list.clearSelection(),this.list.model.selection=[]},t)}var l=e("underscore"),d=e("common/component/panel/Panel"),u=e("common/component/panel/trait/collapsiblePanelTrait"),c=e("common/component/list/view/ListWithSelection"),h=e("common/component/tree/trait/addToSelectionModelTrait"),p=e("common/component/list/model/ListWithSelectionModel").extend(h),m=(e("common/component/tree/plugin/TooltipPlugin"),e("./dataprovider/DataProviderWithSearchCache"));return d.extend({constructor:function(e){e||(e={}),l.extend(e,{traits:[u]}),d.prototype.constructor.call(this,e)},initialize:function(e){e||(e={}),this._isReady=!1,this.item=e.item||{},this.id=this.item.id,this.owner=e.owner,this.parent=e.parent,this.itemsTemplate=e.itemsTemplate,this.listItemHeight=e.listItemHeight,this.levelHeight=e.levelHeight,this.lazyLoad=!!e.lazyLoad,this.selection=e.selection||{allowed:!1,multiple:!1},this.resource=this.item.value,this.bufferSize=e.bufferSize,this.cache="undefined"!=typeof e.cache?e.cache:!1,this.allowMouseDownEventPropagation=e.allowMouseDownEventPropagation,this.items={},this.plugins=[];for(var t={el:this.el,model:this.model},i=0,n=e.plugins.length;n>i;i++){var o=e.plugins[i].constr;this.plugins.push(new o(l.extend({},t,e.plugins[i].options)))}this.dataLayer=this.owner.getDataLayer(this),l.invoke(this.plugins,"dataLayerObtained",this.dataLayer),d.prototype.initialize.apply(this,arguments)},render:function(){var e=new p({bufferSize:this.bufferSize,getData:this._getDataProvider(this.cache)});return this.list=new c({markerClass:"."+this.cid,eventListenerPattern:"."+this.cid+":not(.readonly) > p",el:this.$contentContainer,itemsTemplate:this.itemsTemplate,listItemHeight:this.listItemHeight,lazy:!0,selection:this.selection,allowMouseDownEventPropagation:this.allowMouseDownEventPropagation,model:e}),this.list.on("render:data",l.bind(t,this)),this.list.on("listRenderError",l.bind(i,this)),this.list.on("selection:change",l.bind(n,this)),this.list.on("item:dblclick",l.bind(o,this)),this.lazyLoad?this.on("open",this._onOpen,this):this.list.renderData(),this},_getDataProvider:function(e){var t=this,i=l.bind(function(e){return this.obtainData(e,t)},this.dataLayer),n={};return e&&("object"==typeof e&&(n=l.extend(n,e)),n.request=n.request||i,this.dataProvider=new m(n),i=this.dataProvider.getData),function(e){return e||(e={offset:0,limit:100}),e.id=t.id,i(l.extend({},t.owner.context,e),t)}},_onOpen:function(){this.$el.removeClass(this.openClass).addClass(this.loadingClass),this.list.renderData()},setElement:function(e){var t=d.prototype.setElement.apply(this,arguments);return this.list&&(this.list.setElement(this.$contentContainer),this.list.totalItems=-1),l.each(this.plugins,function(t){t.setElement(e)}),this.lazyLoad||this.list&&this.list.renderData(),this.collapsed||(this.open({silent:!0,depth:0}),this.lazyLoad&&this.list.renderData()),t},open:function(e){r(this,d.prototype.open,e,e?e.depth:0),d.prototype.open.call(this,e)},close:function(e){d.prototype.close.call(this,e),r(this,d.prototype.close,e,e?e.depth:void 0),a(this)},getLevel:function(e){return l(this.items).reduce(function(t,i){return t||(i.id===e?i:i.getLevel(e))},!1)},refresh:function(e){this.listRenderError||(this.lazyLoad&&!this.collapsed||!this.lazyLoad?(this.once("ready",l.bind(r,this,this,this.refresh,e,1)),this.list.model.fetch({top:0,bottom:this.list.model.bufferSize,force:!0}),this.list.scrollTo(0)):(this.list.model.set("bufferStartIndex",void 0,{silent:!0}),this.list.model.set("bufferEndIndex",void 0,{silent:!0}),this.list.model.set("total",void 0,{silent:!0}),r(this,this.refresh,e)))},fetch:function(e,t){this.list.fetch(t,e)},recalcConstraints:function(){this.list.resize()},fetchVisibleData:function(){this.list._fetchVisibleData()},resetSelection:function(e){a(this,e),e&&e.silent||this.trigger("selection:change",[])},hasItems:function(){return!!this.$("> .subcontainer > .j-view-port-chunk > ul > li").length},clearCache:function(){l.each(this.items,function(e){e.clearCache()}),this.dataProvider&&this.dataProvider.clear()},remove:function(){var e=this,t=-1;if(l.forEach(l.keys(this.items),function(t){e.items[t].remove()}),this.dataProvider&&this.dataProvider.clear(),this.list.remove(),this.parent){var i=this.parent.id,n=this.owner.getDataLayer(i);if(n&&n.predefinedData&&n.predefinedData[i]&&l.isArray(n.predefinedData[i])){for(var o=0;o<n.predefinedData[i].length;o++)if(n.predefinedData[i][o].id===this.id){t=o;break}t>-1&&(n.predefinedData[i].splice(t,1),delete n.predefinedData[this.id])}delete this.parent.items[this.id]}d.prototype.remove.apply(this,arguments)},isReady:function(){return this._isReady}})}),define("common/component/tree/TreeDataLayer",["require","underscore","jquery","common/util/classUtil","./TreeLevel","common/util/xssUtil","request"],function(e){"use strict";function t(e,t){return n.call(this,i.call(this,e),t)}function i(e){for(var t=0,i=e.length;i>t;t++)e[t]={id:this.extractId(e[t]),value:e[t]};return e}function n(e,t){var i,n;if(this.processors&&this.processors.length)for(var o=0,s=this.processors.length;s>o;o++){i=[];for(var r=0,a=e.length;a>r;r++)n=this.processors[o].processItem(e[r],t,this),n&&i.push(n);e=i}return e}var o=e("underscore"),s=e("jquery"),r=e("common/util/classUtil"),a=(e("./TreeLevel"),e("common/util/xssUtil")),l=e("request");return r.extend({constructor:function(e){this.requestType=e.requestType?e.requestType:"GET",e.getDataUri&&(this.getDataUri=e.getDataUri),this.getDataUri||(this.getDataUri=o.template(e.dataUriTemplate)),e.getDataArray&&(this.getDataArray=e.getDataArray),e.getDataSize&&(this.getDataSize=e.getDataSize),e.extractId&&(this.extractId=e.extractId),this.levelDataId=e.levelDataId?e.levelDataId:"id",this.processors=e.processors||[],this.initialize(e)},initialize:function(e){},extractId:function(e){return e[this.levelDataId]},getDataSize:function(e,t,i){return this.getDataArray(e,t,i).length},getDataArray:function(e,t,i){return e},obtainData:function(e,i){var n=new s.Deferred,o=this;return this.predefinedData&&this.predefinedData[e.id]?n.resolve({total:this.predefinedData[e.id].length,data:this.predefinedData[e.id]}):l({type:this.requestType,dataType:this.dataType||"json",headers:{Accept:this.accept||"application/json","Content-Type":this.contentType||void 0},cache:!1,data:this.data||void 0,url:this.getDataUri(e)}).done(function(){var i=a.escape(arguments[0],{softHTMLEscape:!0});o.dataSize=o.getDataSize.call(o,i,e,arguments[2]),n.resolve({total:o.dataSize,data:t.call(o,o.getDataArray.call(o,i,e,arguments[2]),e)})}).fail(function(e){n.reject(e.status,e.responseText)}),n},_process:t})}),define("text!common/component/tree/template/treeLevelListTemplate.htm",[],function(){return'<ul class="list collapsible folders" style="top: {{- top}}px; position: relative;">\n    {{ _.each(items, function(item){ }}\n    <li class="{{- item._node ? \'node closed\' : \'leaf\'}} {{- item.selected ? \'selected\' : \'\'}}" data-index="{{- item.index }}" tabindex="-1">\n        <p class="wrap button draggable" data-tooltip="{{- item.value.label }}"><b class="icon"/> {{- item.value.label }} </p>\n        <div class="subcontainer" />\n    </li>\n    {{ }) }}\n</ul>\n'}),define("text!common/component/tree/template/treeLevelTemplate.htm",[],function(){return'<div>\n    <ul class="list collapsible folders">\n        <li class="node">\n            <p class="wrap button">\n                <b class="icon" id="handler2" title=""></b>root\n            </p>\n            <div class="subcontainer"/>\n        </li>\n    </ul>\n</div>'}),define("common/component/tree/Tree",["require","css!lists","jquery","underscore","backbone","./TreeLevel","./TreeDataLayer","text!./template/treeLevelListTemplate.htm","text!./template/treeLevelTemplate.htm"],function(e){"use strict";function t(e){var i=e.list.model.get("items"),o=this;i=n.where(i,{_node:!0}),e.$(".node").each(function(r,a){var l=i[r].id;e.items[l]?e.items[l].setElement(a):(e.items[l]=new s(n.extend({},o._options,{el:a,item:i[r],parent:e})),o.listenTo(e.items[l],"listRenderError",n.bind(function(e,t,i){this.trigger("levelRenderError",e,t,i)},o)),e.listenTo(e.items[l],"ready",n.bind(t,o)),e.listenTo(e.items[l],"selection:change",function(t,i,n){i&&n.push(i),e.list.model.clearSelection(),e.trigger("selection:change",t,e,n)}),e.listenTo(e.items[l],"item:dblclick",function(t){e.list.model.clearSelection(),e.trigger("item:dblclick",t)}),e.items[l].render())}).length&&e.$(".j-view-port-chunk").css({height:"auto"})}e("css!lists");var i=e("jquery"),n=e("underscore"),o=e("backbone"),s=e("./TreeLevel"),r=e("./TreeDataLayer"),a=e("text!./template/treeLevelListTemplate.htm"),l=e("text!./template/treeLevelTemplate.htm"),d={ADD:"add",UPDATE:"update"},u=o.View.extend({template:n.template(l),_plugins:[],el:function(){return this.template()},constructor:function(e){e||(e={}),this.defaultDataLayer=new r(e),this.customDataLayers=e.customDataLayers,e.type?(this._type=e.type,e.type=void 0):this._type="tree",e.collapserSelector||(e.collapserSelector="b.icon:eq(0)"),e.predefinedData?(this.defaultDataLayer.predefinedData=e.predefinedData,e.predefinedData=void 0):this.defaultDataLayer.predefinedData={},e.rootless&&(this.rootless=e.rootless,e.rootless=void 0),e.additionalCssClasses&&(this.additionalCssClasses=e.additionalCssClasses,e.additionalCssClasses=void 0),e.getDataLayer&&(this.getDataLayer=e.getDataLayer,e.getDataLayer=void 0),this._options=n.extend({itemsTemplate:a,plugins:this._plugins,owner:this},e),this.context=e.context||{};for(var t=0,i=this._plugins.length;i>t;t++)this._plugins[t].processors&&(this.processors=this.processors.concat(this._plugins[t].processors));o.View.apply(this,arguments)},initialize:function(e){this.rootLevel=new s(n.extend({},this._options,{levelHeight:e.rootLevelHeight},{el:this.$("li")[0]},{item:{id:"/",value:{id:"/",resourceType:"folder"}}})),this.rootless&&this.$el.find("ul:first").addClass("hideRoot"),this.additionalCssClasses&&this.$el.find("ul:first").addClass(this.additionalCssClasses),this.listenTo(this.rootLevel,"ready",n.bind(t,this)),this.listenTo(this.rootLevel,"selection:change",n.bind(function(e,t,i){t&&i&&n.isArray(i)&&(this.rootLevel.selection.multiple||this.rootLevel.resetSelection({silent:!0,exclude:[i[0]]})),this.trigger("selection:change",e)},this)),this.listenTo(this.rootLevel,"item:dblclick",n.bind(function(e){this.trigger("item:dblclick",e)},this));for(var i=0,o=this._plugins.length;o>i;i++)this._plugins[i].constr.treeInitialized.call(this,this._plugins[i].options);this.rootLevel.render(),e.collapsed&&e.lazyLoad&&this.rootless&&this.expand("/")},remove:function(){for(var e=0,t=this._plugins.length;t>e;e++)this._plugins[e].constr.treeRemoved.call(this);this.rootLevel.remove(),o.View.prototype.remove.apply(this,arguments)},expand:function(e,t){var i=this.getLevel(e);return i&&i.open(t),this},collapse:function(e,t){var i=this.getLevel(e);return i&&i.close(t),this},_getNodeById:function(e){var t,i,o=this.getLevel(e);if(o)return o.parent?(t=o.parent.list,{node:o.item,nodeElement:o.$el,itsList:t}):null;var s=!1;if("list"===this._type)s=this.rootLevel;else if("tree"===this._type){var r=e.split("/");if(r=r.slice(0,r.length-1).join("/"),""===r&&(r="@fakeRoot"),s=this.getLevel(r),!s)return null}return s?(t=s.list,i=n.find(t.model.get("items"),function(t){return t.id===e}),i?{node:i,nodeElement:t.$el.find("li.leaf.selected"),itsList:t}:null):null},select:function(e){var t=this._getNodeById(e);t&&(t.itsList.model.clearSelection().addValueToSelection(t.node.value,t.node.index),this.trigger("selection:change",t.itsList.getValue()))},deselect:function(e){},addItem:function(e,t){var i=this.getLevel(e),n=d.ADD;return i&&this._getNodeItems(e,i,t,n),this},updateItem:function(e,t){var i=t?this.getLevel(t):this.rootLevel;return i&&this._getNodeItems(i.id,i,e),this},resetSelection:function(e){return this.rootLevel.list.clearSelection(),this.rootLevel.list.model.selection=[],this.rootLevel.resetSelection(e),this},refresh:function(e){e&&(this.context=e),this.rootLevel.refresh()},recalcConstraints:function(){this.rootLevel.recalcConstraints()},fetchVisibleData:function(){this.rootLevel.fetchVisibleData()},clearCache:function(){this.rootLevel.clearCache()},getLevel:function(e){return this.rootLevel.id===e?this.rootLevel:this.rootLevel.getLevel(e)},getDataLayer:function(e){return this.customDataLayers&&this.customDataLayers[e.id]?this.customDataLayers[e.id]:this.defaultDataLayer},_addItem:function(e,t,i){return!n.findWhere(e,{id:i.id})&&e.push(i),e},_updateItem:function(e,t){return n.each(e,function(e){e.id===t.id&&n.extend(e,t)},this),e},_getNodeItems:function(e,t,i,o){var s,r=this.getDataLayer(t),a=t.list.model.get("items")?t.list.model.get("items"):[];r.predefinedData=r.predefinedData||{},s=o===d.ADD?this._addItem(a,e,i):this._updateItem(a,i),r.predefinedData[e]=n.sortBy(s,"label"),t.fetch({force:!0,keepPosition:!0})},_selectTreeNode:function(e,t){if(n.isString(e)&&""!==e){var o=n.bind(function(){var s=n.bind(function(){var i=e;if("/"===i&&(i="@fakeRoot"),this.expand(i),this.select(i),"list"===this._type)this.rootLevel.on("ready",o);else if("tree"===this._type&&t&&t.length){var n=this.$el,s=this._getNodeById(i);if(!s)return;var r=s.nodeElement;if(!r)return;var a=r.offset().top-n.offset().top-t.height()/2+r.height()/2;t.scrollTop(a)}},this);if("/"===e||"/public"===e||"list"===this._type)s();else{var r=e.replace(/\/$/,""),a=r.substr(0,r.lastIndexOf("/"));a=a||"/";var l=new i.Deferred;this._openPath(a,l,0),l.done(s)}},this);this.rootLevel.isReady()?o():this.rootLevel.on("ready",o)}},_openPath:function(e,t,i){if(!e)return t.resolve();var o,s,r,a=this;return"/"===e?s=["/"]:(s=e.split("/"),s[0]="/"),"/"===s[0]&&"public"===s[1]&&(s=n.union(["/public"],n.rest(s,2))),i=i||0,i===s.length?t.resolve():(o=n.first(s,i+1).join("/"),"/"===o&&(o="@fakeRoot"),o=o.replace(/\/\//g,"/"),r=this.getLevel(o),void(r&&(r.collapsed?(r.once("ready",function(){a._openPath(e,t,i+1)}),r.open()):this._openPath(e,t,i+1))))}},{instance:function(e){return new this(e)}});return{use:function(e,t){return function(e){return{use:function(t,i){return e.prototype._plugins.push({constr:t,options:i}),this},create:function(){return e}}}(u.extend({_plugins:[{constr:e,options:t}]}))},create:function(){return u}}}),define("common/component/tree/plugin/ContextMenuTreePlugin",["require","./TreePlugin","underscore","jquery"],function(e){"use strict";var t=e("./TreePlugin"),i=e("underscore"),n=(e("jquery"),i.memoize(function(e){var t=i.map(e.options,function(e){return e.model.get("action")});return t},function(e){return e.cid}));return t.extend({initialize:function(e){if(!e)throw new Error("Initialization error. Options required.");if(this.contextMenus=e.contextMenus,this.contextMenu=e.contextMenu,this.defaultSelectedItems=e.defaultSelectedItems||function(){},!this.contextMenus&&!this.contextMenu)throw new Error("contextMenu or contextMenus must be specified.");if(this.showContextMenuCondition=e.showContextMenuCondition,!this.showContextMenuCondition&&!this.contextMenu)throw new Error("contextMenu must be specified for default behaviour");!this.showContextMenuCondition&&(this.showContextMenuCondition=function(){return this.contextMenu}),this.model=e.model,t.prototype.initialize.apply(this,arguments)},itemAction:function(e){var t=e.get("action");this.treeItem.action=t},itemsRendered:function(e,t){var i=this;this.listenTo(t,"list:item:contextmenu",function(e,t){if(this.currentContextMenu=i.showContextMenuCondition(e),this.lastContextMenu&&this.lastContextMenu.hide(),this.lastContextMenu=this.currentContextMenu,this.currentContextMenu){this.currentContextMenu.treeItem=e;var o=this.currentContextMenu.treeItem.action;o||(o=i.defaultSelectedItems.call(this.currentContextMenu,e,n(this.currentContextMenu)))?this.currentContextMenu.resetSelection([o]):this.currentContextMenu.resetSelection(),this.currentContextMenu.show({left:t.pageX,top:t.pageY}),this.listenTo(this.currentContextMenu.collection,"select",function(e,t){this.itemAction.call(this.currentContextMenu,t)},this)}},this)},remove:function(){this.stopListening(),this.contextMenu&&this.contextMenu.remove()}})}),define("tenantImportExport/view/tenantTree",["require","common/component/tree/Tree","jquery","underscore","common/component/tree/TreeDataLayer","common/component/tree/plugin/TooltipPlugin","common/component/tree/plugin/ContextMenuTreePlugin","bundle!CommonBundle","jrs.configs"],function(e){"use strict";var t=e("common/component/tree/Tree"),i=e("jquery"),n=e("underscore"),o=e("common/component/tree/TreeDataLayer"),s=e("common/component/tree/plugin/TooltipPlugin"),r=e("common/component/tree/plugin/ContextMenuTreePlugin"),a=e("bundle!CommonBundle"),l=e("jrs.configs"),d={tenantProcessor:function(e){return{processItem:function(t){return t._node=!0,t.label=t.value.tenantName,t.value.label=t.label,t.value.uri=t.value.tenantUri,t.id===e&&(t.addToSelection=!0),t}}}};return function(e){var u=e.comparator,c=t.use(s,{i18n:a,contentTemplate:e.tooltipContentTemplate});return e.contextMenu&&(c=c.use(r,{contextMenu:e.contextMenu})),c.create().instance(n.extend({},{selection:{allowed:{left:!0,right:!0},multiple:!1},rootless:!0,collapsed:!0,lazyLoad:!0,bufferSize:5e3,allowMouseDownEventPropagation:!0,dataUriTemplate:l.contextPath+"/rest_v2/organizations?{{= id != 'organizations' ? 'rootTenantId=' + id : ''}}&offset={{= offset }}&limit={{= limit }}&maxDepth=1",levelDataId:"id",getDataArray:function(e,t,i){var n=e?e.organization:[];return u&&n.sort(u),n},processors:[d.tenantProcessor(e.tenantId)],customDataLayers:{"/":n.extend(new o({dataUriTemplate:l.contextPath+"/flow.html?_flowId=treeFlow&method=getNode&provider=tenantTreeFoldersProvider&uri=/",processors:[d.tenantProcessor(e.tenantId)],getDataArray:function(e){return e=JSON.parse(i(e).text()),[{id:e.id,tenantName:e.label,tenantUri:"/",resourceType:"folder",_links:{content:"@fakeContentLink"}}]}}),{accept:"text/html",dataType:"text"})}}))}}),define("text!common/component/menu/template/menuOptionTemplate.htm",[],function(){return'<li class="leaf" {{ if(typeof(groupId)!== "undefined") { }} data-groupId = {{- groupId }} {{ } }} >\n    <p class="wrap button"><span class="icon"></span>{{- label }}</p>\n</li>'}),define("text!common/component/menu/template/menuContainerTemplate.htm",[],function(){return'<div class="menu vertical dropDown fitable" tabindex="-1" style="z-index: 99999; display: none;">\r\n    <div class="content">\r\n        <ul></ul>\r\n    </div>\r\n</div>'}),define("common/component/menu/Menu",["require","jquery","underscore","../base/OptionContainer","text!./template/menuOptionTemplate.htm","text!./template/menuContainerTemplate.htm","css!menu"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("../base/OptionContainer"),o=e("text!./template/menuOptionTemplate.htm"),s=e("text!./template/menuContainerTemplate.htm");return e("css!menu"),n.extend({constructor:function(e,t){if(!e||!i.isArray(e)||0===e.length)throw new Error("Menu should have options");t||(t={}),n.call(this,{options:e,collection:t.collection,mainTemplate:t.menuContainerTemplate||s,optionTemplate:t.menuOptionTemplate||o,toggle:t.toggle,toggleClass:t.toggleClass}),this.maxSize=t.maxSize,this._onConstructor&&this._onConstructor(e,t)},initialize:function(){n.prototype.initialize.apply(this,arguments),t("body").append(this.$el),this._onInitialize&&this._onInitialize()},show:function(){var e=n.prototype.show.apply(this,arguments);return this.applyMaxSize(),e},applyMaxSize:function(){this.maxSize&&this.options.length>this.maxSize&&this.$el.css({"overflow-y":"auto",
"max-height":this.maxSize*this.options[0].$el.height()+"px"})}})}),define("common/component/menu/ContextMenu",["require","./Menu","jquery","underscore"],function(e){"use strict";var t=e("./Menu"),i=e("jquery"),n=e("underscore");return t.extend({constructor:function(e,i){t.call(this,e,i),n.bindAll(this,"_tryHide"),this.topPadding=i&&i.topPadding||5,this.leftPadding=i&&i.leftPadding||5,this.hideOnMouseLeave=i&&i.hideOnMouseLeave||!1,this.hideOnMouseLeave&&this.$el.on("mouseleave",this._tryHide)},_tryHide:function(){this.hide(),this._signOffTryHide()},_signOffTryHide:function(){i(document.body).off("click.contextMenu",this._tryHide)},show:function(e,o){if(!e||!n.isNumber(e.top)||!n.isNumber(e.left))throw new Error("Required params (top, left) missing: "+JSON.stringify(e));i(document.body).on("click.contextMenu",this._tryHide);var s=e.top,r=e.left,a=this.topPadding,l=this.leftPadding,d=i("body"),u=this.$el.height(),c=this.$el.width(),h=o?o.height():d.height(),p=o?o.width():d.width(),m=o?o.offset():d.offset(),g=h-e.top,f=p-e.left;return u>g&&(s=e.top-u-a,s<m.top&&(s+=m.top-s+a),s=0>s?h/2-u/2:s),c>f&&(r=e.left-c-l,r<m.left&&(r+=m.left-r+l),r=0>r?p/2-c/2:r),n.extend(this,{top:s,left:r}),this.$el.css({top:this.top,left:this.left}),t.prototype.show.apply(this,arguments)},remove:function(){this._signOffTryHide(),this.hideOnMouseLeave&&this.$el.off("mouseleave",this._tryHide),t.prototype.remove.apply(this,arguments)}})}),define("text!tenantImportExport/templates/tooltipTemplate.htm",[],function(){return'{{ if (model.value.tenantDesc) { }}\n<!--<p class="message label">{{- i18n[\'tooltip.description\'] }}</p><p class="message">{{- model.value.tenantDesc }}</p>-->\n{{ } }}\n{{ if (model.value.uri) { }}\n<p class="message label">{{- i18n[\'tooltip.path\'] }}</p><p class="message">{{- model.value.uri }}</p>\n{{ } }}'}),define("tenantImportExport/view/TenantsTreeView",["require","jquery","underscore","backbone","bundle!ImportExportBundle","tenantImportExport/export/view/ExportDialogView","tenantImportExport/import/view/ImportDialogView","tenantImportExport/view/tenantTree","common/component/menu/ContextMenu","text!tenantImportExport/templates/tooltipTemplate.htm"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),o=e("bundle!ImportExportBundle"),s=e("tenantImportExport/export/view/ExportDialogView"),r=e("tenantImportExport/import/view/ImportDialogView"),a=e("tenantImportExport/view/tenantTree"),l=e("common/component/menu/ContextMenu"),d=e("text!tenantImportExport/templates/tooltipTemplate.htm"),u="organizations",c=n.View.extend({initialize:function(e){this.$container=t(e.container);var n=window.localStorage?JSON.parse(localStorage.getItem("selectedTenant")):null,c=e.selectedTenant||n,h=e.currentUser?e.currentUser.split("|")[1]||u:"/"===c.tenantUri?c.tenantId||u:u;this.splittedUri=i.compact(c.tenantUri.split("/")),this.splittedUri.splice(this.splittedUri.length-1,1),this.splittedUri.unshift(h);var p={tooltipContentTemplate:d,tenantId:c.id||h,comparator:e.comparator};e.removeContextMenuTreePlugin||(this.contextMenu=new l([{label:o["context.menu.option.export"],action:"export"},{label:o["context.menu.option.import"],action:"import"}],{hideOnMouseLeave:!0}),i.extend(p,{contextMenu:this.contextMenu}),this.listenTo(this.contextMenu,"option:export",this._onExport),this.listenTo(this.contextMenu,"option:import",this._onImport)),this.exportDialog=new s,this.importDialog=new r,this.tree=new a(p),this._initEvents()},render:function(){this.$container.append(this.tree.render().$el)},refreshTenant:function(e){var t=this.tree.getLevel(e);this.tree.getDataLayer(t).predefinedData=[],e?t.refresh():this.tree.refresh()},getTenant:function(){return this.selectedTenant},setTenant:function(e,t,i){t?this.selectedTenant[t]=i:this.selectedTenant=e},selectTenant:function(e){this.tree.select(e)},addTenant:function(e,t){var i=this.tree.getLevel(e);this.listenToOnce(i,"ready",function(){this.tree.addItem(e,this._processItem(t,!0))}),i.open()},updateTenant:function(e,t,i){this.tree.updateItem(this._processItem(t,!1,i),e)},removeTenant:function(e,t){var n,o=this.tree.getLevel(t);e=i.isArray(e)?e:[e],i.each(e,function(e){n=this.tree.getLevel(e),n&&n.remove()},this),o.refresh(),o.open()},remove:function(){this.tree.remove(),this.contextMenu&&this.contextMenu.remove()},_processItem:function(e,t,i){var n=e.tenantId||e.id,o=e.tenantFolderUri||e.tenantUri,s=e.tenantName,r={id:n,label:s,uri:o,tenantUri:o,parentId:e.parentId};return t?{_node:!0,id:n,label:s,value:r}:{id:e.tenantId,addToSelection:i,label:s,value:r}},_initEvents:function(){this.expandedLevels=[],this.listenTo(this.tree,"selection:change",function(e){this.trigger("selection:change",i.compact(e)[0])}),this.listenTo(this.importDialog,"import:finished",function(e){this.refreshTenant(e),this.trigger("import:finished",e)}),this._recursivelyOpenLevels(this.tree.rootLevel)},_recursivelyOpenLevels:function(e){this.listenTo(e,"ready",function(){var e=this.tree.getLevel(this.splittedUri[0]);this.splittedUri.splice(0,1),e?(this.expandedLevels.push(e),this.tree.expand(e.id),this._recursivelyOpenLevels(e)):i.each(this.expandedLevels,function(e){this.stopListening(e,"ready")},this)})},_onExport:function(){this.exportDialog.openTenantDialog(this.selectedTenant)},_onImport:function(){this.importDialog.openDialog(this.selectedTenant)}});return c}),define("attributes/enum/attributesTypesEnum",[],function(){return{USER:"user",TENANT:"tenant",SERVER:"server"}}),function(e,t){if("function"==typeof define&&define.amd)define("backbone.marionette",["backbone","underscore"],function(i,n){return e.Marionette=e.Mn=t(e,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=t(e,i,n)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,i){"use strict";!function(e,t){var i=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===i?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._views),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(e,t),e.ChildViewContainer.VERSION="0.1.5",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),function(e,t){var i=e.Wreqr,n=e.Wreqr={};return e.Wreqr.VERSION="1.3.1",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var i=this.getCommands(e);i.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),i}(),n.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,i)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,i,n){var o=this.storage.getCommands(e);t.each(o.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n),n.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.hasHandler(e)?this.getHandler(e).apply(this,t):void 0}})}(n),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(i){var n=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(n.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var o="vent"===e?"on":"setHandler";t.each(i,function(i,s){this[e][o](s,t.bind(i,n))},this)}}}),n}(n),n.radio=function(e){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=o(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},o=function(e,t,i){return function(n){var o=e._getChannel(n)[t],s=Array.prototype.slice.call(arguments,1);return o[i].apply(o,s)}};return new i}(n),e.Wreqr}(t,i);var n=e.Marionette,o=t.Marionette={};o.VERSION="2.3.2",o.noConflict=function(){return e.Marionette=n,this},t.Marionette=o,o.Deferred=t.$.Deferred,o.extend=t.Model.extend,o.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},o.getOption=function(e,t){return e&&t?e.options&&void 0!==e.options[t]?e.options[t]:e[t]:void 0},o.proxyGetOption=function(e){return o.getOption(this,e)},o._getValue=function(e,t,n){return i.isFunction(e)&&(n=n||[],e=e.apply(t,n)),e},o.normalizeMethods=function(e){return i.reduce(e,function(e,t,n){return i.isFunction(t)||(t=this[t]),t&&(e[n]=t),e},{},this)},o.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return t[e.slice(4)]})},o.normalizeUIKeys=function(e,t){return i.reduce(e,function(e,i,n){var s=o.normalizeUIString(n,t);return e[s]=i,e},{})},o.normalizeUIValues=function(e,t){return i.each(e,function(n,s){i.isString(n)&&(e[s]=o.normalizeUIString(n,t))}),e},o.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=i.values(i.result(this,t)),o=[e].concat(i.toArray(arguments));return i[n].apply(i,o)}})};var s=o.deprecate=function(e,t){i.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||s._cache[e]||(s._warn("Deprecation warning: "+e),s._cache[e]=!0)};s._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},s._cache={},o._triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi;return function(n,o,s){var r=arguments.length<3;r&&(s=o,o=s[0]);var a,l="on"+o.replace(t,e),d=n[l];return i.isFunction(d)&&(a=d.apply(n,r?i.rest(s):s)),i.isFunction(n.trigger)&&(r+s.length>1?n.trigger.apply(n,r?s:[o].concat(i.rest(s,0))):n.trigger(o)),a}}(),o.triggerMethod=function(e){return o._triggerMethod(this,arguments)},o.triggerMethodOn=function(e){var t=i.isFunction(e.triggerMethod)?e.triggerMethod:o.triggerMethod;return t.apply(e,i.rest(arguments))},o.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,s()}function n(){e._isRendered=!0,s()}function s(){e._isShown&&e._isRendered&&o.isNodeAttached(e.el)&&i.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}e.on({show:t,render:n})},function(e){function t(t,n,o,s){var r=s.split(/\s+/);i.each(r,function(i){var s=t[i];if(!s)throw new e.Error('Method "'+i+'" was configured as an event handler, but does not exist.');t.listenTo(n,o,s)})}function n(e,t,i,n){e.listenTo(t,i,n)}function o(e,t,n,o){var s=o.split(/\s+/);i.each(s,function(i){var o=e[i];e.stopListening(t,n,o)})}function s(e,t,i,n){e.stopListening(t,i,n)}function r(t,n,o,s,r){if(n&&o){if(!i.isObject(o))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});o=e._getValue(o,t),i.each(o,function(e,o){i.isFunction(e)?s(t,n,o,e):r(t,n,o,e)})}}e.bindEntityEvents=function(e,i,o){r(e,i,o,n,t)},e.unbindEntityEvents=function(e,t,i){r(e,t,i,s,o)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(o);var r=["description","fileName","lineNumber","name","message","number"];return o.Error=o.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+o.VERSION+"/",constructor:function(e,t){i.isObject(e)?(t=e,e=t.message):t||(t={});var n=Error.call(this,e);i.extend(this,i.pick(n,r),i.pick(t,r)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,o.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),o.Error.extend=o.extend,o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),o.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,t.Events,{destroy:function(){return o._triggerMethod(this,"before:destroy",arguments),o._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:o.triggerMethod,getOption:o.proxyGetOption}),o.Object=function(e){this.options=i.extend({},i.result(this,"options"),e),this.initialize.apply(this,arguments)},o.Object.extend=o.extend,i.extend(o.Object.prototype,t.Events,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening()},triggerMethod:o.triggerMethod,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Region=o.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new o.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),o.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e);var i=t||{},n=e!==this.currentView,s=!!i.preventDestroy,r=!!i.forceShow,a=!!this.currentView,l=n&&!s,d=n||r;if(a&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&delete this.currentView._parent,l?this.empty():a&&d&&this.currentView.off("destroy",this.empty,this),d){e.once("destroy",this.empty,this),e.render(),e._parent=this,a&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),o.triggerMethodOn(e,"before:show",e,this,t),a&&this.triggerMethod("swapOut",this.currentView,this,t);var u=o.isNodeAttached(this.el),c=[],h=i.triggerBeforeAttach||this.triggerBeforeAttach,p=i.triggerAttach||this.triggerAttach;return u&&h&&(c=this._displayedViews(e),this._triggerAttach(c,"before:")),this.attachHtml(e),this.currentView=e,u&&p&&(c=this._displayedViews(e),this._triggerAttach(c)),a&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),o.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var n=(t||"")+"attach";i.each(e,function(e){o.triggerMethodOn(e,n,e,this)},this)},_displayedViews:function(e){return i.union([e],i.result(e,"_getNestedViews")||[])},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new o.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new o.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,o._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(){var e=this.currentView;if(e)return e.off("destroy",this.empty,this),this.triggerMethod("before:empty",e),this._destroyView(),this.triggerMethod("empty",e),delete this.currentView,this},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&(e.remove(),e.isDestroyed=!0)},attachView:function(e){return this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(i.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(i.isFunction(e))return this._buildRegionFromRegionClass(e);throw new o.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var n=e.regionClass||t,o=i.omit(e,"selector","regionClass");return e.selector&&!o.el&&(o.el=e.selector),new n(o)},_buildRegionFromRegionClass:function(e){return new e}}),o.RegionManager=o.Controller.extend({constructor:function(e){this._regions={},o.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=o._getValue(e,this,arguments),i.reduce(e,function(e,n,o){return i.isString(n)&&(n={selector:n}),n.selector&&(n=i.defaults({},n,t)),e[o]=this.addRegion(o,n),e},{},this)},addRegion:function(e,t){var i;return i=t instanceof o.Region?t:o.Region.buildRegion(t,o.Region),this.triggerMethod("before:add:region",e,i),i._parent=this,this._store(e,i),this.triggerMethod("add:region",e,i),i},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return i.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return i.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),o.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this._setLength(),this.triggerMethod("remove:region",e,t)},_setLength:function(){this.length=i.size(this._regions)}}),o.actAsCollection(o.RegionManager.prototype,"_regions"),o.TemplateCache=function(e){this.templateId=e},i.extend(o.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new o.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=i.toArray(arguments),n=t.length;if(n>0)for(e=0;n>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var i=t.$(e).html();if(!i||0===i.length)throw new o.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return i},compileTemplate:function(e){return i.template(e)}}),o.Renderer={render:function(e,t){if(!e)throw new o.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var n=i.isFunction(e)?e:o.TemplateCache.get(e);return n(t)}},o.View=t.View.extend({isDestroyed:!1,constructor:function(e){i.bindAll(this,"render"),e=o._getValue(e,this),this.options=i.extend({},i.result(this,"options"),e),this._behaviors=o.Behaviors(this),t.View.apply(this,arguments),o.MonitorDOMRefresh(this),this.on("show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,i.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=o._getValue(t,this),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"_uiBindings");return o.normalizeUIKeys(e,t||i.result(this,"ui"))},normalizeUIValues:function(e){var t=i.result(this,"ui"),n=i.result(this,"_uiBindings");return o.normalizeUIValues(e,n||t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(i.result(this,"triggers"));return i.reduce(e,function(e,t,i){return e[i]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var n=o._getValue(e||this.events,this);n=this.normalizeUIKeys(n),i.isUndefined(e)&&(this.events=n);var s={},r=i.result(this,"behaviorEvents")||{},a=this.configureTriggers(),l=i.result(this,"behaviorTriggers")||{};i.extend(s,r,n,a,l),t.View.prototype.delegateEvents.call(this,s)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(!this.isDestroyed){var e=i.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.remove(),i.invoke(this._behaviors,"destroy",e),this}},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=i.isObject(e),n=i.defaults({},t?e:{},{preventDefault:!0,stopPropagation:!0}),o=t?n.event:e;return function(e){e&&(e.preventDefault&&n.preventDefault&&e.preventDefault(),e.stopPropagation&&n.stopPropagation&&e.stopPropagation());var t={view:this,model:this.model,collection:this.collection};this.triggerMethod(o,t)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){for(var e=o._triggerMethod,t=e(this,arguments),i=this._behaviors,n=0,s=i&&i.length;s>n;n++)e(i[n],arguments);return t},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?i.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},normalizeMethods:o.normalizeMethods,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,i.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){if(!e)throw new o.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.serializeData();t=this.mixinTemplateHelpers(t);var i=o.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",constructor:function(e){var t=e||{};i.isUndefined(this.sort)&&(this.sort=i.isUndefined(t.sort)?!0:t.sort),this.once("render",this._initialEvents),this._initChildViewStorage(),o.View.apply(this,arguments),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&i.each(this._bufferedChildren,i.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&(i.each(this._bufferedChildren,i.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(e,t){o.triggerMethodOn(t,e)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e){this.destroyEmptyView();var t=this.getChildView(e),i=this.collection.indexOf(e);this.addChild(e,t,i)},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},onShowCalled:function(){this.children.each(i.partial(this._triggerMethodOnChild,"show"))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},resortView:function(){this.render()},_sortViews:function(){var e=this.collection.find(function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this);e&&this.resortView()},_emptyViewIndex:-1,_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var e;this.collection.each(function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(n)&&(n=n.call(this,e,this._emptyViewIndex));var s=this.buildChildView(e,t,n);s._parent=this,this.proxyChildEvents(s),this._isShown&&o.triggerMethodOn(s,"before:show"),this.children.add(s),this.renderChildView(s,this._emptyViewIndex),this._isShown&&o.triggerMethodOn(s,"show")},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new o.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=o._getValue(n,this,[e,i]);var s=this.buildChildView(e,t,n);return this._updateIndices(s,!0,i),this._addChildView(s,i),s._parent=this,s},_updateIndices:function(e,t,i){this.sort&&(t&&(e._index=i),this.children.each(function(i){i._index>=e._index&&(i._index+=t?1:-1)}))},_addChildView:function(e,t){this.proxyChildEvents(e),this.triggerMethod("before:add:child",e),this.children.add(e),this.renderChildView(e,t),this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"show"),this.triggerMethod("add:child",e)},renderChildView:function(e,t){return e.render(),this.attachHtml(this,e,t),e},buildChildView:function(e,t,n){var o=i.extend({model:e},n);return new t(o)},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),
this._updateIndices(e,!1)),e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},attachHtml:function(e,t,i){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i,n=this.sort&&t<this.children.length-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),i?(i.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?void 0:(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){var e=this.children.map(i.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),e},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=i.toArray(arguments),o=n[0],s=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+o,n.splice(1,0,e),"undefined"!=typeof s&&i.isFunction(s[o])&&s[o].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)},this)},_getImmediateChildren:function(){return i.values(this.children._views)}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t},serializeData:function(){var e={};return this.model&&(e=i.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&o.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=o.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},getChildViewContainer:function(e,t){if("$childViewContainer"in e)return e.$childViewContainer;var i,n=o.getOption(e,"childViewContainer");if(n){var s=o._getValue(n,e);if(i="@"===s.charAt(0)&&e.ui?e.ui[s.substr(4)]:e.$(s),i.length<=0)throw new o.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else i=e.$el;return e.$childViewContainer=i,i},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),o.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:i.partial(i.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=o._getValue(this.regions,this,[e])||{};var n=this.getOption.call(e,"regions");n=o._getValue(n,this,[e]),i.extend(t,n),t=this.normalizeUIValues(t),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return i.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),o.Behavior=o.Object.extend({constructor:function(e,t){this.view=t,this.defaults=i.result(this,"defaults")||{},this.options=i.extend({},this.defaults,e),o.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){this.stopListening()},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),o.Behaviors=function(e,t){function i(e,n){return t.isObject(e.behaviors)?(n=i.parseBehaviors(e,n||t.result(e,"behaviors")),i.wrap(e,n,t.keys(s)),n):{}}function n(e,i){this._view=e,this._viewUI=t.result(e,"ui"),this._behaviors=i,this._triggers={}}var o=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(e,t){var i=new n(this,t);return i.buildBehaviorTriggers()},behaviorEvents:function(i,n){var s={},r=this._uiBindings||t.result(this,"ui");return t.each(n,function(i,n){var a={},l=t.clone(t.result(i,"events"))||{},d=i._uiBindings||t.result(i,"ui"),u=t.extend({},r,d);l=e.normalizeUIKeys(l,u);var c=0;t.each(l,function(e,s){var r=s.match(o),l=r[1]+"."+[this.cid,n,c++," "].join(""),d=r[2],u=l+d,h=t.isFunction(e)?e:i[e];a[u]=t.bind(h,i)},this),s=t.extend(s,a)},this),s}};return t.extend(i,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(i.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,o){var s=i.getBehaviorClass(n,o),r=new s(n,e),a=i.parseBehaviors(e,t.result(r,"behaviors"));return[r].concat(a)}).flatten().value()},wrap:function(e,i,n){t.each(n,function(n){e[n]=t.partial(s[n],e[n],i)})}}),t.extend(n.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(i,n){var o=t.extend({},this._viewUI,t.result(i,"ui")),s=t.clone(t.result(i,"triggers"))||{};s=e.normalizeUIKeys(s,o),t.each(s,t.bind(this._setHandlerForBehavior,this,i,n))},_setHandlerForBehavior:function(e,t,i,n){var o=n.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[o]=this._view._buildViewTrigger(i)}}),i}(o,i),o.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(i.isFunction(this.onRoute)){var n=i.invert(this.getOption("appRoutes"))[e];this.onRoute(e,n,t)}},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,n){var s=e[n];if(!s)throw new o.Error('Method "'+n+'" was not found on the controller');this.route(t,n,i.bind(s,e))},getOption:o.proxyGetOption,triggerMethod:o.triggerMethod,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Application=o.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new o.Callbacks,this.submodules={},i.extend(this,e),this._initChannel(),o.Object.call(this,e)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var n=o.Module.getClass(t),s=i.toArray(arguments);return s.unshift(this),n.create.apply(n,s)},getRegionManager:function(){return new o.RegionManager},_initializeRegions:function(e){var t=i.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var n=o.getOption(e,"regions");return i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){o._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,o._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){o._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],o._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres}}),o.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var s=i.flatten([this,this.app,t,o,t.$,i,n]);e.apply(this,s)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(e,t,n){var o=e,s=i.rest(arguments,3);t=t.split(".");var r=t.length,a=[];return a[r-1]=n,i.each(t,function(t,i){var r=o;o=this._getModule(r,t,e,n),this._addModuleDefinition(r,o,a[i],s)},this),o},_getModule:function(e,t,n,o,s){var r=i.extend({},o),a=this.getClass(o),l=e[t];return l||(l=new a(t,n,r),e[t]=l,e.submodules[t]=l),l},getClass:function(e){var t=o.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var o=this._getDefine(i),s=this._getStartWithParent(i,t);o&&t.addDefinition(o,n),this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof o.Module?(n=t.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(e)?(n=e.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof o.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),o}),define("common/component/baseTable/behaviors/TooltipRowBehavior",["require","backbone.marionette"],function(e){var t=e("backbone.marionette");return t.Behavior.extend({events:{mouseover:"_onMouseOver",mouseout:"_onMouseOut"},_onMouseOver:function(e){this.view.trigger("mouseover",this.view.model,e)},_onMouseOut:function(e){this.view.trigger("mouseout",this.view.model,e)}})}),define("common/component/baseTable/childView/BaseRow",["require","underscore","backbone.marionette","common/view/mixin/epoxyViewMixin","common/component/baseTable/behaviors/TooltipRowBehavior"],function(e){var t=e("underscore"),i=e("backbone.marionette"),n=e("common/view/mixin/epoxyViewMixin"),o=e("common/component/baseTable/behaviors/TooltipRowBehavior"),s=i.ItemView.extend({behaviors:{Tooltip:{behaviorClass:o}},initialize:function(){this.epoxifyView()},render:function(){return i.ItemView.prototype.render.apply(this,arguments),this.applyEpoxyBindings(),this},remove:function(){this.removeEpoxyBindings(),i.ItemView.prototype.remove.apply(this,arguments)}});return t.extend(s.prototype,n),s}),define("text!attributes/templates/rowDesignerEditTemplate.htm",[],function(){return'<div class="editMode">\n    <span class="control firstInputGroup">\n        <span class="name editMode control" data-bind="validationErrorClass:name">\n            <div class="wrap">{{- i18n["attributes.name"]}}:</div>\n            <input type="text" data-bind="value:name, events:[\'keyup\'], disabled:inherited" />\n            <span class="message warning" data-bind="validationErrorText:name" ></span>\n        </span>\n        <span class="value editMode control" data-bind="validationErrorClass:value">\n            <div class="wrap">{{- i18n["attributes.value"]}}:</div>\n            <input type="password" data-bind="toggle:secure, value:encrypt, events:[\'keyup\']" />\n            <input type="text" data-bind="toggle:not(secure), value:value, events:[\'keyup\']" />\n            <span class="message warning" data-bind="validationErrorText:value"></span>\n        </span>\n    </span>\n    <label class="descriptionArea editMode control" data-bind="validationErrorClass:description">\n        <div class="wrap">{{- i18n["attributes.description"]}}:</div>\n        <input type="text" data-bind="value:description, events:[\'keyup\']" />\n        <span class="message warning" data-bind="validationErrorText:description"></span>\n    </label>\n    {{ if (type !== types.USER) { }}\n    <span class="permission editMode control">\n        <div class="wrap">{{- i18n["attributes.permission"]}}:</div>\n        <select data-bind="value:integer(permissionEmbedded)">\n            <option value="1">{{- i18n["attributes.attribute.permissionMask.1"]}}</option>\n            <option value="2">{{- i18n["attributes.attribute.permissionMask.2"]}}</option>\n            <option value="32">{{- i18n["attributes.attribute.permissionMask.32"]}}</option>\n            <option value="0">{{- i18n["attributes.attribute.permissionMask.0"]}}</option>\n        </select>\n    </span>\n    {{ } }}\n    <div class="secure editMode control">\n        <input name="secure" data-bind="checked:secure" type="checkbox"/>\n        <span class="wrap">{{- i18n["attributes.encrypt"]}}</span>\n    </div>\n    <div class="actions control">\n        <button class="button action up primary ok editMode">\n            <span class="wrap">{{- i18n2["button.ok"] }}</span>\n        </button>\n        <button class="button action up cancel editMode">\n            <span class="wrap">{{- i18n2["button.cancel"] }}</span>\n        </button>\n    </div>\n</div>\n'}),define("text!attributes/templates/rowDesignerViewTemplate.htm",[],function(){return'<div class="name table-column" data-tooltip="true">\n    <div class="item"><p data-bind="text:name"></p></div>\n</div>\n<div class="value table-column"\n     data-tooltip="true">\n    <div class="item">\n        <input readonly type="password" data-bind="toggle:secure, value:encrypt"/>\n        <p data-bind="toggle:not(secure), text:value"></p>\n    </div>\n</div>\n<div class="secure table-column">\n    <div class="item">\n        <input data-bind="toggle:not(readOnly), checked:secure" type="checkbox"/>\n        <span data-bind="toggle:readOnly, text:secure"></span>\n    </div>\n</div>\n{{ if (type !== types.SERVER) { }}\n<div class="inherited table-column">\n    <div class="item">\n        <span data-bind="text:inherited"></span>\n    </div>\n</div>\n{{ } if (type !== types.USER) { }}\n<div class="permission table-column">\n    <div class="item">\n        <select data-bind="value:integer(permissionEmbedded), disabled:readOnly">\n            <option value="1">{{- i18n["attributes.attribute.permissionMask.1"]}}</option>\n            <option value="2">{{- i18n["attributes.attribute.permissionMask.2"]}}</option>\n            <option value="32">{{- i18n["attributes.attribute.permissionMask.32"]}}</option>\n            <option value="0">{{- i18n["attributes.attribute.permissionMask.0"]}}</option>\n        </select>\n    </div>\n</div>\n{{ } }}\n<div class="actions table-column">\n    <div class="item">\n        <div class="actionButtons">\n            <span data-bind="toggle:not(readOnly)">\n                <button name="editButton" class="button action simple edit"></button>\n            </span>\n            <span data-bind="toggle:not(disableRemove)">\n                <button name="deleteButton" class="button action simple delete"></button>\n            </span>\n        </div>\n    </div>\n</div>\n\n'}),define("text!attributes/templates/emptyDesignerTemplate.htm",[],function(){return'<div class="table-column name"></div>\n<div class="table-column value"></div>\n<div class="table-column secure"></div>\n{{ if (type !== types.SERVER) { }}<div class="table-column inherited"></div>\n{{ } if (type !== types.USER) { }} <div class="table-column permission"></div> {{ } }}\n<div class="table-column actions"></div>\n'}),define("text!attributes/templates/rowViewTemplate.htm",[],function(){return'<div class="name table-column viewer" data-tooltip="true">\n    <div class="item">\n        <p data-bind="text:name"></p></div>\n</div>\n<div class="value table-column viewer"\n     data-tooltip="true">\n    <div class="item">\n        <input readonly type="password" data-bind="toggle:secure, value:encrypt"/>\n\n        <p data-bind="toggle:not(secure), text:value"></p>\n    </div>\n</div>\n<div class="secure table-column viewer">\n    <div class="item">\n        <span name="secure" data-bind="text:secure"></span>\n    </div>\n</div>\n{{ if (type !== types.SERVER) { }}\n<div class="inherited table-column viewer">\n    <div class="item">\n        <span data-bind="text:inherited"></span>\n    </div>\n</div>\n{{ } if (type !== types.USER) { }}\n<div class="permission table-column viewer">\n    <div class="item">\n        <select data-bind="value:integer(permissionEmbedded)" disabled="disabled">\n            <option value="1">{{- i18n["attributes.attribute.permissionMask.1"]}}</option>\n            <option value="2">{{- i18n["attributes.attribute.permissionMask.2"]}}</option>\n            <option value="32">{{- i18n["attributes.attribute.permissionMask.32"]}}</option>\n            <option value="0">{{- i18n["attributes.attribute.permissionMask.0"]}}</option>\n        </select>\n    </div>\n</div>\n{{ } }}\n\n\n\n'}),define("attributes/factory/rowTemplatesFactory",["require","text!attributes/templates/rowDesignerEditTemplate.htm","text!attributes/templates/rowDesignerViewTemplate.htm","text!attributes/templates/emptyDesignerTemplate.htm","text!attributes/templates/rowViewTemplate.htm"],function(e){var t=e("text!attributes/templates/rowDesignerEditTemplate.htm"),i=e("text!attributes/templates/rowDesignerViewTemplate.htm"),n=e("text!attributes/templates/emptyDesignerTemplate.htm"),o=e("text!attributes/templates/rowViewTemplate.htm");return function(e){return e=e||{},e.readOnly?o:e.empty?n:e.editMode?t:i}}),define("attributes/view/RowView",["require","underscore","bundle!AttributesBundle","bundle!CommonBundle","common/component/baseTable/childView/BaseRow","attributes/enum/attributesTypesEnum","attributes/factory/rowTemplatesFactory"],function(e){var t=e("underscore"),i=e("bundle!AttributesBundle"),n=e("bundle!CommonBundle"),o=e("common/component/baseTable/childView/BaseRow"),s=e("attributes/enum/attributesTypesEnum"),r=e("attributes/factory/rowTemplatesFactory"),a="~secure~",l=o.extend({className:"table-row",template:t.template(r({readOnly:!0})),templateHelpers:function(){return{i18n:i,i18n2:n,type:this.type,types:s,encrypted:a}},computeds:{encrypt:{get:function(){return a},set:function(e){this.setBinding("value",e)}}},initialize:function(e){this.type=e.type,o.prototype.initialize.apply(this,arguments)}});return l}),define("serverSettingsCommon/enum/confirmDialogTypesEnum",[],function(){return{CANCEL_CONFIRM:"cancelConfirm",DELETE_CONFIRM:"deleteConfirm",PERMISSION_CONFIRM:"permissionConfirm",NAME_CONFIRM:"nameConfirm",EDIT_CONFIRM:"editConfirm"}}),define("serverSettingsCommon/behaviors/DeleteConfirmBehavior",["require","backbone.marionette","serverSettingsCommon/enum/confirmDialogTypesEnum"],function(e){var t=e("backbone.marionette"),i=e("serverSettingsCommon/enum/confirmDialogTypesEnum");return t.Behavior.extend({events:{"click .delete":"_onDeleteClick"},_onDeleteClick:function(e){this.view.trigger("open:confirm",i.DELETE_CONFIRM,this.view,this.view.model)}})}),define("attributes/view/DesignerRowView",["require","underscore","jquery","attributes/view/RowView","serverSettingsCommon/behaviors/DeleteConfirmBehavior","serverSettingsCommon/enum/confirmDialogTypesEnum","attributes/enum/permissionMasksEnum","attributes/factory/rowTemplatesFactory"],function(e){var t=e("underscore"),i=e("jquery"),n=e("attributes/view/RowView"),o=e("serverSettingsCommon/behaviors/DeleteConfirmBehavior"),s=e("serverSettingsCommon/enum/confirmDialogTypesEnum"),r=e("attributes/enum/permissionMasksEnum"),a=e("attributes/factory/rowTemplatesFactory"),l="~secure~",d="28px",u="100%",c=n.extend({tagName:"div",className:"table-row",ui:{passwordInput:"input[type='password']"},events:t.extend({},n.prototype.events,{"click .edit":"toggleActive","click .cancel":"cancel","click .ok":"runValidation","click @ui.passwordInput":"toggleValue","blur @ui.passwordInput":"toggleValue"}),modelEvents:{change:"_onModelChange"},behaviors:t.extend(n.prototype.behaviors,{DeleteConfirm:{behaviorClass:o}}),computeds:t.extend(n.prototype.computeds,{readOnly:{deps:["inherited","permissionMask"],get:function(e,t){var i=t===r.READ_ONLY;return i||e&&i}},disableRemove:{deps:["inherited","permissionMask"],get:function(e,t){return e||t===r.READ_ONLY}}}),initialize:function(e){this.editMode=!1,this._onViewInitialize&&this._onViewInitialize(),n.prototype.initialize.apply(this,arguments)},render:function(){return n.prototype.render.apply(this,arguments),this._onViewRender&&this._onViewRender(),this},getTemplate:function(){var e=!this.editMode&&this.model.get("name");return t.template(a({editMode:!e}))},toggleActive:function(){var e=new i.Deferred,t=this;return this.toggleMode().done(function(){t.trigger("active",t.editMode,e)}),e},toggleMode:function(){var e=new i.Deferred;return this.editMode=!this.editMode,this.editMode?this.slideDown(e):this.slideUp(e),e},toggleIfModelIsValid:function(){return this.validateModel()?(this.model.setState("confirmedState"),this.model.isNew()&&this.confirmState(),this.modelChanged=null,this.toggleActive()):new i.Deferred},slideDown:function(e){return this.render().hide().slideDown({done:function(){e.resolve()}}),this},slideUp:function(e,t){t=t||d;var i=this;return this.$el.animate({height:t},{done:function(){i.render().$el.css({height:u}).show(),e.resolve()}}),this},hide:function(){return this.$el.hide()},show:function(){return this.$el.show()},cancel:function(){this.model.set(this.model.getState("confirmedState")),this.toggleActive()},runValidation:function(e,t){this.validateModel(t)&&this.triggerConfirmOpening(t)},triggerConfirmOpening:function(e){e=e||{};var n=new i.Deferred,o=this,r=function(){o.permissionConfirmShouldBeShown?o._openPermissionConfirm&&t.bind(o._openPermissionConfirm,o,e)():o.triggerModelValidation(e)};this.model.isNew()?r():this.modelChanged?(this.modelChanged.name?this.trigger("open:confirm",s.NAME_CONFIRM,{dfd:n}):n.resolve(),n.done(function(){o.modelChanged._embedded?r():o.triggerModelValidation(e)})):this.toggleActive()},triggerModelValidation:function(e){this.model.trimAttrs(["name","value","description"]),this.trigger("validate",e)},validateModel:function(e){e=e||{};var t=this.model.isValid(!0);return!t&&e.dfd&&e.dfd.reject(),t},confirmState:function(e){this.model.confirmState(e)},isStateConfirmed:function(){return this.model.isStateConfirmed()},isInherited:function(){return this.model.getState("originalState").inherited},getChangedProperties:function(e){return this.modelChanged?e?this.modelChanged[e]:this.modelChanged:void 0},toggleValue:function(e){if(this.editMode){var t=i(e.target),n=t.val(),o=n===l,s=i(e.relatedTarget).hasClass("ok"),r="click"===e.type;n&&(r&&o&&(t.val(""),this.model.resetField("value")),r||s||t.val(l))}},invokeFiltration:function(){var e=this.model;return e.hasChanged("secure")||e.hasChanged("_embedded")&&!this._isPermissionLimited()?!this.editMode&&e.hasChanged("inherited"):void 0},validateIfSecure:function(){var e=this.getChangedProperties("name");this.model.validateIfSecure=this.model.validateSecureValue()&&e||!1},_onSaveSuccess:function(){this.modelChanged=null,this.model.setId(),this.model.get("secure")&&this.model.resetField("value"),this.model.setState(),this.model.setState("confirmedState")},_onModelChange:function(e){this.modelChanged=this.modelChanged||{};var i,n=e.changedAttributes(),o=this.model.getState(),s=this.isInherited(),r=e.isNew();t.each(n,function(e,i){if("inherited"!==i){var n=o[i],s=t.isObject(e)?t.isEqual(n,e):n===e;s?delete this.modelChanged[i]:this.modelChanged[i]=e}},this),i=!t.isEmpty(this.modelChanged),s&&e.set("inherited",!i),!this.editMode&&n.secure&&e.setState("confirmedState"),this.trigger("changed",i||r),this.model.validate(this.modelChanged)}});return c}),define("attributes/view/DesignerEmptyView",["require","underscore","backbone.marionette","attributes/enum/attributesTypesEnum","attributes/factory/rowTemplatesFactory"],function(e){var t=e("underscore"),i=e("backbone.marionette"),n=e("attributes/enum/attributesTypesEnum"),o=e("attributes/factory/rowTemplatesFactory"),s=i.ItemView.extend({className:"table-row",templateHelpers:function(){return{type:this.type,types:n}},initialize:function(e){e=e||{},this.type=e.type,this.template=t.template(o({empty:!0}))}});return s}),define("attributes/view/viewWithPermissionTrait",["require","underscore","serverSettingsCommon/enum/confirmDialogTypesEnum","attributes/enum/permissionMasksEnum"],function(e){var t=e("underscore"),i=e("serverSettingsCommon/enum/confirmDialogTypesEnum"),n=e("attributes/enum/permissionMasksEnum"),o={1:1,2:2,32:3,0:4};return{_onViewInitialize:function(){this.listenTo(this.model,"change:_embedded",t.bind(this._onPermissionChange,this))},_onViewRender:function(){var e=this.model.get("inherited"),i=this.model.getPermission(),o=i&&i.mask,s=t.isNumber(o)?o:this.model.get("permissionMask");if(e&&s!==n.ADMINISTRATOR){var r=this.$el.find("option:selected");r.prevAll().attr("disabled","disabled")}},_onPermissionChange:function(e,t){var i=this._isPermissionLimited(t);this._showPermissionConfirm(!1),this.modelChanged._embedded&&i?this.editMode?this._showPermissionConfirm(!0):this._openPermissionConfirm():!this.editMode&&e.setState("confirmedState")},_showPermissionConfirm:function(e){this.permissionConfirmShouldBeShown=e},_isPermissionLimited:function(e){var t=this.model,i=t.getState("confirmedState"),n=o[t.getPermission(e).mask],s=o[t.getPermission(i._embedded).mask];return n>s},_openPermissionConfirm:function(e){this.trigger("open:confirm",i.PERMISSION_CONFIRM,e||{})}}}),define("attributes/enum/roleEnum",{ROLE_ADMINISTRATOR:"role:/ROLE_ADMINISTRATOR"}),define("attributes/model/modelWithPermissionTrait",["require","underscore","attributes/enum/roleEnum","attributes/enum/permissionMasksEnum"],function(e){var t=e("underscore"),i=e("attributes/enum/roleEnum");e("attributes/enum/permissionMasksEnum");return{computeds:{permissionEmbedded:{deps:["_embedded","permissionMask"],get:function(e,t){var i=this.getPermission(e);return i?i.mask:t},set:function(e){var n=t.cloneDeep(this.get("_embedded")),o=this.getPermission(n);return o?o.mask=e:n.permission.push({mask:e,recipient:i.ROLE_ADMINISTRATOR}),{_embedded:n}}}},_initModelWithPermissionDefaults:function(){this.defaults=t.extend({},this.defaults,{_embedded:{permission:[{recipient:i.ROLE_ADMINISTRATOR,mask:"1"}]}})},getPermission:function(e){return e=e||this.get("_embedded"),e?t.find(e.permission,function(e){return e.recipient===i.ROLE_ADMINISTRATOR}):void 0}}}),define("text!attributes/templates/tooltipTemplate.htm",[],function(){return"{{ if( !_.isUndefined(model.value) ) { }}\n    <p class='message label'>{{- i18n['attributes.value'] + ':'}}</p>\n    <p class='message'>{{- model.value }}</p>\n{{ }else{ }}\n    <p class='message label'>{{- i18n['attributes.name'] + ':'}}</p>\n    <p class='message'>{{- model.name }}</p>\n    <p class='message label'>{{- i18n['attributes.description'] + ':'}}</p>\n    <p class='message'>{{- model.description }}</p>\n{{ } }}"}),define("attributes/factory/attributesViewOptionsFactory",["require","underscore","bundle!AttributesBundle","attributes/collection/AttributesCollection","attributes/view/DesignerRowView","attributes/view/DesignerEmptyView","attributes/view/viewWithPermissionTrait","attributes/view/RowView","attributes/enum/attributesTypesEnum","bundle!CommonBundle","attributes/model/AttributeModel","attributes/model/modelWithPermissionTrait","text!attributes/templates/tooltipTemplate.htm"],function(e){var t=e("underscore"),i=e("bundle!AttributesBundle"),n=e("attributes/collection/AttributesCollection"),o=e("attributes/view/DesignerRowView"),s=e("attributes/view/DesignerEmptyView"),r=e("attributes/view/viewWithPermissionTrait"),a=e("attributes/view/RowView"),l=e("attributes/enum/attributesTypesEnum"),d=e("bundle!CommonBundle"),u=e("attributes/model/AttributeModel"),c=e("attributes/model/modelWithPermissionTrait"),h=e("text!attributes/templates/tooltipTemplate.htm");return function(e){var p=new n([],{context:e.context,model:e.type===l.USER?u:u.extend(c)}),m={type:e.type,collection:p,childViewContainer:".tbody",tooltip:{template:h,i18n:i}};return t.extend(m,e.type!==l.SERVER?{$container:e.container,designer:{childView:e.type===l.USER?o:o.extend(r),emptyView:s,filters:[{title:i["attributes.table.filters.all"],value:"true",field:"defaultFilter",selected:!0},{title:i["attributes.table.filters.true"],value:"true",
field:"inherited"},{title:i["attributes.table.filters.false"],value:"false",field:"inherited"}]},viewer:{childView:a}}:{el:e.el,childView:o.extend(r),emptyView:s,buttons:[{label:d["button.save"],action:"save",primary:!0},{label:d["button.cancel"],action:"cancel",primary:!1}],buttonsContainer:".buttonsContainer"})}}),define("attributes/trait/attributesViewScrollEventTrait",["require","attributes/enum/attributesTypesEnum"],function(e){var t=e("attributes/enum/attributesTypesEnum");return{initScrollEvent:function(e){var i=e.type===t.SERVER?e.$el.parent():e.$container.parent(),n=e.$el.find(".addNewItem"),o=20;i.scroll(function(e){n.css("margin-right",o-i.scrollLeft()+"px")})},detachScrollEvent:function(e){e.off()}}}),define("attributes/factory/confirmationDialogFactory",["require","underscore","bundle!AttributesBundle","serverSettingsCommon/enum/confirmDialogTypesEnum","common/component/dialog/ConfirmationDialog"],function(e){var t=e("underscore"),i=e("bundle!AttributesBundle"),n=e("serverSettingsCommon/enum/confirmDialogTypesEnum"),o=e("common/component/dialog/ConfirmationDialog"),s={},r={title:i["attributes.confirm.dialog.title"]};return s[n.DELETE_CONFIRM]=r,s[n.NAME_CONFIRM]={title:i["attributes.confirm.dialog.title"],text:i["attributes.confirm.name.dialog.text"]},s[n.CANCEL_CONFIRM]={title:i["attributes.confirm.dialog.title"],text:i["attributes.confirm.cancel.dialog.text.custom"]},s[n.PERMISSION_CONFIRM]=r,s[n.EDIT_CONFIRM]=t.extend({},{text:i["attributes.confirm.edit.dialog.text"]},r),function(e){return s[e]&&new o(s[e])}}),define("text!attributes/templates/attributesDesignerTemplate.htm",[],function(){return'<div class="baseTableContainer {{-type}}">\n    <div class="baseTable">\n        <div class="table-row thead">\n            <div class="name table-column">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.name"]}}\n                    </p>\n                </div>\n            </div>\n            <div class="value table-column">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.value"]}}\n                    </p>\n                </div>\n            </div>\n            <div class="secure table-column">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.encrypted"]}}\n                    </p>\n                </div>\n            </div>\n            {{ if (type !== types.SERVER) { }}\n            <div class="inherited table-column">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.inherited"]}}\n                    </p>\n                </div>\n            </div>\n            {{ } if (type !== types.USER) { }}\n            <div class="permission table-column">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.permission"]}}\n                    </p>\n                </div>\n            </div>\n            {{ } }}\n            <div class="actions table-column"></div>\n        </div>\n        <div class="tbody"></div>\n    </div>\n    <a href="#" class="addNewItem">{{- i18n["attributes.button.add.new"]}}</a>\n</div>'}),define("text!attributes/templates/attributesViewerTemplate.htm",[],function(){return'<div class="baseTableContainer {{-type}}">\n    <div class="baseTable">\n        <div class="table-row thead">\n            <div class="name table-column viewer">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.name"]}}\n                    </p>\n                </div>\n            </div>\n            <div class="value table-column viewer">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.value"]}}\n                    </p>\n                </div>\n            </div>\n            <div class="secure table-column viewer">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.encrypted"]}}\n                    </p>\n                </div>\n            </div>\n            {{ if (type !== types.SERVER) { }}\n            <div class="inherited table-column viewer">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.inherited"]}}\n                    </p>\n                </div>\n            </div>\n            {{ } if (type !== types.USER) { }}\n            <div class="permission table-column viewer">\n                <div class="item">\n                    <p>\n                        {{- i18n["attributes.permission"]}}\n                    </p>\n                </div>\n            </div>\n            {{ } }}\n        </div>\n        <div class="tbody"></div>\n    </div>\n</div>\n'}),define("text!attributes/templates/emptyViewerTemplate.htm",[],function(){return'<div class="tbody">\n    <p class="emptyTemplateMessage">{{- i18n["attributes.no.attributes"]}}</p>\n</div>\n'}),define("attributes/factory/tableTemplatesFactory",["require","text!attributes/templates/attributesDesignerTemplate.htm","text!attributes/templates/attributesViewerTemplate.htm","text!attributes/templates/emptyViewerTemplate.htm"],function(e){var t=e("text!attributes/templates/attributesDesignerTemplate.htm"),i=e("text!attributes/templates/attributesViewerTemplate.htm"),n=e("text!attributes/templates/emptyViewerTemplate.htm");return function(e){return e=e||{},e.readOnly?e.empty?n:i:t}}),define("attributes/factory/errorFactory",["require","bundle!AttributesBundle","underscore"],function(e){function t(e,t){var i={};return o.each(e,function(e,n){o.isObject(e)?i[e.field]=e.fn(t[n]):i[e]=t[n]}),i}function i(e){return n["attributes.attribute.permissionMask."+e]}var n=e("bundle!AttributesBundle"),o=e("underscore"),s={},r=[n["attributes.error.message.unknown.error"]];return s["access.denied"]=[n["attributes.error.message.access.denied"],["name"]],s[401]=[n["attributes.error.message.not.authenticated"]],s["illegal.parameter.value.error"]=[n["attributes.illegal.parameter.value.error"]],s["attribute.invalid.permission.order"]=[n["attributes.error.message.invalid.permission.order"],["name",{field:"strongerPermission",fn:i},{field:"inheritedPermission",fn:i}]],s["attribute.duplicate.server.level"]=[n["attributes.error.message.duplicate.server.level"],["name"]],function(e){var i,n=e.responseJSON||{},a=n.errorCode,l=n.parameters,d=e.status,u=s[a?a:d]||r;return i=o.template(u[0])(u[1]?t(u[1],l):{})}}),define("common/component/baseTable/BaseTable",["require","backbone.marionette","common/component/tooltip/Tooltip"],function(e){var t=e("backbone.marionette"),i=e("common/component/tooltip/Tooltip"),n=t.CompositeView.extend({initialize:function(e){e=e||{};var t=e.tooltip;t&&t.template&&t.i18n&&(this.tooltip=new i({i18n:t.i18n,attachTo:this.$el,contentTemplate:t.template}))},remove:function(){this.tooltip&&this.tooltip.remove(),t.CompositeView.prototype.remove.apply(this,arguments)}});return n}),define("attributes/view/AttributesViewer",["require","jquery","underscore","bundle!AttributesBundle","attributes/enum/attributesTypesEnum","common/component/baseTable/BaseTable","attributes/factory/tableTemplatesFactory","common/util/xssUtil","css!attributes.css"],function(e){var t=e("jquery"),i=e("underscore"),n=e("bundle!AttributesBundle"),o=e("attributes/enum/attributesTypesEnum"),s=e("common/component/baseTable/BaseTable"),r=e("attributes/factory/tableTemplatesFactory"),a=e("common/util/xssUtil");e("css!attributes.css");var l=s.extend({className:"attributesViewer",templateHelpers:function(){return{i18n:n,type:this.type,types:o}},initialize:function(e){e=e||{},this.type=e.type,this.childViewOptions=i.extend({},e.childViewOptions,{type:this.type}),this.$container=t(e.$container),s.prototype.initialize.apply(this,arguments),this.tooltip&&this._initTooltipEvents()},render:function(){return s.prototype.render.apply(this,arguments),this.$container.append(a.escape(this.$el,{softHTMLEscape:!0})),this},setContext:function(e,t){return this.collection.setContext(e,t)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},getTemplate:function(){var e=r({readOnly:!0,empty:!this.collection.models.length});return i.template(e)},_initTooltipEvents:function(){this.listenTo(this,"childview:mouseover",this._onChildViewMouseOver),this.listenTo(this,"childview:mouseout",this._onChildViewMouseOut)},_onChildViewMouseOver:function(e,n,o){var s=t(o.target).closest(".table-column");s.hasClass("name")&&(n=i.pick(n.toJSON(),["name","description"])),s.hasClass("value")&&(n=i.pick(n.toJSON(),"value")),this.tooltip.show(n)},_onChildViewMouseOut:function(e,t,i){this.tooltip.hide()}});return l}),define("attributes/view/AttributesDesigner",["require","underscore","jquery","backbone","bundle!AttributesBundle","serverSettingsCommon/enum/confirmDialogTypesEnum","attributes/enum/attributesTypesEnum","attributes/enum/permissionMasksEnum","attributes/factory/confirmationDialogFactory","attributes/factory/tableTemplatesFactory","attributes/factory/errorFactory","attributes/view/AttributesViewer","common/component/notification/Notification","common/component/dialog/AlertDialog"],function(e){var t=e("underscore"),i=e("jquery"),n=e("backbone"),o=e("bundle!AttributesBundle"),s=e("serverSettingsCommon/enum/confirmDialogTypesEnum"),r=e("attributes/enum/attributesTypesEnum"),a=(e("attributes/enum/permissionMasksEnum"),e("attributes/factory/confirmationDialogFactory")),l=e("attributes/factory/tableTemplatesFactory"),d=e("attributes/factory/errorFactory"),u=e("attributes/view/AttributesViewer"),c=e("common/component/notification/Notification"),h=e("common/component/dialog/AlertDialog"),p=u.extend({className:"attributesDesigner",ui:{addNewBtn:".addNewItem"},events:{"click @ui.addNewBtn":"_addNewChildView","mousedown .filterItems, .actions.table-column button, .permission.table-column select, .secure.table-column input":"_checkCurrentAttribute","focus .filterItems, .actions.table-column button, .permission.table-column select, .secure.table-column input":"_checkCurrentAttribute"},childEvents:{active:"_activeChildView",changed:"_saveChildViewToChangedList","open:confirm":"_openConfirm",validate:"_validateChildView"},initialize:function(e){e=e||{};var i={type:e.type};this.notification=new c,this.alertDialog=new h,this.model=new n.Model,this.changedModels=[],this.overriddenInheritedModels=[],u.prototype.initialize.apply(this,arguments),this.childViewOptions=t.extend({},e.childViewOptions,i),this.emptyViewOptions=t.extend({},e.emptyViewOptions,i),this._initConfirmationDialogs(),this._initFilters&&this._initFilters(e),!t.isEmpty(e.buttons)&&e.buttonsContainer&&this._initButtons&&this._initButtons(e),this._initEvents()},render:function(e){return u.prototype.render.apply(this,arguments),this._renderFilters&&this._renderFilters(e),this},hide:function(){this._resetFilters&&this._resetFilters(),u.prototype.hide.apply(this,arguments)},saveChildren:function(){var e=this,n=this._filterChangeList("isDeleted"),o=t.difference(this.changedModels,n);return this.saveDfD=new i.Deferred,this._validateNotAcceptedChildView().done(function(){e.containsUnsavedItems()?e.collection.save(e.changedModels,o).done(t.bind(e._successAjaxCallback,e)).fail(t.bind(e._errorAjaxCallback,e)):e.saveDfD.resolve()}).fail(function(){e.saveDfD.reject()}),this.saveDfD},_validateNotAcceptedChildView:function(){var e=new i.Deferred;return this.currentChildView?this.currentChildView.runValidation(null,{dfd:e}):e.resolve(),e},revertChanges:function(){this.revertDfd=new i.Deferred;var e,t=this,n=new i.Deferred;return this.currentChildView?this.currentChildView.toggleActive().done(n.resolve):n.resolve(),n.done(function(){for(var i=t.changedModels.length,n=i-1;n>=0;n--)e=t.changedModels[n],e.isDeleted?t.revertViewRemoval(e):e.isNew()?t._removeModel(e):e.reset().setState("confirmedState",e.getState());t._resetChangedList(),t.revertDfd.resolve()}),this.revertDfd},getTemplate:function(){return t.template(l())},containsUnsavedItems:function(){return!!this.changedModels.length},removeView:function(e){var t=this._findChildrenByModel(e);e.isDeleted={index:this.collection.indexOf(e)},e.get("inherited")?this._saveRemovedOverriddenInheritedModelToList(e):this._saveChildViewToChangedList(t,!e.isNew()),this._removeModel(e)},revertViewRemoval:function(e){var i=e.isDeleted&&e.isDeleted.index,n=t.isNumber(i)?i:this.collection.models.length;this._deleteViewFromChangedList(e),e.reset(),this.collection.add(e,{at:n}),delete e.isDeleted},remove:function(){i(window).off("beforeunload",this._onPageLeave),this._removeConfirmationDialogs(),this.notification&&this.notification.remove(),this.alertDialog&&this.alertDialog.remove(),u.prototype.remove.apply(this,arguments)},_initEvents:function(){i(window).on("beforeunload",t.bind(this._onPageLeave,this))},_initConfirmationDialogs:function(){this.confirmationDialogs={},t.each(s,function(e){this.confirmationDialogs[e]=a(e)},this),this.listenTo(this.confirmationDialogs[s.DELETE_CONFIRM],"button:yes",this._onDeleteConfirm),this.listenTo(this.confirmationDialogs[s.NAME_CONFIRM],"button:yes",this._onNameConfirm),this.listenTo(this.confirmationDialogs[s.NAME_CONFIRM],"button:no",t.bind(this._revertChangedModelProperty,this,"name")),this.listenTo(this.confirmationDialogs[s.CANCEL_CONFIRM],"button:yes",this.revertChanges),this.listenTo(this.confirmationDialogs[s.EDIT_CONFIRM],"button:yes",this._onEditConfirm),this._initPermissionConfirmEvents&&this._initPermissionConfirmEvents()},_removeConfirmationDialogs:function(){t.each(this.confirmationDialogs,function(e){e.remove()},this)},_successAjaxCallback:function(e){this.notification.show({message:o["attributes.notification.message.saved"],type:"success"}),this._sendSearchRequest()?this._searchForInherited(t.union(this.deletedModels,this.renamedModels)).then(this.saveDfD.resolve,this.saveDfD.reject):this.saveDfD.resolve(),e&&this._postProcessItems(e),this._resetChangedList()},_sendSearchRequest:function(){return!this._isServerLevel()&&this._searchForInherited&&this._deletedRenamedModels()},_deletedRenamedModels:function(){return this.deletedModels=this._filterChangeList("isDeleted"),this.renamedModels=this._filterChangeList("isRenamed"),this.deletedModels.length||this.renamedModels.length},_filterChangeList:function(e){var i;return t.compact(t.filter(this.changedModels,function(n){return i=n[e],n.get("inherited")?void 0:t.isFunction(i)?n[e]():i}))},_postProcessItems:function(e){var i,n=e.attribute;t.each(n,function(e){i=this._findChildrenByModel(e.name),i&&i._onSaveSuccess()},this)},_errorAjaxCallback:function(e){this.alertDialog.setMessage(d(e)),this.alertDialog.open(),this.saveDfD.reject()},_toggleAddNewItemButton:function(e){var t=i(this.ui.addNewBtn);e?t.show():t.hide()},_checkCurrentAttribute:function(e){this.currentChildView&&(e.preventDefault(),this.confirmationDialogs[s.EDIT_CONFIRM].open())},_onPageLeave:function(e){return this.containsUnsavedItems()?((e||window.event).returnValue=o["attributes.dialog.unsaved.changes"],o["attributes.dialog.unsaved.changes"]):void 0},_onEditConfirm:function(){this.currentChildView.cancel()},_onNameConfirm:function(){this.validateDfD&&this.validateDfD.resolve()},_onDeleteConfirm:function(){var e=this.model.get("changedChildView"),t=e.model,i=t.get("name");e.isInherited()&&!t.isRenamed()?t.reset():(this.removeView(t),this._revertInheritedRemoval&&this._revertInheritedRemoval(i))},_isServerLevel:function(){return this.type===r.SERVER||null===this.collection.getContext().id},_revertChangedModelProperty:function(e){var t=this.model.get("changedChildView")||this.currentChildView;t.model.reset(e,"confirmedState")},_addNewChildView:function(){var e=this.collection.addNew(),t=this._findChildrenByModel(e);this._saveChildViewToChangedList(t,!0),t.toggleActive()},_scrollToChildView:function(e){var t=this.$el.closest(".body"),i=t.height(),n=e.$el,o=n.height(),s=n.position(),r=i<s.top+o&&{scrollTop:t.scrollTop()+(s.top+o-i)};r&&t.animate(r,900)},_successValidationCallback:function(e,t,i){var n=this,o=e.model;this._filterInheritedViews&&this._filterInheritedViews(i),e.validateIfSecure(),e.toggleIfModelIsValid().done(function(){n._removeInheritedView&&n._removeInheritedView(o),n._addInheritedView&&n._addInheritedView(o),n._showPermissionConfirm&&n._showPermissionConfirm(e),n._resetFilters&&n._resetFilters(),t.resolve()})},_deleteViewFromChangedList:function(e){var i=t.indexOf(this.changedModels,e);-1!==i&&this.changedModels.splice(i,1)},_removeModel:function(e){this.collection.remove(e)},_findModelsWhere:function(e){return this.collection.findWhere(e)},_findChildrenByModel:function(e){return e=t.isString(e)?this._findModelsWhere({name:e}):e,e&&this.children.findByModel(e)},_resetChangedList:function(){this.changedModels.length=0,this.overriddenInheritedModels.length=0,this._triggerChangeEvent()},_triggerChangeEvent:function(){this.toggleButtons&&this.toggleButtons(),this.trigger("change")},_activeChildView:function(e,t,i){this._setCurrentChildView(t?e:null),this._scrollToChildView(e),i&&i.resolve()},_saveChildViewToChangedList:function(e,i){var n=e.model;t.contains(this.changedModels,n)?!i&&this._deleteViewFromChangedList(n):i&&this.changedModels.push(n),e.invokeFiltration()&&this._resetFilters&&this._resetFilters(),this._triggerChangeEvent()},_saveRemovedOverriddenInheritedModelToList:function(e){!t.contains(this.overriddenInheritedModels,e)&&this.overriddenInheritedModels.push(e)},_openConfirm:function(e,i,n){this.validateDfD=n.dfd,this.model.set("changedChildView",e);var r=this.confirmationDialogs[i],a=i!==s.CANCEL_CONFIRM?!0:this.containsUnsavedItems();switch(i){case s.DELETE_CONFIRM:r.setContent(t.template(o["attributes.confirm.delete.dialog.text"],{name:e.model.get("name")}));break;case s.PERMISSION_CONFIRM:r.setContent(o["attributes.confirm.permission.dialog.text"])}a&&r.open()},_validateChildView:function(e,n){n=n||{};var o=e.model,s=n.dfd?n.dfd:new i.Deferred,r=!o.isOriginallyInherited(),a=t.bind(this._successValidationCallback,this,e,s),l=this._isServerLevel();return e.getChangedProperties("name")&&!this._sendValidateSearchRequest(o)?this.collection.validateSearch(o,this.changedModels,r,l).then(a):a(),s},_sendValidateSearchRequest:function(e){var i=this._filterChangeList("isDeleted"),n=t.filter(i,function(t){return e.get("name")===t.get("name")}).length,o=t.filter(this.changedModels,function(t){return e.get("name")===t.get("name")}).length;return n&&!e.isDeleted&&2>=o},_setCurrentChildView:function(e){this._toggleAddNewItemButton(!e);var t=this.currentChildView;if(t){var i=t.model,n=i.isNew()&&!t.isStateConfirmed();n&&this.removeView(i)}this.currentChildView=e}});return p}),define("text!serverSettingsCommon/templates/buttonTemplate.htm",[],function(){return'<button class="button action up {{= primary ? \'primary\' : \'\'}}">\n    <span class="wrap">{{- label }}<span class="icon"></span></span>\n</button>\n'}),define("serverSettingsCommon/view/traits/buttonsTrait",["require","underscore","common/component/base/OptionContainer","serverSettingsCommon/enum/confirmDialogTypesEnum","text!serverSettingsCommon/templates/buttonTemplate.htm"],function(e){var t=e("underscore"),i=e("common/component/base/OptionContainer"),n=e("serverSettingsCommon/enum/confirmDialogTypesEnum"),o=e("text!serverSettingsCommon/templates/buttonTemplate.htm");return{_initButtons:function(e){this.buttons=new i({options:e.buttons,el:e.buttonsContainer,contextName:"button",optionTemplate:o}),this.buttons.disable(),this.listenTo(this.buttons,"button:save",this.saveChildren),this.listenTo(this.buttons,"button:cancel",t.bind(this._openConfirm,this,null,n.CANCEL_CONFIRM))},toggleButtons:function(){var e=this.buttons;this.containsUnsavedItems()?e.enable():(t.each(e.options,function(e){e.$el.removeClass("over")}),e.disable())}}}),define("attributes/attributesFilter/AttributesFilterCollectionView",["require","jquery","underscore","backbone","backbone.marionette","bundle!AttributesBundle","common/view/mixin/epoxyViewMixin"],function(e){var t=e("jquery"),i=e("underscore"),n=e("backbone"),o=e("backbone.marionette"),s=e("bundle!AttributesBundle"),r=e("common/view/mixin/epoxyViewMixin"),a="defaultFilter",l=["true","false"],d=o.CompositeView.extend({className:"filtersContainer",events:{"change select":"_onCurrentFilterChange"},templateHelpers:function(){return{i18n:s}},constructor:function(e){this._initCurrentCriteria(),o.CompositeView.apply(this,arguments)},initialize:function(e){this.targetCollection=e&&e.targetCollection||[],this.epoxifyView(),this.initEvents()},initEvents:function(){this.listenTo(this.targetCollection,"add",this.addItemToFilterCollection),this.listenTo(this.targetCollection,"remove",this.removeItemFromFilterCollection),this.listenTo(this.targetCollection,"sync",this._initFilterCollection)},filter:function(e){var t=e||this.currentCriteria,i=t.defaultFilter?this.filterCollection.models:this.filterCollection.where(t);this.targetCollection.reset(i)},reset:function(){this.currentCriteria[a]||(this.$el.find("option[value='"+a+"::true']").prop("selected",!0),this._initCurrentCriteria(),this.filter())},addItemToFilterCollection:function(e){this.filterCollection.add(e)},removeItemFromFilterCollection:function(e){this.filterCollection.remove(e)},render:function(){return o.CompositeView.prototype.render.apply(this,arguments),this.applyEpoxyBindings(),this.delegateEvents(this.events),this},remove:function(){this.removeEpoxyBindings(),o.CompositeView.prototype.remove.apply(this,arguments)},_initCurrentCriteria:function(e,t){e=e||a,t=i.isUndefined(t)?!0:t,this.currentCriteria={},this.currentCriteria[e]=t},_initFilterCollection:function(){this.filterCollection=new n.Collection(this.targetCollection.models)},_onCurrentFilterChange:function(e){var n=t(e.target).val().split("::"),o=n[0],s=n[1];-1!==i.indexOf(l,s)&&(this._initCurrentCriteria(o,t.parseJSON(s)),this.filter())}});return i.extend(d.prototype,r),d}),define("text!attributes/attributesFilter/template/attributesFilterViewTemplate.htm",[],function(){return'<option value="{{- model.field + \'::\' + model.value}}" {{ if(model.selected) { }}selected="selected"{{ } }} >{{- model.title }}</option>'}),define("attributes/attributesFilter/view/AttributesFilterView",["require","underscore","text!attributes/attributesFilter/template/attributesFilterViewTemplate.htm","backbone.marionette"],function(e){var t=e("underscore"),i=e("text!attributes/attributesFilter/template/attributesFilterViewTemplate.htm"),n=e("backbone.marionette"),o=n.ItemView.extend({template:function(e){return t.template(i)({model:e})},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)}});return o}),define("text!attributes/attributesFilter/template/attributesFilterCollectionViewTemplate.htm",[],function(){return'<span>{{- i18n["attributes.table.filters.filter.by"]}}</span>\n<select class="filterItems"></select>\n\n'}),define("attributes/view/trait/designerFilterTrait",["require","underscore","backbone","common/util/xssUtil","attributes/attributesFilter/AttributesFilterCollectionView","attributes/attributesFilter/view/AttributesFilterView","text!attributes/attributesFilter/template/attributesFilterCollectionViewTemplate.htm"],function(e){var t=e("underscore"),i=e("backbone"),n=e("common/util/xssUtil"),o=e("attributes/attributesFilter/AttributesFilterCollectionView"),s=e("attributes/attributesFilter/view/AttributesFilterView"),r=e("text!attributes/attributesFilter/template/attributesFilterCollectionViewTemplate.htm");return{_initFilters:function(e){this.filters=new o({collection:new i.Collection(e.filters||[]),childView:s,childViewContainer:"select",template:t.template(r),model:new i.Model({currentFilter:null}),targetCollection:this.collection})},_renderFilters:function(e){var t=this.filters.render().el;return!e&&this.$el.prepend(n.escape(t,{softHTMLEscape:!0}))},_resetFilters:function(){this.filters.reset()}}}),define("attributes/view/trait/designerInheritedTrait",["require","underscore"],function(e){var t=e("underscore");return{_findOriginallyInheritedModelByName:function(e,i){return t.find(e,function(e){return e.isOriginallyInherited()&&e.get("name")===i})},_filterInheritedViews:function(e){this.filteredInheriteds=this.collection.filterInheritedAttributes(e)},_findInheriteds:function(e){return this._findModelsWhere({name:e,inherited:!0})},_revertInheritedRemoval:function(e){if(!this._findInheriteds(e)){var i=this._findOriginallyInheritedModelByName(t.union(this.changedModels,this.overriddenInheritedModels),e);i&&this.revertViewRemoval(i)}},_searchForInherited:function(e){var t=this;return this.collection.search(e).done(function(e){e&&(t._filterInheritedViews(e),t.collection.addItemsToCollection(t.filteredInheriteds))})},_removeInheritedView:function(e){var t=this._findInheriteds(e.get("name"));t&&this.removeView(t)},_addInheritedView:function(e){this.filteredInheriteds&&this.filteredInheriteds.length&&(e.resetField("id"),this.collection.addItemsToCollection(this.filteredInheriteds))}}}),define("attributes/view/trait/designerPermissionTrait",["require","serverSettingsCommon/enum/confirmDialogTypesEnum"],function(e){var t=e("serverSettingsCommon/enum/confirmDialogTypesEnum");return{_initPermissionConfirmEvents:function(){this.listenTo(this.confirmationDialogs[t.PERMISSION_CONFIRM],"button:yes",this._onPermissionConfirm),this.listenTo(this.confirmationDialogs[t.PERMISSION_CONFIRM],"button:no",this._onPermissionCancel)},_onPermissionConfirm:function(){var e;this.currentChildView?this.currentChildView.triggerModelValidation({dfd:this.validateDfD}):(e=this.model.get("changedChildView").model,e.setState("confirmedState"),e.hasChanged("inherited")&&this._resetFilters&&this._resetFilters())},_onPermissionCancel:function(){this._revertChangedModelProperty("_embedded")},_showPermissionConfirm:function(e){e._showPermissionConfirm(!1)}}}),define("attributes/factory/attributesDesignerFactory",["require","underscore","attributes/view/AttributesDesigner","attributes/enum/attributesTypesEnum","serverSettingsCommon/view/traits/buttonsTrait","attributes/view/trait/designerFilterTrait","attributes/view/trait/designerInheritedTrait","attributes/view/trait/designerPermissionTrait"],function(e){function t(e){var t={};return i.each(e,function(e){i.extend(t,e)}),t}var i=e("underscore"),n=e("attributes/view/AttributesDesigner"),o=e("attributes/enum/attributesTypesEnum"),s=e("serverSettingsCommon/view/traits/buttonsTrait"),r=e("attributes/view/trait/designerFilterTrait"),a=e("attributes/view/trait/designerInheritedTrait"),l=e("attributes/view/trait/designerPermissionTrait"),d={};return d[o.SERVER]=[s,l],d[o.TENANT]=[r,a,l],d[o.USER]=[r,a],function(e,i){var o=n.extend(t(d[e]));return new o(i)}}),define("attributes/AttributesViewFacade",["require","backbone.marionette","underscore","attributes/collection/AttributesCollection","attributes/factory/attributesDesignerFactory","attributes/view/AttributesViewer"],function(e){var t=e("backbone.marionette"),i=e("underscore"),n=(e("attributes/collection/AttributesCollection"),e("attributes/factory/attributesDesignerFactory")),o=e("attributes/view/AttributesViewer"),s=t.Controller.extend({initialize:function(e){e=e||{};var t=i.extend({},e,e.designer),s=i.extend({},e,e.viewer);this.designer=n(t.type,t),this.viewer=new o(s),this.listenTo(this.designer,"change",this._triggerChangeEvent),this.setCurrentView()},render:function(e){return this.getCurrentView().render(e),this},getCurrentView:function(){return this.currentView},cancel:function(){return this.currentView.revertChanges()},containsUnsavedItems:function(){return this.currentView.containsUnsavedItems&&this.currentView.containsUnsavedItems()},setCurrentView:function(e){this.currentView=e||this.viewer},toggleMode:function(e,t){this.getCurrentView().hide(),this.setCurrentView(e?this.designer:this.viewer),this.render(t).getCurrentView().show()},_triggerChangeEvent:function(){this.trigger("change",this.containsUnsavedItems())}});return s}),define("managePro/manageOrgsMain",["require","org.mng.components","utils.common","!domReady","underscore","org.mng.actions","jrs.configs","bundle!AttributesBundle","bundle!CommonBundle","tenantImportExport/view/TenantsTreeView","attributes/enum/attributesTypesEnum","common/component/dialog/ConfirmationDialog","attributes/factory/attributesViewOptionsFactory","attributes/trait/attributesViewScrollEventTrait","attributes/AttributesViewFacade","css!manageTenants.css"],function(e){"use strict";e("org.mng.components"),e("utils.common");var t=e("!domReady"),i=e("underscore"),n=e("org.mng.actions"),o=e("jrs.configs"),s=e("bundle!AttributesBundle"),r=e("bundle!CommonBundle"),a=e("tenantImportExport/view/TenantsTreeView"),l=e("attributes/enum/attributesTypesEnum"),d=e("common/component/dialog/ConfirmationDialog"),u=e("attributes/factory/attributesViewOptionsFactory"),c=e("attributes/trait/attributesViewScrollEventTrait"),h=e("attributes/AttributesViewFacade");e("css!manageTenants.css"),t(function(){"undefined"==typeof n.messages&&(n.messages={}),"undefined"==typeof n.Configuration&&(n.Configuration={}),i.extend(window.localContext,o.orgManagement.localContext),i.extend(n.messages,o.orgManagement.orgModule.messages),i.extend(n.Configuration,o.orgManagement.orgModule.Configuration),n.orgManager.initialize({_:i,i18n:s,i18n2:r,attributesViewOptionsFactory:u,AttributesViewFacade:h,scrollEventTrait:c,attributesTypesEnum:l,ConfirmationDialog:d,TenantsTreeView:a})})});