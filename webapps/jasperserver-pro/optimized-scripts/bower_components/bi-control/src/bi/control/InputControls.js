define(["require","exports","module","jquery","underscore","backbone","common/bi/component/util/biComponentUtil","common/bi/component/BiComponent","./model/InputControlPropertiesModel","./collection/InputControlCollection","./view/InputControlCollectionView","./error/biComponentErrorFactoryInputControlsProxy","text!./schema/InputControls.json","logger"],function(e,t,r){"use strict";function o(e,t,r,o){var n=this.validate(),p=this,c={};if(n)return void e.reject(C.validationError(n));var l=r.validate();if(l)return void e.reject(C.inputControlsValidationError(l));a(t,r),c.params=s.cloneDeep(t.properties.params)||{},s.defaults(c.params,r.getState());var d=s.isEmpty(c.params)?"fetch":"update";if(t.properties.container){var u=i(t.properties.container);u.length&&"1"==u[0].nodeType||e.reject(C.containerNotFoundError(t.properties.container)),o.setContainer(u)}r[d](c).done(function(o){t.data=r.toJSON(),t.data.parameters=r.getState(),e.resolve(p.data())}).fail(function(t){"generic.error.message"===t.responseJSON.errorCode&&-1!=t.responseJSON.message.search(/Parameter [\S]+ does not exist/)?e.reject(C.inputControlParameterNotFound(t.responseJSON.message)):e.reject(C.requestError(t))})}function n(e,t,r){var o=this;t.properties.params={},r.fetch().done(function(n){t.data=r.toJSON(),t.data.parameters=r.getState(),e.resolve(o.data())}).fail(function(t){"generic.error.message"===t.responseJSON.errorCode&&-1!=t.responseJSON.message.search(/Parameter [\S]+ does not exist/)?e.reject(C.inputControlParameterNotFound(t.responseJSON.message)):e.reject(C.requestError(t))})}function a(e,t){s.extend(t,{resourceUri:e.properties.resource,contextPath:e.properties.server})}var i=e("jquery"),s=e("underscore"),p=e("backbone"),c=e("common/bi/component/util/biComponentUtil"),l=e("common/bi/component/BiComponent"),d=e("./model/InputControlPropertiesModel"),u=e("./collection/InputControlCollection"),m=e("./view/InputControlCollectionView"),C=e("./error/biComponentErrorFactoryInputControlsProxy"),f=JSON.parse(e("text!./schema/InputControls.json")),v=(e("logger").register(r),s.keys(f.properties)),g=["properties"],S=["data"],h=function(e){var t={properties:s.extend({},e),data:[]},r=new d(e||{});c.createInstancePropertiesAndFields(this,t,v,g,S,r);var a=new u([],{stateModel:r}),i=new m({collection:a,stateModel:r}),l=s.extend({},p.Events);l.listenTo(a,"changeState",function(){t.data=a.toJSON(),t.data.parameters=a.getState()}),s.extend(this,{validate:c.createValidateAction(t,f,r),run:c.createDeferredAction(o,r,t,a,i),reset:c.createDeferredAction(n,r,t,a)})};return h.prototype=new l,h});