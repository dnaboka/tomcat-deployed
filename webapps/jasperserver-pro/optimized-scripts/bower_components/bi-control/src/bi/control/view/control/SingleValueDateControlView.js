define(["require","../BaseInputControlView","jquery","underscore","components/dateAndTime/DateAndTimePicker","text!../../template/singleValueDateTemplate.htm","settings/dateTimeSettings","common/util/parse/date"],function(e){"use strict";function t(e){var t=e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"");return t.replace(/[\s]*(\+|\-)[\s]*/g,"$1")}var i=e("../BaseInputControlView"),a=e("jquery"),n=e("underscore"),s=e("components/dateAndTime/DateAndTimePicker"),o=e("text!../../template/singleValueDateTemplate.htm"),r=e("settings/dateTimeSettings"),d=e("common/util/parse/date");return i.extend({template:o,initialize:function(){this.renderStructure(),this.renderState(),this.model.get("visible")&&(this.setupCalendar(),this.bindCustomEventListeners()),this.model.get("readOnly")&&this.disable(),this.updateWarningMessage()},setupCalendar:function(){var e=this,i=this.$el.find("input"),o=this.model.get("dataType"),l=null,u=null;o&&(o.minValue&&(l=d.iso8601DateToMoment(o.minValue),o.strictMin&&l.add(1,"d"),l=d.momentToLocalizedDate(l)),o.maxValue&&(u=d.iso8601DateToMoment(o.maxValue),o.strictMax&&u.subtract(1,"d"),u=d.momentToLocalizedDate(u))),this.picker=new s({el:i,currentText:r.datepicker.currentText,dateFormat:r.datepicker.dateFormat,disabled:i[0].disabled,onSelect:n.bind(this.updateState,this),minDate:l,maxDate:u}),i.change(n.bind(function(e){e.stopPropagation();var i=a(e.target),n=t(i.val());i.val(n),this.updateState(n)},this)),this.$el.find(".jr-mInput-datetrigger").on("click",function(){e.picker.show()})},updateValue:function(e){var t=d.isoDateToLocalizedDate(e);this.$el.find("input").attr("value",t)},updateState:function(e){this.model.changeState(d.localizedDateToIsoDate(e))},bindCustomEventListeners:function(){this.listenTo(this.model.state,"change:value",function(e,t){this.updateValue(t)},this),this.listenTo(this.model.state,"reset change",this.updateWarningMessage,this)},remove:function(){this.picker.remove(),i.prototype.remove.call(this)}})});