define(["require","../BaseInputControlView","jquery","underscore","components/dateAndTime/DateAndTimePicker","text!../../template/singleValueTimeTemplate.htm","settings/dateTimeSettings","common/util/parse/date","common/util/parse/time"],function(e){"use strict";function t(e){var t=e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"");return t.replace(/[\s]*(\+|\-)[\s]*/g,"$1")}var i=e("../BaseInputControlView"),s=e("jquery"),n=e("underscore"),a=e("components/dateAndTime/DateAndTimePicker"),o=e("text!../../template/singleValueTimeTemplate.htm"),r=e("settings/dateTimeSettings"),m=e("common/util/parse/date"),u=e("common/util/parse/time");return i.extend({template:o,initialize:function(e){this.renderStructure(e),this.renderState(),this.model.get("visible")&&(this.setupCalendar(),this.bindCustomEventListeners()),this.model.get("readOnly")&&this.disable(),this.updateWarningMessage()},setupCalendar:function(){var e,i,o=this,m=this.$el.find("input"),l=this.model.get("dataType"),d=null,c=null;l&&l.minValue&&(d=new Date,e=u.iso8601TimeToTimeObject(l.minValue),d.setHours(e.hours),d.setMinutes(e.minutes),d.setSeconds(e.seconds+(l.strictMin?1:0))),l&&l.maxValue&&(c=new Date,i=u.iso8601TimeToTimeObject(l.maxValue),c.setHours(i.hours),c.setMinutes(i.minutes),c.setSeconds(i.seconds+(l.strictMax?1:0))),this.picker=new a({el:m,currentText:r.timepicker.currentText,timeFormat:r.timepicker.timeFormat,disabled:m[0].disabled,onClose:n.bind(this.updateState,this),minDateTime:d,maxDateTime:c}),m.change(n.bind(function(e){e.stopPropagation();var i=s(e.target),n=t(i.val());i.val(n),this.updateState(n)},this)),this.$el.find(".jr-mInput-datetrigger").on("click",function(){o.picker.show()})},updateValue:function(e){var t=m.isoTimeToLocalizedTime(e);this.$el.find("input").attr("value",t)},updateState:function(e){this.model.changeState(m.localizedTimeToIsoTime(e))},bindCustomEventListeners:function(){this.listenTo(this.model.state,"change:value",function(e,t){this.updateValue(t)},this),this.listenTo(this.model.state,"reset change",this.updateWarningMessage,this)},remove:function(){this.picker.remove(),i.prototype.remove.call(this)}})});