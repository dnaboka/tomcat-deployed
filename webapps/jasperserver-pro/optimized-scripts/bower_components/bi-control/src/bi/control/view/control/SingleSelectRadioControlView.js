define(["require","exports","module","../BaseInputControlView","components/sizer/Sizer","jquery","underscore","logger","mustache","../../util/inputControlHelpers","text!../../template/singleSelectRadioTemplate.htm","text!../../template/radioInputItem.htm"],function(t,e,i){"use strict";var n=t("../BaseInputControlView"),o=t("components/sizer/Sizer"),s=t("jquery"),h=t("underscore"),r=(t("logger").register(i),t("mustache")),a=t("../../util/inputControlHelpers"),l=t("text!../../template/singleSelectRadioTemplate.htm"),d=t("text!../../template/radioInputItem.htm"),c=3,u=5,m=2;return n.extend({template:l,renderStructure:function(){return this.$el=s(r.to_html(this.template||"",this.model.toJSON())),this.$radioContainer=this.$el.find(".jr-mInput-set"),this.renderOptions(),this.once("attached",this._checkForRealAttachedToDOM,this),this},renderOptions:function(){var t=this.$radioContainer.find("ul")[0],e=h.map(this.model.state.options.toJSON(),function(t){var e=h.clone(t);return e.readOnly=this.model.get("readOnly"),e.name=this.getOptionName(),e.uuid="jr-label-id-"+h.uniqueId(this.model.get("id")),e},this);a.setInnerHtml(t,function(t){return r.to_html(d,t)},{data:e}),this._handleHeight()},updateOptionsSelection:function(){var t=this;this.model.state.options.each(function(e){t.$radioContainer.find("input[value='"+e.get("value")+"']").prop("checked",e.get("selected"))}),this._handleHeight()},_checkForRealAttachedToDOM:function(){this._getItemHeight()?(this.attached=!0,this.$radioContainer.height(this._calcHeightByItemsCount(u)),this._initSizer()):h.delay(h.bind(this._checkForRealAttachedToDOM,this),500)},_initSizer:function(){this.sizer=new o({container:this.$radioContainer}),this.$el.append(this.sizer.$el),this._handleHeight()},_handleHeight:function(){var t=this.model.state.options.length;if(this.attached&&t&&this._getItemHeight()){var e=this.$radioContainer.height(),i=e,n=this._calcHeightByItemsCount(c),o=this._calcHeightByItemsCount(t)+m;u>=t?n=o=i=this._calcHeightByItemsCount(Math.max(c,t)):e>o&&(i=this._calcHeightByItemsCount(t)),this.$radioContainer.height(i),this.sizer.updateMinMax({minHeight:n,maxHeight:o}),n===o?(this.sizer.hide(),this.$radioContainer.css("overflow-y","auto")):(this.sizer.show(),this.$radioContainer.css("overflow-y","scroll"))}},_calcHeightByItemsCount:function(t){var e=this._getItemHeight(),i=Math.round(parseFloat(this.$radioContainer.find("ul").css("margin-top"))||0);return t*e+i},_getItemHeight:function(){return this.$radioContainer.find("li").outerHeight()},getOptionName:function(){return this.model.get("id")+"_option"},bindCustomEventListeners:function(){if(!this.model.get("readOnly")){var t=this;this.$el.on("change","input",h.bind(function(e){var i=e.target.value;setTimeout(function(){t.model.changeState(i)})},this))}this.model.state.options.on("reset",this.renderOptions,this),this.model.state.options.on("change:selected",this.updateOptionsSelection,this)},remove:function(){this.$el.off("change","input"),this.singleSelect&&this.singleSelect.remove(),this.model.state.options.off("reset",this.renderOptions,this),this.model.state.options.off("change:selected",this.updateOptionsSelection,this),n.prototype.remove.call(this)}})});