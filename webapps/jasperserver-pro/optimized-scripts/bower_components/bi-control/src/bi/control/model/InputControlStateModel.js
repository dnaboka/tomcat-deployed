define(["require","exports","module","underscore","logger","common/model/BaseModel","../enum/substitutionConstants","common/util/parse/date","common/util/parse/time","settings/decimalFormatSymbols","common/util/parse/NumberUtils","bundle!InputControlsValidation","../collection/InputControlOptionCollection"],function(e,r,i){"use strict";var t=e("underscore"),a=e("logger").register(i),l=e("common/model/BaseModel"),s=e("../enum/substitutionConstants"),o=e("common/util/parse/date"),n=e("common/util/parse/time"),m=e("settings/decimalFormatSymbols"),u=e("common/util/parse/NumberUtils"),f=new u(m),c=e("bundle!InputControlsValidation"),p=e("../collection/InputControlOptionCollection");return l.extend({defaults:{id:void 0,value:void 0,options:void 0,uri:void 0,error:void 0},initialize:function(){l.prototype.initialize.apply(this,arguments),this.isValue=t.isUndefined(this.get("options")),this.options=new p(this.get("options")||[]),this.on("change:options",t.bind(function(){this.options.reset(this.get("options")||[])},this)),this.on("all",a.debug,a)},validation:function(){var e,r=this.get("value"),i=this.dataType;if(!this.isValue)return this.mandatory&&!this.getData().length?c["fillParameters.error.mandatoryField"]:null;if(this.mandatory&&(""===r||t.isUndefined(r)||r===s.NULL_SUBSTITUTION_VALUE))return c["fillParameters.error.mandatoryField"];if(!i||""===r)return null;if("text"===i.type&&i.pattern&&!RegExp("^"+i.pattern+"$").test(r))return c["fillParameters.error.invalidPattern"];if("number"===i.type){if(r=f.parseNumber(r),!t.isNumber(r)||t.isNaN(r))return c["fillParameters.error.invalidValueForType"].replace("{0}","number");if(i.minValue){if(i.strictMin&&i.minValue>=r)return c["fillParameters.error.smallerThan"];if(!i.strictMin&&i.minValue>r)return c["fillParameters.error.smallerOrEqual"]}if(i.maxValue){if(i.strictMax&&i.maxValue<=r)return c["fillParameters.error.greaterThan"];if(!i.strictMax&&i.maxValue<r)return c["fillParameters.error.greaterOrEqual"]}}if("date"===i.type){var a=o.isoDateToLocalizedDate(r);if(!o.isDate(a)&&!o.isRelativeDate(r))return c["fillParameters.error.invalidValueForType"].replace("{0}","Date");if(i.minValue)if(e=o.compareDates(o.isoDateToLocalizedDate(i.minValue.substr(0,10)),a),i.strictMin){if(-1!==e)return c["fillParameters.error.smallerThan"]}else if(-1!==e&&0!==e)return c["fillParameters.error.smallerOrEqual"];if(i.maxValue)if(e=o.compareDates(o.isoDateToLocalizedDate(i.maxValue.substr(0,10)),a),i.strictMax){if(1!==e)return c["fillParameters.error.greaterThan"]}else if(1!==e&&0!==e)return c["fillParameters.error.greaterOrEqual"]}if("time"===i.type){var l=o.isoTimeToLocalizedTime(r);if(!n.isTime(l))return c["fillParameters.error.invalidValueForType"].replace("{0}","Time");if(i.minValue)if(e=n.compareTimes(o.isoTimeToLocalizedTime(i.minValue),l),i.strictMin){if(-1!==e)return c["fillParameters.error.smallerThan"]}else if(-1!==e&&0!==e)return c["fillParameters.error.smallerOrEqual"];if(i.maxValue)if(e=n.compareTimes(o.isoTimeToLocalizedTime(i.maxValue),l),i.strictMax){if(1!==e)return c["fillParameters.error.greaterThan"]}else if(1!==e&&0!==e)return c["fillParameters.error.greaterOrEqual"]}if("datetime"===i.type){var m=o.isoTimestampToLocalizedTimestamp(r);if(r=r.replace("T"," "),!o.isTimestamp(m)&&!o.isRelativeTimestamp(r))return c["fillParameters.error.invalidValueForType"].replace("{0}","DateTime");if(i.minValue)if(e=o.compareTimestamps(o.isoTimestampToLocalizedTimestamp(i.minValue),m),i.strictMin){if(-1!==e)return c["fillParameters.error.smallerThan"]}else if(-1!==e&&0!==e)return c["fillParameters.error.smallerOrEqual"];if(i.maxValue)if(e=o.compareTimestamps(o.isoTimestampToLocalizedTimestamp(i.maxValue),m),i.strictMax){if(1!==e)return c["fillParameters.error.greaterThan"]}else if(1!==e&&0!==e)return c["fillParameters.error.greaterOrEqual"]}return null},changeState:function(e){this.isValue?this.set("value",e):(e=t.isArray(e)?e:[e],this.options.each(function(r){r.set("selected",t.contains(e,r.get("value")),{silent:!0})}),this.options.trigger("change:selected"),this.options.trigger("change"));var r=this.validation();return this.set("error",r),r},getData:function(){return this.isValue?[this.get("value")]:this.options.reduce(function(e,r){return r.get("selected")&&e.push(r.get("value")),e},[])}})});