define(["require","../BaseInputControlView","jquery","underscore","components/dateAndTime/DateAndTimePicker","text!../../template/singleValueDatetimeTemplate.htm","settings/dateTimeSettings","common/util/parse/date"],function(e){"use strict";function t(e){var t=e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"");return t.replace(/[\s]*(\+|\-)[\s]*/g,"$1")}var i=e("../BaseInputControlView"),a=e("jquery"),n=e("underscore"),s=e("components/dateAndTime/DateAndTimePicker"),r=e("text!../../template/singleValueDatetimeTemplate.htm"),o=e("settings/dateTimeSettings"),m=e("common/util/parse/date");return i.extend({template:r,initialize:function(){this.renderStructure(),this.renderState(),this.model.get("visible")&&(this.setupCalendar(),this.bindCustomEventListeners()),this.model.get("readOnly")&&this.disable(),this.updateWarningMessage()},setupCalendar:function(){var e=this,i=this.$el.find("input"),r=this.model.get("dataType"),d=r&&m.iso8601TimestampToDateObject(r.minValue)||null,l=r&&m.iso8601TimestampToDateObject(r.maxValue)||null;r&&r.strictMin&&d&&d.setSeconds(d.getSeconds()+1),r&&r.strictMax&&l&&l.setSeconds(l.getSeconds()-1),this.picker=new s({el:i,currentText:o.timepicker.currentText,dateFormat:o.datepicker.dateFormat,timeFormat:o.timepicker.timeFormat,disabled:i[0].disabled,onSelect:n.bind(this.updateState,this),minDateTime:d,maxDateTime:l}),i.change(n.bind(function(e){e.stopPropagation();var i=a(e.target),n=t(i.val());i.val(n),this.updateState(n)},this)),this.$el.find(".jr-mInput-datetrigger").on("click",function(){e.picker.show()})},updateValue:function(e){var t=m.isoTimestampToLocalizedTimestamp(e);this.$el.find("input").attr("value",t)},updateState:function(e){this.model.changeState(m.localizedTimestampToIsoTimestamp(e))},bindCustomEventListeners:function(){this.listenTo(this.model.state,"change:value",function(e,t){this.updateValue(t)},this),this.listenTo(this.model.state,"reset change",this.updateWarningMessage,this)},remove:function(){this.picker.remove(),i.prototype.remove.call(this)}})});