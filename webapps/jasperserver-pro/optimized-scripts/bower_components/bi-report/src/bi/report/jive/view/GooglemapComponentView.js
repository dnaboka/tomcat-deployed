define(["require","./BaseJiveComponentView"],function(o){"use strict";var n=o("./BaseJiveComponentView");return n.extend({render:function(o){this.$reportEl=o,this.infowindow={},this._init()},_init:function(){var n=this,e=n.model.get("instanceData"),i=e.requestParams||"";"&"===i[0]&&(i=i.substr(1)),"undefined"==typeof google||"undefined"!=typeof google&&"undefined"==typeof google.maps?o(["async!//maps.google.com/maps/api/js?"+i+"!callback"],function(){n._showMap(n.model.get("id"),e.latitude,e.longitude,e.zoom,e.mapType,e.markerList,e.pathsList)}):n._showMap(n.model.get("id"),e.latitude,e.longitude,e.zoom,e.mapType,e.markerList,e.pathsList)},_configureImage:function(o,n,e){var i,t,a,l,r,s;i=n[o+".width"]?parseInt(n[o+".width"]):null,t=n[o+".height"]?parseInt(n[o+".height"]):null,a=n[o+".origin.x"]?parseInt(n[o+".origin.x"]):0,l=n[o+".origin.y"]?parseInt(n[o+".origin.y"]):0,r=n[o+".anchor.x"]?parseInt(n[o+".anchor.x"]):0,s=n[o+".anchor.y"]?parseInt(n[o+".anchor.y"]):0,e[o]={url:n[o+".url"],size:i&&t?new google.maps.Size(i,t):null,origin:new google.maps.Point(a,l),anchor:new google.maps.Point(r,s)}},_createInfo:function(o){if(o["infowindow.content"]&&o["infowindow.content"].length>0){var n=google.maps,e={content:o["infowindow.content"]};return o["infowindow.pixelOffset"]&&(e.pixelOffset=o["infowindow.pixelOffset"]),o["infowindow.latitude"]&&o["infowindow.longitude"]&&(e.position=new n.LatLng(o["infowindow.latitude"],o["infowindow.longitude"])),o["infowindow.maxWidth"]&&(e.maxWidth=o["infowindow.maxWidth"]),new n.InfoWindow(e)}return null},_showMap:function(o,n,e,i,t,a,l){var r=this,s=google.maps,g={zoom:i,center:new s.LatLng(n,e),mapTypeId:s.MapTypeId[t],autocloseinfo:!0},d=new s.Map(r.$reportEl.find("#"+o)[0],g);if(a)for(var c,p=0;p<a.length;p++){var f=a[p],h=new s.LatLng(f.latitude,f.longitude),w={position:h,map:d};f["icon.url"]&&f["icon.url"].length>0?r._configureImage("icon",f,w):f.icon&&f.icon.length>0?w.icon=f.icon:f.color&&f.color.length>0?w.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+(f.label&&f.label.length>0?f.label:"%E2%80%A2")+"%7C"+f.color:f.label&&f.label.length>0&&(w.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+f.label+"%7CFE7569"),f["shadow.url"]&&f["shadow.url"].length>0&&r._configureImage("shadow",f,w);for(c in f)c.indexOf(".")<0&&f.hasOwnProperty(c)&&!w.hasOwnProperty(c)&&(w[c]=f[c]);var u=new google.maps.Marker(w);u.info=r._createInfo(f),s.event.addListener(u,"click",function(){d.autocloseinfo&&r.infowindow&&r.infowindow.close&&r.infowindow.close(),this.info?(r.infowindow=this.info,this.info.open(d,this)):this.url&&this.url.length>0&&window.open(this.url,this.target)})}if(l)for(var m=0;m<l.length;m++){var _=l[m],v={},y=[],I=!1;for(var L in _)if("locations"===L&&_[L])for(var b=_[L],c=0;c<b.length;c++){var x=b[c];y.push(new google.maps.LatLng(x.latitude,x.longitude))}else"isPolygon"===L?I=r._getBooleanValue(_[L]):"visible"===L||"editable"===L||"clickable"===L||"draggable"===L||"geodesic"===L?v[L]=r._getBooleanValue(_[L]):v[L]=_[L];v.map=d,I?(v.paths=y,new google.maps.Polygon(v)):(v.path=y,new google.maps.Polyline(v))}},_getBooleanValue:function(o){return o===!0||"true"===o}})});