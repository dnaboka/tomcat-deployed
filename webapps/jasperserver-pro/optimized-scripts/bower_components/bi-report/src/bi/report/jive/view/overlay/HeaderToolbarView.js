define(["require","backbone","jquery","underscore","common/component/base/OptionContainer","common/component/menu/HoverMenu","common/component/menu/cascadingMenuTrait","text!./template/headerToolbarTemplate.htm","text!./template/headerToolbarButtonTemplate.htm","text!./template/dropdownMenuTemplate.htm","text!./template/dropdownOptionTemplate.htm"],function(t){var e=t("backbone"),n=t("jquery"),o=t("underscore"),s=t("common/component/base/OptionContainer"),i=t("common/component/menu/HoverMenu"),u=t("common/component/menu/cascadingMenuTrait"),r=t("text!./template/headerToolbarTemplate.htm"),a=t("text!./template/headerToolbarButtonTemplate.htm"),h=t("text!./template/dropdownMenuTemplate.htm"),l=t("text!./template/dropdownOptionTemplate.htm"),m=i.extend(u),c=e.View.extend({events:{"mousedown button":"_onMouseTouchDown","touchstart button":"_onMouseTouchDown","mouseup button":"_onMouseTouchUp","touchend button":"_onMouseTouchUp"},initialize:function(t){t=t||{},this.parentElement=n(t.parentElement?t.parentElement:"body");var o=t.buttons||[];this.buttons=new s({contextName:"button",mainTemplate:r,contentContainer:".jive_button_bar_options",optionTemplate:a,options:o}),this.resetCurrentButton(),this.initEvents(),this.initHoverMenus(),this.setElement(this.buttons.$el),this.rendered=!1,e.View.prototype.initialize.apply(this,arguments)},initEvents:function(){this.listenTo(this.buttons,"mouseover",this._onMouseOver),this.listenTo(this.buttons,"mouseout",this._onMouseOut),this.listenTo(this.buttons,"button:select button:sortAsc button:sortDesc button:filter",this._onSelect)},initHoverMenus:function(){this.cascadingMenus=[],o.each(this.buttons.options,function(t){var e=t.model.get("hoverMenuOptions");if(e){var n=new m(e,t.$el,null,{menuContainerTemplate:h,menuOptionTemplate:l});this.listenTo(n,"option:select",this._onSelect),this.cascadingMenus.push(n)}},this)},_onSelect:function(t,e,n){this.trigger("select",t,e,n)},_onMouseTouchDown:function(t){if(this.currentButton){var e=this.currentButton;!e.$el.hasClass("disabled")&&e.$el.addClass("pressed")}return!1},_onMouseTouchUp:function(t){return this.currentButton&&this.currentButton.$el.removeClass("pressed"),!1},_onMouseOver:function(t,e,n){this.resetCurrentButton(t),!t.$el.hasClass("disabled")&&t.$el.addClass("over")},_onMouseOut:function(t,e,n){this.resetCurrentButton(),t.$el.removeClass("over pressed")},resetCurrentButton:function(t){this.currentButton=t?t:null},resetButtonsClasses:function(){this.$el.find("button").removeClass("over pressed disabled")},disableButtons:function(){this.$el.find("button").addClass("disabled")},setPosition:function(t){return this.$el.position(t),this},show:function(t){return this.resetButtonsClasses(),!t&&this.disableButtons(),this.$el.show(),this},hide:function(){return this.$el.hide(),this},render:function(){return this.parentElement.append(this.$el),this.rendered=!0,this},remove:function(){e.View.prototype.remove.apply(this,arguments),this.rendered=!1,this.buttons&&this.buttons.remove(),o.invoke(this.cascadingMenus,"remove")}});return c});