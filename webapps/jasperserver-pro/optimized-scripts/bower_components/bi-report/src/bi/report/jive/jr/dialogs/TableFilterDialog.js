define(["require","underscore","common/component/dialog/Dialog","text!./template/tableFilterDialogTemplate.htm","./view/TableFilterView","../../util/jiveDataConverter","bundle!CommonBundle"],function(e){"use strict";function t(e,t){var l,a={};return e.operator&&(a.operator=n.schemaFormatOperatorToFilterOperator(e.operator,e.value,t),l=this.columnComponentModel.parent.config.genericProperties,"datetime"===t?o.isArray(e.value)?(a.value=[],a.value[0]=n.isoTimestampTojQueryUiTimestamp(e.value[0],l),a.value[1]=n.isoTimestampTojQueryUiTimestamp(e.value[1],l)):a.value=n.isoTimestampTojQueryUiTimestamp(e.value,l):"time"===t?o.isArray(e.value)?(a.value=[],a.value[0]=n.isoTimeTojQueryUiTime(e.value[0],l),a.value[1]=n.isoTimeTojQueryUiTime(e.value[1],l)):a.value=n.isoTimeTojQueryUiTime(e.value,l):a.value=e.value),a}var o=e("underscore"),l=e("common/component/dialog/Dialog"),a=e("text!./template/tableFilterDialogTemplate.htm"),i=e("./view/TableFilterView"),n=e("../../util/jiveDataConverter"),r=e("bundle!CommonBundle");return l.extend({defaultTemplate:a,constructor:function(e){this.tableFilterView=new i({i18n:e.i18n}),l.prototype.constructor.call(this,{buttons:[{label:r["button.cancel"],action:"cancel",primary:!1,"float":"right"},{label:r["button.ok"],action:"ok",primary:!0,"float":"right"}],additionalCssClasses:"tableFilterDialog",modal:!0,resizable:!1,contentContainer:".dialogContent",content:this.tableFilterView}),this.on("button:ok",this._applyFilter),this.on("button:cancel",this.close)},open:function(e){this.columnComponentModel=e;var o=this.columnComponentModel.toReportComponentObject();this.tableFilterView.viewModel.set({columnLabel:o.label?o.label:"#"+(this.columnComponentModel.get("columnIndex")+1),clearFilter:null==o.filter.operator?"true":"false",filterOptions:this.columnComponentModel.parent.config.genericProperties.operators[this.columnComponentModel.get("dataType").toLowerCase()],dataType:this.columnComponentModel.get("dataType").toLowerCase(),calendarPatterns:this.columnComponentModel.parent.config.genericProperties.calendarPatterns}),this.tableFilterView.model.reset().set(t.call(this,o.filter,o.dataType)),l.prototype.open.call(this)},_applyFilter:function(e){var t=this.tableFilterView.model.toJSON();if(t.operator){var l=this.columnComponentModel.toReportComponentObject(),a=o.isArray(t.value)?t.value[0]:t.value,i=o.isArray(t.value)?t.value[1]:void 0;l.filter=n.operatorAndValueToSchemaFormat.call(this.columnComponentModel,t.operator,l.dataType,a,i,l.detailsRowFormat.pattern),this.columnComponentModel.updateFromReportComponentObject(l)}else this.columnComponentModel.set({filterValue:null,filterOperator:null},{silent:!0});var r=this.columnComponentModel.actions["change:filter"].call(this.columnComponentModel);this.columnComponentModel.filter(r.filterData),this.close()},remove:function(){l.prototype.remove.call(this),this.tableFilterView&&this.tableFilterView.remove()}})});