function RegExpRepresenter(e){this.charMap={"\\s":" "},this.expressionTokens=this.__parse(e)}function invokeServerAction(e,t){var i=orgModule.serverActionFactory[e];if(!i)throw new Error("No server action found for action name '"+e+"'");var n=i.call(orgModule.serverActionFactory,t);n.invokeAction()}function invokeClientAction(e,t){var i=orgModule.clientActionFactory[e];if(i){var n=i.call(orgModule.clientActionFactory,t);return n.invokeAction()}throw new Error("No client action found for action name '"+e+"'")}function invokeRoleAction(e,t){var i=orgModule.roleActionFactory[e](t);i.invokeAction()}function invokeRoleManagerAction(e,t){var i=orgModule.roleManager.actionFactory[e](t);i.invokeAction()}function canAddRole(){return orgModule.roleManager.tenantsTree?null!=orgModule.roleManager.tenantsTree.getTenant():!0}function canEditRole(e){var e=e?e:orgModule.properties.getValue();return e.tenantId||orgModule.manager.isUserSuperuser()}function canDeleteRole(e){var e=e?e:orgModule.properties.getValue();return e.tenantId||orgModule.manager.isUserSuperuser()&&!_.contains(orgModule.systemRoles,e.roleName)}function canDeleteAll(){var e=orgModule.entityList.getSelectedEntities();return e.length>0&&!e.detect(function(e){return!canDeleteRole(e)})}define("tools.infiniteScroll",["require","prototype","utils.common"],function(e){"use strict";e("prototype"),e("utils.common");var t=function(e){this._id=e.id,this._contentId=e.contentId?e.contentId:void 0,this._scroll=e.scroll,this._loadFactor=e.loadFactor?e.loadFactor:.95,this._lastContentHeight=0,this._loading=!1,e.control?void 0!==e.control.length&&e.control.length>1?this._control=$(e.control[0]):this._control=$(e.control):this._control=this._scroll?this._scroll.parent:$(this._id),this._scroll?this._content=this._scroll.element:e.content?void 0!==e.content.length&&e.content.length>1?this._content=$(e.content[0]):this._content=$(e.content):this._content=this._contentId?$(this._contentId):this._control.childElements()[0],this._eventType=isSupportsTouch()?"touchmove":"scroll",this._control.observe(this._eventType,this._onScrollHandler.bind(this))};return t.addMethod("destroy",function(){this._control&&this._control.stopObserving(this._eventType,this._handler)}),t.addMethod("_onScrollHandler",function(e){var t=this._scroll?-1*this._scroll.y:this._control.scrollTop,i=this._content.getHeight(),n=this._control.getHeight();i!=this._lastContentHeight&&(this._loading=!1);var o=!this._loading&&0!=i;o=this._scroll?o&&this._scroll.isBottom():o&&(n+t)/i>this._loadFactor,o&&(this._loading=!0,this._lastContentHeight=i,isIPad()&&this.wait(),this.onLoad())}),t.addMethod("onLoad",doNothing),t.addMethod("reset",function(){isIPad()?this._scroll.reset():this._control.scrollTop=0,this._loading=!1}),t.addMethod("wait",function(){if(!this._waitIndicator){this._waitIndicator=new Element("div",{"class":"dimmer resultsOverlay"});var e=this._control.getDimensions(),t=this._control.positionedOffset();this._waitIndicator.setStyle({zIndex:"4000",top:t.top+"px",left:t.left+"px",height:e.height+"px",width:e.width+"px"}),this._control.insert({after:this._waitIndicator})}this._waitIndicator.show()}),t.addMethod("stopWaiting",function(){this._waitIndicator&&this._waitIndicator.hide()}),window.InfiniteScroll=t,t});var toolbarButtonModule={UP:"up",DOWN:"down",OVER:"over",DISABLED:"disabled",PRESSED:"pressed",CONTENT_PREFIX:"toolbar_",MenuClass:"menu vertical dropDown",TOOLBAR_MENU_CLASS:"menu vertical dropDown fitable",ACTION_MODEL_TAG:"adhocActionModel",CAPSULE_PATTERN:"capsule",showButtonMenu:function(e,t){t=jQuery(t);var i=this.CONTENT_PREFIX+t.attr("id"),n="adhocActionModel"==this.ACTION_MODEL_TAG?this.actionModel:this.ACTION_MODEL_TAG;actionModel.showDropDownMenu(e,t,i,this.TOOLBAR_MENU_CLASS,n)},setActionModel:function(e){this.actionModel=e},isToolBarButton:function(e){return e?jQuery(e).hasClass("capsule"):!1},enable:function(e,t){buttonManager.enable(e)},disable:function(e){buttonManager.disable(e)},setButtonState:function(e,t){t?this.enable(e):this.disable(e)}};define("components.toolbarButtons",["jquery","prototype"],function(e){return function(){var t;return t||e.toolbarButtonModule}}(this)),toolbarButtonModule.initialize=function(e){toolbarButtonModule.actionMap=e,jQuery(".toolbar").on("mouseup mouseover mouseout","button",function(e){jQuery(this).prop("disabled")||toolbarButtonModule["mouse"+e.type.substring(5,6).toUpperCase()+e.type.substring(6)+"Handler"](e,this)}),isFirefox()&&jQuery(".toolbar li").each(function(e,t){jQuery(t).css("padding","0 2px")})},toolbarButtonModule.mouseUpHandler=function(e,t){var i=t.className.indexOf("capsule")>=0?toolbarButtonModule.actionMap[t.id]:null;if(i){var n=getAsFunction(i);n(e),e.stopPropagation()}},toolbarButtonModule.mouseOverHandler=function(e,t){t.className.indexOf("capsule")>=0&&t.className.indexOf("mutton")>=0&&!buttonManager.isDisabled(t)&&toolbarButtonModule.showButtonMenu(e.originalEvent,t)},toolbarButtonModule.mouseOutHandler=function(e,t){},define("components.toolbar",["jquery","prototype","utils.common","components.toolbarButtons"],function(e){return function(){var t;return t||e.toolbarButtonModule}}(this));var orgModule={TREE_ID:"orgTree",COOKIE_NAME:"selectedTenant",messages:[],ActionMap:{SEARCH:"search",BROWSE:"browse",NEXT:"next",SELECT_AND_GET_DETAILS:"selectAndGetDetails",SEARCH_AVAILABLE:"searchAvailable",SEARCH_ASSIGNED:"searchAssigned",NEXT_AVAILABLE:"nextAvailable",NEXT_ASSIGNED:"nextAssigned",CREATE:"create",UPDATE:"update",DELETE:"delete",DELETE_ALL:"deleteAll",EXIST:"exist"},Event:{ORG_BROWSE:"org:browse",ENTITY_SEARCH:"entity:search",ENTITY_NEXT:"entity:next",ENTITY_SELECT_AND_GET_DETAILS:"entity:selectAndGetDetails",RESULT_CHANGED:"result:changed",RESULT_NEXT:"result:next",ENTITY_DETAILS_LOADED:"entity:detailsLoaded",SEARCH_AVAILABLE_LOADED:"searchAvailable:loaded",SEARCH_ASSIGNED_LOADED:"searchAssigned:loaded",NEXT_AVAILABLE_LOADED:"nextAvailable:loaded",NEXT_ASSIGNED_LOADED:"nextAssigned:loaded",SERVER_ERROR:"server:error",SERVER_UNAVAILABLE:"server:unavailable",ENTITY_CREATED:"entity:created",ENTITY_UPDATED:"entity:updated",ENTITY_DELETED:"entity:deleted",ENTITIES_DELETED:"entities:deleted"},observe:function(e,t){this._getContainer().observe(e,t)},stopObserving:function(e,t){this._getContainer().stopObserving(e,t)},fire:function(e,t){this._getContainer().fire(e,t)},getMessage:function(e,t){var i=orgModule.messages[e];return i?new Template(i).evaluate(t?t:{}):""},_comparator:function(e,t){return e>t?1:t>e?-1:0},_getContainer:function(){return this._container||(this._container=document.body),this._container},Configuration:{nameSeparator:"|",userDefaultRole:"ROLE_USER",userNameNotSupportedSymbols:"[|]",roleNameNotSupportedSymbols:"[|]",emailRegExpPattern:"^[\\p{L}\\p{M}\\p{N}._%'-\\@\\,\\;\\s]+$",superuserRole:"ROLE_SUPERUSER",adminRole:"ROLE_ADMINISTRATOR",anonymousRole:"ROLE_ANONYMOUS"}};orgModule.systemRoles=[orgModule.Configuration.userDefaultRole,orgModule.Configuration.superuserRole,orgModule.Configuration.adminRole,orgModule.Configuration.anonymousRole],orgModule.Organization=function(e){if(!e)throw new Error("Can't create Organization from undefined json or node");e.param?(this.id=e.param.id,this.name=e.name,this.uri=e.param.uri,this.treeNode=e):(this.id=e.tenantId||e.id,this.name=e.tenantName,this.alias=e.tenantAlias||e.alias,this.desc=e.tenantDesc,this.uri=e.tenantUri,this.parentId=e.parentId,this.subTenantCount=e.subTenantCount)},orgModule.Organization.addMethod("isRoot",function(e){return"organizations"==this.id}),orgModule.Organization.addMethod("getNameWithTenant",function(){return this.id}),orgModule.Organization.addMethod("getDisplayName",function(){return this.name}),orgModule.Organization.addMethod("equals",function(e){return e&&this.id==e.id}),orgModule.Organization.addMethod("toJSON",function(e){return{tenantId:this.id,tenantName:this.name,tenantAlias:this.alias,tenantDesc:this.desc,parentId:this.parentId,tenantUri:this.uri}}),orgModule.Organization.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.organization),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({tenantId:this.id}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.Permission=function(e){this.isInherited=!!e.isInherited,e.permission&&(this.permission=e.permission),e.inheritedPermission&&(this.inheritedPermission=e.inheritedPermission),this.isDisabled=!!e.isDisabled},orgModule.Permission.addMethod("getResolvedPermission",function(){return this.isInherited?this.inheritedPermission:this.permission}),orgModule.Permission.addMethod("toJSON",function(){return{permission:this.permission,isInherited:this.isInherited,inheritedPermission:this.inheritedPermission,newPermission:this.newPermission}}),orgModule.Permission.addMethod("toData",function(){return{permission:this.permission,isInherited:this.isInherited,inheritedPermission:this.inheritedPermission,newPermission:this.newPermission}}),orgModule.User=function(e){e&&(this.userName=e.userName,this.fullName=e.fullName,this.password=e.password||"",this.confirmPassword=e.confirmPassword||"",this.tenantId=e.tenantId,this.email=e.email,this.enabled=e.enabled,this.external=e.external,this.roles=[],e.roles&&e.roles.each(function(e){this.roles.push(new orgModule.Role(e))}.bind(this)),e.permissionToDisplay&&(this.permission=new orgModule.Permission(e.permissionToDisplay)))},orgModule.User.addVar("FLOW_ID","userListFlow"),orgModule.User.addMethod("getDisplayName",function(){return this.userName}),orgModule.User.addMethod("getNameWithTenant",function(){return this.tenantId&&!this.tenantId.blank()?this.userName+orgModule.Configuration.userNameSeparator+this.tenantId:this.userName}),orgModule.User.addMethod("getManagerURL",function(){return"flow.html?"+Object.toQueryString({_flowId:this.FLOW_ID,text:"undefined"!=typeof this.userName?encodeURIComponent(this.userName):this.userName,tenantId:"undefined"!=typeof this.tenantId?encodeURIComponent(this.tenantId):this.tenantId})}),orgModule.User.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.user),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({text:this.userName,tenantId:this.tenantId}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.User.addMethod("equals",function(e){return e&&this.userName==e.userName&&this.tenantId==e.tenantId}),orgModule.User.addMethod("toPermissionData",function(e){return{userName:this.userName,tenantId:this.tenantId,permissionToDisplay:this.permission.toData()}}),orgModule.Role=function(e){e&&(this.roleName=e.roleName,this.external=e.external,this.tenantId=e.tenantId),e.permissionToDisplay&&(this.permission=new orgModule.Permission(e.permissionToDisplay))},orgModule.Role.addVar("FLOW_ID","roleListFlow"),orgModule.Role.addMethod("getDisplayName",function(){return this.roleName}),orgModule.Role.addMethod("getNameWithTenant",function(){return this.tenantId&&!this.tenantId.blank()?this.roleName+orgModule.Configuration.userNameSeparator+this.tenantId:this.roleName}),orgModule.Role.addMethod("getManagerURL",function(){return"flow.html?"+Object.toQueryString({_flowId:this.FLOW_ID,text:"undefined"!=typeof this.roleName?encodeURIComponent(this.roleName):this.roleName,tenantId:"undefined"!=typeof this.tenantId?encodeURIComponent(this.tenantId):this.tenantId})}),orgModule.Role.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.role),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({text:this.roleName,tenantId:this.tenantId}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.Role.addMethod("equals",function(e){return e&&this.roleName==e.roleName&&this.tenantId==e.tenantId}),orgModule.Role.addMethod("toPermissionData",function(e){return{roleName:this.roleName,tenantId:this.tenantId,permissionToDisplay:this.permission.toData()}}),orgModule.initTenantsTreeEvents=function(){orgModule.manager.tenantsTree.on("selection:change",function(e){if(!orgModule.manager.lastSelectedOrg||orgModule.manager.lastSelectedOrg.id!==e.id){var t=new orgModule.Organization(e),i=orgModule.properties;orgModule.manager.tenantsTree.setTenant(t),window.localStorage&&localStorage.setItem(orgModule.COOKIE_NAME,JSON.stringify(e)),orgModule.fire(orgModule.Event.ORG_BROWSE,{organization:t,entityEvent:!1}),orgModule.orgManager&&(i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID]),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.id,entityEvent:!1})),(orgModule.userManager||orgModule.roleManager)&&(i.hide(),i.unlock())}}),orgModule.manager.tenantsTree.on("import:finished",function(e){var t=orgModule.properties;orgModule.fire(orgModule.Event.ORG_BROWSE,{force:!0,entityEvent:!1}),orgModule.orgManager&&(t.changeDisable(!1,["#"+t._EDIT_BUTTON_ID]),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{refreshAttributes:!0,entityId:e,entityEvent:!1}))})},orgModule.entityList={ID_PATTERN:".ID > a",_listId:"entitiesList",_containerId:"listContainer",_searchBoxId:"secondarySearchBox",initialize:function(e){this.list=new dynamicList.List(this._listId,{listTemplateDomId:e.listTemplateId,itemTemplateDomId:e.itemTemplateId,multiSelect:!0,selectionDefaultsToCursor:!0,comparator:function(e,t){return orgModule._comparator(e.getLabel(),t.getLabel())}}),this._initEvents(),this._infiniteScroll=new InfiniteScroll({id:this._containerId,contentId:this._listId}),this._searchBox=new SearchBox({id:this._searchBoxId}),e.text&&this._searchBox.setText(e.text),this._infiniteScroll.onLoad=function(){orgModule.fire(orgModule.Event.ENTITY_NEXT,{})},this._searchBox.onSearch=function(e){orgModule.fire(orgModule.Event.ENTITY_SEARCH,{text:e})},orgModule.toolbar.initialize(e.toolbarModel),this.toolbar=orgModule.toolbar,this.list.show()},_initEvents:function(){this.list.observe("item:selected",function(e){var t=e.memo.item,i=orgModule.properties;this.lastSelectedName=t.getValue().getNameWithTenant(),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.getValue().id,entityEvent:!0}),i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID])}.bindAsEventListener(this)),this.list.observe("item:unselected",function(e){var t=orgModule.manager.tenantsTree,i=orgModule.properties;i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID]),!i.locked&&t?orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.getTenant().id,entityEvent:!0,isCtrlHeld:e.memo.isCtrlHeld}):(i.hide(),this.toolbar.refresh())}.bindAsEventListener(this)),this.list.observe("item:beforeSelectOrUnselect",function(e){var t=e.memo.item;e.stopSelectOrUnselect=!invokeClientAction("cancelIfEdit",{entity:t.getValue(),showConfirm:e.memo.showConfirm})}.bindAsEventListener(this))},_createEntityItem:function(e){var t=new dynamicList.ListItem({label:e.getDisplayName(),value:e}),i=this;return t.processTemplate=function(e){var t=e.select(i.ID_PATTERN)[0];return t.update(xssUtil.escape(this.getValue().getDisplayName())),e},t},getSearchText:function(){return this._searchBox.getText()},setSearchText:function(e){return this._searchBox.setText(e)},getSelectedEntities:function(){return this.list?this.list.getSelectedItems().collect(function(e){return e.getValue()}):[]},setEntities:function(e){var t=e.collect(this._createEntityItem.bind(this));this._infiniteScroll.reset(),this.list.setItems(t),this.list.show(),this.toolbar.refresh()},findEntity:function(e){var t=this.list.getItems(),i=orgModule.properties.options||orgModule.userManager.options;return i._.find(t,function(t){return t.getValue().fullName===e})},addEntities:function(e){var t=e.collect(this._createEntityItem.bind(this));this.list.addItems(t),this.list.refresh(),this.toolbar.refresh()},selectEntity:function(e){var t=this.list.getItems(),i=t.detect(function(t){return t.getValue().getNameWithTenant()==e});i&&(i.isSelected()&&i.deselect(),i.select(),this.lastSelectedName=i.getValue().getNameWithTenant())},restoreSelectedEntity:function(e){this.selectEntity(this.lastSelectedName?this.lastSelectedName:e)},deselectAll:function(){this.list.resetSelected()},update:function(e,t){var i=this.list.getItems(),n=i.findAll(function(t){return t.getValue().getNameWithTenant()==e});n.each(function(e){e.setValue(t),e.refresh()})},remove:function(e){var t,i=this.list.getItems();t=isArray(e)?i.findAll(function(t){return e.include(t.getValue().getNameWithTenant())}):i.findAll(function(t){return t.getValue().getNameWithTenant()==e}),this.list.resetSelected(),this.list.removeItems(t)}},orgModule.properties={_EDIT_MODE_CLASS:"editMode",_moveButtonsId:"moveButtons",_id:"properties",_value:null,isEditMode:!1,_NOTHING_TO_DISPLAY_ID:"nothingToDisplay",_ASSIGNED_VIEW_ID:"assignedView",_ASSIGNED_VIEW_LIST_ID:"assignedViewList",_ASSIGNED_ID:"assigned",_AVAILABLE_ID:"available",_ASSIGNED_LIST_ID:"assignedList",_AVAILABLE_LIST_ID:"availableList",_ATTRIBUTES_LIST_ID:"attributesTab",_EDIT_BUTTON_ID:"edit",_SAVE_BUTTON_ID:"save",_CANCEL_BUTTON_ID:"cancel",_DELETE_BUTTON_ID:"delete",_REMOVE_FROM_ASSIGNED_BUTTON_ID:"removeFromAssigned",_ADD_TO_ASSIGNED_BUTTON_ID:"addToAssigned",_BUTTONS_CONTAINER_ID:"propertiesButtons",_MOVE_BUTTONS_CONTAINER_ID:"moveButtons",_DND_CLASS:".draggable",_DROP_CLASS:"wrap",buttonsFunctions:{},initialize:function(e){var t=e.attributesTypesEnum;if(this.options=e,this.locked=!1,this.hide(),this.processTemplate(e),this._toggleButton(),e.attributes){var i=!orgModule.userManager&&orgModule.orgManager?t.TENANT:t.USER,n=e.attributesViewOptionsFactory,o=e.scrollEventTrait,s=e.AttributesViewFacade;this.options._.extend(this,o),this.attributesFacade=new s(n({context:e.attributes.context,container:jQuery("#attributesTab"),type:i}))}this.options.showAssigned&&this.initDnD(),this.initEvents(),this.initButtonsFunctions(),this.options.ConfirmationDialog&&this._initConfirmationDialog()},_initConfirmationDialog:function(){var e=this,t=this.options.i18n;this.confirmationDialog=new this.options.ConfirmationDialog({title:t["attributes.confirm.dialog.title"],text:t["attributes.confirm.cancel.dialog.text"]}),this.confirmationDialog.on("button:yes",function(){e.cancelOnEdit()})},_toggleButton:function(){var e=this.isChanged(),t=this.attributesFacade&&this.attributesFacade.containsUnsavedItems()||e;t?this.saveButton.removeAttribute("disabled"):this.saveButton.removeClassName("over").setAttribute("disabled","disabled")},show:function(e,t){if(!this.locked){if(this.attributesFacade){var i=this,n=e&&e.isRoot&&e.isRoot(),o=n?this.options._.extend({},e,{id:null}):e;this.attributesFacade.getCurrentView().setContext(o,t).done(function(){i.attributesFacade.render(n)})}var s=$(this._NOTHING_TO_DISPLAY_ID);s.addClassName(layoutModule.HIDDEN_CLASS),document.body.removeClassName(layoutModule.NOTHING_TO_DISPLAY_CLASS),this._value=e,this.changeMode(!1)}},hide:function(){if(!this.locked){var e=$(this._NOTHING_TO_DISPLAY_ID);e.removeClassName(layoutModule.HIDDEN_CLASS),centerElement(e,{horz:!0,vert:!0}),document.body.addClassName(layoutModule.NOTHING_TO_DISPLAY_CLASS),this._value=null,this.changeMode(!1)}},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},setDetailsLoadedEntity:function(e){this.detailsLoadedEntity=e},getDetailsLoadedEntity:function(){return this.detailsLoadedEntity},processTemplate:function(e){if(this.editButton=$(this._EDIT_BUTTON_ID),this.saveButton=$(this._SAVE_BUTTON_ID),this.cancelButton=$(this._CANCEL_BUTTON_ID),this.deleteButton=$(this._DELETE_BUTTON_ID),this.options.showAssigned){this.removeFromAssigned=$(this._REMOVE_FROM_ASSIGNED_BUTTON_ID),this.addToAssigned=$(this._ADD_TO_ASSIGNED_BUTTON_ID),this.assignedViewList=new dynamicList.List(this._ASSIGNED_VIEW_LIST_ID,{listTemplateDomId:e.viewAssignedListTemplateDomId,itemTemplateDomId:e.viewAssignedItemTemplateDomId,comparator:this.assignedComparator,allowSelections:!1,selectionDefaultsToCursor:!1});var t={listTemplateDomId:"list_responsive_collapsible_fields",itemTemplateDomId:"list_responsive_collapsible_fields:fields",comparator:this.assignedComparator,dragPattern:this._DND_CLASS,allowSelections:!0,selectionDefaultsToCursor:!0,multiSelect:!0,selectOnMousedown:!0,setCursorOnMouseDown:!0};this.assignedList=new dynamicList.List(this._ASSIGNED_LIST_ID,Object.extend({},t,{allowSelections:!1,selectionDefaultsToCursor:!1})),this.availableList=new dynamicList.List(this._AVAILABLE_LIST_ID,t),e.searchAssigned&&(this.assignedViewSearchBox=new SearchBox({id:$(this._ASSIGNED_VIEW_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.assignedViewSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:e})}),this.availableSearchBox=new SearchBox({id:$(this._AVAILABLE_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.availableSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_AVAILABLE,{text:e})},this.assignedSearchBox=new SearchBox({id:$(this._ASSIGNED_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.assignedSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:e})},e.searchAssigned&&(this.assignedViewInfiniteScroll=new InfiniteScroll({id:$($(this._ASSIGNED_VIEW_LIST_ID).parentNode).identify(),contentId:this._ASSIGNED_VIEW_LIST_ID}),this.assignedViewInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_ASSIGNED,{})}),this.availableInfiniteScroll=new InfiniteScroll({id:$($(this._AVAILABLE_LIST_ID).parentNode).identify(),contentId:this._AVAILABLE_LIST_ID}),this.availableInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_AVAILABLE,{})},this.assignedInfiniteScroll=new InfiniteScroll({id:$($(this._ASSIGNED_LIST_ID).parentNode).identify(),contentId:this._ASSIGNED_LIST_ID}),this.assignedInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_ASSIGNED,{})}}},initDnD:function(){Droppables.add($(this._ASSIGNED_LIST_ID).up(),{accept:[this._DROP_CLASS],hoverclass:layoutModule.DROP_TARGET_CLASS,onDrop:function(e,t,i){e.items&&this._addToAssigned()}.bind(this)}),Droppables.add($(this._AVAILABLE_LIST_ID).up(),{accept:[this._DROP_CLASS],hoverclass:layoutModule.DROP_TARGET_CLASS,onDrop:function(e,t,i){e.items&&this._removeFromAssigned()}.bind(this)})},initEvents:function(){function e(){(this.assignedList.getSelectedItems().length>0?buttonManager.enable:buttonManager.disable)(this.removeFromAssigned)}function t(){(this.availableList.getSelectedItems().length>0?buttonManager.enable:buttonManager.disable)(this.addToAssigned)}$(this._BUTTONS_CONTAINER_ID).observe("click",function(e){var t=e.element(),i=matchAny(t,[layoutModule.BUTTON_PATTERN],!0);i&&this.buttonsFunctions[i.identify()]&&this.buttonsFunctions[i.identify()].call(this),e.stop()}.bindAsEventListener(this)),this.options.showAssigned&&($(this._MOVE_BUTTONS_CONTAINER_ID).observe("click",function(e){var t=e.element(),i=matchAny(t,[layoutModule.BUTTON_PATTERN],!0);i&&(i==this.removeFromAssigned?this._removeFromAssigned():i==this.addToAssigned&&this._addToAssigned()),e.stop()}.bindAsEventListener(this)),this.assignedList.observe("item:selected",e.bindAsEventListener(this)),this.assignedList.observe("item:unselected",e.bindAsEventListener(this)),this.assignedList.observe("item:dblclick",function(e){this._removeFromAssigned()}.bindAsEventListener(this)),this.availableList.observe("item:selected",t.bindAsEventListener(this)),this.availableList.observe("item:unselected",t.bindAsEventListener(this)),this.availableList.observe("item:dblclick",function(e){this._addToAssigned()}.bindAsEventListener(this))),this.attributesFacade&&this.attributesFacade.on("change",this.options._.bind(this._toggleButton,this))},initButtonsFunctions:function(){this.buttonsFunctions[this._EDIT_BUTTON_ID]=function(){this.changeMode(!0)},this.buttonsFunctions[this._SAVE_BUTTON_ID]=function(){var e=this,t=new jQuery.Deferred;this.validate()&&(this.attributesFacade?this.attributesFacade.getCurrentView().saveChildren().done(function(){t.resolve()}).fail(function(){t.reject(),jQuery(".tab[tabid='#attributesTab']").trigger("mouseup")}):t.resolve(),t.done(function(){e.save(e._value)}))},this.buttonsFunctions[this._CANCEL_BUTTON_ID]=function(){this.attributesFacade?this.isChanged()?this.confirmationDialog.open():this.cancelOnEdit():invokeClientAction("cancelIfEdit",{entity:this.getValue()})},this.buttonsFunctions[this._DELETE_BUTTON_ID]=function(){this._deleteEntity()},this.buttonsFunctions[this._REMOVE_FROM_ASSIGNED_BUTTON_ID]=function(){this._removeFromAssigned()},this.buttonsFunctions[this._ADD_TO_ASSIGNED_BUTTON_ID]=function(){this._addFromAssigned()}},cancelOnEdit:function(){var e=this;this.isEditMode&&this.cancel().done(function(){e.unlock(),e.changeMode(!1),e._toggleButton()})},changeMode:function(e){this.isEditMode=e;var t,i,n,o;if(this.attributesFacade){i=$("attributesTab");var s=!!this._value&&"organizations"===this._value.id;this.detachScrollEvent(this.attributesFacade.getCurrentView().$container.parent()),this.attributesFacade.toggleMode(e,s),e&&this.initScrollEvent(this.attributesFacade.getCurrentView()),t=$$(".tertiary")[0],n=$("propertiesTab"),o=jQuery(".control.tabSet.anchor")}e?($(this._id).addClassName(this._EDIT_MODE_CLASS),t&&(t.down(".selected").removeClassName("selected"),t.down("li",0).addClassName("selected"),t.addClassName("tabbed"),i.addClassName("hidden"),n.removeClassName("hidden"),o.removeClass("attributesAnchor")),this._assigned=[],this._unassigned=[],this.options.showAssigned&&(centerElement($(this._moveButtonsId),{horz:!0}),$(this._moveButtonsId).style.zIndex=1e3,this.assignedList.setItems([]),this.assignedList.show(),this.availableList.setItems([]),this.availableList.show(),buttonManager.disable(this.removeFromAssigned),buttonManager.disable(this.addToAssigned),this.assignedSearchBox.setText(""),this.availableSearchBox.setText(""),invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:this.assignedSearchBox.getText()}),invokeServerAction(orgModule.ActionMap.SEARCH_AVAILABLE,{text:this.availableSearchBox.getText()})),this._editEntity(),this._toggleButton()):($(this._id).removeClassName(this._EDIT_MODE_CLASS),t&&(i.removeClassName("hidden"),n.removeClassName("hidden"),t.removeClassName("tabbed")),this.options.searchAssigned&&this.assignedViewSearchBox&&this.assignedViewSearchBox.setText(""),this.changeDisable(this.canEdit(),["#"+this._EDIT_BUTTON_ID]),this.changeDisable(this.canDelete(),["#"+this._DELETE_BUTTON_ID]),this._showEntity(),this._assigned=[],this._unassigned=[])},canEdit:function(){return!0},canDelete:function(){var e=orgModule.manager.tree&&orgModule.manager.tree.getOrganization();return e&&"/"===e.uri&&!orgModule.entityList.getSelectedEntities().length?!1:!0},setValuesProperty:function(e,t){this._value[e]=t},getValue:function(){return this._value},setProperties:function(e){},isChanged:function(e){},save:function(e){},validate:function(){return!0},assignedComparator:function(e,t){var i=e.getLabel(),n=t.getLabel();return i>n?1:n>i?-1:0},_moveEntities:function(e){var t,i,n,o;e?(t=this._unassigned,n=this.availableList,i=this._assigned,o=this.assignedList):(t=this._assigned,n=this.assignedList,i=this._unassigned,o=this.availableList);var s=n.getSelectedItems(),r=s.collect(function(e){return e.getValue()});i=i.concat(r.collect(function(t){return t.available==e?t:null})).compact(),t=t.reject(function(e){return r.detect(function(t){return e.equals(t)})}),n.removeItems(s),o.addItems(s,!0),o.refresh(),e?(this._unassigned=t,this._assigned=i):(this._assigned=t,this._unassigned=i)},_addToAssigned:function(){this._moveEntities(!0)},_removeFromAssigned:function(){this._moveEntities(!1)},_entitiesToItems:function(e,t){return e=e?e:[],e.collect(function(e){var i="",n=[],o="orgTooltip";e instanceof orgModule.User?(i=e.userName,e.fullName&&e.fullName.length>0&&(n=[e.fullName]),o=e.tenantId?"fullNameAndOrgTooltip":"fullNameTooltip"):e instanceof orgModule.Role&&(i=e.roleName,o=e.tenantId?"orgTooltip":void 0),e.tenantId&&e.tenantId.length>0&&n.push(e.tenantId),e.available=!!t;var s=new dynamicList.ListItem({label:i,value:e});return this.isEditMode?s.processTemplate=function(e){return n.length>0&&new JSTooltip(e,{text:xssUtil.escape(n),templateId:o}),dynamicList.ListItem.prototype.processTemplate.call(this,e)}:s.processTemplate=function(e){var t=e.select("a")[0];return t.insert(xssUtil.escape(this.getLabel())),t.writeAttribute("href",this.getValue().getManagerURL()),n.length>0&&new JSTooltip(e,{text:xssUtil.escape(n),templateId:o}),e},s}.bind(this))},getAssignedEntities:function(){return this._assigned},getUnassignedEntities:function(){return this._unassigned},setAssignedEntities:function(e){this.assignedViewInfiniteScroll&&this.assignedViewInfiniteScroll.reset(),this.assignedInfiniteScroll&&this.assignedInfiniteScroll.reset();var t=this.isEditMode?this.assignedList:this.assignedViewList,i=this._filterEntities(e,this._unassigned,this._assigned,this.assignedSearchBox.getText());t.setItems(this._entitiesToItems(i)),t.refresh()},addAssignedEntities:function(e){var t=this.isEditMode?this.assignedList:this.assignedViewList,i=this._filterEntities(e,this._unassigned,this._assigned,this.assignedSearchBox.getText());t.addItems(this._entitiesToItems(i)),t.refresh()},setAvailableEntities:function(e){this.availableInfiniteScroll.reset();var t=this._filterEntities(e,this._assigned,this._unassigned,this.availableSearchBox.getText());this.availableList.setItems(this._entitiesToItems(t,!0)),this.availableList.refresh()},addAvailableEntities:function(e){var t=this._filterEntities(e,this._assigned,this._unassigned,this.availableSearchBox.getText());this.availableList.addItems(this._entitiesToItems(t,!0)),this.availableList.refresh()},_filterEntities:function(e,t,i,n){var o=e.reject(function(e){return t.detect(function(t){return t.equals(e)})});return n=n.toLowerCase(),o=o.concat(i.findAll(function(e){return e.getDisplayName().toLowerCase().include(n)}))},changeReadonly:function(e,t){t.each(function(t){$(this._id).select(t)[0].writeAttribute(layoutModule.READONLY_ATTR_NAME,e?null:layoutModule.READONLY_ATTR_NAME)}.bind(this))},resetValidation:function(e){var t=$(this._id);e.each(function(e){ValidationModule.hideError(t.select(e)[0])}.bind(this))},changeDisable:function(e,t){t.each(function(t){e?buttonManager.enable($(this._id).select(t)[0]):buttonManager.disable($(this._id).select(t)[0])}.bind(this))},_deleteEntity:function(){},_editEntity:function(){},_showEntity:function(){}},orgModule.addDialog={show:function(e){},hide:function(e){}},orgModule.Action=function(e,t){Object.isFunction(e)&&(t=t&&Object.isFunction(t)?t:this.beforeInvoke,this.invokeAction=function(){return t()?e.apply(this,arguments):void 0})},orgModule.Action.addMethod("invokeAction",doNothing),orgModule.Action.addMethod("beforeInvoke",function(){return!0}),orgModule.ServerAction=function(e,t){this.actionURL="flow.html?_flowExecutionKey="+localContext.flowExecutionKey+"&_eventId="+e,this.data=Object.toQueryString(t),this.onSuccess=doNothing(),this.onError=doNothing()},orgModule.ServerAction.addMethod("invokeAction",function(){this.beforeInvoke()&&ajaxTargettedUpdate(this.actionURL,{postData:this.data,callback:function(e){e.error?this.onError(e.error):this.onSuccess(e.data)}.bind(this),errorHandler:function(e){return e.getResponseHeader("LoginRequested")?(orgModule.fire(orgModule.Event.SERVER_UNAVAILABLE,{}),!0):baseErrorHandler(e)},mode:AjaxRequester.prototype.EVAL_JSON})}),orgModule.ServerAction.addMethod("beforeInvoke",function(){return!0}),orgModule.toolbar={_actionModel:{},initialize:function(e){this._actionModel=e,toolbarButtonModule.initialize(this._toActionMap(this._actionModel)),this.refresh()},refresh:function(){for(var e in this._actionModel){var t=this._actionModel[e].buttonId,i=toFunction(this._actionModel[e].test);toolbarButtonModule.setButtonState($(t),i());
}},_toActionMap:function(e){var t={};for(var i in e){var n=e[i],o=n.buttonId;t[o]=function(e,t){return function(){var i=getAsFunction(e),n=t,o=localContext&&localContext[e];n&&isArray(n)?i.apply(o?localContext:null,n):i.call(o?localContext:null,n)}}(n.action,n.actionArgs)}return t}},orgModule.createInputRegExValidator=function(e){return{validator:function(t){var i=e.regExp.test(t),n=!i,o=n?"":orgModule.getMessage("unsupportedSymbols",{symbols:e.unsupportedSymbols});return e.isValid=n,{isValid:n,errorMessage:o}},element:e}},orgModule.createBlankValidator=function(e,t,i,n){return{validator:function(e){var i=!e.blank(),n=i?"":orgModule.getMessage(t);return{isValid:i,errorMessage:n}},element:e,onValid:i,onInvalid:n}},orgModule.createMaxLengthValidator=function(e,t,i){return{validator:function(n){var o=e.hasAttribute("maxlength")?e.readAttribute("maxlength"):e.maxlength,s=n.length<parseInt(o),r=s?"":orgModule.getMessage(t);return i&&(r=r.replace(i,o)),{isValid:s,errorMessage:r}},element:e}},orgModule.createSameValidator=function(e,t,i){return{validator:function(e){var n=e===t.getValue(),o=n?"":orgModule.getMessage(i);return{isValid:n,errorMessage:o}},element:e}},orgModule.createRegExpValidator=function(e,t,i){return"string"==typeof i&&(i=window.XRegExp?XRegExp(i):new RegExp(i)),{validator:function(e){var n=i.exec(e),o=!n&&0===e.length||n&&e==n[0],s=o?"":orgModule.getMessage(t);return{isValid:o,errorMessage:s}},element:e}},orgModule.truncateOrgName=function(e){return e&&e.length>0?e.truncate(15):""},RegExpRepresenter.addMethod("__parse",function(e){for(var t=$A(),i=1;i<e.length-1;i++){var n=e.charAt(i);"\\"==n&&(n+=e.charAt(++i)),"\\u"==n&&(n+=e.substring(++i,i+4),i+=3),t.push(n)}return t}),RegExpRepresenter.addMethod("getCharacters",function(){var result=$A();return this.expressionTokens.each(function(token){if(token.startsWith("\\u"))result.push(eval('"'+token+'"'));else if(token.startsWith("\\")){var ch=this.charMap[token];result.push(ch?ch:token.substring(1,token.length))}else result.push(token)}.bind(this)),result}),RegExpRepresenter.addMethod("getRepresentedString",function(){for(var e="",t=this.getCharacters(),i=t.length,n=0;i>n;n++){var o=t[n];e+=" "==o||"."==o||","==o?"["+o+"]":o,i-1>n&&(e+=", ")}return e}),define("mng.common",["jquery","underscore","prototype","utils.common","tools.infiniteScroll","components.list","components.dynamicTree","components.toolbar","common/component/dialog/ConfirmationDialog"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.confirmAndLeave=function(){var e=orgModule.entityList.getSelectedEntities();return orgModule.properties.attributesFacade?!0:invokeClientAction("cancelIfEdit",{entity:e[0],entityEvent:!1})},orgModule.manager={initialize:function(e){this.options=e,this.state=e.state,_.extend(this.state,{id:this.state.tenantId}),isProVersion()&&(this.tenantsTree=new e.TenantsTreeView({container:"#folders .body",currentUser:e.currentUser,removeContextMenuTreePlugin:e.removeContextMenuTreePlugin,selectedTenant:this.state,comparator:function(e,t){return orgModule._comparator(e.tenantName,t.tenantName)}}),orgModule.initTenantsTreeEvents(),this.tenantsTree.render()),orgModule.observe("org:browse",function(e){var t;this.tenantsTree&&(t=this.tenantsTree.getTenant());var i=e.memo.entityEvent,n=e.memo.force;if(n||!this.lastSelectedOrg||this.lastSelectedOrg.id!=t.id){var o=orgModule.entityList.getSelectedEntities();invokeClientAction("cancelIfEdit",{entity:o[0]||t,entityEvent:i})?(invokeServerAction(orgModule.ActionMap.BROWSE,{tenantId:t?t.id:null}),this.lastSelectedOrg=t):this.lastSelectedOrg&&this.tenantsTree.selectTenant(this.lastSelectedOrg.id)}}.bindAsEventListener(this)),orgModule.observe("entity:search",function(e){var t,i=orgModule.entityList.getSelectedEntities(),n=e.memo.text;this.tenantsTree&&(t=this.tenantsTree.getTenant()),invokeClientAction("cancelIfEdit",{entity:i[0]||t})?(invokeServerAction(orgModule.ActionMap.SEARCH,{text:n}),this.lastSearchText=n):0===n.length&&this.lastSearchText&&0!==this.lastSearchText.length&&orgModule.entityList.setSearchText(this.lastSearchText)}.bindAsEventListener(this)),orgModule.observe("entity:next",function(e){invokeServerAction(orgModule.ActionMap.NEXT,{})}.bindAsEventListener(this)),orgModule.observe("entity:selectAndGetDetails",function(e){var t=e.memo.entityEvent,i=e.memo.isCtrlHeld,n=e.memo.cancelIfEdit,o=orgModule.entityList.getSelectedEntities(),s=Boolean(e.memo.refreshAttributes);if(o.length>1)orgModule.properties.hide();else{var r,a=o[0];if(r=a&&t?a.getNameWithTenant():(!t||i||n)&&e.memo.entityId,!a&&(orgModule.userManager||!orgModule.userManager&&orgModule.roleManager)&&i)return void orgModule.properties.hide();r&&invokeServerAction(orgModule.ActionMap.SELECT_AND_GET_DETAILS,{refreshAttributes:s,entity:r})}}.bindAsEventListener(this)),orgModule.observe("result:changed",function(t){var i=t.memo.responseData;orgModule.entityList.setEntities(i.entities.collect(this.entityJsonToObject)),e.defaultEntity&&orgModule.entityList.restoreSelectedEntity(e.defaultEntity)}.bindAsEventListener(this)),orgModule.observe("result:next",function(e){var t=e.memo.responseData;t.entities.length>0&&orgModule.entityList.addEntities(t.entities.collect(this.entityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("entity:detailsLoaded",function(e){var t=this.entityJsonToObject(e.memo.responseData),i=orgModule.properties,n=e.memo.inputData.refreshAttributes;orgModule.entityList.update(t.getNameWithTenant(),t),i.setDetailsLoadedEntity(t),i.show(t,n),!i.locked&&i.setProperties(t),orgModule.entityList.toolbar.refresh(),i.unlock()}.bindAsEventListener(this)),orgModule.observe("searchAvailable:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&orgModule.properties.setAvailableEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("searchAssigned:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&orgModule.properties.setAssignedEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("nextAvailable:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&t.entities.length>0&&orgModule.properties.addAvailableEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("nextAssigned:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&t.entities.length>0&&orgModule.properties.addAssignedEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("server:error",function(e){var t=e.memo.responseData;t&&alert(t.message+"\n\n"+t.description?t.description:"")}),orgModule.observe("entity:created",function(e){orgModule.addDialog.hide();var t=e.memo.inputData.entity;if(t){var i=this.entityJsonToObject(t.evalJSON());orgModule.entityList.addEntities([i]),orgModule.entityList.deselectAll(),orgModule.entityList.selectEntity(i.getNameWithTenant())}}.bindAsEventListener(this)),orgModule.observe("entity:updated",function(e){var t=this,i=e.memo.inputData.entityName,n=e.memo.responseData;n.roles||(n=e.memo.unencryptedEntity),n||(n=e.memo.inputData.entity);var o=orgModule.properties.attributesFacade||{},s=o.designer&&o.designer.saveDfD;orgModule.properties.isEditMode&&(s?s.done(function(){orgModule.properties.changeMode(!1)}):orgModule.properties.changeMode(!1)),n&&(s?s.done(function(){t.updateEntityList(n,i)}):this.updateEntityList(n,i))}.bindAsEventListener(this)),orgModule.observe("entity:deleted",function(e){var t=e.memo.inputData.entity;orgModule.entityList.remove(t)}.bindAsEventListener(this)),orgModule.observe("entities:deleted",function(e){var t=e.memo.inputData.entities;t&&orgModule.entityList.remove(t.evalJSON())}.bindAsEventListener(this))},updateEntityList:function(e,t){var i=this.entityJsonToObject(e.evalJSON?e.evalJSON():e);orgModule.entityList.update(t,i),orgModule.entityList.selectEntity(i.getNameWithTenant?i.getNameWithTenant():t)},entityJsonToObject:function(e){},relatedEntityJsonToObject:function(e){},reloadEntities:function(){orgModule.fire(orgModule.Event.ORG_BROWSE,{})},isUserSuperuser:function(){var e=isProVersion()?orgModule.Configuration.superuserRole:orgModule.Configuration.adminRole,t=this.options.currentUserRoles;return null!=t.detect(function(t){return t.roleName==e&&!t.tenantId})}},define("mng.main",["jquery","mng.common"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.roleManager={Event:{},Action:{},initialize:function(e){layoutModule.resizeOnClient("folders","roles","properties"),webHelpModule.setCurrentContext("admin");var t=_.extend(e,localContext.roleMngInitOptions,{removeContextMenuTreePlugin:!0});orgModule.manager.initialize(t),orgModule.manager.entityJsonToObject=function(e){return new orgModule.Role(e)},orgModule.manager.relatedEntityJsonToObject=function(e){return new orgModule.User(e)},this.roleList.initialize({toolbarModel:this.actionModel,text:orgModule.manager.state.text}),orgModule.addDialog.show=function(e){this.addDialog.show(e)}.bind(this),orgModule.addDialog.hide=function(e){this.addDialog.hide(e)}.bind(this),this.properties.initialize(),this.addDialog.initialize(),orgModule.observe("server:unavailable",function(e){var t=orgModule.manager.tree,i=t?t.getOrganization().id:null;new orgModule.Role({roleName:"",tenantId:i}).navigateToManager()}.bindAsEventListener(this)),orgModule.observe("entity:deleted",function(){orgModule.properties.hide()}),orgModule.observe("entities:deleted",function(){orgModule.properties.hide()}),isProVersion()||orgModule.manager.reloadEntities()},actionModel:{ADD:{buttonId:"addNewRoleBtn",action:invokeClientAction,actionArgs:"create",test:canAddRole},DELETE:{buttonId:"deleteAllRolesBtn",action:invokeClientAction,actionArgs:"deleteAll",test:canDeleteAll}}},"undefined"==typeof require&&document.observe("dom:loaded",orgModule.roleManager.initialize.bind(orgModule.roleManager)),define("org.role.mng.main",["jquery","mng.main","components.webHelp"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.roleManager.roleList={CE_LIST_TEMPLATE_ID:"tabular_oneColumn:roles",CE_ITEM_TEMPLATE_ID:"tabular_oneColumn:roles:leaf",PRO_LIST_TEMPLATE_ID:"tabular_twoColumn:roles",PRO_ITEM_TEMPLATE_ID:"tabular_twoColumn:roles:leaf",ROLE_ID_PATTERN:".ID",ROLE_ORGANIZATION_PATTERN:".organization",initialize:function(e){orgModule.entityList.initialize({listTemplateId:isProVersion()?this.PRO_LIST_TEMPLATE_ID:this.CE_LIST_TEMPLATE_ID,itemTemplateId:isProVersion()?this.PRO_ITEM_TEMPLATE_ID:this.CE_ITEM_TEMPLATE_ID,toolbarModel:e.toolbarModel,text:e.text}),orgModule.entityList._createEntityItem=function(e){var t=new dynamicList.ListItem({label:e.roleName,value:e});return t.processTemplate=function(e){var t=e.select(orgModule.roleManager.roleList.ROLE_ID_PATTERN)[0];t.update(xssUtil.escape(this.getValue().roleName));var i=this.getValue().tenantId;if(isProVersion()&&i){var n=e.select(orgModule.roleManager.roleList.ROLE_ORGANIZATION_PATTERN)[0];n.update(xssUtil.escape(i))}return e},t}}},orgModule.roleManager.properties={ROLE_NAME_PATTERN:"#roleName",EXTERNAL_ROLE_PATTERN:"#externalRole",role:null,initialize:function(){orgModule.properties.initialize({viewAssignedListTemplateDomId:"list_responsive_fields",viewAssignedItemTemplateDomId:"list_responsive_fields:leaf",searchAssigned:!0,showAssigned:!0});var e=$(orgModule.properties._id);this.roleName=e.select(this.ROLE_NAME_PATTERN)[0],this.external=e.select(this.EXTERNAL_ROLE_PATTERN)[0],this.roleName.regExp=new RegExp(orgModule.Configuration.roleNameNotSupportedSymbols),this.roleName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.roleNameNotSupportedSymbols).getRepresentedString(),this.roleName.inputValidator=orgModule.createInputRegExValidator(this.roleName),this._validators=[orgModule.createBlankValidator(this.roleName,"roleNameIsEmpty"),this.roleName.inputValidator],this._initCustomEvents(),orgModule.properties.setProperties=function(e){var t=orgModule.roleManager.properties;t.roleName.setValue(e.roleName),t.external.checked=e.external,e.external?t.external.up("fieldset").removeClassName(layoutModule.HIDDEN_CLASS):t.external.up("fieldset").addClassName(layoutModule.HIDDEN_CLASS),invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:""})},orgModule.properties._deleteEntity=function(){invokeClientAction(orgModule.ActionMap.DELETE,{entity:this._value})},orgModule.properties._editEntity=function(){var e=orgModule.roleManager.properties;this.resetValidation([e.ROLE_NAME_PATTERN]),this.changeReadonly(!0,[e.ROLE_NAME_PATTERN])},orgModule.properties._showEntity=function(){var e=orgModule.roleManager.properties;this.resetValidation([e.ROLE_NAME_PATTERN]),this.changeReadonly(!1,[e.ROLE_NAME_PATTERN])},orgModule.properties.validate=function(){var e=orgModule.roleManager.properties,t=e._toRole(this._value.tenantId);return t.roleName!=this._value.roleName?ValidationModule.validateLegacy(e._validators)&&invokeServerAction(orgModule.ActionMap.EXIST,{entity:t,onExist:function(){ValidationModule.showError(e.roleName,orgModule.messages.roleNameIsAlreadyInUse)}.bind(this),onNotExist:function(){ValidationModule.hideError(e.roleName),this.save(t)}.bind(this)}):void this.save(t)},orgModule.properties.isChanged=function(){var e=orgModule.roleManager.properties,t=this._value,i=e._toRole();return this.isEditMode&&(t.roleName!=i.roleName||this.getAssignedEntities().length>0||this.getUnassignedEntities().length>0)},orgModule.properties.save=function(e){invokeServerAction("update",{entityName:this._value.getNameWithTenant(),entity:e,assigned:this.getAssignedEntities(),unassigned:this.getUnassignedEntities()})},orgModule.properties.cancel=function(){var e=new jQuery.Deferred;return this.setProperties(this._value),e.resolve()},orgModule.properties.canEdit=function(){return null==this._value?!0:canEditRole(this._value)},orgModule.properties.canDelete=function(){return null==this._value?!0:canDeleteRole(this._value)}},_initCustomEvents:function(e){var t=$(orgModule.properties._id),i=jQuery("#moveButtons, #userEnable"),n=jQuery("#editUsers").find("#assigned, #available");t.observe("keyup",function(e){var t=e.element();t==this.roleName&&(ValidationModule.validateLegacy([t.inputValidator]),e.stop()),orgModule.properties._toggleButton()}.bindAsEventListener(this)),i.on("click",function(e){orgModule.properties._toggleButton()}),n.on("dblclick",function(){orgModule.properties._toggleButton()})},_toRole:function(e){var t=$(orgModule.properties._id),i=new orgModule.Role({roleName:t.select(this.ROLE_NAME_PATTERN)[0].getValue()});return e&&(i.tenantId=e),i.users=orgModule.properties.getAssignedEntities(),i}},orgModule.roleManager.addDialog={ADD_ROLE_ID:"addRole",ADD_ROLE_BUTTON_ID:"addRoleBtn",CANCEL_ROLE_BUTTON_ID:"cancelAddRoleBtn",ADD_ROLE_NAME_ID:"addRoleName",ADD_ROLE_BUTTON_TITLE_PATTERN:".wrap",initialize:function(){this.addRole=$(this.ADD_ROLE_ID),this.addBtn=$(this.ADD_ROLE_BUTTON_ID),this.cancelBtn=$(this.CANCEL_ROLE_BUTTON_ID),this.roleName=$(this.ADD_ROLE_NAME_ID),this.roleName.regExp=new RegExp(orgModule.Configuration.roleNameNotSupportedSymbols),this.roleName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.roleNameNotSupportedSymbols).getRepresentedString(),this.roleName.inputValidator=orgModule.createInputRegExValidator(this.roleName),this._validators=[orgModule.createBlankValidator(this.roleName,"roleNameIsEmpty"),this.roleName.inputValidator],this.addRole.observe("keyup",function(e){var t=e.element();t==this.roleName&&(ValidationModule.validateLegacy([t.inputValidator]),e.stop())}.bindAsEventListener(this)),this.addRole.observe("click",function(e){var t=matchAny(e.element(),[layoutModule.BUTTON_PATTERN],!0);t==this.addBtn?this._doAdd():t==this.cancelBtn&&this.hide()}.bindAsEventListener(this))},show:function(e){this.organization=e,ValidationModule.hideError(this.roleName);var t=this.addBtn.select(this.ADD_ROLE_BUTTON_TITLE_PATTERN)[0];if(t){var i=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addRoleTo",{organizationName:orgModule.truncateOrgName(this.organization.id)}):orgModule.getMessage("addRole");t.update(i)}this.addBtn.title=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addRoleTo",{organizationName:this.organization.id}):orgModule.getMessage("addRole"),dialogs.popup.show(this.addRole,!0);try{this.roleName.focus()}catch(n){}},hide:function(){dialogs.popup.hide(this.addRole),this.roleName.setValue("")},_validate:function(){return ValidationModule.validateLegacy(this._validators)},_doAdd:function(){if(this._validate()){var e=new orgModule.Role({roleName:this.roleName.getValue()});this.organization&&!this.organization.isRoot()&&(e.tenantId=this.organization.id),invokeServerAction(orgModule.ActionMap.EXIST,{entity:e,onExist:function(){ValidationModule.showError(this.roleName,orgModule.messages.roleNameIsAlreadyInUse)}.bind(this),onNotExist:function(){ValidationModule.hideError(this.roleName),invokeServerAction(orgModule.ActionMap.CREATE,{entity:e})}.bind(this)})}}},define("org.role.mng.components",["jquery","org.role.mng.main"],function(e){return function(){var t;return t||e.orgModule}}(this)),define("common/enum/httpStatusCodes",{100:"continue",101:"switchingProtocols",200:"ok",201:"created",202:"accepted",203:"nonAuthoritativeInformation",204:"noContent",205:"resetContent",206:"partialContent",300:"multipleChoices",301:"movedPermanently",302:"found",303:"seeOther",304:"notModified",305:"useProxy",307:"temporaryRedirect",400:"badRequest",401:"unauthorized",402:"paymentRequired",403:"forbidden",404:"notFound",405:"methodNotAllowed",406:"notAcceptable",407:"proxyAuthenticationRequired",408:"requestTimeout",409:"conflict",410:"gone",411:"lengthRequired",412:"preconditionFailed",413:"requestEntityTooLarge",414:"requestUriTooLong",415:"unsupportedMediaType",416:"requestedRangeNotSatisfiable",417:"expectationFailed",500:"internalServerError",501:"notImplemented",502:"badGateway",503:"serviceUnavailable",504:"gatewayTimeout",505:"httpVersionNotSupported"}),define("common/enum/errorCodes",["require"],function(e){"use strict";return{UNEXPECTED_ERROR:"unexpected.error",INVALID_RESOURCE_TYPE:"invalid.resource.type"}}),define("common/model/BaseModel",["require","underscore","backbone","common/enum/httpStatusCodes","common/enum/errorCodes"],function(e){"use strict";var t=e("underscore"),i=e("backbone"),n=e("common/enum/httpStatusCodes"),o=e("common/enum/errorCodes"),s=i.Model.extend({initialize:function(){this.on("error",s.unifyServerErrors)},serialize:function(){return t.clone(this.attributes)}},{unifyServerErrors:function(e,t){var i=n[t.status],o=s.createServerError(t);e.trigger("error:"+i,e,o,t),e.trigger("error:all",e,o,t)},createServerError:function(e){var t;try{t=JSON.parse(e.responseText)}catch(i){t={message:"Can't parse server response",errorCode:o.UNEXPECTED_ERROR,parameters:[]}}return t}});return s}),define("tenantImportExport/export/model/ResourcesModel",["require","backbone","request"],function(e){var t=e("backbone"),i=e("request");return t.Model.extend({url:"rest_v2/settings/exportResourceOptions",fetch:function(){return i({url:this.url,type:"GET"})}})}),define("tenantImportExport/export/enum/exportTypesEnum",{ROOT_TENANT:"rootTenant",TENANT:"tenant",SERVER_CE:"serverCE",SERVER_PRO:"serverPRO",REPOSITORY:"repository"}),define("tenantImportExport/export/factory/exportModelAttributesFactory",["require","underscore","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("underscore"),i=e("tenantImportExport/export/enum/exportTypesEnum"),n={},o={roles:null,users:null,everything:!0,userForRoles:!1,rolesForUser:!1,includeReports:!0,includeOtherResourceFiles:!0,includeDataSources:!0,includeDependentObjects:!0,includeAttributes:!0,includeAttributeValues:!0},s={includeAccessEvents:!1,includeAuditEvents:!1,includeMonitoringEvents:!1},r={includeDomains:!0,includeAdHocViews:!0,includeDashboards:!0},a={includeSubOrganizations:!0},l={includeServerSettings:!0};return n[i.ROOT_TENANT]=t.extend({},o,s,r,a,l),n[i.TENANT]=t.extend({},o,r,a),n[i.SERVER_PRO]=t.extend({},o,s,r,a,l),n[i.SERVER_CE]=t.extend({},o,l,{includeAccessEvents:!0}),function(e){return n[e]}}),define("tenantImportExport/export/model/ExportModel",["require","jquery","underscore","backbone","backbone.validation","jrs.configs","bundle!ImportExportValidationBundle","common/util/i18nMessage","common/model/BaseModel","../model/ResourcesModel","tenantImportExport/export/factory/exportModelAttributesFactory","tenantImportExport/export/enum/exportTypesEnum"],function(e){function t(e){var t,i,o=[];return e.get("everything")?(o.push("everything"),e.get("includeAccessEvents")&&o.push("include-access-events")):(t=n(e)&&e.get("includeRepositoryPermissions")&&!r.isEmpty(e.get("uris")),i=!e.get("includeAttributeValues")||!e.get("includeAttributes"),e.get("userForRoles")&&o.push("role-users"),e.get("rolesForUser")&&o.push("users-roles"),t&&o.push("repository-permissions"),!e.get("includeSubOrganizations")&&o.push("skip-suborganizations"),e.get("includeAttributes")&&o.push("include-attributes"),i&&o.push("skip-attribute-values"),e.get("includeServerSettings")&&o.push("include-server-settings"),(!n(e)||!e.get("includeDependentObjects"))&&o.push("skip-dependent-resources")),e.get("includeAuditEvents")&&o.push("include-audit-events"),e.get("includeMonitoringEvents")&&o.push("include-monitoring-events"),e.get("encryptFile")&&o.push("encrypted"),o}function i(e){var t=[],i=new s.Deferred;return!e.get("everything")&&n(e)?e.resources.fetch().done(function(n){for(var o in v)e.get(o)&&t.push(n[v[o]]);i.resolve(r.flatten(t))}):i.resolve(null),i}function n(e){var t=r.keys(v);return r.filter(t,function(t){return e.get(t)}).length}function o(e){var t=d.organizationsFolderUri||"/organizations",i=d.orgTemplateFolderUri||"/org_template",n=new RegExp("^("+t+"(?!"+i+")/([^/]+))+");return n.exec(e)}var s=e("jquery"),r=e("underscore"),a=e("backbone"),l=e("backbone.validation"),d=e("jrs.configs"),c=e("bundle!ImportExportValidationBundle"),u=e("common/util/i18nMessage").extend({bundle:c}),h=e("common/model/BaseModel"),p=e("../model/ResourcesModel"),m=e("tenantImportExport/export/factory/exportModelAttributesFactory"),g=e("tenantImportExport/export/enum/exportTypesEnum"),f=256,v={includeReports:"report",includeDomains:"domain",includeAdHocViews:"adhocDataView",includeDataSources:"dataSource",includeDashboards:"dashboard",includeOtherResourceFiles:"others"},E=h.extend({defaults:{uris:["/"],fileName:"export.zip",encryptFile:!1,includeRepositoryPermissions:!0,includeScheduledReportJobs:!0,includeDependencies:!0,includeFullResourcePath:!0},validation:{fileName:[{required:!0,msg:new u("export.file.name.empty")},{maxLength:f,msg:new u("export.file.name.too.long",f)},{fn:function(e){return/[\\/?*%:|"<>]/g.test(e)?new u("export.file.name.contains.not.supported.characters"):/^[\.]{1,2}$/g.test(e)?new u("export.file.name.not.valid"):void 0}}],uris:[{fn:function(){var e=this.toExportTask();return!(e.uris||e.roles||e.users||r.filter(e.parameters,function(e){return"role-users"!==e&&"users-roles"!==e}).length)}}]},initialize:function(){h.prototype.initialize.call(this),r.bindAll(this),this.resources=new p},url:function(){return"rest_v2/export"},save:function(){var e=new s.Deferred,t=new a.Model,n=this;t.url=this.url;var o={};return i(this).done(function(i){i&&(o.resourceTypes=i),t.save(r.extend(n.toExportTask(),o)).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t),n.trigger("error",n,t)})}),e},cancel:function(){var e=this.url()+"/"+this.id;this.destroy({url:e})},toExportTask:function(){var e=this.get("everything"),i=this.get("roles"),s=this.get("users"),a=r.clone(this.get("uris")),l=e||this.get("includeReports")&&this.get("includeScheduledReportJobs"),d={uris:a,scheduledJobs:this.get("includeScheduledReportJobs")?a:null,parameters:[]};this.get("includeRepositoryPermissions")&&d.parameters.push("repository-permissions"),!this.get("includeDependencies")&&d.parameters.push("skip-dependent-resources");var c=o(a&&a[0]);c&&!this.get("includeFullResourcePath")&&(d.organization=c.last(),d.parameters.push("skip-suborganizations","skip-attribute-values"),d.uris=r.map(a,function(e){return e.replace(c.first(),"")}),d.scheduledJobs=this.get("includeScheduledReportJobs")?d.uris:null);var u={uris:n(this)?a:null,roles:r.isEmpty(i)?null:i,users:r.isEmpty(s)?null:s,scheduledJobs:l?a:null,organization:this.get("organization"),parameters:t(this)};return this.type!==g.REPOSITORY?u:d},reset:function(e,t){this.type=t;var i=r.extend({},this.defaults,m(t));this.clear().set(r.extend({},i,e))}});return r.extend(E.prototype,l.mixin),E}),define("tenantImportExport/export/model/ExportStateModel",["require","underscore","common/model/BaseModel"],function(e){var t=e("underscore"),i=e("common/model/BaseModel"),n={INPROGRESS:"inprogress",READY:"finished",FAILED:"failed",PENDING:"pending",CANCELLED:"cancelled"};return i.extend({url:function(){return"rest_v2/export/"+this.id+"/state"},initialize:function(e){i.prototype.initialize.call(this),this.on("change:phase",function(e,i){i==n.INPROGRESS&&t.isUndefined(e.interval)?e.interval=window.setInterval(function(){e.fetch({cache:!1}).fail(t.bind(e.stopPolling,e))},1e3):e.stopPolling()})},stopPolling:function(){t.isUndefined(this.interval)||(window.clearInterval(this.interval),this.interval=void 0)}},{STATE:n})}),define("tenantImportExport/export/model/AuthorityPickerModel",["require","jquery","backbone","components.templateengine","underscore"],function(e){"use strict";var t=e("jquery"),i=e("backbone"),n=e("components.templateengine"),o=e("underscore");return i.Model.extend({defaults:{items:[]},url:function(){return n.renderUrl(this.urlTemplate,this.context,!0)},parse:function(e){return{items:e?e.role?e.role:e.user:[]}},defaultErrorHandler:function(e,i){var n;try{n=t.parseJSON(i.responseText)}catch(o){n=null}this.trigger("error:server",i.status,n,e)},setContext:function(e){this.context=o.extend(this.context||{},e),this.fetch({error:o.bind(this.defaultErrorHandler,this)})}},{instance:function(e,t){var i=new this;return i.urlTemplate=e,t&&i.setContext(t),i}})}),define("text!tenantImportExport/export/template/authorityPickerTemplate.htm",[],function(){return'<div class="control combo {{- customClass}} " title="{{- title}}">\n    <span class="wrap">{{- title}}</span>\n        <span class="control searchLockup ">\n            <div class="wrap">\n                <input type="text" tabindex="">\n            </div>\n            <b class="right">\n                <a class="button searchClear"></a>\n            </b>\n            <a class="button search up"></a>\n        </span>\n\n    <div class="authorityPicker" onselectstart="return false">\n        <div class="selectBorder upper"></div>\n        <ul class="list"></ul>\n        <div class="selectBorder lower"></div>\n    </div>\n\n    <div class="button-select-all" title="{{- selectLabel }}">\n        <i class="icon"></i>\n        <a class="label">\n            <span class="text">{{- selectLabel }}</span>\n        </a>\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm",[],function(){return'{{ for (var i = 0, l = items.length; i<l; i++){ }}\n<li class="leaf">\n    <div class=""><span class="leftColumn">{{- items[i].name}}{{- items[i].username}}</span>\n        {{ if (items[i].tenantId){ }}\n            <span class="rightColumn">{{- items[i].tenantId }}</span>\n        {{ } }}\n    </div>\n</li>\n{{ } }}\n'}),define("tenantImportExport/export/view/AuthorityPickerView",["require","jquery","backbone","text!tenantImportExport/export/template/authorityPickerTemplate.htm","text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm","underscore"],function(e){"use strict";function t(e,t,i){return i<=Math.max(e,t)&&i>=Math.min(e,t)}var i=e("jquery"),n=e("backbone"),o=e("text!tenantImportExport/export/template/authorityPickerTemplate.htm"),s=e("text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm"),r=e("underscore");return n.View.extend({events:{"click .button.search":"search","click .button.searchClear":"clear","click .button-select-all":"_selectAllHandler","keydown input[type=text]":"keyHandler","mousedown li":"selectionStarted","mouseenter li":"mouseEntered","mouseleave li":"mouseLeave","mouseup ul":"selectionFinished","mouseenter ul":"stopScroll","mouseleave ul":"startScroll"},cursor:-1,baseCursor:-1,selecting:!1,scrollSpeed:30,initialize:function(e){this.model.on("change",r.bind(this.renderList,this)),this.model.on("error:server",r.bind(function(){this.trigger("error:server",arguments)},this)),this.upHandler=r.bind(function(e){this.stopScroll(e),this.selecting=!1},this),this.el=!1,this.initOptions=e},render:function(){return this.mainTemplate||(this.mainTemplate=r.template(o)),this.optionsTemplate||(this.optionsTemplate=r.template(s)),this.el||(this.$el=i("<div/>").html(this.mainTemplate(this.initOptions)).children(),this.el=this.$el[0],this.subEl=this.$el.find(".authorityPicker ul"),this.delegateEvents()),this.model.context||this.model.setContext(),this},renderList:function(){return this.subEl.html(this.optionsTemplate(this.model.attributes)).find("li").each(function(e,t){i(t).attr("index",e)}),this.cursor=-1,this.baseCursor=-1,this.scrollSpeed=this.subEl.find("li:eq(0)").height(),this.subEl.scrollTop(0),this.trigger("change:selection",[]),this},getSelected:function(){return r.reduce(this.subEl.find(".selected"),function(e,t){return e.push(r.pluck(i(t).find("span"),"innerHTML").join("|")),e},[])},search:function(){var e=this.$el.find("input[type=text]").val();this.model.setContext({searchString:e}),e?this.$el.find(".button.searchClear").addClass("up"):this.$el.find(".button.searchClear").removeClass("up")},_selectAllHandler:function(){this.selectAll()},clear:function(){this.$el.find("input[type=text]").val(""),this.search()},keyHandler:function(e){13===e.which&&this.search()},setDisabled:function(e){var t=this.$el.find(".button-select-all").children();e?(this.subEl.addClass("disabled"),t.addClass("disabled"),this.undelegateEvents()):(this.subEl.removeClass("disabled"),t.removeClass("disabled"),this.delegateEvents()),this.$el.find("input[type=text]").attr("disabled",e)},highlightSet:function(e){this.subEl.find("li").each(function(t,n){n=i(n),n.toggleClass("highlighted",r.contains(e,r.pluck(n.find("span"),"innerHTML").join("|")))})},selectAll:function(e){this.subEl.find("li").each(function(e,t){i(t).addClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectNone:function(e){this.subEl.find("li").each(function(e,t){i(t).removeClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectInverse:function(e){this.subEl.find("li").each(function(e,t){i(t).toggleClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectItem:function(e,t){this.subEl.find("li[index="+e+"]").addClass("selected"),t||this.trigger("change:selection",this.getSelected())},unSelectItem:function(e,t){this.subEl.find("li[index="+e+"]").removeClass("selected"),t||this.trigger("change:selection",this.getSelected())},selectRange:function(e,t,n){var o=Math.min(e,t),s=Math.max(e,t);this.subEl.find("li:lt("+(s+1)+")").each(function(e,t){e>=o&&i(t).addClass("selected")}),n||this.trigger("change:selection",this.getSelected())},selectionStarted:function(e){this.selecting=!0,e.ctrlKey||e.metaKey||this.selectNone(!0);var t=+i(e.target).parents("li").toggleClass("selected").attr("index");e.shiftKey?-1!=this.cursor&&this.selectRange(this.cursor,t,!0):(this.cursor=t,this.baseCursor=this.cursor)},mouseEntered:function(e){this.selecting&&(this.cursor=+i(e.target).parents("li").addClass("selected").attr("index"))},mouseLeave:function(e){if(this.selecting){var n=i(e.target).parents("li"),o=i(e.relatedTarget).parents("li");t(this.cursor,this.baseCursor,+o.attr("index"))&&n.removeClass("selected")}},selectionFinished:function(e){
this.selecting=!1,this.trigger("change:selection",this.getSelected())},startScroll:function(e){if(this.selecting){if(i(e.relatedTarget).hasClass("upper"))this.direction=-1;else{if(!i(e.relatedTarget).hasClass("lower"))return void(this.selecting=!1);this.direction=1}i(document.body).on("mouseup",this.upHandler),this.scrollTimer=setInterval(r.bind(this.scrollList,this),200)}},stopScroll:function(e){this.selecting&&(clearInterval(this.scrollTimer),this.direction=0,i(document.body).off("mouseup",this.upHandler))},scrollList:function(){this.subEl.scrollTop(+this.subEl.scrollTop()+this.scrollSpeed*this.direction),t(this.cursor,this.baseCursor,this.cursor+this.direction)?this.unSelectItem(this.cursor,!0):this.selectItem(this.cursor+this.direction,!0),this.cursor=this.cursor+this.direction}})}),define("text!tenantImportExport/export/template/loadingDialogTemplate.htm",[],function(){return'<div class="panel dialog loading overlay moveable centered_horz centered_vert {{- additionalCssClasses }}" tabindex="-1">\n    <div class="content">\n        <div class="header mover">\n            <div class="title">{{- title }}</div>\n        </div>\n        <div class="body">\n            <p class="message"></p>\n        </div>\n    </div>\n</div>\n'}),define("tenantImportExport/export/view/LoadingDialog",["require","common/component/dialog/Dialog","underscore","bundle!CommonBundle","text!tenantImportExport/export/template/loadingDialogTemplate.htm"],function(e){var t=e("common/component/dialog/Dialog"),i=e("underscore"),n=e("bundle!CommonBundle"),o=e("text!tenantImportExport/export/template/loadingDialogTemplate.htm");return t.extend({defaultTemplate:o,constructor:function(e){i.defaults(e,{contentContainer:".body > .message",title:n["dialog.overlay.title"],modal:!0}),t.call(this,e)}})}),define("text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm",[],function(){return'{{ if (message) { }}<p class="message">{{- message }}</p> {{ } }}\n<div class="control groupBox">\n    <ol class="list tabular oneColumn">\n        {{ for (var i = 0; i<items.length; i++) { }}\n        <li class="leaf {{-  i === 0 ? \' first\' : \'\' }} {{- i === items.length - 1 ? \'last\' : \'\' }}" tabindex="-1">\n            <div class="wrap">\n                <div class="column one">\n                    <p class="uri">{{- items[i] }} </p>\n                </div>\n            </div>\n        </li>\n        {{ } }}\n    </ol>\n\n</div>\n\n'}),define("tenantImportExport/view/BaseWarningDialogView",["require","jquery","underscore","common/component/dialog/Dialog","bundle!ImportExportBundle","text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm"],function(e){var t=(e("jquery"),e("underscore")),i=e("common/component/dialog/Dialog"),n=e("bundle!ImportExportBundle"),o=e("text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm");return i.extend({events:{resize:"onResizeHeight"},onResizeHeight:function(){this.$contentContainer.height(this.$el.height()-this._resizableContainerShiftHeight),this.$(".control.groupBox").css("min-height",this.$contentContainer.height()-this.$(".message").outerHeight(!0))},constructor:function(e){e=e||{},this.options=e,i.prototype.constructor.call(this,{modal:!0,resizable:e.resizable,minWidth:e.minWidth,minHeight:e.minHeight,additionalCssClasses:e.additionalCssClasses||"dependent-resources-dialog jr-uWidth-725px jr-uHeight-500px",title:e.title||n["dialog.broken.dependencies.title"],content:"",buttons:e.buttons}),this.template=t.template(e.template||o)},open:function(e){this.setContent(this.template(t.defaults(e,{message:""}))),i.prototype.open.apply(this,arguments),this.$contentContainer.scrollTop(0),this._resizableContainerShiftHeight=this.$(".jr-mDialog-footer").outerHeight()+this.$(".jr-mDialog-header").outerHeight()+this.$contentContainer.outerHeight()-this.$contentContainer.height()}})}),define("tenantImportExport/export/view/ExportDependentResourcesDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,buttons:[{label:n["export.button.continue"],action:"export",primary:!0},{label:i["button.cancel"],action:"cancel",primary:!1}]}),o.prototype.constructor.call(this,e),this.on("button:export",t.bind(this.close,this)),this.on("button:cancel",t.bind(this.close,this))},open:function(e){t.extend(e,{message:n["export.dialog.broken.dependencies.intro"]}),o.prototype.open.call(this,e)}})}),define("text!common/component/notification/template/notificationTemplate.htm",[],function(){return'<div class="notificationAlert">\n    <p class="notificationMessage">\n        <span>{{- message }}</span>\n        <span class="close">| <a href="#">{{- i18n[\'notification.button.close\'] }}</a></span>\n    </p>\n</div>'}),define("common/component/notification/Notification",["require","underscore","jquery","backbone","bundle!js-sdk/CommonBundle","text!./template/notificationTemplate.htm","css!notifications"],function(e){"use strict";var t,i,n=e("underscore"),o=e("jquery"),s=e("backbone"),r=e("bundle!js-sdk/CommonBundle"),a=e("text!./template/notificationTemplate.htm");e("css!notifications");var l={SUCCESS:"success",WARNING:"warning"},d=2e3,c={};return c[l.WARNING]=l.WARNING,i=s.View.extend({template:n.template(a),events:{"click .close a":"hide"},el:function(){return this.template({message:this.message,i18n:r})},initialize:function(){this.render()},render:function(){return o("body").append(this.$el),this.$el.hide(),this.$messageContainer=this.$(".notificationMessage > span:first-child"),this},show:function(e){return e=n.extend({type:l.WARNING,delay:d},e),this.$messageContainer.text(e.message),this.$messageContainer.removeClass().attr({"class":c[e.type]}),this.$el.slideDown(),e.delay&&n.delay(n.bind(this.hide,this),e.delay),this},hide:function(){return arguments.length&&arguments[0].preventDefault&&arguments[0].preventDefault(),this.$el.slideUp(),this},remove:function(){s.View.prototype.remove.apply(this,arguments)}},{show:function(){return t||(t=new i),t.show.apply(t,arguments)},hide:function(){return t||(t=new i),t.hide.apply(t,arguments)}})}),define("common/view/mixin/epoxyCustomBindingHandlers",["require"],function(e){return{}}),define("common/view/mixin/epoxyCustomBindingFilters",["require"],function(e){return{}}),define("common/view/mixin/epoxyViewMixin",["require","backbone.epoxy","underscore","./epoxyCustomBindingHandlers","./epoxyCustomBindingFilters"],function(e){var t=e("backbone.epoxy"),i=e("underscore"),n=e("./epoxyCustomBindingHandlers"),o=e("./epoxyCustomBindingFilters");return{epoxifyView:function(){var e=this.remove;t.View.mixin(this),e&&(this.remove=e),this.bindingFilters?this.bindingFilters=i.extend({},o,this.bindingFilters):o,this.bindingHandlers?this.bindingHandlers=i.extend({},n,this.bindingHandlers):n},applyEpoxyBindings:function(){this.applyBindings&&this.applyBindings()},removeEpoxyBindings:function(){this.removeBindings&&this.removeBindings()}}}),define("text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm",[],function(){return'<div class="section resources tenant-options">\n    <p class="title">{{- i18n["export.dialog.resources"] }}</p>\n\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.data.sources"] }}</label>\n            <input class="includeDataSources" name="includeDataSources" type="checkbox"\n                   data-bind="checked:includeDataSources, disabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.domains"] }}</label>\n            <input class="includeDomains" name="includeDomains" type="checkbox"\n                   data-bind="checked:includeDomains, disabled:everything">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.ad.hoc.views"] }}</label>\n            <input class="includeAdHocViews" name="includeAdHocViews" type="checkbox"\n                   data-bind="checked:includeAdHocViews, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.reports"] }}</label>\n            <input class="includeReports" name="includeReports" type="checkbox"\n                   data-bind="checked:includeReports, disabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.dashboards"] }}</label>\n            <input class="includeDashboards" name="includeDashboards" type="checkbox"\n                   data-bind="checked:includeDashboards, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.scheduled.report.jobs"] }}</label>\n            <input class="includeScheduledReportJobs" name="includeScheduledReportJobs" type="checkbox"\n                   data-bind="checked:includeScheduledReportJobs, enabled:enableReportJobs">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.other.resources"] }}</label>\n            <input class="includeOtherResourceFiles" name="includeOtherResourceFiles" type="checkbox"\n                   data-bind="checked:includeOtherResourceFiles, disabled:everything">\n        </div>\n    </div>\n</div>\n\n<div class="section assets tenant-options">\n    <p class="title">{{- i18n["export.dialog.assets"] }}</p>\n\n    <div class="group">\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.sub.organizations"] }}</label>\n            <input class="includeSubOrganizations" name="includeSubOrganizations" type="checkbox"\n                   data-bind="checked:includeSubOrganizations, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.dependent.objects"] }}</label>\n            <input class="includeDependentObjects" name="includeDependentObjects" type="checkbox"\n                   data-bind="checked:includeDependentObjects, enabled:someResourceIsChecked">\n        </div>\n\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.repository.permissions"] }}</label>\n            <input class="includeRepositoryPermissions" name="includeRepositoryPermissions" type="checkbox"\n                   data-bind="checked:includeRepositoryPermissions, enabled:someResourceIsChecked">\n        </div>\n        {{ if (isServerOrRootType) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.server.settings"] }}</label>\n            <input class="includeServerSettings" name="includeServerSettings" type="checkbox"\n                   data-bind="checked:includeServerSettings, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.attributes"] }}</label>\n            <input class="includeAttributes" name="includeAttributes" type="checkbox"\n                   data-bind="checked:includeAttributes, disabled:everything">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.attribute.values"] }}</label>\n            <input class="includeAttributeValues" name="includeAttributeValues" type="checkbox"\n                   data-bind="checked:includeAttributeValues, enabled:enableAttributesValues">\n        </div>\n    </div>\n</div>\n'}),define("text!tenantImportExport/export/template/eventsToIncludeTemplate.htm",[],function(){return'<div class="section events">\n    <p class="title">{{- i18n["export.dialog.events"] }}</p>\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.access.events"] }}</label>\n            <input class="includeAccessEvents" name="includeAccessEvents" type="checkbox" data-bind="checked:includeAccessEvents, enabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.audit.events"] }}</label>\n            <input class="includeAuditEvents" name="includeAuditEvents" type="checkbox" data-bind="checked:includeAuditEvents">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.monitoring.events"] }}</label>\n            <input class="includeMonitoringEvents" name="includeMonitoringEvents" type="checkbox" data-bind="checked:includeMonitoringEvents">\n        </div>\n        {{ } }}\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/exportDataFileTemplate.htm",[],function(){return'<div class="section file-name">\n    {{ if (!isRepository) { }} <p class="title">{{- i18n["export.dialog.file.properties"] }}</p> {{ } }}\n    <div class="group">\n        <div class="control input" data-bind="validationErrorClass:fileName" data-model-attr="fileName">\n            <span class="wrap">{{- i18n["export.dialog.file.properties.data.file.name"]}}</span>\n            <input type="text" class="fileName"  data-bind="value:fileName, events:[\'keyup\']"/>\n            <span class="message warning fileNameMessage" data-bind="validationErrorText:fileName" data-model-attr="fileName"></span>\n        </div>\n\n        {{ if (0) { }}\n        <div class="control checkBox encryptFileWrapper">\n            <label class="wrap" title="">{{- i18n["export.dialog.file.properties.encrypt.file"] }}</label>\n            <input class="encryptFile" name="encryptFile" type="checkbox" data-bind="checked:encryptFile">\n        </div>\n        {{ } }}\n    </div>\n</div>\n'}),define("text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm",[],function(){return'<div class="section roles-users">\n    <p class="title">{{- i18n["export.dialog.roles.users"] }}</p>\n    <div class="group rolesAndUsers">\n        <div class="control radio">\n            <label class="wrap" title="" for="selectedUsersRoles">{{- i18n["export.dialog.roles.users.selected.roles.users"] }}</label>\n            <input id="selectedUsersRoles" class="selectedUsersRoles" name="sample" type="radio" data-bind="disabled:everything" checked="checked">\n        </div>\n        <div class="control radio">\n            <label class="wrap" title="" for="usersWithSelectedRoles">{{- i18n["export.dialog.roles.users.users.with.selected.roles"] }}</label>\n            <input id="usersWithSelectedRoles" class="usersWithSelectedRoles" name="sample" type="radio" data-bind="disabled:everything">\n        </div>\n        <div class="control radio">\n            <label class="wrap" title="" for="rolesWithSelectedUsers">{{- i18n["export.dialog.roles.users.roles.with.selected.users"] }}</label>\n            <input id="rolesWithSelectedUsers" class="rolesWithSelectedUsers" name="sample" type="radio" data-bind="disabled:everything">\n        </div>\n    </div>\n    <div class="group">\n        <div class="selectRolesUsers column two control pickWells"></div>\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm",[],function(){return'<div class="export-options">\n    {{ if (!isRepository) { }}\n    <p class="title export-options-title">{{- i18n["export.dialog.options"] }}</p>\n    <div class="section everything">\n        <div class="control checkBox everything">\n            <label class="wrap" title="">{{- i18n["export.dialog.everything"] }}</label>\n            <input class="everything" name="everything" type="checkbox" data-bind="checked:everything">\n        </div>\n    </div>\n    {{ } }}\n</div>'}),define("text!tenantImportExport/export/template/repositoryExportTemplate.htm",[],function(){return'<div class="section resources">\n    <p>{{- i18n["export.dialog.options"] }}</p>\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.report.jobs"] }}</label>\n            <input class="includeScheduledReportJobs" name="includeScheduledReportJobs" type="checkbox" data-bind="checked:includeScheduledReportJobs">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.permissions"] }}</label>\n            <input class="includeRepositoryPermissions" name="includeRepositoryPermissions" type="checkbox" data-bind="checked:includeRepositoryPermissions">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.dependencies"] }} </label>\n            <input class="includeDependencies" name="includeDependencies" type="checkbox" data-bind="checked:includeDependencies">\n        </div>\n        {{ if (isSubOrgLevel) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.full.repo.path"] }}</label>\n            <input class="includeFullResourcePath" name="includeFullResourcePath" type="checkbox" data-bind="checked:includeFullResourcePath">\n        </div>\n        {{ } }}\n    </div>\n</div>'}),define("tenantImportExport/export/factory/exportTemplateFactory",["require","jquery","text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm","text!tenantImportExport/export/template/eventsToIncludeTemplate.htm","text!tenantImportExport/export/template/exportDataFileTemplate.htm","text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm","text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm","text!tenantImportExport/export/template/repositoryExportTemplate.htm","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("jquery"),i=e("text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm"),n=e("text!tenantImportExport/export/template/eventsToIncludeTemplate.htm"),o=e("text!tenantImportExport/export/template/exportDataFileTemplate.htm"),s=e("text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm"),r=e("text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm"),a=e("text!tenantImportExport/export/template/repositoryExportTemplate.htm"),l=e("tenantImportExport/export/enum/exportTypesEnum"),d={};return d[l.ROOT_TENANT]=[s,i,n].join(""),d[l.TENANT]=[s,i].join(""),d[l.SERVER_PRO]=[s,i,n].join(""),d[l.SERVER_CE]=[s,i,n].join(""),d[l.REPOSITORY]=[a].join(""),function(e){return e=e||{},o+t(r).append(d[e.type])[0].outerHTML}}),define("tenantImportExport/export/view/ExportView",["require","css!importExport","jquery","underscore","backbone","../model/ExportModel","../model/ExportStateModel","../model/AuthorityPickerModel","./AuthorityPickerView","./LoadingDialog","./ExportDependentResourcesDialogView","common/component/notification/Notification","common/view/mixin/epoxyViewMixin","tenantImportExport/export/factory/exportTemplateFactory","tenantImportExport/export/enum/exportTypesEnum","bundle!ImportExportBundle","bundle!CommonBundle"],function(e){"use strict";function t(e){this.rolesList=new c({model:d.instance("rest_v2/{{#tenantId}}organizations/{{{tenantId}}}/{{/tenantId}}roles?q={{{searchString}}}{{#excludeSubOrgs}}&includeSubOrgs=false{{/excludeSubOrgs}}",{tenantId:e.tenantId}),customClass:"selectedRoles",title:v["export.dialog.roles.users.roles.label"],selectLabel:v["export.dialog.roles.users.select.all.roles.label"]}),this.rolesList.on("change:selection",this.bindWithRoles),this.rolesList.render(),this.usersList=new c({model:d.instance("rest_v2/{{#tenantId}}organizations/{{{tenantId}}}/{{/tenantId}}users?q={{{searchString}}}{{#excludeSubOrgs}}&includeSubOrgs=false{{/excludeSubOrgs}}",{tenantId:e.tenantId}),customClass:"select selectedUsers",title:v["export.dialog.roles.users.users.label"],selectLabel:v["export.dialog.roles.users.select.all.users.label"]}),this.usersList.on("change:selection",this.bindWithUsers),this.usersList.render(),this.rolesToUsers=d.instance("rest_v2/users?hasAllRequiredRoles=false{{#roles}}&requiredRole={{{.}}}{{/roles}}"),this.rolesToUsers.on("change",this.onRolesToUsersChange),this.usersToRoles=d.instance("rest_v2/roles?hasAllUsers=false{{#users}}&user={{{.}}}{{/users}}"),this.usersToRoles.on("change",this.onUsersToRolesChange),this.changeEnabledState(),this.listenTo(this.model,"change:everything",this.changeEnabledState),this.$el.find(".selectRolesUsers").append(this.rolesList.el).append(this.usersList.el),this.listenTo(this.model,"change:includeSubOrganizations",this.filterAuthoritiesBySubOrgs)}function i(){var e=document.createElement("iframe");e.src=this.model.url()+"/"+this.stateModel.id+"/"+this.model.get("fileName"),e.style.display="none",o("body").append(e)}function n(e){this.model.cancel(),this.stateModel.set("phase",e)}e("css!importExport");var o=e("jquery"),s=e("underscore"),r=e("backbone"),a=e("../model/ExportModel"),l=e("../model/ExportStateModel"),d=e("../model/AuthorityPickerModel"),c=e("./AuthorityPickerView"),u=e("./LoadingDialog"),h=e("./ExportDependentResourcesDialogView"),p=e("common/component/notification/Notification"),m=e("common/view/mixin/epoxyViewMixin"),g=e("tenantImportExport/export/factory/exportTemplateFactory"),f=e("tenantImportExport/export/enum/exportTypesEnum"),v=e("bundle!ImportExportBundle"),E=e("bundle!CommonBundle"),b=r.View.extend({className:"export-view",events:{"change .usersWithSelectedRoles":"includeRolesByUsers","change .rolesWithSelectedUsers":"includeUsersWithRoles","change .selectedUsersRoles":"includeSelectedRolesUsersOnly","click .section .checkBox label":"_clickOnCheckbox"},computeds:{includeAccessEventsChecked:function(){return this.model.get("everything")?this.model.get("includeAccessEvents"):!1},enableAttributesValues:{deps:["everything","includeAttributes"],get:function(e,t){return!e&&t}},enableReportJobs:{deps:["everything","includeReports"],get:function(e,t){return!e&&t}},someResourceIsChecked:{deps:["everything","includeReports","includeAdHocViews","includeDashboards","includeDomains","includeDataSources","includeOtherResourceFiles"],get:function(e,t,i,n,o,s,r){return!e&&(t||i||n||o||s||r)}}},initialize:function(){s.bindAll(this),this.model||(this.model=new a),this.stateModel=new l,this.epoxifyView(),this.loadingDialog=new u({content:E["dialog.overlay.loading"]}),this.notification=new p,this.dependentResourcesDialogView=new h,this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.stateModel,"change:phase",this.handleExportPhase,this),this.listenTo(this.model,"error:unauthorized",window.location.reload),this.listenTo(this.stateModel,"error:unauthorized",window.location.reload);var e={delay:!1,message:v["export.error.cancelled"]},t={delay:!1,message:v["export.error.unexpected"]};this.listenTo(this.model,"error:notFound",s.bind(this.notification.show,this.notification,e)),this.listenTo(this.stateModel,"error:notFound",s.bind(this.notification.show,this.notification,e)),this.listenTo(this.model,"error:internalServerError",s.bind(this.notification.show,this.notification,t)),this.listenTo(this.stateModel,"error:internalServerError",s.bind(this.notification.show,this.notification,t)),this.listenTo(this.model,"error",s.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.stateModel,"error",s.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.dependentResourcesDialogView,"button:export",s.compose(s.bind(this.dependentResourcesDialogView.close,this.dependentResourcesDialogView),s.bind(function(){i.call(this),this._showNotification({message:v["export.finished"],type:"success"})},this))),this.listenTo(this.dependentResourcesDialogView,"button:cancel",s.bind(n,this,l.STATE.CANCELLED))},render:function(e){e=e||{},this.type=e.type;var i=this._isServerLevel(this.type),n=i||this.type===f.ROOT_TENANT;return n?this.$el.addClass("with-events"):this.$el.removeClass("with-events"),this.stopListening(this.model,"change:includeSubOrganizations",this.filterAuthoritiesBySubOrgs),this._resetModel(e),this.template=s.template(g(e))({everything:!1,i18n:v,isServerOrRootType:n,isServerLevel:i,isServerCe:this.type===f.SERVER_CE,isRepository:this.type===f.REPOSITORY,isSubOrgLevel:e.isSubOrgLevel}),this.$el.html(this.template),this.$(".selectRolesUsers").length&&t.call(this,e),this.applyEpoxyBindings(),this},doExport:function(){var e=this;this.model.isValid(!0)&&(this.loadingDialog.open(),this.model.save().done(function(t){e.stateModel.unset("warnings",{silent:!0}),e.stateModel.set(t),e.model.set("id",t.id)}))},handleExportPhase:function(){var e,t=this.stateModel.get("phase"),n=this._getBrokenDependencies();t==l.STATE.READY&&(this.loadingDialog.close(),s.isEmpty(n)?(i.call(this),e={message:v["export.finished"],type:"success"}):this.dependentResourcesDialogView.open({items:n})),t==l.STATE.FAILED&&(e={message:v["export.error.unexpected"]}),t==l.STATE.CANCELLED&&(e={message:v["export.error.cancelled"]}),e&&this._showNotification(e)},filterAuthoritiesBySubOrgs:function(){var e={excludeSubOrgs:!this.model.get("includeSubOrganizations")};this.rolesList.model.setContext(e),this.usersList.model.setContext(e)},bindWithRoles:function(e){this.model.set({roles:e}),this.onUsersToRolesChange(),e.length?this.rolesToUsers.setContext({roles:e}):this.rolesToUsers.set({items:[]})},bindWithUsers:function(e){this.model.set({users:e}),this.onRolesToUsersChange(),e.length?this.usersToRoles.setContext({users:e}):this.usersToRoles.set({items:[]})},changeEnabledState:function(){var e=this.model.get("everything");this.rolesList.setDisabled(e||this.model.get("rolesForUser")),this.usersList.setDisabled(e||this.model.get("userForRoles")),e&&(this.rolesList.selectNone(),this.usersList.selectNone())},includeRolesByUsers:function(e){var t=o(e.target).is(":checked");this.model.set({rolesForUser:!t,userForRoles:t}),this.onRolesToUsersChange(),this._includeUsersOrRoles(!t,t)},includeUsersWithRoles:function(e){var t=o(e.target).is(":checked");this.model.set({rolesForUser:t,userForRoles:!t}),this.onUsersToRolesChange(),this._includeUsersOrRoles(t,!t)},includeSelectedRolesUsersOnly:function(e){o(e.target).is(":checked")&&(this.model.set({userForRoles:!1,rolesForUser:!1}),this.onRolesToUsersChange(),this.onUsersToRolesChange(),this._includeUsersOrRoles(!1,!1))},sendParameters:function(e){this.model.isValid(!0)&&this.model.save()},onRolesToUsersChange:function(){this.model.get("userForRoles")?(this.usersList.highlightSet(s.map(this.rolesToUsers.get("items"),function(e){return e.username+(e.tenantId?"|"+e.tenantId:"")})),this.rolesList.highlightSet([])):this.usersList.highlightSet([])},onUsersToRolesChange:function(){this.model.get("rolesForUser")?(this.rolesList.highlightSet(s.map(this.usersToRoles.get("items"),function(e){return e.name+(e.tenantId?"|"+e.tenantId:"")})),this.usersList.highlightSet([])):this.rolesList.highlightSet([])},_isServerLevel:function(e){return e===f.SERVER_CE||e===f.SERVER_PRO},_includeUsersOrRoles:function(e,t){this.rolesList.setDisabled(e),this.usersList.setDisabled(t),this.rolesList.selectNone(),this.usersList.selectNone()},_showNotification:function(e){e=s.defaults(e,{type:"warning"}),this.loadingDialog.isVisible()&&this.loadingDialog.close(),this.notification.show({delay:!1,message:e.message,type:e.type})},_getBrokenDependencies:function(){var e=this.stateModel.get("warnings"),t=[];return s.each(e,function(e){"export.broken.dependency"===e.code&&t.push(e.parameters)}),s.flatten(s.sortBy(t,function(e){return e}))},_clickOnCheckbox:function(e){var t=o(e.target).next();t[0].disabled||this.model.set(t[0].name,!t[0].checked)},_onModelChange:function(){this.model.isValid(!0)},_resetModel:function(e){var t={organization:this.type==f.REPOSITORY?null:e.tenantId};if(this.type===f.ROOT_TENANT||this.type===f.TENANT){var i=this.type===f.ROOT_TENANT?"root_export.zip":e.tenantId+"_export.zip";s.extend(t,{fileName:i})}this.model.reset(t,this.type)}});return s.extend(b.prototype,m),b}),define("tenantImportExport/export/view/ExportDialogView",["require","jquery","underscore","jrs.configs","common/component/dialog/Dialog","./ExportView","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/export/enum/exportTypesEnum"],function(e){function t(e){return n.isArray(e)?n.pluck(e,"URIString"):[e.URIString]}function i(e){return n.isArray(e)||(e=[e]),!!n.reduce(e,function(e,t){return e||!t.resourceType||t.resourceType.indexOf("ReportUnit")+1||t.resourceType.indexOf("ReportOptions")+1},!1)}var n=(e("jquery"),e("underscore")),o=e("jrs.configs"),s=e("common/component/dialog/Dialog"),r=e("./ExportView"),a=e("bundle!CommonBundle"),l=e("bundle!ImportExportBundle"),d=e("tenantImportExport/export/enum/exportTypesEnum");return s.extend({constructor:function(e){e||(e={}),this.options=e,s.prototype.constructor.call(this,{model:this.model,resizable:!0,modal:!0,content:"",buttons:[{label:a["button.export"],action:"export",primary:!0},{label:a["button.cancel"],action:"cancel",primary:!1}]}),this.on("button:export",n.bind(this._onExportButtonClick,this)),this.on("button:cancel",n.bind(this._closeExportDialog,this))},initialize:function(e){this.exportView=new r,this.listenTo(this.exportView.model,"validated",function(e){e?this.buttons.enable("export"):this.buttons.disable("export")},this),s.prototype.initialize.apply(this,arguments)},openRepoDialog:function(e){var n=t(e),s=o.organizationsFolderUri||"/organizations",r=o.orgTemplateFolderUri||"/org_template",a=new RegExp("^("+s+"/([^/]+))+"),c=new RegExp("^"+s+r+"(/.*)?"),u=!!a.exec(n[0])&&!c.exec(n[0]),h={type:d.REPOSITORY,isSubOrgLevel:u},p=" "+l["export.dialog.repository.title"];this.addCssClasses("repository-export-dialog"),this._openExportDialog(h,p),this.exportView.model.set({uris:n,includeScheduledReportJobs:i(e)})},openTenantDialog:function(e){var t=" "+e.name,i=e.isRoot()?d.ROOT_TENANT:d.TENANT,n={type:i,tenantId:e.id};this.addCssClasses("tenant-export-dialog"),this._openExportDialog(n,t)},fieldIsValid:function(){},fieldIsInvalid:function(e){},_onExportButtonClick:function(){this.exportView.doExport(),this._closeExportDialog()},_closeExportDialog:function(){this.$el.css({width:this.width}),this.close()},_openExportDialog:function(e,t){var i=l["export.dialog.title"]+(t?t:"");this.setContent(this.exportView.render(e).$el),this.setTitle(i),this.exportView.applyEpoxyBindings(),this.exportView.delegateEvents(),s.prototype.open.apply(this,arguments),this.$el.css({minHeight:this.$el.outerHeight()}),this.width=this.$el.outerWidth()}})}),define("tenantImportExport/import/factory/importModelAttributesFactory",["require","underscore","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("underscore"),i=e("tenantImportExport/export/enum/exportTypesEnum"),n={},o={includeAccessEvents:!0,includeAuditEvents:!0,includeMonitoringEvents:!0},s={skipThemes:!0},r={includeServerSettings:!0};return n[i.ROOT_TENANT]=t.extend({},o,s),n[i.TENANT]=t.extend({},s),n[i.SERVER_PRO]=t.extend({},o,s,r),n[i.SERVER_CE]=t.extend({},r,{includeAccessEvents:!0}),function(e){return n[e]}}),define("tenantImportExport/import/enum/brokenDependencyStrategyEnum",{FAIL:"fail",SKIP:"skip",INCLUDE:"include"}),define("common/transport/AjaxFormSubmitter",["require","underscore","request","jquery"],function(e){
function t(e){var t,n=null;return e.firstChild.innerText&&""!==e.firstChild.innerText&&e.body?(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e.firstChild.innerText.replace("\r\n-","\r\n"))):t=e,t.firstChild&&(n=t.firstChild.nodeName.toLowerCase()),n&&"html"!==n&&"#comment"!==n?i("xml"===t.firstChild.nodeName.toLowerCase()?t.firstChild.nextSibling:t.firstChild):{errorCode:"unexpected.error"}}function i(e){var t,n;if(e.children)t=e.children;else{t=[];for(var o=0,s=e.childNodes.length;s>o;o++)null===e.childNodes[o].nodeValue&&t.push(e.childNodes[o])}if(0===t.length&&1===e.childNodes.length)return e.childNodes[0].nodeValue;if(t.length>1&&t[0].nodeName===t[1].nodeName){n=[];for(var o=0,s=t.length;s>o;o++)n[o]=i(t[o])}else{n={};for(var o=0,s=t.length;s>o;o++)n[t[o].nodeName]=i(t[o])}return n}function n(e){var t=new a.Deferred;return e.submit(function(i){i.preventDefault(),r({url:e.attr("action"),type:e.attr("method"),data:new FormData(e[0]),cache:!1,contentType:!1,processData:!1,headers:{Accept:"application/json"}}).done(function(e){t.resolve(e)}).fail(function(e){e=e.responseJSON||e||{},s.defaults(e,{errorCode:"error.load.error"}),t.reject(e)}),e.unbind("submit")}),e.submit(),t}function o(e,i){var n=a.Deferred(),o=a("<iframe style='display:none' name='"+i+"'></iframe>");return e.append(o).attr("target",i),o.load(function(){try{n.resolve(t(this.contentWindow.document))}catch(e){n.reject({errorCode:"error.invalid.response"})}o.remove()}),o.on("abort",function(){n.reject({errorCode:"error.load.aborted"}),o.remove()}),o.on("error",function(){n.reject({errorCode:"error.load.error"}),o.remove()}),e.submit(),n}var s=e("underscore"),r=e("request"),a=e("jquery"),l=function(e,i,n,o){this.name=s.uniqueId("uploadTarget"),this.form=a(e),i&&this.form.attr("action",i),n&&this.form.attr("method",n),o&&this.form.attr("enctype",o),this.parceXmlDocToObject=t};return l.prototype.submit=function(){return window.FormData?n(this.form):o(this.form,this.name)},l}),define("tenantImportExport/import/model/ImportModel",["require","underscore","jquery","tenantImportExport/import/factory/importModelAttributesFactory","../enum/brokenDependencyStrategyEnum","common/transport/AjaxFormSubmitter","backbone.validation","common/model/BaseModel"],function(e){var t=e("underscore"),i=e("jquery"),n=e("tenantImportExport/import/factory/importModelAttributesFactory"),o=e("../enum/brokenDependencyStrategyEnum"),s=e("common/transport/AjaxFormSubmitter"),r=e("backbone.validation"),a=e("common/model/BaseModel"),l=a.extend({defaults:{fileName:"",update:!0,skipUserUpdate:!1,mergeOrganization:!1,skipThemes:!0,brokenDependencies:o.FAIL},url:"rest_v2/import",validation:{fileName:[{fn:function(e){return!/\.zip$/.test(e)}}]},initialize:function(e,t){this.form=new s(t.form,this.url,"post","multipart/form-data")},parse:function(){return this.attributes},save:function(){var e,n,o=this;return this.isNew()?(e=new i.Deferred,this.form.submit().done(function(i){o.set("id",i.id),t.isUndefined(i.errorCode)&&t.isUndefined(i.error)?e.resolve(i):e.reject(i)}).fail(function(t){o.trigger("error",t),e.reject(t)})):(n=this._convertParameters(),e=a.prototype.save.call(this,{parameters:n},{url:this.url+"/"+this.id}).fail(t.bind(this.trigger,"error"))),e},cancel:function(){var e=this.url+"/"+this.id;this.destroy({url:e})},reset:function(e,i){var o=t.extend({},this.defaults,n(e),i);this.clear().set(t.extend({},o)),this.id=void 0},_convertParameters:function(){var e=[];return this.get("skipUserUpdate")&&e.push("skip-user-update"),this.get("includeAccessEvents")&&e.push("include-access-events"),this.get("includeAuditEvents")&&e.push("include-audit-events"),this.get("includeMonitoringEvents")&&e.push("include-monitoring-events"),this.get("includeServerSettings")&&e.push("include-server-setting"),this.get("mergeOrganization")&&e.push("merge-organization"),this.get("skipThemes")&&e.push("skip-themes"),this.get("update")&&e.push("update"),e}});return t.extend(l.prototype,r.mixin),l}),define("tenantImportExport/import/model/ImportStateModel",["require","../../export/model/ExportStateModel"],function(e){var t=e("../../export/model/ExportStateModel");return t.extend({url:function(){return"rest_v2/import/"+this.id+"/state"}})}),define("tenantImportExport/import/enum/importPendingStatesEnum",{BROKEN_DEPS:"import.broken.dependencies",TENANT_MISMATCH:"import.organizations.not.match"}),define("text!tenantImportExport/import/template/mergeTenantDialogTemplate.htm",[],function(){return"<p class=\"message\">{{- i18n['import.dialog.merge.tenant.intro'] }}</p>\n\n<p class=\"message imported-tenant\"><b>{{- i18n['import.dialog.merge.tenant.imported'] }} : </b> {{- fileTenantId}} </p>\n<p class=\"message selected-tenant\"><b>{{- i18n['import.dialog.merge.tenant.selected'] }} : </b> {{- selectedTenantId}} </p>\n\n<p class=\"message\">{{- i18n['import.dialog.merge.tenant.outro'] }} {{- selectedTenantId}}</p>\n"}),define("tenantImportExport/import/view/MergeTenantDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView","text!tenantImportExport/import/template/mergeTenantDialogTemplate.htm"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView"),s=e("text!tenantImportExport/import/template/mergeTenantDialogTemplate.htm");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,additionalCssClasses:"merge-tenant-dialog",title:n["import.dialog.merge.tenant.title"],buttons:[{label:n["import.button.continue"],action:"import",primary:!0},{label:i["button.cancel"],action:"cancel",primary:!1}],template:s}),o.prototype.constructor.call(this,e),this.on("button:import",t.bind(this.close,this)),this.on("button:cancel",t.bind(this.close,this))},open:function(e){t.extend(e,{i18n:n}),o.prototype.open.call(this,e)}})}),define("tenantImportExport/import/view/ImportDependentResourcesDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,buttons:[{label:n["import.button.include"],action:"include",primary:!0},{label:n["import.button.skip"],action:"skip",primary:!1},{label:i["button.cancel"],action:"cancel",primary:!1}]}),o.prototype.constructor.call(this,e),this.on("button:include",t.bind(this.close,this)),this.on("button:skip",t.bind(this.close,this)),this.on("button:cancel",t.bind(this.close,this))},open:function(e){t.extend(e,{message:n["import.dialog.broken.dependencies.intro"]}),o.prototype.open.call(this,e)}})}),define("tenantImportExport/import/view/ImportWarningsDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),n=e("bundle!ImportExportBundle"),o=e("tenantImportExport/view/BaseWarningDialogView");return o.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,title:n["import.dialog.warnings.title"],additionalCssClasses:"warnings-dialog",buttons:[{label:i["button.close"],action:"close",primary:!1}]}),o.prototype.constructor.call(this,e),this.on("button:close",t.bind(this.close,this))}})}),define("tenantImportExport/import/factory/warningsFactory",["require","bundle!ImportExportBundle","underscore"],function(e){function t(e,t){var i={};return n.each(e,function(e,n){i[e]=t[n]}),i}var i=e("bundle!ImportExportBundle"),n=e("underscore"),o={};return o["import.resource.uri.too.long"]=[{msg:i["import.resource.uri.too.long"],parameters:["resourceURI"]},{msg:i["import.resource.uri.too.long.length"],parameters:["resourceURI","maxURILength"]}],o["import.access.denied"]=[{msg:i["import.access.denied"],parameters:["resourceURI"]}],o["import.resource.not.found"]=[{msg:i["import.resource.not.found"],parameters:["resourceURI"]}],o["import.resource.different.type.already.exists"]=[{msg:i["import.resource.different.type.already.exists"],parameters:["resourceURI"]}],o["import.resource.uri.not.valid"]=[{msg:i["import.resource.uri.not.valid"],parameters:["resourceURI"]}],o["import.resource.data.missing"]=[{msg:i["import.resource.data.missing"],parameters:["resourceURI"]}],o["import.reference.resource.not.found"]=[{msg:i["import.reference.resource.not.found"],parameters:["resourceURI"]},{msg:i["import.reference.dependent.resource.not.found"],parameters:["dependentResourceURI","resourceURI"]}],o["import.resource.attached.not.exist.org"]=[{msg:i["import.resource.attached.not.exist.org"],parameters:["resourceURI"]}],o["import.folder.attached.not.exist.org"]=[{msg:i["import.folder.attached.not.exist.org"],parameters:["resourceURI"]}],o["import.multi.tenancy.not.supported"]=[{msg:i["import.multi.tenancy.not.supported"],parameters:["organizationId"]}],o["import.report.job.reference.resource.not.found"]=[{msg:i["import.report.job.reference.resource.not.found"],parameters:["resourceURI"]},{msg:i["import.report.job.reference.dependent.resource.not.found"],parameters:["dependentResourceURI","resourceURI"]}],function(e){var i,s=e.code,r=e.parameters,a=o[s];return i=n.template(a[r.length-1].msg)(t(a[r.length-1].parameters,r))}}),define("text!tenantImportExport/import/template/importTemplate.htm",[],function(){return'<input name="organization" class="" type="hidden" data-bind="value:organization"/>\n\n<fieldset class="group">\n    <legend class="">\n        <span>{{- i18n[\'import.file.name\'] }}</span>\n    </legend>\n    <label for="uploadFile">\n        <input name="file" class="upload-file" id="uploadFile" type="file"/>\n    </label>\n</fieldset>\n<fieldset class="group">\n    <legend class="">\n        <span>{{- i18n[\'import.options\'] }}</span>\n    </legend>\n    <ul class="list inputSet">\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="" for="update">{{- i18n[\'import.update\'] }}</label>\n                <input id="update" class="" type="checkbox" value="" name="update" data-bind="checked:update"/>\n            </div>\n            <ul class="list inputSet">\n                <li class="leaf">\n                    <div class="control checkBox">\n                        <label class="wrap" title="">{{- i18n[\'import.skip.user.update\']\n                            }}</label>\n                        <input id="skipUserUpdate" class="" type="checkbox" value="" name="skip-user-update"\n                               data-bind="checked:skipUserUpdate, enabled:update"/>\n                    </div>\n                </li>\n            </ul>\n        </li>\n\n        {{ if (model.includeAuditEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.audit.events\']}}</label>\n                <input id="includeAuditEvents" class="" type="checkbox" name="include-audit-events"\n                       data-bind="checked:includeAuditEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeAccessEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.access.events\']}}</label>\n                <input id="includeAccessEvents" class="" type="checkbox" value="" name="include-access-events"\n                       data-bind="checked:includeAccessEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeMonitoringEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.monitoring.events\'] }}</label>\n                <input id="includeMonitoringEvents" class="" type="checkbox" value="" name="include-monitoring-events"\n                       data-bind="checked:includeMonitoringEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeServerSettings) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap">{{- i18n[\'import.include.configuration.settings\']}}</label>\n                <input class="" type="checkbox" value="" name="include-server-settings"\n                       data-bind="checked:includeServerSettings"/>\n            </div>\n        </li>\n        {{ } if (typeof model.skipThemes !== "undefined") { }}\n\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.themes\']}}</label>\n                <input type="checkbox" value=""\n                       data-bind="checked:not(skipThemes)"/>\n                <input class="hidden" id="skip-themes" type="checkbox"  value="" name="skip-themes"\n                       data-bind="checked:skipThemes"/>\n            </div>\n        </li>\n        {{ } }}\n    </ul>\n</fieldset>\n\n<!-- Hack for correct sending of multipart/form-data in IE. -->\n<!-- Here is the fix https://blog.yorkxin.org/posts/2014/02/06/ajax-with-formdata-is-broken-on-ie10-ie11/ -->\n<input type="hidden" name="_dontcare">'}),define("tenantImportExport/import/view/ImportView",["require","css!importExport.css","jquery","underscore","backbone","../model/ImportModel","../model/ImportStateModel","../enum/importPendingStatesEnum","../enum/brokenDependencyStrategyEnum","../../export/view/LoadingDialog","./MergeTenantDialogView","./ImportDependentResourcesDialogView","./ImportWarningsDialogView","tenantImportExport/import/factory/warningsFactory","common/component/notification/Notification","common/view/mixin/epoxyViewMixin","text!tenantImportExport/import/template/importTemplate.htm","bundle!ImportExportBundle","bundle!CommonBundle"],function(e){"use strict";function t(){var e=this.stateModel.get("warnings");return a.map(e,function(e){return v(e)})}function i(e,i){i=i||"warning";var n=t.call(this);"import.finished"!==e||a.isEmpty(n)||this.warningsDialogView.open({items:n}),this.notification.show({delay:!1,message:x[e]||x["import.error.unexpected"],type:i}),this.trigger("import:finished",this.model.get("organization")),this.model.reset(this.type)}function n(){var e=this.stateModel.get("error");e.errorCode===u.BROKEN_DEPS?this.dependentResourcesDialogView.open({items:e.parameters}):e.errorCode===u.TENANT_MISMATCH&&this.mergeTenantDialogView.open({fileTenantId:e.parameters[0],selectedTenantId:this.model.get("organization")})}function o(e,t){return function(i){e.model.set("brokenDependencies",t),e.doImport()}}function s(e){this.model.cancel(),this.stateModel.set("phase",e)}e("css!importExport.css");var r=e("jquery"),a=e("underscore"),l=e("backbone"),d=e("../model/ImportModel"),c=e("../model/ImportStateModel"),u=e("../enum/importPendingStatesEnum"),h=e("../enum/brokenDependencyStrategyEnum"),p=e("../../export/view/LoadingDialog"),m=e("./MergeTenantDialogView"),g=e("./ImportDependentResourcesDialogView"),f=e("./ImportWarningsDialogView"),v=e("tenantImportExport/import/factory/warningsFactory"),E=e("common/component/notification/Notification"),b=e("common/view/mixin/epoxyViewMixin"),T=e("text!tenantImportExport/import/template/importTemplate.htm"),x=e("bundle!ImportExportBundle"),y=e("bundle!CommonBundle"),_=l.View.extend({tagName:"form",className:"import-view",id:"importDataFile",events:{"change input[type='file']":"validateFile","click .checkBox label":"_clickOnCheckbox"},initialize:function(){this.model||(this.model=new d(null,{form:this.el})),this.stateModel=new c,this.loadingDialog=new p({content:y["dialog.overlay.loading"]}),this.mergeTenantDialogView=new m,this.dependentResourcesDialogView=new g,this.warningsDialogView=new f,this.notification=new E,this.listenTo(this.stateModel,"change:phase",this._handleImportPhase,this);var e={delay:!1,message:x["import.error.cancelled"]},t={delay:!1,message:x["import.error.unexpected"]};this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.model,"error:notFound",a.bind(this.notification.show,this.notification,e)),this.listenTo(this.stateModel,"error:notFound",a.bind(this.notification.show,this.notification,e)),this.listenTo(this.model,"error:internalServerError",a.bind(this.notification.show,this.notification,t)),this.listenTo(this.stateModel,"error:internalServerError",a.bind(this.notification.show,this.notification,t)),this.listenTo(this.model,"error",a.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.stateModel,"error",a.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.mergeTenantDialogView,"button:import",function(){this.model.set("mergeOrganization",!0),this.doImport()},this),this.listenTo(this.mergeTenantDialogView,"button:cancel",a.bind(s,this,c.STATE.CANCELLED)),this.listenTo(this.dependentResourcesDialogView,"button:skip",o(this,h.SKIP)),this.listenTo(this.dependentResourcesDialogView,"button:include",o(this,h.INCLUDE)),this.listenTo(this.dependentResourcesDialogView,"button:cancel",a.bind(s,this,c.STATE.CANCELLED)),this.epoxifyView()},render:function(e){return this.type=e.type,this.model.reset(this.type,{organization:e.tenantId}),this.$el.html(a.template(T)({i18n:x,model:this.model.toJSON()})),this.applyEpoxyBindings(),this},validateFile:function(e){this.model.set("fileName",r(e.target).val());var t=r(e.target),i=t.parent();this.model.isValid(!0)?i.removeClass("error"):i.addClass("error")},doImport:function(){var e=this;this.loadingDialog.open(),this.model.isValid(!0)&&this.model.save().always(function(t){e.stateModel.set(t)})},_handleImportPhase:function(){var e=this.stateModel.get("phase");e!==c.STATE.INPROGRESS&&this.loadingDialog.close(),e===c.STATE.READY&&i.call(this,"import.finished","success")||e===c.STATE.FAILED&&i.call(this,this.stateModel.get("error").errorCode)||e===c.STATE.CANCELLED&&i.call(this,"import.error.cancelled")||e===c.STATE.PENDING&&n.call(this)},_clickOnCheckbox:function(e){var t=r(e.target).next();t[0].disabled||(t[0].checked=!t[0].checked,t.trigger("change"))},_onModelChange:function(){this.model.isValid(!0)}});return a.extend(_.prototype,b),_}),define("tenantImportExport/import/view/ImportDialogView",["require","underscore","common/component/dialog/Dialog","./ImportView","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("underscore"),i=e("common/component/dialog/Dialog"),n=e("./ImportView"),o=e("bundle!CommonBundle"),s=e("bundle!ImportExportBundle"),r=e("tenantImportExport/export/enum/exportTypesEnum");return i.extend({constructor:function(e){e||(e={}),this.options=e,i.prototype.constructor.call(this,{model:this.model,modal:!0,resizable:!0,additionalCssClasses:"tenant-import-dialog",content:"",buttons:[{label:o["button.import"],action:"import",primary:!0},{label:o["button.cancel"],action:"cancel",primary:!1}]}),this.on("button:import",t.bind(this._onImportButtonClick,this)),this.on("button:cancel",t.bind(this._closeImportDialog,this))},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.importView=new n,this.listenTo(this.importView,"import:finished",function(e){this.close(),this.trigger("import:finished",e)}),this.listenTo(this.importView.model,"validated",function(e){e?this.buttons.enable("import"):this.buttons.disable("import")},this)},openDialog:function(e){var t=s["tenant.import.dialog.title"]+" "+e.name,n=e.isRoot()?r.ROOT_TENANT:r.TENANT;e.isRoot()&&this.addCssClasses("tenant"),this.setContent(this.importView.render({type:n,tenantId:e.id}).$el),this.setTitle(t),i.prototype.open.apply(this,arguments),this.importView.applyEpoxyBindings(),this.importView.delegateEvents(),this.$el.css("minHeight",this.$el.outerHeight())},fieldIsValid:function(){},fieldIsInvalid:function(e){},_closeImportDialog:function(){this.$el.css({minHeight:0,height:"auto",width:"auto"}),this.close()},_onImportButtonClick:function(){this.importView.doImport(),this._closeImportDialog()}})}),define("common/component/panel/trait/collapsiblePanelTrait",["require","underscore","jquery","./abstractPanelTrait"],function(e){"use strict";function t(e,t){!t&&e.stopPropagation(),this.onCollapseControlPressed?this.onCollapseControlPressed(e):this.toggleCollapsedState()}function i(){this.$collapser&&this.$collapser.off("mousedown"),this.$el&&this.$el.find(this.expandOnDblClickSelector).off("dblclick")}var n=e("underscore"),o=e("jquery"),s=e("./abstractPanelTrait");return n.extend({},s,{onConstructor:function(e){this.collapserClass=e.collapserClass||"buttonIconToggle",this.collapserSelector=e.collapserSelector||".buttonIconToggle",this.collapsiblePanelClass=e.collapsiblePanelClass||"collapsiblePanel",this.expandOnDblClickSelector=e.expandOnDblClickSelector||"> p:first",this.allowEventPropagation=!!e.allowMouseDownEventPropagation,this.onCollapseControlPressed=e.onCollapseControlPressed},beforeSetElement:function(){i.call(this)},afterSetElement:function(){this.$el.addClass(this.collapsiblePanelClass),this.$collapser=this.$(this.collapserSelector),this.$collapser.length||(this.$collapser=o("<button></button>").addClass(this.collapserClass),this.$("> .header").prepend(this.$collapser)),this.$collapser.on("mousedown",n.bind(t,this,this.allowEventPropagation)),this.$el.find(this.expandOnDblClickSelector).on("dblclick",n.bind(t,this))},onRemove:function(){i.call(this)}})}),define("common/component/tree/trait/addToSelectionModelTrait",["require","underscore","common/component/list/model/ScalableListModel"],function(e){"use strict";var t=e("underscore"),i=e("common/component/list/model/ScalableListModel");return{afterFetchComplete:function(e,n){i.prototype.afterFetchComplete.apply(this,arguments);var o,s;t.each(e,function(e,t){e.addToSelection&&(e.selected=!0,o=e.value,s=this.get("bufferStartIndex")+t,this.selectionContains&&!this.selectionContains(o,s)&&this.addValueToSelection(o,s),delete e.addToSelection)},this)}}}),define("common/component/tree/plugin/TreePlugin",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.View.extend({dataLayerObtained:function(){},itemsRendered:function(){}},{processors:null,treeInitialized:function(){},treeRemoved:function(){}})}),define("text!common/component/tooltip/template/tooltipTemplate.htm",[],function(){return'<div class="{{- cssClasses }}" style="position: absolute; z-index: 100000;">\n    <div class="content">\n        <div class="body"></div>\n    </div>\n</div>\n'}),define("common/component/tooltip/Tooltip",["require","jquery","underscore","backbone","text!./template/tooltipTemplate.htm"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),o=e("text!./template/tooltipTemplate.htm");return n.View.extend({template:i.template(o),delay:500,offset:{x:10,y:10},attribute:"data-tooltip",cssClasses:"panel info tooltip",contentSelector:".body",triggerEvents:!1,el:function(){return this.template({cssClasses:this.cssClasses})},constructor:function(e){if(e||(e={}),!e.attachTo||0===t(e.attachTo).length)throw new Error("Tooltip should be attached to an element");if(!e.contentTemplate)throw new Error("Tooltip should have contentTemplate");this._shown=!1,this.$attachTo=t(e.attachTo),this.$attachTo[0].tooltip=this,e.delay&&(this.delay=e.delay),e.offset&&(this.offset=e.offset),e.attribute&&(this.attribute=e.attribute),e.cssClasses&&(this.cssClasses=e.cssClasses),this.contentTemplate=e.contentTemplate,this.i18n=e.i18n||{},!i.isUndefined(e.triggerEvents)&&(this.triggerEvents=e.triggerEvents),this.selector="["+this.attribute+"]",i.bindAll(this,"show","_onMouseMove","_onMouseLeave"),this.$attachTo.on("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.on("mouseleave touchend",this.selector,this._onMouseLeave),n.View.prototype.constructor.apply(this,arguments)},_render:function(e,t,o){if(this._event){e=e instanceof n.Model?e.toJSON():e;var s=i.template(this.contentTemplate)({model:e,i18n:this.i18n,options:t||{}});this.$el.find(".body").empty().append(s),this._showTooltip()}o.resolve()},show:function(e,n){var o=new t.Deferred;return this._timer=setTimeout(i.bind(this._render,this,e,n,o),this.delay),o},_showTooltip:function(){t("body").append(this.$el),this._updatePosition(),this._shown=!0,this.triggerEvents&&this.trigger("show",this)},hide:function(){this.contentTemplate&&this._timer&&clearTimeout(this._timer),this.$el.detach(),this._shown=!1,this.triggerEvents&&this.trigger("hide",this)},_updatePosition:function(){var e=this.$el.innerHeight(),i=this.$el.innerWidth(),n=t(window).height(),o=t(window).width(),s=this.offset.y,r=this.offset.x;e+this._event.pageY+this.offset.y+3>=n&&(s=-this.offset.y-e),i+this._event.pageX+this.offset.x+3>=o&&(r=-this.offset.x-i),this.$el.css({top:this._event.pageY+s,left:this._event.pageX+r})},_onMouseMove:function(e){this._event=e},_onMouseLeave:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this._event=null},remove:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this.$attachTo.off("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.off("mouseleave touchend",this.selector,this._onMouseLeave),n.View.prototype.remove.apply(this,arguments)}},{attachTo:function(e,t){var i=this;return t||(t={}),t.attachTo=e||"body",new i(t)},detachFrom:function(e){e=t(e)[0],e.tooltip&&e.tooltip.remove()}})}),define("common/component/tree/plugin/TooltipPlugin",["require","./TreePlugin","underscore","common/component/tooltip/Tooltip"],function(e){"use strict";var t=e("./TreePlugin"),i=e("underscore"),n=e("common/component/tooltip/Tooltip");return t.extend({initialize:function(e){this.tooltip=n.attachTo(e.attachTo,i.omit(e,"el")),this.listensToList=!1,t.prototype.initialize.apply(this,arguments)},itemsRendered:function(e,t){var i=this;this.listensToList||(this.listensToList=!0,this.listenTo(t,"list:item:mouseover",function(e,t){i.tooltip.show(e)}),this.listenTo(t,"list:item:mouseout",function(){i.tooltip.hide()}))},remove:function(){n.detachFrom(this.$el),this.tooltip.remove(),t.prototype.remove.apply(this,arguments)}})}),define("common/component/tree/dataprovider/DataProviderWithSearchCache",["require","underscore","jquery"],function(e){"use strict";var t=e("underscore"),i=e("jquery"),n=999,o=50,s=50,r="criteria",a=2147483647,l=function(e){t.bindAll(this,"getData"),e=e||{},this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.pageSize=e.pageSize||n,this.criteriaKey=e.searchKey||r,this.maxSearchCacheSize=e.maxSearchCacheSize||o,this.getDataByCriteriaHolder={},this.controlGetTotal="undefined"!=typeof e.controlGetTotal?e.controlGetTotal:!1,this.dataConverter=e.dataConverter,this.saveLastCriteria="undefined"!=typeof e.saveLastCriteria?e.saveLastCriteria:!1,this.lastCriteria=null,this.serialRequestsDelay="undefined"!=typeof e.serialRequestsDelay?e.serialRequestsDelay:s,this.serialRequestsDelayedPromise=null,this.request=e.request};return t.extend(l.prototype,{getData:function(e){if(e=e||{},e[this.criteriaKey])return this._getDataByCriteria(e[this.criteriaKey])(e);if("undefined"==typeof e[this.criteriaKey]&&this.saveLastCriteria&&this.lastCriteria)return this._getDataByCriteria(this.lastCriteria)(e);this.lastCriteria=null;var t=i.Deferred(),n=this._getPagesToLoad(e);return n?this._requestData(e,n,t):this._resolveDeferredUsingDataFromCache(t,e),t.promise()},clear:function(){this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.getDataByCriteriaHolder={},this.lastCriteria=null},_requestData:function(e,i,n){var o=(i[i.length-1]-i[0]+1)*this.pageSize,s=t.extend({},e,{offset:i[0]*this.pageSize,limit:o});this.controlGetTotal&&(s.skipGetTotal=!0),o>=a/this.pageSize*this.pageSize&&delete s.limit,this.controlGetTotal&&"number"!=typeof this.dataCacheTotal&&delete s.skipGetTotal,this.serialRequestsDelay>0?(clearTimeout(this.deferredTimeout),this.deferredTimeout=setTimeout(t.bind(this._requestDataDeferred,this,e,s,n),this.serialRequestsDelay)):this._requestDataDeferred(e,s,n)},_requestDataDeferred:function(e,i,n){var o=this._getPagesToLoad(e);o?this.serialRequestsDelayedPromise&&t.isEqual(i,this.serialRequestsDelayedPromise.query)?this.serialRequestsDelayedPromise.promise.done(n.resolve).fail(n.reject):(this.serialRequestsDelayedPromise={promise:n.promise(),query:i},this.request(i).done(t.bind(this._requestDone,this,e,i,n)).fail(n.reject)):this._resolveDeferredUsingDataFromCache(n,e)},_requestDone:function(e,t,i,n){this._putDataToCache(t,n),this.serialRequestsDelayedPromise=null,this._resolveDeferredUsingDataFromCache(i,e)},_resolveDeferredUsingDataFromCache:function(e,t){var i=this._getDataFromCache(t);e.resolve({total:this.dataCacheTotal,data:i})},_getPagesToLoad:function(e){var t,i=this._convertLimitOffsetToFirstLast(e),n=this._findPageIndex(i.first),o=this._findPageIndex(i.last),s=[];for(t=n;o>=t;t++)if(!this.dataCachePages[t]){s.push(t);break}for(t=o;t>=n;t--)if(!this.dataCachePages[t]){s.push(t);break}return s.length>0?s:null},_findPageIndex:function(e){return Math.floor(e/this.pageSize)},_convertLimitOffsetToFirstLast:function(e){var t=e&&e.offset?e.offset:0,i=e&&e.limit?t+e.limit-1:this.dataCacheTotal?this.dataCacheTotal-1:a;return this.dataCacheTotal&&i>this.dataCacheTotal-1&&(i=this.dataCacheTotal-1),{first:t,last:i}},_getDataFromCache:function(e){e=t.defaults(e,{offset:0,limit:a});var i=Math.max(0,e.offset),n=Math.min(i+e.limit,this.dataCacheTotal);return this.dataCache.slice(i,n)},_putDataToCache:function(e,t){var i;for("undefined"!=typeof t.total&&(this.dataCacheTotal=t.total),e.limit=e.limit||a,i=0;i<t.data.length;i++)this.dataCache[i+e.offset]=this.dataConverter?this.dataConverter(t.data[i]):t.data[i];var n=e.offset/this.pageSize,o=Math.floor((Math.min(e.limit,t.data.length)+e.offset-1)/this.pageSize);for(i=n;o>=i;i++)this.dataCachePages[i]=!0},_getDataByCriteria:function(e){if(!this.getDataByCriteriaHolder[e]){var t,i=Number.MAX_VALUE,n=0,o=0;for(var s in this.getDataByCriteriaHolder)if(this.getDataByCriteriaHolder.hasOwnProperty(s)){o+=1;var r=this.getDataByCriteriaHolder[s];r.index<i&&(i=r.index,t=s),r.index>n&&(n=r.index)}o>=this.maxSearchCacheSize&&delete this.getDataByCriteriaHolder[t],this.getDataByCriteriaHolder[e]={getData:this._createDataProviderForCriteria(e),index:n+1}}return this.lastCriteria=e,this.getDataByCriteriaHolder[e].getData},_createDataProviderForCriteria:function(e){var i=this.request,n=this,o=new l({pageSize:this.pageSize,dataConverter:this.dataConverter,serialRequestsDelay:this.serialRequestsDelay,searchKey:this.criteriaKey,controlGetTotal:this.controlGetTotal,request:function(o){var s=t.extend({},o);return s[n.criteriaKey]=e,i(s)}}),s=o.getData;return o.getData=function(e){var i=t.extend({},e);return delete i[n.criteriaKey],s.call(o,i)},o.getData}}),l}),define("common/component/tree/TreeLevel",["require","underscore","common/component/panel/Panel","common/component/panel/trait/collapsiblePanelTrait","common/component/list/view/ListWithSelection","common/component/tree/trait/addToSelectionModelTrait","common/component/list/model/ListWithSelectionModel","common/component/tree/plugin/TooltipPlugin","./dataprovider/DataProviderWithSearchCache"],function(e){"use strict";function t(){this.$el.removeClass(this.loadingClass).addClass(this.openClass),l.invoke(this.plugins,"itemsRendered",this.list.model,this.list);var e=this.list.$("> .j-view-port-chunk > ul > li").addClass(this.cid).length,t=l.isFunction(this.levelHeight)?this.levelHeight():this.levelHeight;t&&e*this.listItemHeight>t?this.list.$el.css({height:t+"px","overflow-y":"auto"}):this.list.$el.css({height:"auto",overflow:"auto"}),this.list._calcViewPortHeight(),this._isReady=!0,this.trigger("ready",this)}function i(e,t){this.listRenderError=!0,this.trigger("listRenderError",e,t,this)}function n(e){var t=[];l.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||a(this),
this.trigger("selection:change",t,this,[])}function o(e){var t=[];l.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||a(this),this.trigger("item:dblclick",t)}function s(e,t){for(var i=0;i<t.length;i++)if(t[i]===e)return!0}function r(e,t,i,n){i&&i.exclude&&l.isArray(i.exclude)&&s(e,i.exclude)||(void 0===n||n>0)&&l.chain(e.items).keys().each(function(o){i&&i.exclude&&l.isArray(i.exclude)&&s(e.items[o],i.exclude)||t.call(e.items[o],i),r(e.items[o],t,i,void 0===n?n:--n)})}function a(e,t){t=t&&{exclude:t.exclude},r(e,function(e){this.list.clearSelection(),this.list.model.selection=[]},t)}var l=e("underscore"),d=e("common/component/panel/Panel"),c=e("common/component/panel/trait/collapsiblePanelTrait"),u=e("common/component/list/view/ListWithSelection"),h=e("common/component/tree/trait/addToSelectionModelTrait"),p=e("common/component/list/model/ListWithSelectionModel").extend(h),m=(e("common/component/tree/plugin/TooltipPlugin"),e("./dataprovider/DataProviderWithSearchCache"));return d.extend({constructor:function(e){e||(e={}),l.extend(e,{traits:[c]}),d.prototype.constructor.call(this,e)},initialize:function(e){e||(e={}),this._isReady=!1,this.item=e.item||{},this.id=this.item.id,this.owner=e.owner,this.parent=e.parent,this.itemsTemplate=e.itemsTemplate,this.listItemHeight=e.listItemHeight,this.levelHeight=e.levelHeight,this.lazyLoad=!!e.lazyLoad,this.selection=e.selection||{allowed:!1,multiple:!1},this.resource=this.item.value,this.bufferSize=e.bufferSize,this.cache="undefined"!=typeof e.cache?e.cache:!1,this.allowMouseDownEventPropagation=e.allowMouseDownEventPropagation,this.items={},this.plugins=[];for(var t={el:this.el,model:this.model},i=0,n=e.plugins.length;n>i;i++){var o=e.plugins[i].constr;this.plugins.push(new o(l.extend({},t,e.plugins[i].options)))}this.dataLayer=this.owner.getDataLayer(this),l.invoke(this.plugins,"dataLayerObtained",this.dataLayer),d.prototype.initialize.apply(this,arguments)},render:function(){var e=new p({bufferSize:this.bufferSize,getData:this._getDataProvider(this.cache)});return this.list=new u({markerClass:"."+this.cid,eventListenerPattern:"."+this.cid+":not(.readonly) > p",el:this.$contentContainer,itemsTemplate:this.itemsTemplate,listItemHeight:this.listItemHeight,lazy:!0,selection:this.selection,allowMouseDownEventPropagation:this.allowMouseDownEventPropagation,model:e}),this.list.on("render:data",l.bind(t,this)),this.list.on("listRenderError",l.bind(i,this)),this.list.on("selection:change",l.bind(n,this)),this.list.on("item:dblclick",l.bind(o,this)),this.lazyLoad?this.on("open",this._onOpen,this):this.list.renderData(),this},_getDataProvider:function(e){var t=this,i=l.bind(function(e){return this.obtainData(e,t)},this.dataLayer),n={};return e&&("object"==typeof e&&(n=l.extend(n,e)),n.request=n.request||i,this.dataProvider=new m(n),i=this.dataProvider.getData),function(e){return e||(e={offset:0,limit:100}),e.id=t.id,i(l.extend({},t.owner.context,e),t)}},_onOpen:function(){this.$el.removeClass(this.openClass).addClass(this.loadingClass),this.list.renderData()},setElement:function(e){var t=d.prototype.setElement.apply(this,arguments);return this.list&&(this.list.setElement(this.$contentContainer),this.list.totalItems=-1),l.each(this.plugins,function(t){t.setElement(e)}),this.lazyLoad||this.list&&this.list.renderData(),this.collapsed||(this.open({silent:!0,depth:0}),this.lazyLoad&&this.list.renderData()),t},open:function(e){r(this,d.prototype.open,e,e?e.depth:0),d.prototype.open.call(this,e)},close:function(e){d.prototype.close.call(this,e),r(this,d.prototype.close,e,e?e.depth:void 0),a(this)},getLevel:function(e){return l(this.items).reduce(function(t,i){return t||(i.id===e?i:i.getLevel(e))},!1)},refresh:function(e){this.listRenderError||(this.lazyLoad&&!this.collapsed||!this.lazyLoad?(this.once("ready",l.bind(r,this,this,this.refresh,e,1)),this.list.model.fetch({top:0,bottom:this.list.model.bufferSize,force:!0}),this.list.scrollTo(0)):(this.list.model.set("bufferStartIndex",void 0,{silent:!0}),this.list.model.set("bufferEndIndex",void 0,{silent:!0}),this.list.model.set("total",void 0,{silent:!0}),r(this,this.refresh,e)))},fetch:function(e,t){this.list.fetch(t,e)},recalcConstraints:function(){this.list.resize()},fetchVisibleData:function(){this.list._fetchVisibleData()},resetSelection:function(e){a(this,e),e&&e.silent||this.trigger("selection:change",[])},hasItems:function(){return!!this.$("> .subcontainer > .j-view-port-chunk > ul > li").length},clearCache:function(){l.each(this.items,function(e){e.clearCache()}),this.dataProvider&&this.dataProvider.clear()},remove:function(){var e=this,t=-1;if(l.forEach(l.keys(this.items),function(t){e.items[t].remove()}),this.dataProvider&&this.dataProvider.clear(),this.list.remove(),this.parent){var i=this.parent.id,n=this.owner.getDataLayer(i);if(n&&n.predefinedData&&n.predefinedData[i]&&l.isArray(n.predefinedData[i])){for(var o=0;o<n.predefinedData[i].length;o++)if(n.predefinedData[i][o].id===this.id){t=o;break}t>-1&&(n.predefinedData[i].splice(t,1),delete n.predefinedData[this.id])}delete this.parent.items[this.id]}d.prototype.remove.apply(this,arguments)},isReady:function(){return this._isReady}})}),define("common/component/tree/TreeDataLayer",["require","underscore","jquery","common/util/classUtil","./TreeLevel","common/util/xssUtil","request"],function(e){"use strict";function t(e,t){return n.call(this,i.call(this,e),t)}function i(e){for(var t=0,i=e.length;i>t;t++)e[t]={id:this.extractId(e[t]),value:e[t]};return e}function n(e,t){var i,n;if(this.processors&&this.processors.length)for(var o=0,s=this.processors.length;s>o;o++){i=[];for(var r=0,a=e.length;a>r;r++)n=this.processors[o].processItem(e[r],t,this),n&&i.push(n);e=i}return e}var o=e("underscore"),s=e("jquery"),r=e("common/util/classUtil"),a=(e("./TreeLevel"),e("common/util/xssUtil")),l=e("request");return r.extend({constructor:function(e){this.requestType=e.requestType?e.requestType:"GET",e.getDataUri&&(this.getDataUri=e.getDataUri),this.getDataUri||(this.getDataUri=o.template(e.dataUriTemplate)),e.getDataArray&&(this.getDataArray=e.getDataArray),e.getDataSize&&(this.getDataSize=e.getDataSize),e.extractId&&(this.extractId=e.extractId),this.levelDataId=e.levelDataId?e.levelDataId:"id",this.processors=e.processors||[],this.initialize(e)},initialize:function(e){},extractId:function(e){return e[this.levelDataId]},getDataSize:function(e,t,i){return this.getDataArray(e,t,i).length},getDataArray:function(e,t,i){return e},obtainData:function(e,i){var n=new s.Deferred,o=this;return this.predefinedData&&this.predefinedData[e.id]?n.resolve({total:this.predefinedData[e.id].length,data:this.predefinedData[e.id]}):l({type:this.requestType,dataType:this.dataType||"json",headers:{Accept:this.accept||"application/json","Content-Type":this.contentType||void 0},cache:!1,data:this.data||void 0,url:this.getDataUri(e)}).done(function(){var i=a.escape(arguments[0],{softHTMLEscape:!0});o.dataSize=o.getDataSize.call(o,i,e,arguments[2]),n.resolve({total:o.dataSize,data:t.call(o,o.getDataArray.call(o,i,e,arguments[2]),e)})}).fail(function(e){n.reject(e.status,e.responseText)}),n},_process:t})}),define("text!common/component/tree/template/treeLevelListTemplate.htm",[],function(){return'<ul class="list collapsible folders" style="top: {{- top}}px; position: relative;">\n    {{ _.each(items, function(item){ }}\n    <li class="{{- item._node ? \'node closed\' : \'leaf\'}} {{- item.selected ? \'selected\' : \'\'}}" data-index="{{- item.index }}" tabindex="-1">\n        <p class="wrap button draggable" data-tooltip="{{- item.value.label }}"><b class="icon"/> {{- item.value.label }} </p>\n        <div class="subcontainer" />\n    </li>\n    {{ }) }}\n</ul>\n'}),define("text!common/component/tree/template/treeLevelTemplate.htm",[],function(){return'<div>\n    <ul class="list collapsible folders">\n        <li class="node">\n            <p class="wrap button">\n                <b class="icon" id="handler2" title=""></b>root\n            </p>\n            <div class="subcontainer"/>\n        </li>\n    </ul>\n</div>'}),define("common/component/tree/Tree",["require","css!lists","jquery","underscore","backbone","./TreeLevel","./TreeDataLayer","text!./template/treeLevelListTemplate.htm","text!./template/treeLevelTemplate.htm"],function(e){"use strict";function t(e){var i=e.list.model.get("items"),o=this;i=n.where(i,{_node:!0}),e.$(".node").each(function(r,a){var l=i[r].id;e.items[l]?e.items[l].setElement(a):(e.items[l]=new s(n.extend({},o._options,{el:a,item:i[r],parent:e})),o.listenTo(e.items[l],"listRenderError",n.bind(function(e,t,i){this.trigger("levelRenderError",e,t,i)},o)),e.listenTo(e.items[l],"ready",n.bind(t,o)),e.listenTo(e.items[l],"selection:change",function(t,i,n){i&&n.push(i),e.list.model.clearSelection(),e.trigger("selection:change",t,e,n)}),e.listenTo(e.items[l],"item:dblclick",function(t){e.list.model.clearSelection(),e.trigger("item:dblclick",t)}),e.items[l].render())}).length&&e.$(".j-view-port-chunk").css({height:"auto"})}e("css!lists");var i=e("jquery"),n=e("underscore"),o=e("backbone"),s=e("./TreeLevel"),r=e("./TreeDataLayer"),a=e("text!./template/treeLevelListTemplate.htm"),l=e("text!./template/treeLevelTemplate.htm"),d={ADD:"add",UPDATE:"update"},c=o.View.extend({template:n.template(l),_plugins:[],el:function(){return this.template()},constructor:function(e){e||(e={}),this.defaultDataLayer=new r(e),this.customDataLayers=e.customDataLayers,e.type?(this._type=e.type,e.type=void 0):this._type="tree",e.collapserSelector||(e.collapserSelector="b.icon:eq(0)"),e.predefinedData?(this.defaultDataLayer.predefinedData=e.predefinedData,e.predefinedData=void 0):this.defaultDataLayer.predefinedData={},e.rootless&&(this.rootless=e.rootless,e.rootless=void 0),e.additionalCssClasses&&(this.additionalCssClasses=e.additionalCssClasses,e.additionalCssClasses=void 0),e.getDataLayer&&(this.getDataLayer=e.getDataLayer,e.getDataLayer=void 0),this._options=n.extend({itemsTemplate:a,plugins:this._plugins,owner:this},e),this.context=e.context||{};for(var t=0,i=this._plugins.length;i>t;t++)this._plugins[t].processors&&(this.processors=this.processors.concat(this._plugins[t].processors));o.View.apply(this,arguments)},initialize:function(e){this.rootLevel=new s(n.extend({},this._options,{levelHeight:e.rootLevelHeight},{el:this.$("li")[0]},{item:{id:"/",value:{id:"/",resourceType:"folder"}}})),this.rootless&&this.$el.find("ul:first").addClass("hideRoot"),this.additionalCssClasses&&this.$el.find("ul:first").addClass(this.additionalCssClasses),this.listenTo(this.rootLevel,"ready",n.bind(t,this)),this.listenTo(this.rootLevel,"selection:change",n.bind(function(e,t,i){t&&i&&n.isArray(i)&&(this.rootLevel.selection.multiple||this.rootLevel.resetSelection({silent:!0,exclude:[i[0]]})),this.trigger("selection:change",e)},this)),this.listenTo(this.rootLevel,"item:dblclick",n.bind(function(e){this.trigger("item:dblclick",e)},this));for(var i=0,o=this._plugins.length;o>i;i++)this._plugins[i].constr.treeInitialized.call(this,this._plugins[i].options);this.rootLevel.render(),e.collapsed&&e.lazyLoad&&this.rootless&&this.expand("/")},remove:function(){for(var e=0,t=this._plugins.length;t>e;e++)this._plugins[e].constr.treeRemoved.call(this);this.rootLevel.remove(),o.View.prototype.remove.apply(this,arguments)},expand:function(e,t){var i=this.getLevel(e);return i&&i.open(t),this},collapse:function(e,t){var i=this.getLevel(e);return i&&i.close(t),this},_getNodeById:function(e){var t,i,o=this.getLevel(e);if(o)return o.parent?(t=o.parent.list,{node:o.item,nodeElement:o.$el,itsList:t}):null;var s=!1;if("list"===this._type)s=this.rootLevel;else if("tree"===this._type){var r=e.split("/");if(r=r.slice(0,r.length-1).join("/"),""===r&&(r="@fakeRoot"),s=this.getLevel(r),!s)return null}return s?(t=s.list,i=n.find(t.model.get("items"),function(t){return t.id===e}),i?{node:i,nodeElement:t.$el.find("li.leaf.selected"),itsList:t}:null):null},select:function(e){var t=this._getNodeById(e);t&&(t.itsList.model.clearSelection().addValueToSelection(t.node.value,t.node.index),this.trigger("selection:change",t.itsList.getValue()))},deselect:function(e){},addItem:function(e,t){var i=this.getLevel(e),n=d.ADD;return i&&this._getNodeItems(e,i,t,n),this},updateItem:function(e,t){var i=t?this.getLevel(t):this.rootLevel;return i&&this._getNodeItems(i.id,i,e),this},resetSelection:function(e){return this.rootLevel.list.clearSelection(),this.rootLevel.list.model.selection=[],this.rootLevel.resetSelection(e),this},refresh:function(e){e&&(this.context=e),this.rootLevel.refresh()},recalcConstraints:function(){this.rootLevel.recalcConstraints()},fetchVisibleData:function(){this.rootLevel.fetchVisibleData()},clearCache:function(){this.rootLevel.clearCache()},getLevel:function(e){return this.rootLevel.id===e?this.rootLevel:this.rootLevel.getLevel(e)},getDataLayer:function(e){return this.customDataLayers&&this.customDataLayers[e.id]?this.customDataLayers[e.id]:this.defaultDataLayer},_addItem:function(e,t,i){return!n.findWhere(e,{id:i.id})&&e.push(i),e},_updateItem:function(e,t){return n.each(e,function(e){e.id===t.id&&n.extend(e,t)},this),e},_getNodeItems:function(e,t,i,o){var s,r=this.getDataLayer(t),a=t.list.model.get("items")?t.list.model.get("items"):[];r.predefinedData=r.predefinedData||{},s=o===d.ADD?this._addItem(a,e,i):this._updateItem(a,i),r.predefinedData[e]=n.sortBy(s,"label"),t.fetch({force:!0,keepPosition:!0})},_selectTreeNode:function(e,t){if(n.isString(e)&&""!==e){var o=n.bind(function(){var s=n.bind(function(){var i=e;if("/"===i&&(i="@fakeRoot"),this.expand(i),this.select(i),"list"===this._type)this.rootLevel.on("ready",o);else if("tree"===this._type&&t&&t.length){var n=this.$el,s=this._getNodeById(i);if(!s)return;var r=s.nodeElement;if(!r)return;var a=r.offset().top-n.offset().top-t.height()/2+r.height()/2;t.scrollTop(a)}},this);if("/"===e||"/public"===e||"list"===this._type)s();else{var r=e.replace(/\/$/,""),a=r.substr(0,r.lastIndexOf("/"));a=a||"/";var l=new i.Deferred;this._openPath(a,l,0),l.done(s)}},this);this.rootLevel.isReady()?o():this.rootLevel.on("ready",o)}},_openPath:function(e,t,i){if(!e)return t.resolve();var o,s,r,a=this;return"/"===e?s=["/"]:(s=e.split("/"),s[0]="/"),"/"===s[0]&&"public"===s[1]&&(s=n.union(["/public"],n.rest(s,2))),i=i||0,i===s.length?t.resolve():(o=n.first(s,i+1).join("/"),"/"===o&&(o="@fakeRoot"),o=o.replace(/\/\//g,"/"),r=this.getLevel(o),void(r&&(r.collapsed?(r.once("ready",function(){a._openPath(e,t,i+1)}),r.open()):this._openPath(e,t,i+1))))}},{instance:function(e){return new this(e)}});return{use:function(e,t){return function(e){return{use:function(t,i){return e.prototype._plugins.push({constr:t,options:i}),this},create:function(){return e}}}(c.extend({_plugins:[{constr:e,options:t}]}))},create:function(){return c}}}),define("common/component/tree/plugin/ContextMenuTreePlugin",["require","./TreePlugin","underscore","jquery"],function(e){"use strict";var t=e("./TreePlugin"),i=e("underscore"),n=(e("jquery"),i.memoize(function(e){var t=i.map(e.options,function(e){return e.model.get("action")});return t},function(e){return e.cid}));return t.extend({initialize:function(e){if(!e)throw new Error("Initialization error. Options required.");if(this.contextMenus=e.contextMenus,this.contextMenu=e.contextMenu,this.defaultSelectedItems=e.defaultSelectedItems||function(){},!this.contextMenus&&!this.contextMenu)throw new Error("contextMenu or contextMenus must be specified.");if(this.showContextMenuCondition=e.showContextMenuCondition,!this.showContextMenuCondition&&!this.contextMenu)throw new Error("contextMenu must be specified for default behaviour");!this.showContextMenuCondition&&(this.showContextMenuCondition=function(){return this.contextMenu}),this.model=e.model,t.prototype.initialize.apply(this,arguments)},itemAction:function(e){var t=e.get("action");this.treeItem.action=t},itemsRendered:function(e,t){var i=this;this.listenTo(t,"list:item:contextmenu",function(e,t){if(this.currentContextMenu=i.showContextMenuCondition(e),this.lastContextMenu&&this.lastContextMenu.hide(),this.lastContextMenu=this.currentContextMenu,this.currentContextMenu){this.currentContextMenu.treeItem=e;var o=this.currentContextMenu.treeItem.action;o||(o=i.defaultSelectedItems.call(this.currentContextMenu,e,n(this.currentContextMenu)))?this.currentContextMenu.resetSelection([o]):this.currentContextMenu.resetSelection(),this.currentContextMenu.show({left:t.pageX,top:t.pageY}),this.listenTo(this.currentContextMenu.collection,"select",function(e,t){this.itemAction.call(this.currentContextMenu,t)},this)}},this)},remove:function(){this.stopListening(),this.contextMenu&&this.contextMenu.remove()}})}),define("tenantImportExport/view/tenantTree",["require","common/component/tree/Tree","jquery","underscore","common/component/tree/TreeDataLayer","common/component/tree/plugin/TooltipPlugin","common/component/tree/plugin/ContextMenuTreePlugin","bundle!CommonBundle","jrs.configs"],function(e){"use strict";var t=e("common/component/tree/Tree"),i=e("jquery"),n=e("underscore"),o=e("common/component/tree/TreeDataLayer"),s=e("common/component/tree/plugin/TooltipPlugin"),r=e("common/component/tree/plugin/ContextMenuTreePlugin"),a=e("bundle!CommonBundle"),l=e("jrs.configs"),d={tenantProcessor:function(e){return{processItem:function(t){return t._node=!0,t.label=t.value.tenantName,t.value.label=t.label,t.value.uri=t.value.tenantUri,t.id===e&&(t.addToSelection=!0),t}}}};return function(e){var c=e.comparator,u=t.use(s,{i18n:a,contentTemplate:e.tooltipContentTemplate});return e.contextMenu&&(u=u.use(r,{contextMenu:e.contextMenu})),u.create().instance(n.extend({},{selection:{allowed:{left:!0,right:!0},multiple:!1},rootless:!0,collapsed:!0,lazyLoad:!0,bufferSize:5e3,allowMouseDownEventPropagation:!0,dataUriTemplate:l.contextPath+"/rest_v2/organizations?{{= id != 'organizations' ? 'rootTenantId=' + id : ''}}&offset={{= offset }}&limit={{= limit }}&maxDepth=1",levelDataId:"id",getDataArray:function(e,t,i){var n=e?e.organization:[];return c&&n.sort(c),n},processors:[d.tenantProcessor(e.tenantId)],customDataLayers:{"/":n.extend(new o({dataUriTemplate:l.contextPath+"/flow.html?_flowId=treeFlow&method=getNode&provider=tenantTreeFoldersProvider&uri=/",processors:[d.tenantProcessor(e.tenantId)],getDataArray:function(e){return e=JSON.parse(i(e).text()),[{id:e.id,tenantName:e.label,tenantUri:"/",resourceType:"folder",_links:{content:"@fakeContentLink"}}]}}),{accept:"text/html",dataType:"text"})}}))}}),define("text!common/component/menu/template/menuOptionTemplate.htm",[],function(){return'<li class="leaf" {{ if(typeof(groupId)!== "undefined") { }} data-groupId = {{- groupId }} {{ } }} >\n    <p class="wrap button"><span class="icon"></span>{{- label }}</p>\n</li>'}),define("text!common/component/menu/template/menuContainerTemplate.htm",[],function(){return'<div class="menu vertical dropDown fitable" tabindex="-1" style="z-index: 99999; display: none;">\r\n    <div class="content">\r\n        <ul></ul>\r\n    </div>\r\n</div>'}),define("common/component/menu/Menu",["require","jquery","underscore","../base/OptionContainer","text!./template/menuOptionTemplate.htm","text!./template/menuContainerTemplate.htm","css!menu"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("../base/OptionContainer"),o=e("text!./template/menuOptionTemplate.htm"),s=e("text!./template/menuContainerTemplate.htm");return e("css!menu"),n.extend({constructor:function(e,t){if(!e||!i.isArray(e)||0===e.length)throw new Error("Menu should have options");t||(t={}),n.call(this,{options:e,collection:t.collection,mainTemplate:t.menuContainerTemplate||s,optionTemplate:t.menuOptionTemplate||o,toggle:t.toggle,toggleClass:t.toggleClass}),this.maxSize=t.maxSize,this._onConstructor&&this._onConstructor(e,t)},initialize:function(){n.prototype.initialize.apply(this,arguments),t("body").append(this.$el),this._onInitialize&&this._onInitialize()},show:function(){var e=n.prototype.show.apply(this,arguments);return this.applyMaxSize(),e},applyMaxSize:function(){this.maxSize&&this.options.length>this.maxSize&&this.$el.css({"overflow-y":"auto","max-height":this.maxSize*this.options[0].$el.height()+"px"})}})}),define("common/component/menu/ContextMenu",["require","./Menu","jquery","underscore"],function(e){"use strict";var t=e("./Menu"),i=e("jquery"),n=e("underscore");return t.extend({constructor:function(e,i){t.call(this,e,i),n.bindAll(this,"_tryHide"),this.topPadding=i&&i.topPadding||5,this.leftPadding=i&&i.leftPadding||5,this.hideOnMouseLeave=i&&i.hideOnMouseLeave||!1,this.hideOnMouseLeave&&this.$el.on("mouseleave",this._tryHide)},_tryHide:function(){this.hide(),this._signOffTryHide()},_signOffTryHide:function(){i(document.body).off("click.contextMenu",this._tryHide)},show:function(e,o){if(!e||!n.isNumber(e.top)||!n.isNumber(e.left))throw new Error("Required params (top, left) missing: "+JSON.stringify(e));i(document.body).on("click.contextMenu",this._tryHide);var s=e.top,r=e.left,a=this.topPadding,l=this.leftPadding,d=i("body"),c=this.$el.height(),u=this.$el.width(),h=o?o.height():d.height(),p=o?o.width():d.width(),m=o?o.offset():d.offset(),g=h-e.top,f=p-e.left;return c>g&&(s=e.top-c-a,s<m.top&&(s+=m.top-s+a),s=0>s?h/2-c/2:s),u>f&&(r=e.left-u-l,r<m.left&&(r+=m.left-r+l),r=0>r?p/2-u/2:r),n.extend(this,{top:s,left:r}),this.$el.css({top:this.top,left:this.left}),t.prototype.show.apply(this,arguments)},remove:function(){this._signOffTryHide(),this.hideOnMouseLeave&&this.$el.off("mouseleave",this._tryHide),t.prototype.remove.apply(this,arguments)}})}),define("text!tenantImportExport/templates/tooltipTemplate.htm",[],function(){return'{{ if (model.value.tenantDesc) { }}\n<!--<p class="message label">{{- i18n[\'tooltip.description\'] }}</p><p class="message">{{- model.value.tenantDesc }}</p>-->\n{{ } }}\n{{ if (model.value.uri) { }}\n<p class="message label">{{- i18n[\'tooltip.path\'] }}</p><p class="message">{{- model.value.uri }}</p>\n{{ } }}'}),define("tenantImportExport/view/TenantsTreeView",["require","jquery","underscore","backbone","bundle!ImportExportBundle","tenantImportExport/export/view/ExportDialogView","tenantImportExport/import/view/ImportDialogView","tenantImportExport/view/tenantTree","common/component/menu/ContextMenu","text!tenantImportExport/templates/tooltipTemplate.htm"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),o=e("bundle!ImportExportBundle"),s=e("tenantImportExport/export/view/ExportDialogView"),r=e("tenantImportExport/import/view/ImportDialogView"),a=e("tenantImportExport/view/tenantTree"),l=e("common/component/menu/ContextMenu"),d=e("text!tenantImportExport/templates/tooltipTemplate.htm"),c="organizations",u=n.View.extend({initialize:function(e){this.$container=t(e.container);var n=window.localStorage?JSON.parse(localStorage.getItem("selectedTenant")):null,u=e.selectedTenant||n,h=e.currentUser?e.currentUser.split("|")[1]||c:"/"===u.tenantUri?u.tenantId||c:c;this.splittedUri=i.compact(u.tenantUri.split("/")),this.splittedUri.splice(this.splittedUri.length-1,1),this.splittedUri.unshift(h);var p={tooltipContentTemplate:d,tenantId:u.id||h,comparator:e.comparator};e.removeContextMenuTreePlugin||(this.contextMenu=new l([{label:o["context.menu.option.export"],action:"export"},{label:o["context.menu.option.import"],action:"import"}],{hideOnMouseLeave:!0}),i.extend(p,{contextMenu:this.contextMenu}),this.listenTo(this.contextMenu,"option:export",this._onExport),this.listenTo(this.contextMenu,"option:import",this._onImport)),this.exportDialog=new s,this.importDialog=new r,this.tree=new a(p),this._initEvents()},render:function(){this.$container.append(this.tree.render().$el)},refreshTenant:function(e){var t=this.tree.getLevel(e);this.tree.getDataLayer(t).predefinedData=[],e?t.refresh():this.tree.refresh()},getTenant:function(){return this.selectedTenant},setTenant:function(e,t,i){t?this.selectedTenant[t]=i:this.selectedTenant=e},selectTenant:function(e){this.tree.select(e)},addTenant:function(e,t){var i=this.tree.getLevel(e);this.listenToOnce(i,"ready",function(){this.tree.addItem(e,this._processItem(t,!0))}),i.open()},updateTenant:function(e,t,i){this.tree.updateItem(this._processItem(t,!1,i),e)},removeTenant:function(e,t){var n,o=this.tree.getLevel(t);e=i.isArray(e)?e:[e],i.each(e,function(e){n=this.tree.getLevel(e),n&&n.remove()},this),o.refresh(),o.open()},remove:function(){this.tree.remove(),this.contextMenu&&this.contextMenu.remove()},_processItem:function(e,t,i){var n=e.tenantId||e.id,o=e.tenantFolderUri||e.tenantUri,s=e.tenantName,r={id:n,label:s,uri:o,tenantUri:o,parentId:e.parentId};return t?{_node:!0,id:n,label:s,value:r}:{id:e.tenantId,addToSelection:i,label:s,value:r}},_initEvents:function(){this.expandedLevels=[],this.listenTo(this.tree,"selection:change",function(e){this.trigger("selection:change",i.compact(e)[0])}),this.listenTo(this.importDialog,"import:finished",function(e){this.refreshTenant(e),this.trigger("import:finished",e)}),this._recursivelyOpenLevels(this.tree.rootLevel)},_recursivelyOpenLevels:function(e){this.listenTo(e,"ready",function(){var e=this.tree.getLevel(this.splittedUri[0]);this.splittedUri.splice(0,1),e?(this.expandedLevels.push(e),this.tree.expand(e.id),this._recursivelyOpenLevels(e)):i.each(this.expandedLevels,function(e){this.stopListening(e,"ready")},this)})},_onExport:function(){this.exportDialog.openTenantDialog(this.selectedTenant)},_onImport:function(){this.importDialog.openDialog(this.selectedTenant)}});return u}),orgModule.serverActionFactory={browse:function(e){return this.createAction(orgModule.ActionMap.BROWSE,e)},search:function(e){return this.createAction(orgModule.ActionMap.SEARCH,e)},next:function(e){return this.createAction(orgModule.ActionMap.NEXT,e)},selectAndGetDetails:function(e){return this.createAction(orgModule.ActionMap.SELECT_AND_GET_DETAILS,e)},searchAvailable:function(e){return this.createAction(orgModule.ActionMap.SEARCH_AVAILABLE,e)},searchAssigned:function(e){return this.createAction(orgModule.ActionMap.SEARCH_ASSIGNED,e)},nextAvailable:function(e){return this.createAction(orgModule.ActionMap.NEXT_AVAILABLE,e)},nextAssigned:function(e){return this.createAction(orgModule.ActionMap.NEXT_ASSIGNED,e)},create:function(e){var t=e.entity,i={entity:Object.toJSON(t)};return this.createAction(orgModule.ActionMap.CREATE,i)},update:function(e){var t=e.entityName,i={entityName:t,entity:Object.toJSON(e.entity),assignedEntities:Object.toJSON(e.assigned),unassignedEntities:Object.toJSON(e.unassigned)};return this.createAction(orgModule.ActionMap.UPDATE,i,e.unencryptedEntity)},deleteAll:function(e){var t=e.entities,i={entities:Object.toJSON(t.collect(function(e){return e.getNameWithTenant()}))};return this.createAction(orgModule.ActionMap.DELETE_ALL,i)},"delete":function(e){var t=e.entity,i=e.entityEvent,n={entity:t.getNameWithTenant(),entityEvent:i};return this.createAction(orgModule.ActionMap.DELETE,n)},exist:function(e){var t=e.entity,i={entityName:t.getNameWithTenant()},n=new orgModule.ServerAction(orgModule.ActionMap.EXIST,i);return n.onSuccess=function(t){t.exist?e.onExist&&e.onExist(t.uniqueId):e.onNotExist&&e.onNotExist()},n.onError=function(t){orgModule.fire(orgModule.Event.SERVER_ERROR,{inputData:e,responseData:t})},n},createAction:function(e,t,i){var n,o=new orgModule.ServerAction(e,t);if(e==orgModule.ActionMap.BROWSE)n=orgModule.Event.RESULT_CHANGED;else if(e==orgModule.ActionMap.SEARCH)n=orgModule.Event.RESULT_CHANGED;else if(e==orgModule.ActionMap.NEXT)n=orgModule.Event.RESULT_NEXT;else if(e==orgModule.ActionMap.SELECT_AND_GET_DETAILS)n=orgModule.Event.ENTITY_DETAILS_LOADED;else if(e==orgModule.ActionMap.SEARCH_AVAILABLE)n=orgModule.Event.SEARCH_AVAILABLE_LOADED;else if(e==orgModule.ActionMap.SEARCH_ASSIGNED)n=orgModule.Event.SEARCH_ASSIGNED_LOADED;else if(e==orgModule.ActionMap.NEXT_AVAILABLE)n=orgModule.Event.NEXT_AVAILABLE_LOADED;else if(e==orgModule.ActionMap.NEXT_ASSIGNED)n=orgModule.Event.NEXT_ASSIGNED_LOADED;else if(e==orgModule.ActionMap.CREATE)n=orgModule.Event.ENTITY_CREATED;else if(e==orgModule.ActionMap.UPDATE)n=orgModule.Event.ENTITY_UPDATED;else if(e==orgModule.ActionMap.DELETE_ALL)n=orgModule.Event.ENTITIES_DELETED;else{if(e!=orgModule.ActionMap.DELETE)throw new Error("Unexpected action name '"+e+"'");n=orgModule.Event.ENTITY_DELETED}return o.onSuccess=function(e){orgModule.fire(n,{inputData:t,unencryptedEntity:i,responseData:e})},o.onError=function(e){orgModule.fire(orgModule.Event.SERVER_ERROR,{inputData:t,unencryptedEntity:i,responseData:e})},o}},orgModule.clientActionFactory={create:function(){var e;orgModule.manager.tenantsTree&&(e=orgModule.manager.tenantsTree.getTenant());var t=orgModule.entityList.getSelectedEntities(),i=function(){return invokeClientAction("cancelIfEdit",{entity:t[0]})};return new orgModule.Action(function(){orgModule.entityList.deselectAll(),orgModule.addDialog.show(e)},i)},deleteAll:function(){var e=orgModule.entityList.getSelectedEntities(),t=function(){return invokeClientAction("cancelIfEdit",{entity:e[0]})};return new orgModule.Action(function(){var t=orgModule.getMessage("deleteAllMessage",{count:e.length});require(["common/component/dialog/ConfirmationDialog"],function(i){var n=new i({text:t});n.on("button:yes",function(){invokeServerAction(orgModule.ActionMap.DELETE_ALL,{entities:e})}),n.open()})},t)},"delete":function(e){var t=e.entity,i=e.entityEvent;return new orgModule.Action(function(){var e=orgModule.getMessage("deleteMessage",{entity:t.getDisplayName()});require(["common/component/dialog/ConfirmationDialog"],function(n){var o=new n({text:e});o.on("button:yes",function(){invokeServerAction(orgModule.ActionMap.DELETE,{entity:t,entityEvent:i})}),o.open()})})},cancelIfEdit:function(e){e=e||{};var t=e.entity||orgModule.manager.tenantsTree&&orgModule.manager.tenantsTree.getTenant(),i="undefined"==typeof e.showConfirm?!0:e.showConfirm,n="undefined"==typeof e.entityEvent?!0:e.entityEvent,o=orgModule.properties;return new orgModule.Action(function(){return o.locked&&n||!(!o.isChanged()||i&&confirm(orgModule.getMessage("cancelEdit",{entity:t.getDisplayName()})))?(!n&&o.lock(),!1):(o.isEditMode&&(o.lock(),o.cancel().done(function(){var e=o.getDetailsLoadedEntity(),t=orgModule.userManager?orgModule.entityList.findEntity(e.fullName):!0;o.unlock(),t?orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:e.id,cancelIfEdit:!0,entityEvent:!0}):o.hide()})),!0)})}},define("mng.common.actions",["jquery","prototype","mng.common"],function(e){return function(){var t;return t||e.orgModule}}(this)),orgModule.roleActionFactory={},orgModule.roleManager.actionFactory={},define("org.role.mng.actions",["org.role.mng.main"],function(e){return function(){var t;return t||e.orgModule}}(this)),define("manage/manageRolesMain",["require","!domReady","underscore","org.role.mng.components","jrs.configs","tenantImportExport/view/TenantsTreeView","mng.common.actions","org.role.mng.actions","css!manageTenants.css"],function(e){"use strict";var t=e("!domReady"),i=e("underscore"),n=e("org.role.mng.components"),o=e("jrs.configs"),s=e("tenantImportExport/view/TenantsTreeView");e("mng.common.actions"),e("org.role.mng.actions"),e("css!manageTenants.css"),t(function(){"undefined"==typeof n.messages&&(n.messages={}),"undefined"==typeof n.Configuration&&(n.Configuration={}),i.extend(window.localContext,o.roleManagement.localContext),i.extend(n.messages,o.roleManagement.orgModule.messages),i.extend(n.Configuration,o.roleManagement.orgModule.Configuration),n.roleManager.initialize({TenantsTreeView:s})})});