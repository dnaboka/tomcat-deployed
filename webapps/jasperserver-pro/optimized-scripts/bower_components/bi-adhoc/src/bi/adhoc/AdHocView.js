define(["require","exports","module","underscore","jquery","logger","common/bi/component/BiComponent","common/bi/component/util/biComponentUtil","./error/biComponentErrorFactoryAdHocViewProxy","adhoc/api/AdHocViewFacade","adhoc/api/model/AdHocPropertiesModel","request","text!./schema/AdHocView.json","text!./schema/AdHocViewDatasetComponent.json"],function(e,r,t){"use strict";function o(e,r,t){var o=this.validate();if(o)e.reject(l.validationError(o));else{if(r.properties.container&&0===c(r.properties.container).length){var n=l.containerNotFoundError(r.properties.container);return u.error(n.toString()),void e.reject(n)}t.adv||(t.adv=new v(r,{stateModel:t.stateModel})),t.adv.run(e,r)}}function n(e,r,t){var o=this.validate();if(o)e.reject(l.validationError(o));else{if(0===c(r.properties.container).length){var n=l.containerNotFoundError(r.properties.container);return u.error(n.toString()),void e.reject(n)}t.adv||(t.adv=new v(r.properties,{stateModel:t.stateModel})),t.adv.refresh(e)}}function a(e,r){r.stateModel.set("_destroyed",!0),r.adv?r.adv.destroy(e):e.resolve()}function i(e,r){if(r.adv)r.adv.resize(),e.resolve();else{var t=l.notYetRenderedError();u.error(t.toString()),e.reject(t)}}function s(e,r,t){return function(){var o,n,a,i,s,p=new c.Deferred;if(r.get("_destroyed"))o=l.alreadyDestroyedError(),u.error(o.toString()),p.reject(o);else try{if(d.isArray(arguments[0]))n=arguments[0],a=arguments[1],i=arguments[2],s=arguments[3];else if(d.isString(arguments[0]))n=[d.extend({},arguments[1],{id:arguments[0]})],a=arguments[2],i=arguments[3],s=arguments[4];else{if(d.isFunction(arguments[0])||d.isUndefined(arguments[0]))throw new Error("Invalid arguments supplied. No component to update");n=[arguments[0]],a=arguments[1],i=arguments[2],s=arguments[3]}a&&d.isFunction(a)&&p.done(a),i&&d.isFunction(i)&&p.fail(i),s&&d.isFunction(s)&&p.always(s);var v=d.reduce(n,function(e,r){if(!e){var t=m.validateObject(h[r.id],d.omit(r,"id"));t&&(e=l.validationError(t))}return e},!1);if(v)p.reject(v);else{var f=d.compact(d.map(n,function(r){var t=e.adv.dataComponents[r.id];return t&&t.updateFromDataComponent?t.updateFromDataComponent(r):void 0}));c.when.apply(c,f).then(function(){p.resolve(t.data)}).fail(function(e){p.reject(e)})}}catch(g){o=l.javaScriptException(g),u.error(o.toString()),p.reject(o)}return p}}var d=e("underscore"),c=e("jquery"),u=e("logger").register(t),p=e("common/bi/component/BiComponent"),m=e("common/bi/component/util/biComponentUtil"),l=e("./error/biComponentErrorFactoryAdHocViewProxy"),v=e("adhoc/api/AdHocViewFacade"),f=e("adhoc/api/model/AdHocPropertiesModel"),g=(e("request"),JSON.parse(e("text!./schema/AdHocView.json"))),h={_dataset_internal_:JSON.parse(e("text!./schema/AdHocViewDatasetComponent.json"))},y=d.keys(g.properties),j=["properties"],w=["data"],A=function(e){var r={properties:d.extend({},e),data:{}},t=new f(d.cloneDeep(e)),c={stateModel:t};m.createInstancePropertiesAndFields(this,r,y,j,w,t),d.extend(this,{validate:m.createValidateAction(r,g,t),run:m.createDeferredAction(o,t,r,c),refresh:m.createDeferredAction(n,t,r,c),destroy:m.createDeferredAction(a,t,c),resize:m.createDeferredAction(i,t,c),_updateComponent_internal_:s(c,t,r)})};return A.prototype=new p,A});