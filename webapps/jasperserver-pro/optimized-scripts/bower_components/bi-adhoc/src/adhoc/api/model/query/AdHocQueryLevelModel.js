define(["require","underscore","backbone","../enum/QueryVariableTypes","../enum/DefaultFormatMap","../enum/DefaultFormatBundle","../enum/TypeKindMap","bundle!AdHocBundle"],function(e){"use strict";function t(e){var t=e.get("functionName"),i=e.isDateTime()?e.get("type"):n.DECIMAL;return"Sum"===t?e.isFloat()?n.BIG_DECIMAL:n.LONG:"CountAll"===t||"CountDistinct"===t?n.LONG:"Average"===t?n.DOUBLE:"Max"===t||"Median"===t||"Min"===t||"Mode"===t||"Range"===t||"StdDevP"===t||"StdDevS"===t?i:"RangeDays"===t||"RangeHours"===t||"RangeMinutes"===t||"RangeMonths"===t||"RangeQuarters"===t||"RangeSemis"===t||"RangeWeeks"===t||"RangeYears"===t?n.BIG_DECIMAL:void 0}var i=e("underscore"),a=e("backbone"),n=e("../enum/QueryVariableTypes"),s=e("../enum/DefaultFormatMap"),r=e("../enum/DefaultFormatBundle"),o=e("../enum/TypeKindMap"),g=e("bundle!AdHocBundle"),u=a.Model.extend({defaults:{timeBalanceFunctionName:"TimeBalanceDefault",includeAll:!1},initialize:function(){this.isDateTime()?this.has("categorizer")||this.set({categorizer:this.defaultCategorizer()},{silent:!0}):"all"===this.get("categorizer")&&this.unset("categorizer",{silent:!0}),this.has("aggregationType")||this.set({aggregationType:t(this)},{silent:!0}),this.has("format")||(this.has("aggregationFormat")&&o[this.get("aggregationType")]===o[this.get("type")]?this.set({format:this.get("aggregationFormat"),formatId:this.get("aggregationFormatId")}):this.set({format:r[s[this.get("type")]],formatId:s[this.get("type")]},{silent:!0})),this.has("aggregationFormat")||(o[this.get("aggregationType")]===o[this.get("type")]?this.set({aggregationFormat:this.get("format"),aggregationFormatId:this.get("formatId")},{silent:!0}):this.set({aggregationFormat:r[s[this.get("type")]],aggregationFormatId:s[this.get("type")]},{silent:!0})),this.has("defaultFunctionName")||this.set({defaultFunctionName:this.collection.adHocModel.schema.getByReference(this.get("hierarchicalName")).aggregation},{silent:!0})},label:function(e){var t;return this.has("labelId")&&this.collection.adHocModel.bundles.length&&(t=this.collection.adHocModel.bundles.getCurrent().toLabel(this.get("labelId"))),i.isUndefined(t)&&(t=this.has("label")?this.get("label"):this.get("dimension")),e&&this.has("functionName")&&this.get("functionName")!==this.get("defaultFunctionName")&&(t+=" ("+g["adhoc.function.aggregate.name."+this.get("functionName")]+")"),t},isDateTime:function(){return this.isDate()||this.isTime()},isDate:function(){var e=this.get("type");return e===n.DATE||e===n.TIMESTAMP},isTime:function(){return this.get("type")===n.TIME},isFloat:function(){var e=this.get("type");return e===n.DECIMAL||e===n.BIG_DECIMAL||e===n.DOUBLE||e===n.FLOAT},isString:function(){return this.get("type")===n.STRING},isMeasure:function(){return"measure"===this.get("kind")},isLevel:function(){return"level"===this.get("kind")},isDefaultCategorizer:function(){return this.get("categorizer")===this.defaultCategorizer()},defaultCategorizer:function(){return this.isDateTime()?this.isTime()?"minute":"day":void 0},toQueryMultiaxisAxisItem:function(){var e;if(this.isMeasure())e={aggregations:{}};else{if(!this.isLevel())throw new Error("Unknown kind: "+this.get("kind"));e={level:i.pick(this.attributes,"id","includeAll","dimension")},e.level.field=this.get("hierarchicalName"),this.isDateTime()&&(e.level.categorizer=this.get("categorizer"))}return e}});return u});