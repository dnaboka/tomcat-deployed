define(["require","underscore","backbone","../enum/QueryVariableTypes"],function(e){"use strict";function t(e,t){var n=t;return""===t&&"string"!==e?n=null:"~NULL~"===t&&(n=null),n}function n(e,t){return s.reduce(e,function(e,t){if(!e[t.name]){var n=t.expression.object.list?t.expression.object.list.items[0]:t.expression.object;n?e[t.name]=s.keys(n)[0]:e[t.name]="string"}return e},t||{})}function r(e,t){var n={};return null===t?n.NULL={}:e!==u.DATE&&e!==u.TIMESTAMP||!a.test(t)?e===u.TIMESTAMP?n[e]={value:t.replace("T"," ")}:n[e]={value:t}:e===u.DATE?n.relativeDateRange={value:t}:n.relativeTimestampRange={value:t},n}var s=e("underscore"),i=e("backbone"),u=e("../enum/QueryVariableTypes"),a=/^(DAY|WEEK|MONTH|QUARTER|SEMI|YEAR)([\+|-][\d]{1,9})?$/,o=i.Model.extend({initialize:function(e,t){this._types={},this._singular={}},toJSON:function(){var e=this;return s.map(this.attributes,function(t,n){var i={name:n};return e._singular[n]?i.expression={object:r(e._types[n],t)}:i.expression={object:{list:{items:s.map(t,s.bind(r,e,e._types[n]))}}},i})},acquire:function(e,t){var r=this,i={},u=s.reduce(t,function(e,t){return s.reduce(t.variables,function(e,t){return e[t.name]=t.type,e},e)},{});this._types=n(e,u),this._singular=s.reduce(e,function(e,t){return e[t.name]=!t.expression.object.list,e},{}),s.each(e,function(e){i[e.name]=r._determinateParameterValue(e)}),this.set(i)},set:function(){var e,n,r=this;return arguments.length>1&&s.isString(arguments[0])?(e={},e[arguments[0]]=arguments[1],n=arguments[2]):(e=arguments[0],n=arguments[1]),e=s.reduce(s.keys(e),function(n,i){return r._singular[i]?s.isArray(e[i])?e[i].length?n[i]=t(r._types[i],e[i][0]):n[i]=null:n[i]=t(r._types[i],e[i]):n[i]=s.map(e[i],s.bind(t,r,r._types[i])),n},{}),i.Model.prototype.set.call(this,e,n)},toDataComponent:function(){var e=this._types;return s.map(s.keys(this.attributes),function(t){return{id:t,type:e[t]}})},_determinateParameterValue:function(e){return e.expression.object.list?e.expression.object.list.items.length?s.map(e.expression.object.list.items,function(e){return s.values(e)[0].value}):[]:s.values(e.expression.object)[0].value}});return o});