define(["require","underscore","moment","momentTimezone","./formatsMappingUtil","./dateFormatter","bundle!AdHocBundle","jrs.configs"],function(e){function t(e){return parseInt(r(e).format("HH"))>=12?"\u4e0b\u5348":"\u4e0a\u5348"}function r(e){return n(e).locale(u.userLocale).tz(u.userTimezone)}function o(e){return/T/.test(e)?e:"1970-01-01T"+e}var n=(e("underscore"),e("moment")),a=(e("momentTimezone"),e("./formatsMappingUtil")),m=e("./dateFormatter"),u=(e("bundle!AdHocBundle"),e("jrs.configs"));return{format:function(e,n,i){return a.isNullOrEmpty(e)?"":a.isOtherNode(e)?e:a.shouldBeFormattedByDateFormatter(i)?m.format(e,n,i):a.shouldBeReturnedAsLocalazedDayOfWeek(i)?a.getLocalizedDayOfWeek(e):(n=a.getFormatForMoment(n,i),n?(/^zh/.test(u.userLocale)&&(n=n.replace("A",t(o(e)))),e=i&&i.ignoreTimezone?a.setToUserTimezone(e):a.ensureTimezone(e),r(o(e)).format(n)):e)}}});