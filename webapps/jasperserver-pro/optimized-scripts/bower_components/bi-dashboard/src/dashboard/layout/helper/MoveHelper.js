define(["require","jquery","underscore","dashboard/dashboardSettings","./BasicHelper"],function(t){"use strict";var e=t("jquery"),a=t("underscore"),s=t("dashboard/dashboardSettings"),r=t("./BasicHelper");return r.extend({elements:"> .content > .body > ["+s.COMPONENT_ID_ATTRIBUTE+"]:not(.inputControlWrapper)",init:function(t){this.container=t,this.mouseEnter=a.bind(this.mouseEnter,this),this.mouseLeave=a.bind(this.mouseLeave,this),this.container.on("mouseenter",this.elements,this.mouseEnter),this.container.on("mouseleave",this.elements,this.mouseLeave)},mouseEnter:function(t){var r=e(t.target).parents("["+s.COMPONENT_ID_ATTRIBUTE+"]");r.parents(".ui-dropping").length||r.hasClass("inputControlWrapper")||r.draggable({cursor:"move",appendTo:this.container.parent(),cursorAt:{top:0,left:0},zIndex:100,distance:10,start:a.bind(this.dashletDragStart,this),stop:a.bind(this.dashletDragStop,this),drag:a.bind(this.dashletDrag,this)})},mouseLeave:function(t){var a=e(t.target);if(a.hasClass("ui-draggable")||(a=a.parents("["+s.COMPONENT_ID_ATTRIBUTE+"]")),!a.hasClass("ui-draggable-dragging"))try{a.draggable("destroy")}catch(r){}},dashletDragStart:function(t,a){var r=e(t.target),n=r.attr(s.COMPONENT_ID_ATTRIBUTE),o={componentId:n};this.strategy.model.currentFoundation.components.selectComponent(n);try{a.helper.resizable("destroy")}catch(i){}a.helper.attr("class","wrap button draggable dragging dragHelper").attr("style",""),o.dashletEl=a.helper.find("> .dashlet").detach();var h=this.strategy.model.currentFoundation.components.get(n);a.helper.text(h.get("name")).data("data",o),this.strategy.onDashletDragStart.call(this.strategy,o,t)},dashletDrag:function(t,a){var r=e(t.target),n=r.attr(s.COMPONENT_ID_ATTRIBUTE);this.strategy.onDashletDrag.call(this.strategy,{componentId:n},t)},dashletDragStop:function(t,a){var r=e(t.target),n=r.attr(s.COMPONENT_ID_ATTRIBUTE);if(!a.helper.find("> .dashlet").length){var o=this.strategy.model.currentFoundation.components.get(a.helper.data("data").componentId);a.helper.attr("class","").attr("style","").html(a.helper.data("data").dashletEl).css(o.getCssPosition())}this.strategy.onDashletDragStop.call(this.strategy,{componentId:n},t)},drop:function(t,e,a){if(e.helper.data("data")&&e.helper.data("data").componentId&&e.helper.data("data").dashletEl){var s=this.strategy.model.currentFoundation.components.get(e.helper.data("data").componentId);s.unset("x",{silent:!0}),s.unset("y",{silent:!0}),s.unset("width",{silent:!0}),s.unset("height",{silent:!0}),e.helper.attr("class","").attr("style","").html(e.helper.data("data").dashletEl)}},deinit:function(){this.container.off("mouseenter",this.elements,this.mouseEnter),this.container.off("mouseleave",this.elements,this.mouseLeave)}})});