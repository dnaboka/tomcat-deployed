define(["require","exports","module","underscore","bi/report/jive/enum/hyperlinkTargets"],function(e,n,t){"use strict";function r(e,n){return u.find(o(i(e)),function(e){return e.name===n})}function a(e,n,t){var r,a=e.indexOf("?"),u=e.indexOf("#"),s=l(c(o(i(e)),n,t));return r=-1===a?-1===u?e.concat("?",s):e.slice(0,u).concat("?",s,e.slice(u)):-1===u?e.slice(0,a+1).concat(s):e.slice(0,a+1).concat(s,e.slice(u))}function i(e){var n,t,r="";return(n=e.indexOf("?"))>=0&&(r=(t=e.indexOf("#"))>=n?e.substring(n+1,t):e.substring(n+1)),r}function o(e){return e?u.compact(u.map(e.split("&"),function(e){if(e){var n=e.split("=");return{name:n[0],value:n[1]}}})):[]}function l(e){return u.map(e,function(e){return u.isUndefined(e.value)?e.name:e.name.concat("=",e.value)}).join("&")}function c(e,n,t){for(var r=0;r<e.length;r++)if(e[r].name===n)return e[r].value=t,e;return e.push({name:n,value:t}),e}var u=e("underscore"),s=e("bi/report/jive/enum/hyperlinkTargets");return{events:{click:function(e,n,t){if(t.model.get("exposeOutputsToFilterManager")&&n.parameters)if(t.model.get("dashletHyperlinkUrl"))try{t.model.collection.disableParametersStateStack(),t.notify(n.parameters),t.model.collection.enableParametersStateStack()}catch(i){throw t.model.collection.enableParametersStateStack(),i}else t.notify(n.parameters);t.model.get("dashletHyperlinkUrl")&&t.model.get("dashletHyperlinkTarget")&&t.model.getLinkUrl(t.model.paramsModel.attributes).done(function(e){var n=r(window.location.href,"_ddHyperlink");n=n&&+n.value?+n.value:0,e=a(e,"_ddHyperlink",n+1),t.model.get("dashletHyperlinkTarget")===s.BLANK&&(e=a(e,"noReturn",!0)),t.model.get("dashletHyperlinkTarget")===s.SELF?window.location.href=e:window.open(e)}).fail(function(e){t.showErrorDialog(e)})}}}});