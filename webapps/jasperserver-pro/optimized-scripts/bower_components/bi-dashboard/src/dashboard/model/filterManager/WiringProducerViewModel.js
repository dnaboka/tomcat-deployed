define(["require","backbone.epoxy","underscore","bundle!DashboardBundle","common/util/i18nMessage","./../DashboardWiringModel","./WiringConsumerViewModel","backbone.validation","../../enum/dashboardComponentTypes","../../collection/filterManager/WiringConsumerViewModelCollection"],function(e){"use strict";var n=e("backbone.epoxy"),o=e("underscore"),t=e("bundle!DashboardBundle"),r=e("common/util/i18nMessage").extend({bundle:t}),i=(e("./../DashboardWiringModel"),e("./WiringConsumerViewModel")),a=e("backbone.validation"),d=e("../../enum/dashboardComponentTypes"),m=e("../../collection/filterManager/WiringConsumerViewModelCollection"),l=n.Model.extend(o.extend({},a.mixin,{defaults:{id:void 0,name:void 0,parameter:void 0,parameterPublicName:void 0,label:void 0},validation:{name:[{required:!0,msg:new r("dashboard.filterManager.error.parameter.name.required")},{fn:function(e,n,t){return o.isUndefined(t.id)?this.collection.find(function(n){return n.get("name")==e&&n.get("id")!==t.id}):void 0},msg:new r("dashboard.filterManager.error.parameter.name.duplication")}]},initialize:function(e,n){n||(n={}),this.consumers=n.consumers||new m([]),this.component=n.component},isValid:function(e){return a.mixin.isValid.call(this,e)&&this.consumers.isValid(e)},setGroupRelatedProperties:function(){this.set({isFirstItemInGroup:this.collection.findWhere({group:this.get("group")})===this,itemsInGroup:this.collection.where({group:this.get("group")}).length})}}),{createFromDashboardWiringModel:function(e,n){var r,a=new m,s=e.get("producer"),c=e.get("producer"),u=e.component.get("outputParameters");if(u&&o.isArray(u)){var p=o.findWhere(u,{id:e.get("name")});o.isUndefined(p)||(s=p.label)}else e.component.get("type")===d.VALUE?(s=e.component.id,c=e.component.id):e.component.get("type")===d.INPUT_CONTROL&&(s=e.component.get("name"),c=e.component.id);return a.add(e.consumers.map(function(e){var o=e.get("consumer").split(":"),t=n.get(o[0]);return new i({id:o[0],parameter:o[1],name:t.get("name")},{component:t,collection:a})})),r=e.component.get("type")===d.INPUT_CONTROL?e.component.getParent()?e.component.getParent().get("name"):t["dashboard.component.filter.group.component.name"]||"Filter Group":e.component.get("type")===d.VALUE?t["dashboard.filter.manager.manually.created.filters"]||"Manually Created Filters":e.component.get("name"),new l({id:e.get("producer"),name:e.get("producer"),parameter:e.get("name"),parameterPublicName:c,label:s,group:r},{component:e.component,consumers:a})}});return l});