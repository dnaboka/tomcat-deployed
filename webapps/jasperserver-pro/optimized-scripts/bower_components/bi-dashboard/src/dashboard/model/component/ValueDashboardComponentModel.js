define(["require","exports","module","./DashboardComponentModel","../../enum/dashboardComponentTypes","dashboard/dashboardSettings","bundle!DashboardBundle","underscore"],function(e,t,i){"use strict";function s(e){this._ignoreValueChange=!0,this._deferValue()?this._deferredValue={value:this._default,index:-1}:(this._current=-1,this.set("value",this._default,e),this._ignoreValueChange=!1)}var a=e("./DashboardComponentModel"),n=e("../../enum/dashboardComponentTypes"),r=(e("dashboard/dashboardSettings"),e("bundle!DashboardBundle")),u=e("underscore");return a.extend({componentName:r["dashboard.component.value.component.name"],defaults:u.extend({},a.prototype.defaults,{type:n.VALUE,value:void 0}),initialize:function(e,t){a.prototype.initialize.apply(this,arguments),this._values=[],this._current=-1,this.on("change:value",function(){this._ignoreValueChange||(this._changed=!0,this.notify())},this),this.initializeSpecific(e,t)},initializeSpecific:function(e,t){this.on("change:name",function(){this.set("label",this.get("name"),{silent:!0})},this),this.set("label",this.get("name"),{silent:!0})},isVisible:function(){return!1},isValueProducer:function(){return!0},notify:function(){this.trigger(this.get("id"),this.get("value"))},acceptWiringVisitor:function(e){e.register(this,{signals:[this.get("id")],slots:{}}),this.notify()},applyDeferredValue:function(){if(this.isValueDeferred()&&(this._current=this._deferredValue.index,this.set("value",this._deferredValue.value),this._deferredValue=void 0,this._ignoreValueChange=!1,this.trigger("parametersState:deferredValueApplied",this)),this._isValueApplying){var e={};e[this.id]=this._deferredExternalValue,this.acquireValue(e)}},prepareForAcquire:function(){},acquireValue:function(){},canPopValue:function(e){return this._current+e>=-1&&this._current+e<this._values.length},isValueDeferred:function(){return!u.isUndefined(this._deferredValue)},pushParametersState:function(){a.prototype.pushParametersState.call(this),this._current<this._values.length-1&&(this._values=this._values.slice(0,this._current+1)),this._values.push(this._changed?u.cloneDeep(this.get("value")):this._values[this._values.length-1]||this._default),this._current=this._values.length-1,this._changed=!1},popParametersState:function(e){a.prototype.popParametersState.call(this,e),this.canPopValue(e)&&(this._current+e===-1?s.call(this):(this._ignoreValueChange=!0,this._deferValue()?this._deferredValue={value:this._values[this._current+e],index:this._current+e}:(this._current+=e,this.set("value",this._values[this._current]),this._ignoreValueChange=!1)))},resetParametersState:function(e){a.prototype.resetParametersState.call(this),s.call(this,e)},setCurrentParametersStateAsDefault:function(e){a.prototype.setCurrentParametersStateAsDefault.call(this,e),this._default=u.cloneDeep(e||this.get("value"))},_deferValue:function(){return!1}})});