define(["require","backbone","underscore","bi/repository/model/RepositoryResourceModel","./RepositoryJsonFileModel","./RepositoryComponentsFileModel","./RepositoryHtmlFileModel","../enum/dashboardResourceReferenceTypes","../enum/dashboardResourceTypes","bi/repository/enum/repositoryResourceTypes","../dashboardSettings"],function(e){"use strict";function r(e){n.FILE in e?(this.resourceReferenceType=n.FILE,this.get("type")===T.COMPONENTS?this.resource=new i(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH}):this.get("type")===T.LAYOUT?this.resource=new u(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH}):this.resource=new c(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH})):n.ADHOC_VIEW in e?(this.resourceReferenceType=n.ADHOC_VIEW,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.ADHOC_DATA_VIEW})):n.REPORT in e?(this.resourceReferenceType=n.REPORT,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.REPORT_UNIT})):n.INPUT_CONTROL in e?(this.resourceReferenceType=n.INPUT_CONTROL,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.INPUT_CONTROL})):n.RESOURCE_REFERENCE in e&&(this.resourceReferenceType=n.RESOURCE_REFERENCE,this.resource=new t(e[this.resourceReferenceType],{contextPath:p.CONTEXT_PATH,type:R.RESOURCE_LOOKUP}))}var o=e("backbone"),s=e("underscore"),t=e("bi/repository/model/RepositoryResourceModel"),c=e("./RepositoryJsonFileModel"),i=e("./RepositoryComponentsFileModel"),u=e("./RepositoryHtmlFileModel"),n=e("../enum/dashboardResourceReferenceTypes"),T=e("../enum/dashboardResourceTypes"),R=e("bi/repository/enum/repositoryResourceTypes"),p=e("../dashboardSettings"),h=o.Model.extend({idAttribute:"name",defaults:{name:void 0,type:void 0,resource:void 0},initialize:function(){this.updateResource(),this.on("change:resource",this.updateResource)},updateResource:function(){var e=this.get("resource");e&&s.isObject(e)&&(this.resource&&this.resourceReferenceType in e?this.resource.set(e[this.resourceReferenceType]):r.call(this,e))},toJSON:function(e){var r=o.Model.prototype.toJSON.apply(this,arguments);return r.resource={},this.resourceReferenceType!==n.FILE?this.resource.isNew()||e===!0?r.resource[this.resourceReferenceType]=this.resource.toJSON():r.resource[n.RESOURCE_REFERENCE]={uri:this.resource.get("uri")}:(r.resource[n.FILE]=this.resource.toJSON(),delete r.resource[n.FILE].version,delete r.resource[n.FILE].uri,delete r.resource[n.FILE].permissionMask,delete r.resource[n.FILE].creationDate,delete r.resource[n.FILE].updateDate),r}});return h.createDashboardResource=function(e,r){var o={};return e.resourceType===R.ADHOC_DATA_VIEW?o[n.ADHOC_VIEW]=e:e.resourceType===R.REPORT_UNIT?o[n.REPORT]=e:e.resourceType===R.INPUT_CONTROL&&(o[n.INPUT_CONTROL]=e),new this({resource:o,type:e.resourceType,name:e.uri},{contextPath:r})},h});