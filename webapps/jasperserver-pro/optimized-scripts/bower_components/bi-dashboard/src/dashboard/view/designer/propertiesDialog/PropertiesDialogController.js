define(["require","underscore","bundle!CommonBundle","common/util/classUtil","dashboard/dashboardSettings","./view/PropertiesDialogView","dashboard/factory/propertiesTitleFactory","common/component/dialog/Dialog","../../../dashboardMessageBus","../../../enum/dashboardMessageBusEvents","dashboard/enum/dashboardComponentTypes"],function(t){"use strict";var o=t("underscore"),e=t("bundle!CommonBundle"),i=t("common/util/classUtil"),n=(t("dashboard/dashboardSettings"),t("./view/PropertiesDialogView")),a=t("dashboard/factory/propertiesTitleFactory"),s=t("common/component/dialog/Dialog"),l=t("../../../dashboardMessageBus"),r=t("../../../enum/dashboardMessageBusEvents"),d=t("dashboard/enum/dashboardComponentTypes"),c=s.extend({events:o.extend({"mousedown .header.mover, .subcontainer, .footer":"_onPropertiesDialogSelect"},s.prototype.events),open:function(){this.content.openTab("basic"),this.content.model.set(this.content.original.clone().attributes),this.content.originalState.set(this.content.original.clone().attributes),s.prototype.open.apply(this,arguments),this.content.model.validate()},_onPropertiesDialogSelect:function(){this.trigger("properties:dialog:select",this)}}),g=function(t){var o="dashboardLevelPropertiesDialog "+t.get("type")+"Dialog";return t.get("type")!==d.DASHBOARD_PROPERTIES&&(o+=" dashletLevelPropertiesDialog"),o};return i.extend({constructor:function(t){this.dialog=new c({model:t,additionalCssClasses:g(t),title:a(t),content:new n({model:t}),buttons:[{label:e["button.apply"],action:"apply",primary:!0},{label:e["button.ok"],action:"ok",primary:!1},{label:e["button.cancel"],action:"cancel",primary:!1}]}),this.initialize()},initialize:function(){this._initEvents(),this.dialogIsOpened=!1},onDialogApply:function(){var t=this;this.dialog.content.hyperlinkParametersSectionView&&this.dialog.content.hyperlinkParametersSectionView.isEditing?this.dialog.content.hyperlinkParametersSectionView.confirmAbort(function(){t.applyModel()}):this.applyModel()},onDialogOk:function(){var t=this;this.dialog.content.hyperlinkParametersSectionView&&this.dialog.content.hyperlinkParametersSectionView.isEditing?this.dialog.content.hyperlinkParametersSectionView.confirmAbort(function(){t.applyModel()&&(t.saveModel(),s.prototype.close.apply(t.dialog,arguments))}):this.applyModel()&&(this.saveModel(),s.prototype.close.apply(this.dialog,arguments))},onDialogCancel:function(){this.dialog.content.hyperlinkParametersSectionView&&this.dialog.content.hyperlinkParametersSectionView.resetState(),this.rollbackModel(),s.prototype.close.apply(this.dialog,arguments)},saveModel:function(){var t=this.dialog.content.originalState;o.isEqual(this.dialog.content.original.attributes,this.dialog.content.originalState.attributes)||(t.set(this.dialog.content.original.toJSON()),l.trigger(r.SAVE_DASHBOARD_STATE))},applyModel:function(){return this.dialog.content.model.isValid(!0)?(this.dialog.content.original&&this.dialog.content.original.set(this.dialog.content.model.attributes),!0):!1},rollbackModel:function(t){var t=t||{},o=this.dialog.content.original,e=this.dialog.content.originalState,i=e.toJSON();t.silent?o.set(i,{silent:!0}):o.set(i)},toggleDialogStateProps:function(t){this[t]?this[t]=!1:this[t]=!0},_initEvents:function(){var t=this;this.dialog.on("open",function(){t.toggleDialogStateProps("dialogIsOpened")}),this.dialog.on("close",function(){t.toggleDialogStateProps("dialogIsOpened"),t.dialog.content.trigger("close")}),this.dialog.on("button:cancel",o.bind(this.onDialogCancel,this)),this.dialog.on("button:apply",o.bind(this.onDialogApply,this)),this.dialog.on("button:ok",o.bind(this.onDialogOk,this)),this.dialog.listenTo(this.dialog.content,"saveAndGoToFilterManager",function(){t.onDialogOk(),l.trigger(r.OPEN_FILTER_MANAGER)})},remove:function(){this.dialog.content.remove(),this.dialog.off("button:cancel"),this.dialog.off("button:apply"),this.dialog.off("button:ok"),this.dialog.off("open"),this.dialog.off("close"),this.dialog.remove()}})});