define(["require","underscore","dashboard/factory/addDashboardComponentDialogTitleFactory","dashboard/factory/addDashboardComponentDialogTemplateFactory","dashboard/view/mixin/parameterExpressionAutocompletionMixin","bi/repository/enum/repositoryResourceTypes","common/component/dialog/Dialog","common/view/ViewWithEpoxy","bi/repository/dialog/resourceChooser/RepositoryChooserDialogFactory","text!dashboard/template/tooltip/sideBarTreeLeafTooltipTemplate.htm","bundle!DashboardBundle","bundle!CommonBundle"],function(o){"use strict";function e(o,e){var t=this;this.model=o,e&&e.overElement&&(this.lastHighestIndex=n.highestIndex,n.highestIndex=parseInt(e.overElement.css("zIndex"))+1),this.dialog=new n({modal:!0,model:o,additionalCssClasses:"addDashboardComponentDialog",title:i(o),content:new u({template:r(o),model:o,i18n:h}),buttons:[{label:c[e&&e.okButtonLabel?e.okButtonLabel:"button.ok"],action:"ok",primary:!0,triggerOnKeyCode:13},{label:c["button.cancel"],action:"cancel",primary:!1,triggerOnKeyCode:27}]}),this.dialog.listenTo(o,"validated:valid",function(){this.enableButton("ok")}),this.dialog.listenTo(o,"validated:invalid",function(){this.disableButton("ok")}),this.dialog.listenTo(o,"change",function(){o.isValid(!0)}),this.dialog.on("close",function(){t.dialog.content.trigger("close")}),this.dialog.on("dialog:visible",function(){var o=this.$el.find("input"),e=o.val();o.focus().val("").val(e)}),e&&e.okButtonDisabled&&this.dialog.disableButton("ok")}var t=o("underscore"),i=o("dashboard/factory/addDashboardComponentDialogTitleFactory"),r=o("dashboard/factory/addDashboardComponentDialogTemplateFactory"),s=o("dashboard/view/mixin/parameterExpressionAutocompletionMixin"),a=o("bi/repository/enum/repositoryResourceTypes"),n=o("common/component/dialog/Dialog"),l=o("common/view/ViewWithEpoxy"),d=o("bi/repository/dialog/resourceChooser/RepositoryChooserDialogFactory"),p=o("text!dashboard/template/tooltip/sideBarTreeLeafTooltipTemplate.htm"),h=o("bundle!DashboardBundle"),c=o("bundle!CommonBundle"),u=l.extend({events:t.extend({},l.prototype.events,{"click .showRepositoryChooserDialog":"showDialog"}),render:function(){var o=l.prototype.render.apply(this,arguments);return this.applyParameterExpressionAutocompletionMixin(),o},showDialog:function(){if(!this.repositoryChooserDialog){var o=d.getDialog("item"),e=[".pdf",".docx",".html",".ods",".odt",".csv",".pptx",".rtf",".xls",".xlsx",".svg",".xml",".jar",".jrxml",".cur",".jrtx",".properties",".css",".eot",".ttf",".woff"];this.repositoryChooserDialog=new o({resourcesTypeToSelect:["img"],resourcesTypeToSelectTree:["file"],title:h["dashboard.dialog.properties.repository.chooser.title"],tooltipTemplate:p,tooltipi18n:c,cssClassItemProcessor:function(o){return o.value.resourceType!==a.FILE||t.find(e,function(e){return o.value.label.toLowerCase().endsWith(e)})||(o.cssClass="dashboard-newContent-image"),o}}),this.listenTo(this.repositoryChooserDialog,"close",function(){if(this.repositoryChooserDialog.selectedResource&&this.repositoryChooserDialog.selectedResource.resourceUri){var o={url:"repo:"+this.repositoryChooserDialog.selectedResource.resourceUri};this.model.set(o),this.model.validate(o)}},this)}this.repositoryChooserDialog.open()},remove:function(){return this.repositoryChooserDialog&&this.repositoryChooserDialog.remove(),l.prototype.remove.apply(this,arguments)}});return t.extend(u.prototype,s),e.prototype.remove=function(){this.dialog.off("dialog:visible"),this.dialog.remove()},e.prototype.closeAndRemove=function(){n.resetHighestIndex(this.lastHighestIndex),this.dialog.close(),this.remove()},e});