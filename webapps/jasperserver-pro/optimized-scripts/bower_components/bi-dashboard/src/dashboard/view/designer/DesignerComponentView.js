define(["require","exports","module","backbone","../base/ComponentView","dashboard/dashboardMessageBus","dashboard/enum/dashboardMessageBusEvents","dashboard/dashboardSettings","dashboard/factory/sandboxFactory","dashboard/view/designer/ParameterMenu","dashboard/view/designer/propertiesDialog/PropertiesDialogController","dashboard/enum/dashboardComponentTypes","common/component/menu/ContextMenu","underscore","jquery","bundle!DashboardBundle"],function(e,o,t){"use strict";var n=e("backbone"),i=e("../base/ComponentView"),s=e("dashboard/dashboardMessageBus"),r=e("dashboard/enum/dashboardMessageBusEvents"),a=(e("dashboard/dashboardSettings"),e("dashboard/factory/sandboxFactory")),d=e("dashboard/view/designer/ParameterMenu"),l=e("dashboard/view/designer/propertiesDialog/PropertiesDialogController"),p=e("dashboard/enum/dashboardComponentTypes"),h=e("common/component/menu/ContextMenu"),c=e("underscore"),g=e("jquery"),u=e("bundle!DashboardBundle");return i.extend({events:c.extend({},i.prototype.events,{click:"_selectComponent",dblclick:"_showPropertiesDialog",contextmenu:"_showContextMenu"}),initialize:function(){i.prototype.initialize.apply(this,arguments),this._initContextMenu(),this.model.get("type")!==p.FILTER_GROUP&&this.addOverlay(),this.on("componentRendered",c.bind(this._onComponentRendered,this)),this.listenTo(this.model,"change:selected",this._onComponentSelect),this.listenTo(s,r.TOGGLE_PREVIEW_MODE,c.bind(this._onTogglePreviewMode,this)),this.listenTo(this.dashboardProperties,"change",this._onDashboardPropertiesChange)},remove:function(){this.propertiesDialogController&&this.propertiesDialogController.remove(),i.prototype.remove.apply(this,arguments)},_initContextMenu:function(){var e=[{label:u["dashboard.context.menu.option.properties"],action:"properties"},{label:u["dashboard.context.menu.option.delete"],action:"delete"}];this.additionalContextMenuOptions&&(e=e.concat(this.additionalContextMenuOptions)),this.contextMenu=new h(e),this.listenTo(this.contextMenu,"option:properties",this._showPropertiesDialog),this.listenTo(this.contextMenu,"option:delete",this._deleteComponent),this._initComponentSpecificContextMenuEvents&&this._initComponentSpecificContextMenuEvents()},_onTogglePreviewMode:function(e){if(this.propertiesDialogController&&this.propertiesDialogController.dialog){var o=this.propertiesDialogController.dialog,t=this.propertiesDialogController.lastCoordinates;this.propertiesDialogController.dialogIsOpened&&!e?o.open(c.extend({silent:!0},t)):o.close({silent:!0})}},_onComponentRendered:function(){},_onComponentSelect:function(){this.model.get("selected")?this.$el.addClass("selected"):(this.$el.removeClass("selected"),this.contextMenu.hide())},_onDashboardPropertiesChange:function(e){},_deleteComponent:function(){this.trigger("delete",this.model)},_selectComponent:function(e){e&&e.stopPropagation&&e.stopPropagation(),this.model&&this.model.collection&&this.model.collection.selectComponent(g(e.target).attr("id")||this.model.id)},_showPropertiesDialog:function(e){var o={};if(e instanceof n.View){var t=e.$el.offset();o={top:t.top,left:t.left}}else e.stopPropagation&&e.stopPropagation(),o={top:e.pageY,left:e.pageX};this.contextMenu.hide(),d.useModel(a.get(this.model.dashboardId).get("dashboardModel")),this.propertiesDialogController||(this.propertiesDialogController=new l(this.model),this.listenTo(this.propertiesDialogController.dialog,"properties:dialog:select",this._selectComponent)),this.propertiesDialogController.lastCoordinates=o,this.propertiesDialogController.dialog.open(c.extend({renderContent:!1},o))},_showContextMenu:function(e){e.preventDefault(),this._selectComponent(e),this.contextMenu.show({left:e.pageX,top:e.pageY},this.$el)}})});