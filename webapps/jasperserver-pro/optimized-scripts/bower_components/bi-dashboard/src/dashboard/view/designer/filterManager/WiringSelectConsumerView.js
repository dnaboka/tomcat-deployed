define(["require","underscore","backbone","common/view/ViewWithEpoxy","bundle!DashboardBundle","bundle!CommonBundle","text!../../../template/filterManager/wiringSelectConsumerTemplate.htm","text!../../../template/filterManager/wiringConsumerOptionTemplate.htm"],function(e){"use strict";function t(){var e=a.template(o),t="";return a.isUndefined(this.model.get("id"))&&(t+=e({label:l["dashboard.filter.manager.select.dashlet"],value:void 0,title:void 0})),a.each(this.consumers,function(i){t+=e({label:i.name,value:i.id,title:void 0})}),t}function i(){var e=a.findWhere(this.consumers,{id:this.model.get("id")}),t=a.template(o),i="",r=this,n=[];return this.model.collection.each(function(e){e===r.model||a.isUndefined(e.get("id"))||a.isUndefined(e.get("parameter"))||n.push(e.get("id")+":"+e.get("parameter"))}),(a.isUndefined(this.model.get("parameter"))||e&&!a.contains(a.pluck(e.parameters,"id"),this.model.get("parameter")))&&(i+=t({label:l["dashboard.filter.manager.select.parameter"],value:void 0,title:l["dashboard.filter.manager.select.parameter"]})),e&&a.each(e.parameters,function(e){-1===a.indexOf(n,r.model.get("id")+":"+e.id)&&(i+=t({label:e.label,value:e.id,title:m["tooltip.parameter"]+" "+e.id}))}),i}var a=e("underscore"),r=e("backbone"),n=e("common/view/ViewWithEpoxy"),l=e("bundle!DashboardBundle"),m=e("bundle!CommonBundle"),s=e("text!../../../template/filterManager/wiringSelectConsumerTemplate.htm"),o=e("text!../../../template/filterManager/wiringConsumerOptionTemplate.htm");return n.extend({el:a.template(s,{i18n:a.extend(m,l)}),constructor:function(e){e||(e={}),this.consumers=e.consumers,r.View.apply(this,arguments)},initialize:function(){this.listenTo(this.model,"change:parameter",this.setParameterLabel),this.setParameterLabel(),n.prototype.initialize.apply(this,arguments)},render:function(){return this.$("select[name='id']").html(t.call(this)),this.$("select[name='parameter']").html(i.call(this)),n.prototype.render.apply(this,arguments)},setParameterLabel:function(){var e,t=a.findWhere(this.consumers,{id:this.model.get("id")});t&&(e=a.findWhere(t.parameters,{id:this.model.get("parameter")}),e&&this.model.set("parameterLabel",e.label))}})});