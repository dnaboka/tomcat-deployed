define(["require","common/view/ViewWithEpoxy","./WiringConsumerCollectionView","underscore","bundle!DashboardBundle","bundle!CommonBundle","../../../enum/dashboardComponentTypes","./WiringSelectConsumerView","../../../model/filterManager/WiringConsumerViewModel","./WiringRemoveConsumerView","text!../../../template/filterManager/wiringProducerTemplate.htm"],function(e){"use strict";var o=e("common/view/ViewWithEpoxy"),t=e("./WiringConsumerCollectionView"),n=e("underscore"),i=e("bundle!DashboardBundle"),r=e("bundle!CommonBundle"),m=e("../../../enum/dashboardComponentTypes"),s=e("./WiringSelectConsumerView"),l=e("../../../model/filterManager/WiringConsumerViewModel"),u=e("./WiringRemoveConsumerView"),d=e("text!../../../template/filterManager/wiringProducerTemplate.htm");return o.extend({events:{"blur > .filterColumn > input":"checkNewProducerName","click > .addConsumerColumn > button.add":"addConsumer","click > .removeConsumerColumn > button.delete":"removeProducer"},computeds:{isHidden:function(){return!this.model.component.isVisible()}},constructor:function(e){e.template=d,e.i18n=n.extend(r,i),o.prototype.constructor.call(this,e)},initialize:function(e){var n=this;o.prototype.initialize.call(this,e),this.selectConsumersCollectionView=new t({collection:this.model.consumers,el:this.$(".selectConsumerColumn > .consumerTable > tbody"),modelView:s,modelViewOptions:{consumers:e.consumers}}),this.removeConsumersCollectionView=new t({collection:this.model.consumers,el:this.$(".removeConsumerColumn > .consumerTable > tbody"),modelView:u}),this.listenTo(this.model.consumers,"add remove",this.toggleRemoveProducerButton),this.listenTo(this.model,"change",function(){n.model.isValid(!0)})},render:function(){return o.prototype.render.apply(this,arguments),this.selectConsumersCollectionView.render(),this.removeConsumersCollectionView.render(),this.toggleRemoveProducerButton(),this},checkNewProducerName:function(){if(this.model.isValid(!0)){this.model.component.set("name",this.model.component.generateName(this.model.get("name")));var e=this.model.component.generateId();this.model.component.set("id",e),this.model.set({parameter:e,id:e+":"+e,label:this.model.component.get("name"),parameterPublicName:e})}},removeProducer:function(){this.model.trigger("destroy",this.model,this.model.collection)},addConsumer:function(){this.model.consumers.add(new l({},{collection:this.model.consumers}))},toggleRemoveProducerButton:function(){this.$("> .removeConsumerColumn > button.delete")[this.model.component.get("type")!==m.VALUE||this.model.consumers.length?"hide":"show"]()},remove:function(){this.selectConsumersCollectionView.remove(),this.removeConsumersCollectionView.remove(),o.prototype.remove.apply(this,arguments)}})});