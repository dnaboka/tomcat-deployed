orgModule.orgManager.orgList={LIST_TEMPLATE_ID:"tabular_threeColumn",ITEM_TEMPLATE_ID:"tabular_threeColumn:leaf",ORG_ID_PATTERN:".ID > a",ORG_NAME_PATTERN:".name",ORG_ORGANIZATIONS_PATTERN:".organization",initialize:function(e){orgModule.entityList.initialize({listTemplateId:this.LIST_TEMPLATE_ID,itemTemplateId:this.ITEM_TEMPLATE_ID,toolbarModel:e.toolbarModel,text:e.text}),orgModule.entityList._createEntityItem=function(e){var t=new dynamicList.ListItem({label:e.id,value:e});return t.processTemplate=function(e){var t=orgModule.orgManager.orgList,i=e.select(t.ORG_ID_PATTERN)[0],o=e.select(t.ORG_NAME_PATTERN)[0],r=e.select(t.ORG_ORGANIZATIONS_PATTERN)[0];i.update(xssUtil.escape(this.getValue().id)),o.update(xssUtil.escape(this.getValue().name));var a=this.getValue().subTenantCount;return a=a||0,r.update(xssUtil.escape(orgModule.getMessage("MT_SUB_TENANT_COUNT",{count:a}))),e},t}}},orgModule.orgManager.addDialog={_ADD_ORGANIZATION_ID:"addOrganization",_ADD_BUTTON_ID:"addOrgBtn",_CANCEL_BUTTON_ID:"cancelOrgBtn",_ORG_NAME_ID:"addOrgName",_ORG_ID_ID:"addOrgID",_ORG_ALIAS_ID:"addOrgAlias",_ORG_DESC_ID:"addOrgDesc",_ADD_BUTTON_TITLE_PATTERN:".wrap",initialize:function(){this.addOrganization=$(this._ADD_ORGANIZATION_ID),this.addBtn=$(this._ADD_BUTTON_ID),this.cancelBtn=$(this._CANCEL_BUTTON_ID),this.orgName=$(this._ORG_NAME_ID),this.orgId=$(this._ORG_ID_ID),this.orgAlias=$(this._ORG_ALIAS_ID),this.orgDesc=$(this._ORG_DESC_ID),this.idUnsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantIdNotSupportedSymbols).getRepresentedString(),this.aliasUnsupportedSymbols=this.idUnsupportedSymbols,this.nameUnsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantNameNotSupportedSymbols).getRepresentedString(),this.orgId.regExp=orgModule.orgManager.ID_REG_EXP,this.orgId.regExpForReplacement=orgModule.orgManager.ID_REG_EXP_FOR_REPLACEMENT,this.orgName.regExp=orgModule.orgManager.NAME_REG_EXP,this.orgAlias.regExp=orgModule.orgManager.ALIAS_REG_EXP,this.orgAlias.regExpForReplacement=orgModule.orgManager.ALIAS_REG_EXP_FOR_REPLACEMENT,this.orgId.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantIdNotSupportedSymbols).getRepresentedString(),this.orgName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantNameNotSupportedSymbols).getRepresentedString(),this.orgAlias.unsupportedSymbols=this.orgId.unsupportedSymbols,this.orgId.inputValidator=orgModule.createInputRegExValidator(this.orgId),this.orgName.inputValidator=orgModule.createInputRegExValidator(this.orgName),this.orgAlias.inputValidator=orgModule.createInputRegExValidator(this.orgAlias),this.addOrganization.observe("keyup",function(e){var t=e.element();if([this.orgId,this.orgName,this.orgAlias].include(t)){if(ValidationModule.validate(t.inputValidator),this.orgName==t){var i=this.orgName;[this.orgId,this.orgAlias].each(function(e){e.changedByUser||(e.regExp.test(i.getValue())?e.setValue(i.getValue().replace(e.regExpForReplacement,"_")):e.setValue(i.getValue()))})}else t.changedByUser||(t.changedByUser=t.getValue()!=t.prevValue);e.stop()}}.bindAsEventListener(this)),this.addOrganization.observe("keydown",function(e){var t=e.element();[this.orgId,this.orgAlias].include(t)&&(t.prevValue=t.getValue())}.bindAsEventListener(this))},_clickButtonHandler:function(e){var t=matchAny(e.element(),[layoutModule.BUTTON_PATTERN],!0);if(t==this.addBtn){var i=this,o=function(e){i.addOrganization.stopObserving("click"),orgModule.stopObserving("entity:created",o)};orgModule.observe("entity:created",o),this._doAdd()}else t==this.cancelBtn&&(this.hide(),this.addOrganization.stopObserving("click"))},show:function(e){this.organization=e,[this.orgName,this.orgId,this.orgAlias,this.orgDesc].each(function(e){ValidationModule.hideError(e),e.changedByUser=!1});var t=this.addBtn.select(this._ADD_BUTTON_TITLE_PATTERN)[0];if(t){var i=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addOrgTo",{organizationName:orgModule.truncateOrgName(this.organization.id)}):orgModule.getMessage("addOrg");t.update(i)}this.addBtn.title=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addOrgTo",{organizationName:this.organization.id}):orgModule.getMessage("addOrg"),dialogs.popup.show(this.addOrganization,!0),this.addOrganization.observe("click",this._clickButtonHandler.bindAsEventListener(this));try{this.orgName.focus()}catch(o){}},hide:function(){dialogs.popup.hide(this.addOrganization),this.orgName.setValue(""),this.orgId.setValue(""),this.orgAlias.setValue(""),this.orgDesc.setValue("")},_validate:function(){return ValidationModule.validateLegacy([orgModule.createBlankValidator(this.orgId,"orgIdIsEmpty"),orgModule.createBlankValidator(this.orgName,"orgNameIsEmpty"),orgModule.createBlankValidator(this.orgAlias,"orgAliasIsEmpty"),this.orgId.inputValidator,this.orgName.inputValidator,this.orgAlias.inputValidator,orgModule.createMaxLengthValidator(this.orgDesc,"error.length.description","{0,number,integer}")])},_autoFill:function(){},_doAdd:function(){if(this._validate()){var e=new orgModule.Organization({tenantId:this.orgId.getValue(),tenantName:this.orgName.getValue(),tenantDesc:this.orgDesc.getValue(),tenantAlias:this.orgAlias.getValue()});return this.organization&&!this.organization.isRoot()&&(e.parentId=this.organization.id),this._checkId(e,function(e){this._checkAlias(e,function(e){invokeServerAction(orgModule.ActionMap.CREATE,{entity:e.toJSON()})})}.bind(this)),!0}return!1},_checkId:function(e,t){invokeServerAction(orgModule.ActionMap.EXIST,{entity:e,onExist:function(e){ValidationModule.showError(this.orgId,orgModule.getMessage("orgIdIsAlreadyInUse",{id:e}))}.bind(this),onNotExist:function(){ValidationModule.hideError(this.orgId),Object.isFunction(t)&&t(e)}.bind(this)})},_checkAlias:function(e,t){e.alias.blank()?Object.isFunction(t)&&t(e):invokeOrgAction(orgModule.orgManager.Action.ALIAS_EXIST,{org:e,onExist:function(e){ValidationModule.showError(this.orgAlias,orgModule.getMessage("orgAliasIsAlreadyInUse",{alias:e}))}.bind(this),onNotExist:function(){ValidationModule.hideError(this.orgAlias),Object.isFunction(t)&&t(e)}.bind(this)})}},orgModule.orgManager.properties={NAME_PATTERN:"#orgName",ID_PATTERN:"#orgID",ALIAS_PATTERN:"#orgAlias",DESC_PATTERN:"#orgDesc",MANAGE_USERS_PATTERN:"#manageUsers",MANAGE_ROLES_PATTERN:"#manageRoles",ASSIGNED_USERS_PATTERN:"#assignedUsers",ASSIGNED_ROLES_PATTERN:"#assignedRoles",org:null,initialize:function(e){var t=$(orgModule.properties._id);this.orgName=t.select(this.NAME_PATTERN)[0],this.orgId=t.select(this.ID_PATTERN)[0],this.orgAlias=t.select(this.ALIAS_PATTERN)[0],this.orgDesc=t.select(this.DESC_PATTERN)[0],this.assignedUsers=t.select(this.ASSIGNED_USERS_PATTERN)[0],this.assignedRoles=t.select(this.ASSIGNED_ROLES_PATTERN)[0],this.manageUsers=t.select(this.MANAGE_USERS_PATTERN)[0],this.manageRoles=t.select(this.MANAGE_ROLES_PATTERN)[0],this.orgName.regExp=orgModule.orgManager.NAME_REG_EXP,this.orgAlias.regExp=orgModule.orgManager.ALIAS_REG_EXP,this.orgName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantNameNotSupportedSymbols).getRepresentedString(),this.orgAlias.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.tenantIdNotSupportedSymbols).getRepresentedString(),this.orgName.inputValidator=orgModule.createInputRegExValidator(this.orgName),this.orgAlias.inputValidator=orgModule.createInputRegExValidator(this.orgAlias),this._validators=[orgModule.createBlankValidator(this.orgName,"orgNameIsEmpty"),orgModule.createBlankValidator(this.orgAlias,"orgAliasIsEmpty"),this.orgName.inputValidator,this.orgAlias.inputValidator,orgModule.createMaxLengthValidator(this.orgDesc,"error.length.description","{0,number,integer}")],orgModule.properties.initialize(e._.extend(e,{viewAssignedListTemplateDomId:"list_type_attributes",viewAssignedItemTemplateDomId:"list_type_attributes:role",searchAssigned:!1,attributes:{context:{urlGETTemplate:"rest_v2/attributes?_embedded=permission&includeInherited=true{{#id}}&holder=tenant:/{{id}}{{/id}}&group=custom&excludeGroup=serverSettings",urlPUTTemplate:"rest_v2{{#id}}/organizations/{{id}}{{/id}}/attributes?_embedded=permission"}},showAssigned:!1})),this._initCustomEvents(),orgModule.properties.setProperties=function(e){var t=orgModule.orgManager.properties;t.orgName.setValue(e.name),t.orgId.setValue(e.id),t.orgAlias.setValue(e.alias),t.orgDesc.setValue(e.desc)},orgModule.properties._deleteEntity=function(){invokeClientAction("delete",{entity:this._value,entityEvent:!!orgModule.entityList.getSelectedEntities().length})},orgModule.properties._editEntity=function(){var e=orgModule.orgManager.properties;this.resetValidation([e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN]),this.changeReadonly(!0,[e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN])},orgModule.properties._showEntity=function(){var e=orgModule.orgManager.properties;this.resetValidation([e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN]),this.changeReadonly(!1,[e.NAME_PATTERN,e.ALIAS_PATTERN,e.DESC_PATTERN])},orgModule.properties.validate=function(){var e=orgModule.orgManager.properties,t=e._toOrg(this._value);return ValidationModule.validateLegacy(e._validators)&&(invokeOrgAction("aliasExist",{org:t,onExist:function(t){ValidationModule.showError(e.orgAlias,orgModule.getMessage("orgAliasIsAlreadyInUse",{alias:t}))}.bind(this),onNotExist:function(){ValidationModule.hideError(e.orgAlias),this.save(t)}.bind(this)}),orgModule.properties.attributesFacade)?!0:void 0},orgModule.properties.isChanged=function(){var e=orgModule.orgManager.properties,t=orgModule.properties.attributesFacade.containsUnsavedItems(),i=this._value,o=e._toOrg(this._value);return this.isEditMode&&(t||i.name!=o.name||i.alias!=o.alias||i.desc!=o.desc)},orgModule.properties.save=function(e){var t=orgModule.orgManager.properties,i=t._toOrg(e);invokeServerAction("update",{entityName:this._value.getNameWithTenant(),entity:i,assigned:[],unassigned:[]})},orgModule.properties.cancel=function(){var e=new jQuery.Deferred;return this.setProperties(this._value),this.attributesFacade?this.attributesFacade.cancel():e.resolve()},orgModule.properties.manageUsers=function(){primaryNavModule.navigationPaths.user.params+="&tenantId="+encodeUriParameter(this._value.id),primaryNavModule.navigationOption("user")},orgModule.properties.manageRoles=function(){primaryNavModule.navigationPaths.role.params+="&tenantId="+encodeUriParameter(this._value.id),primaryNavModule.navigationOption("role")}},_initCustomEvents:function(e){var t=(orgModule.orgManager.properties,$(orgModule.properties._id));t.observe("keyup",function(e){var t=e.element();matchAny(t,[this.NAME_PATTERN,this.ALIAS_PATTERN])&&(t.inputValidator&&ValidationModule.validate([t.inputValidator]),e.stop()),orgModule.properties._toggleButton()}.bindAsEventListener(this)),t.observe("click",function(e){var t=e.element();t==this.manageUsers?(orgModule.properties.manageUsers(),e.stop()):t==this.manageRoles&&(orgModule.properties.manageRoles(),e.stop())}.bindAsEventListener(this)),orgModule.properties._toggleButton()},_toOrg:function(e){e=e||{};var t=new orgModule.Organization({tenantName:this.orgName.getValue(),tenantId:this.orgId.getValue(),tenantAlias:this.orgAlias.getValue(),tenantDesc:this.orgDesc.getValue(),tenantUri:e.uri});return e.parentId&&(t.parentId=e.parentId),t},setAssigned:function(e,t){this.assignedUsers.update(e),this.assignedRoles.update(t)}};